"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[785],{2773:(S,m,a)=>{a.d(m,{n:()=>E});var g=a(6146),h=a(3022),r=a(3107);const e=[[["","angorCardFront",""]],[["","angorCardBack",""]],"*",[["","angorCardExpansion",""]]],i=["[angorCardFront]","[angorCardBack]","*","[angorCardExpansion]"];function y(s,v){1&s&&(r.j41(0,"div",0),r.SdG(1),r.k0s(),r.j41(2,"div",1),r.SdG(3,1),r.k0s())}function x(s,v){1&s&&(r.j41(0,"div",2),r.SdG(1,3),r.k0s()),2&s&&r.Y8G("@expandCollapse",void 0)}function w(s,v){if(1&s&&(r.SdG(0,2),r.DNE(1,x,2,1,"div",2)),2&s){const c=r.XpG();r.R7$(),r.vxM(c.expanded?1:-1)}}let E=(()=>{class s{constructor(){this.expanded=!1,this.face="front",this.flippable=!1}get classList(){return{"angor-card-expanded":this.expanded,"angor-card-face-back":this.flippable&&"back"===this.face,"angor-card-face-front":this.flippable&&"front"===this.face,"angor-card-flippable":this.flippable}}ngOnChanges(c){"expanded"in c&&(this.expanded=(0,h.he)(c.expanded.currentValue)),"flippable"in c&&(this.flippable=(0,h.he)(c.flippable.currentValue))}static{this.\u0275fac=function(u){return new(u||s)}}static{this.\u0275cmp=r.VBU({type:s,selectors:[["angor-card"]],hostVars:2,hostBindings:function(u,f){2&u&&r.HbH(f.classList)},inputs:{expanded:"expanded",face:"face",flippable:"flippable"},exportAs:["angorCard"],features:[r.OA$],ngContentSelectors:i,decls:2,vars:2,consts:[[1,"angor-card-front"],[1,"angor-card-back"],[1,"angor-card-expansion"]],template:function(u,f){1&u&&(r.NAR(e),r.DNE(0,y,4,0)(1,w,2,1)),2&u&&(r.vxM(f.flippable?0:-1),r.R7$(),r.vxM(f.flippable?-1:1))},styles:["angor-card{position:relative;display:flex;overflow:hidden;--tw-bg-opacity: 1;background-color:rgba(var(--angor-bg-card-rgb),var(--tw-bg-opacity));border-radius:1rem;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable{border-radius:0;overflow:visible;transform-style:preserve-3d;transition:transform 1s;perspective:600px;background:transparent;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable.angor-card-face-back .angor-card-front{visibility:hidden;opacity:0;transform:rotateY(180deg)}angor-card.angor-card-flippable.angor-card-face-back .angor-card-back{visibility:visible;opacity:1;transform:rotateY(360deg)}angor-card.angor-card-flippable .angor-card-front,angor-card.angor-card-flippable .angor-card-back{display:flex;flex-direction:column;flex:1 1 auto;z-index:10;transition:transform .5s ease-out 0s,visibility 0s ease-in .2s,opacity 0s ease-in .2s;backface-visibility:hidden;--tw-bg-opacity: 1;background-color:rgba(var(--angor-bg-card-rgb),var(--tw-bg-opacity));border-radius:1rem;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable .angor-card-front{position:relative;opacity:1;visibility:visible;transform:rotateY(0);overflow:hidden}angor-card.angor-card-flippable .angor-card-back{position:absolute;inset:0;opacity:0;visibility:hidden;transform:rotateY(180deg);overflow:hidden auto}\n"],encapsulation:2,data:{animation:g.F}})}}return s})()},8166:(S,m,a)=>{a.r(m),a.d(m,{default:()=>D});var g=a(3014),h=a(708),r=a(4460),e=a(3107),i=a(936),y=a(9471),x=a(6071),w=a(3904),E=a(6389),s=a(4375),v=a(8378),c=a(3125),u=a(8078),f=a(5821),A=a(5492),Z=a(2773);function T(d,F){1&d&&(e.j41(0,"div",6)(1,"label",7),e.EFF(2,"Comment (Optional)"),e.k0s(),e.nrm(3,"textarea",17),e.k0s())}function I(d,F){if(1&d&&(e.j41(0,"div",18)(1,"h3",19),e.EFF(2,"Invoice Created:"),e.k0s(),e.j41(3,"p",20),e.EFF(4),e.k0s()()),2&d){const t=e.XpG();e.R7$(4),e.JRh(t.invoice.pr)}}function j(d,F){if(1&d&&(e.j41(0,"div",21)(1,"p",22),e.EFF(2),e.k0s()()),2&d){const t=e.XpG();e.R7$(2),e.JRh(t.error)}}const D=[{path:"",component:(()=>{class d{constructor(){this.formBuilder=(0,e.WQX)(i.ok),this.signerService=(0,e.WQX)(u.A),this.relayService=(0,e.WQX)(c.b),this.utilities=(0,e.WQX)(f.FP),this.payRequest=null,this.invoice={pr:""},this.canZap=!1,this.loading=!1,this.error=""}ngOnInit(){this.initializeForm()}initializeForm(){this.sendZapForm=this.formBuilder.group({lightningAddress:["",[i.k0.required,this.validateLightningAddress]],eventId:[""],amount:["",[i.k0.required,i.k0.min(1)]],comment:[""]})}validateLightningAddress(t){return t.value.includes("@")?null:{invalidFormat:!0}}getCallbackUrl(t){try{if(t.includes("@")){const[o,n]=t.split("@");return`https://${n}/.well-known/lnurlp/${o}`}return t.toLowerCase().startsWith("lnurl")?this.utilities.convertBech32ToText(t).toString():null}catch(o){return console.error("Error generating callback URL:",o),null}}fetchPayRequest(){var t=this;return(0,g.A)(function*(){t.resetState();const o=t.sendZapForm.get("lightningAddress")?.value;if(!o)return void t.setError("Lightning Address is required.");const n=t.getCallbackUrl(o);if(n)try{const l=yield fetch(n);if(!l.ok)throw new Error(`Failed to fetch pay request: ${l.statusText}`);const p=yield l.json();if("ERROR"===p.status)throw new Error(p.reason||"Error fetching the pay request.");t.payRequest=p,t.canZap=!0,t.configureAmountValidators()}catch(l){t.setError(l.message||"Error connecting to the server.")}finally{t.loading=!1}else t.setError("Invalid Lightning Address.")})()}configureAmountValidators(){if(!this.payRequest)return;const t=(this.payRequest.minSendable||1e3)/1e3,o=(this.payRequest.maxSendable||21e6)/1e3,n=this.sendZapForm.get("amount");n?.setValidators([i.k0.required,i.k0.min(t),i.k0.max(o)]),n?.updateValueAndValidity()}onSubmit(){var t=this;return(0,g.A)(function*(){if(t.sendZapForm.invalid)return void t.setError("Please fill out the form correctly.");t.resetState();const{eventId:n,amount:l,comment:p}=t.sendZapForm.value;if(t.payRequest)try{const b=new URL(t.payRequest.callback),C=new URLSearchParams({amount:(1e3*l).toString()});if(p&&t.payRequest.commentAllowed&&C.set("comment",p),n){const $=yield t.createAndSignZapRequest(n,p);C.set("nostr",JSON.stringify($))}const R=yield fetch(`${b.origin}${b.pathname}?${C.toString()}`);if(!R.ok)throw new Error(`Failed to fetch invoice: ${R.statusText}`);const k=yield R.json();if("ERROR"===k.status)throw new Error(k.reason||"Error fetching the invoice.");t.invoice=k}catch(b){t.setError(b.message||"Error processing the zap request.")}finally{t.loading=!1}else t.setError("Pay request is not loaded.")})()}createAndSignZapRequest(t,o){var n=this;return(0,g.A)(function*(){try{const l=n.createZapRequestData(t,o),p=n.signerService.isUsingSecretKey()?(0,A.pC)(l,(0,v.aT)(yield n.signerService.getDecryptedSecretKey())):yield n.signerService.signEventWithExtension(l);if(!p)throw new Error("Signing failed. Signed event is null.");return p}catch(l){throw console.error("Error creating and signing zap request:",l),new Error("Failed to create and sign zap request.")}})()}createZapRequestData(t,o){return{kind:9734,content:o||"",tags:[["e",t],["p",this.payRequest?.nostrPubkey||""],["relays",...this.relayService.getConnectedRelays()]],pubkey:this.signerService.getPublicKey(),created_at:Math.floor(Date.now()/1e3)}}resetState(){this.error="",this.loading=!0,this.invoice={pr:""}}setError(t){this.error=t,this.loading=!1}static{this.\u0275fac=function(o){return new(o||d)}}static{this.\u0275cmp=e.VBU({type:d,selectors:[["app-zap"]],decls:27,vars:6,consts:[[1,"mx-auto","w-full","max-w-5xl","p-6","sm:p-8"],[1,"flex","w-full","max-w-140","m-auto","flex-col","items-start"],[1,"mb-8","flex","flex-col","items-start","p-6","sm:p-8","transition-all","duration-300","w-full","pb-6"],[1,"flex","items-center","justify-center","mb-6","w-full"],[1,"text-2xl","font-semibold","text-center"],[1,"w-full","space-y-4",3,"ngSubmit","formGroup"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-600","mb-1"],[1,"flex","items-center"],["type","text","formControlName","lightningAddress","placeholder","username@domain.com",1,"flex-grow","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["type","button",1,"ml-2","px-4","py-2","text-sm","bg-gray-800","text-white","rounded","hover:bg-gray-700",3,"click"],["type","text","formControlName","eventId","placeholder","Event ID for specific zap",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["type","number","formControlName","amount","placeholder","Amount",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["class","form-group",4,"ngIf"],["type","submit",1,"w-full","py-2","text-sm","font-semibold","bg-gray-800","text-white","rounded","hover:bg-gray-700","disabled:bg-gray-400",3,"disabled"],["class","invoice mt-6 p-4 border rounded-lg bg-gray-50 shadow w-full",4,"ngIf"],["class","error mt-6 p-4 border rounded-lg bg-red-50 shadow w-full",4,"ngIf"],["formControlName","comment","placeholder","Add a comment...","rows","3",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],[1,"invoice","mt-6","p-4","border","rounded-lg","bg-gray-50","shadow","w-full"],[1,"text-lg","font-semibold","text-gray-800"],[1,"text-gray-700","break-words"],[1,"error","mt-6","p-4","border","rounded-lg","bg-red-50","shadow","w-full"],[1,"text-red-600","font-medium"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"angor-card",2)(3,"div",3)(4,"h2",4),e.EFF(5,"Send a Zap"),e.k0s()(),e.j41(6,"form",5),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.j41(7,"div",6)(8,"label",7),e.EFF(9,"Lightning Address"),e.k0s(),e.j41(10,"div",8),e.nrm(11,"input",9),e.j41(12,"button",10),e.bIt("click",function(){return n.fetchPayRequest()}),e.EFF(13," Fetch "),e.k0s()()(),e.j41(14,"div",6)(15,"label",7),e.EFF(16,"Event ID (Optional)"),e.k0s(),e.nrm(17,"input",11),e.k0s(),e.j41(18,"div",6)(19,"label",7),e.EFF(20,"Amount (in Satoshis)"),e.k0s(),e.nrm(21,"input",12),e.k0s(),e.DNE(22,T,4,0,"div",13),e.j41(23,"button",14),e.EFF(24),e.k0s()(),e.DNE(25,I,5,1,"div",15)(26,j,3,1,"div",16),e.k0s()()()),2&o&&(e.R7$(6),e.Y8G("formGroup",n.sendZapForm),e.R7$(16),e.Y8G("ngIf",null==n.payRequest?null:n.payRequest.commentAllowed),e.R7$(),e.Y8G("disabled",n.sendZapForm.invalid||n.loading),e.R7$(),e.SpI(" ",n.loading?"Sending...":"Send Zap"," "),e.R7$(),e.Y8G("ngIf",n.invoice.pr),e.R7$(),e.Y8G("ngIf",n.error))},dependencies:[r.MD,r.bT,x.RG,E.fS,y.Hl,w.m_,s.Ve,h.EE,i.X1,i.qT,i.me,i.Q0,i.BC,i.cb,i.j4,i.JD,Z.n],encapsulation:2})}}return d})()}]}}]);