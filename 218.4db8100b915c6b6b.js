"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[218],{497:(I,b,s)=>{s.d(b,{W:()=>c});var d=s(177),p=s(605),u=s(9969),e=s(4438);let c=(()=>{class i{constructor(){this.displayText="",this.hasStarted=!1,this.days="00",this.hours="00",this.minutes="00",this.seconds="00",this.previousDays="00",this.previousHours="00",this.previousMinutes="00",this.previousSeconds="00"}ngOnInit(){this.subscription=(0,p.Y)(1e3).subscribe(()=>{this.updateTime()}),this.updateTime()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}updateTime(){const t=Math.floor(Date.now()/1e3),o=(this.hasStarted?this.expiryDate:this.startDate)-t;if(t>=this.startDate&&t<this.expiryDate)this.hasStarted=!0,this.displayText="Time Remaining";else{if(!(t<this.startDate))return this.hasStarted=!0,this.displayText="Expired",void(this.days=this.hours=this.minutes=this.seconds="00");this.hasStarted=!1,this.displayText="Starting in"}if(o>0){const y=Math.floor(o/86400),g=Math.floor(o%86400/3600),v=Math.floor(o%3600/60),K=o%60;this.previousDays=this.days,this.previousHours=this.hours,this.previousMinutes=this.minutes,this.previousSeconds=this.seconds,this.days=this.formatTimeUnit(y),this.hours=this.formatTimeUnit(g),this.minutes=this.formatTimeUnit(v),this.seconds=this.formatTimeUnit(K)}else this.days=this.hours=this.minutes=this.seconds="00"}formatTimeUnit(t){return t<10?"0"+t:t.toString()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["countdown-timer"]],inputs:{startDate:"startDate",expiryDate:"expiryDate"},decls:24,vars:11,consts:[[1,"countdown-container"],[1,"time-boxes-container"],[1,"time-box"],[1,"time-value"],[1,"time-label"],[1,"status-tooltip"]],template:function(r,o){1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e.EFF(4),e.k0s(),e.j41(5,"div",4),e.EFF(6,"Days"),e.k0s()(),e.j41(7,"div",2)(8,"div",3),e.EFF(9),e.k0s(),e.j41(10,"div",4),e.EFF(11,"Hours"),e.k0s()(),e.j41(12,"div",2)(13,"div",3),e.EFF(14),e.k0s(),e.j41(15,"div",4),e.EFF(16,"Min"),e.k0s()(),e.j41(17,"div",2)(18,"div",3),e.EFF(19),e.k0s(),e.j41(20,"div",4),e.EFF(21,"Sec"),e.k0s()()(),e.j41(22,"div",5),e.EFF(23),e.k0s()()),2&r&&(e.R7$(3),e.Y8G("@numberChange",o.days!==o.previousDays),e.R7$(),e.JRh(o.days),e.R7$(4),e.Y8G("@numberChange",o.hours!==o.previousHours),e.R7$(),e.JRh(o.hours),e.R7$(4),e.Y8G("@numberChange",o.minutes!==o.previousMinutes),e.R7$(),e.JRh(o.minutes),e.R7$(4),e.Y8G("@numberChange",o.seconds!==o.previousSeconds),e.R7$(),e.JRh(o.seconds),e.R7$(3),e.xc7("color",o.hasStarted?"#ff6e99":"#42f548"),e.R7$(),e.SpI(" ",o.displayText," "))},dependencies:[d.MD],styles:[".countdown-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:.5rem;position:absolute;top:130px;right:30px;transform:translateY(0);width:auto}.time-boxes-container[_ngcontent-%COMP%]{display:flex;gap:.75rem}.time-box[_ngcontent-%COMP%]{background:#ffffff1a;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);border-radius:6px;padding:.5rem;min-width:55px;box-shadow:0 2px 4px #0000001a;text-align:center}.time-value[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;font-family:Monaco,monospace;margin-bottom:.15rem}.time-label[_ngcontent-%COMP%]{font-size:.65rem;text-transform:uppercase;opacity:.8}.status-tooltip[_ngcontent-%COMP%]{position:absolute;bottom:-25px;right:0;background:#000c;color:#fff;padding:4px 8px;border-radius:4px;font-size:.75rem;opacity:0;transition:opacity .2s ease-in-out;pointer-events:none;white-space:nowrap;z-index:10}.countdown-container[_ngcontent-%COMP%]:hover   .status-tooltip[_ngcontent-%COMP%]{opacity:1}@media (max-width: 600px){.countdown-container[_ngcontent-%COMP%]{justify-content:flex-end;margin-top:.25rem;width:auto;transform:translateY(0)}.time-boxes-container[_ngcontent-%COMP%]{gap:.5rem}.time-box[_ngcontent-%COMP%]{padding:.25rem;min-width:45px}.time-value[_ngcontent-%COMP%]{font-size:1rem}.time-label[_ngcontent-%COMP%]{font-size:.55rem}.status-tooltip[_ngcontent-%COMP%]{font-size:.65rem}}"],data:{animation:[(0,u.hZ)("numberChange",[(0,u.kY)(":increment",[(0,u.iF)({transform:"translateY(-100%)",opacity:0}),(0,u.i0)("500ms ease-out",(0,u.iF)({transform:"translateY(0)",opacity:1}))]),(0,u.kY)(":decrement",[(0,u.iF)({transform:"translateY(100%)",opacity:0}),(0,u.i0)("500ms ease-out",(0,u.iF)({transform:"translateY(0)",opacity:1}))])])]}})}}return i})()},8098:(I,b,s)=>{s.d(b,{U:()=>c});var d=s(467),p=s(4412),u=s(4438),e=s(6324);let c=(()=>{class i{constructor(t){this._signerService=t,this.STORAGE_KEY="userBookmarkedProjects",this.bookmarksSubject=new p.t([]),this.bookmarks$=this.bookmarksSubject.asObservable(),this.currentUserPubKey=null,window.addEventListener("storage",r=>{r.key===this.STORAGE_KEY&&this.refreshBookmarksForCurrentUser()})}initializeForCurrentUser(){var t=this;return(0,d.A)(function*(){t.clearBookmarks(),t.currentUserPubKey=yield t._signerService.getPublicKey(),t.currentUserPubKey&&(yield t.loadBookmarksForCurrentUser())})()}clearBookmarks(){this.bookmarksSubject.next([])}loadBookmarksForCurrentUser(){var t=this;return(0,d.A)(function*(){if(!t.currentUserPubKey)return;const o=t.getUserBookmarks()[t.currentUserPubKey]||[];t.bookmarksSubject.next(o)})()}getUserBookmarks(){const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):{}}saveUserBookmarks(t){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}addBookmark(t){var r=this;return(0,d.A)(function*(){if(!r.currentUserPubKey&&(r.currentUserPubKey=yield r._signerService.getPublicKey(),!r.currentUserPubKey))return void console.warn("No public key found for the current user.");const o=r.getUserBookmarks(),y=o[r.currentUserPubKey]||[];y.includes(t)||(y.push(t),o[r.currentUserPubKey]=y,r.saveUserBookmarks(o),r.bookmarksSubject.next(y))})()}removeBookmark(t){var r=this;return(0,d.A)(function*(){if(!r.currentUserPubKey&&(r.currentUserPubKey=yield r._signerService.getPublicKey(),!r.currentUserPubKey))return void console.warn("No public key found for the current user.");const o=r.getUserBookmarks(),g=(o[r.currentUserPubKey]||[]).filter(v=>v!==t);o[r.currentUserPubKey]=g,r.saveUserBookmarks(o),r.bookmarksSubject.next(g)})()}isBookmarked(t){var r=this;return(0,d.A)(function*(){return r.currentUserPubKey||(r.currentUserPubKey=yield r._signerService.getPublicKey(),r.currentUserPubKey)?(r.getUserBookmarks()[r.currentUserPubKey]||[]).includes(t):(console.warn("No public key found for the current user."),!1)})()}getBookmarks(){var t=this;return(0,d.A)(function*(){return t.currentUserPubKey||(t.currentUserPubKey=yield t._signerService.getPublicKey(),t.currentUserPubKey)?t.getUserBookmarks()[t.currentUserPubKey]||[]:(console.warn("No public key found for the current user."),[])})()}removeAllBookmarks(){var t=this;return(0,d.A)(function*(){if(!t.currentUserPubKey&&(t.currentUserPubKey=yield t._signerService.getPublicKey(),!t.currentUserPubKey))return void console.warn("No public key found for the current user.");const r=t.getUserBookmarks();r[t.currentUserPubKey]=[],t.saveUserBookmarks(r),t.bookmarksSubject.next([])})()}refreshBookmarksForCurrentUser(){this.currentUserPubKey&&this.loadBookmarksForCurrentUser()}static{this.\u0275fac=function(r){return new(r||i)(u.KVO(e.A))}}static{this.\u0275prov=u.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},833:(I,b,s)=>{s.d(b,{F:()=>p});var d=s(4438);let p=(()=>{class u{constructor(){this.mainnetLocalStorageKey="mainnetIndexers",this.testnetLocalStorageKey="testnetIndexers",this.mainnetPrimaryIndexerKey="mainnetPrimaryIndexer",this.testnetPrimaryIndexerKey="testnetPrimaryIndexer",this.networkStorageKey="selectedNetwork",this.defaultMainnetIndexer="https://btc.indexer.angor.io/",this.defaultTestnetIndexer="https://tbtc.indexer.angor.io/",this.initializeDefaultIndexers()}initializeDefaultIndexers(){0===this.getIndexers("mainnet").length&&(this.addIndexer(this.defaultMainnetIndexer,"mainnet"),this.setPrimaryIndexer(this.defaultMainnetIndexer,"mainnet")),0===this.getIndexers("testnet").length&&(this.addIndexer(this.defaultTestnetIndexer,"testnet"),this.setPrimaryIndexer(this.defaultTestnetIndexer,"testnet"))}addIndexer(c,i){let l=this.getIndexers(i);l.includes(c)||(l.push(c),this.saveIndexers(l,i))}getIndexers(c){return JSON.parse(localStorage.getItem("mainnet"===c?this.mainnetLocalStorageKey:this.testnetLocalStorageKey)||"[]")}saveIndexers(c,i){localStorage.setItem("mainnet"===i?this.mainnetLocalStorageKey:this.testnetLocalStorageKey,JSON.stringify(c))}setPrimaryIndexer(c,i){this.getIndexers(i).includes(c)&&localStorage.setItem("mainnet"===i?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey,c)}getPrimaryIndexer(c){return localStorage.getItem("mainnet"===c?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey)}removeIndexer(c,i){let l=this.getIndexers(i);const t=l.indexOf(c);-1!==t&&(l.splice(t,1),this.saveIndexers(l,i),c===this.getPrimaryIndexer(i))&&localStorage.removeItem("mainnet"===i?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey)}clearAllIndexers(c){const l="mainnet"===c?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;localStorage.removeItem("mainnet"===c?this.mainnetLocalStorageKey:this.testnetLocalStorageKey),localStorage.removeItem(l)}setNetwork(c){localStorage.setItem(this.networkStorageKey,c)}getNetwork(){return localStorage.getItem(this.networkStorageKey)||"testnet"}static{this.\u0275fac=function(i){return new(i||u)}}static{this.\u0275prov=d.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},8729:(I,b,s)=>{s.d(b,{i:()=>A});var d=s(467),p=s(4412),u=s(7673),e=s(6648),c=s(8810),i=s(4668),l=s(2498),t=s(8141),r=s(6354),o=s(1397),y=s(5558),g=s(9437),v=s(5964),K=s(6649),E=s(9974);const T=(m,S)=>(m.push(S),m);function M(){return(0,E.N)((m,S)=>{(function O(m,S){return(0,E.N)((0,K.S)(m,S,arguments.length>=2,!1,!0))})(T,[])(m).subscribe(S)})}var P=s(4438),B=s(1626),D=s(833),F=s(7291),C=s(5645);let A=(()=>{class m{constructor(n,a,h,f){this.http=n,this.indexerService=a,this.storageService=h,this.subscriptionService=f,this.INITIAL_OFFSET=0,this.LIMIT=50,this.offset=this.INITIAL_OFFSET,this.totalProjects=0,this.totalProjectsFetched=!1,this.projectsSubject=new p.t([]),this.projects$=this.projectsSubject.asObservable().pipe((0,i.t)(1)),this.loadingSubject=new p.t(!1),this.loading$=this.loadingSubject.asObservable(),this.noMoreProjectsSubject=new p.t(!1),this.noMoreProjects$=this.noMoreProjectsSubject.asObservable(),this.projectStatsSubject=new p.t({}),this.projectStats$=this.projectStatsSubject.asObservable().pipe((0,i.t)(1)),this.selectedNetwork=this.indexerService.getNetwork(),console.log("Selected network:",this.selectedNetwork)}fetchProjects(){if(this.loadingSubject.value||this.noMoreProjectsSubject.value)return console.log("Skipping fetch: Already loading or no more projects."),(0,u.of)([]);this.loadingSubject.next(!0);const a=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects?${this.totalProjectsFetched?`offset=${this.offset}&`:""}limit=${this.LIMIT}`;return this.http.get(a,{observe:"response"}).pipe((0,l.L)(3),(0,t.M)(h=>this.handlePaginationResponse(h)),(0,r.T)(h=>h.body||[]),(0,o.Z)(this.filterUniqueProjects.bind(this)),(0,y.n)(this.processNewProjects.bind(this)),(0,g.W)(this.handleError.bind(this)),(0,t.M)(()=>this.loadingSubject.next(!1)))}handlePaginationResponse(n){if(!this.totalProjectsFetched&&n?.headers){const a=n.headers.get("pagination-total");this.totalProjects=a?+a:0,this.totalProjectsFetched=!0,this.offset=Math.max(this.totalProjects-this.LIMIT,0)}}filterUniqueProjects(n){return(0,e.H)(n).pipe((0,v.p)(a=>!this.projectsSubject.value.some(h=>h.projectIdentifier===a.projectIdentifier)),M())}processNewProjects(n){if(!n.length)return this.noMoreProjectsSubject.next(!0),(0,u.of)([]);const a=(0,e.H)(n).pipe((0,o.Z)(f=>(0,e.H)(this.storageService.saveProject(f))),M()),h=(0,e.H)(n).pipe((0,o.Z)(this.fetchProjectDetails.bind(this)),M());return a.pipe((0,y.n)(()=>h),(0,t.M)(this.updateProjectsList.bind(this)))}fetchProjectDetails(n){return(0,e.H)(this.storageService.getProjectStats(n.projectIdentifier)).pipe((0,r.T)(a=>(this.updateProjectStats(n.projectIdentifier,a),n)),(0,g.W)(a=>(console.error(`Error fetching details for project ${n.projectIdentifier}:`,a),(0,u.of)(n))))}updateProjectsList(n){const a=[...this.projectsSubject.value,...n];this.projectsSubject.next(a),this.subscribeToProjectDetails(n.map(h=>h.nostrEventId)),this.offset=Math.max(this.offset-this.LIMIT,0)}updateProjectStats(n,a){this.projectStatsSubject.next({...this.projectStatsSubject.value,[n]:a})}handleError(n){return console.error("Error fetching projects:",n),this.loadingSubject.next(!1),(0,c.$)(()=>new Error("Failed to fetch projects. Please try again later."))}subscribeToProjectsMetadata(n){this.subscriptionService.addSubscriptions([{kinds:[0],authors:n}],h=>{const f=this.parseMetadataEvent(h);this.storageService.saveProfile(h.pubkey,f)})}subscribeToProjectDetails(n){var a=this;this.subscriptionService.addSubscriptions([{kinds:[30078],ids:n}],function(){var f=(0,d.A)(function*(k){try{const U=Array.isArray(k)?k:[k],j=[];for(const R of U){const x=a.parseMetadataEvent(R);yield a.storageService.saveProjectDetails(x),x.nostrPubKey&&!j.includes(x.nostrPubKey)&&j.push(x.nostrPubKey)}j.length>0&&a.subscribeToProjectsMetadata(j)}catch(U){console.error("Error handling project details subscription:",U)}});return function(k){return f.apply(this,arguments)}}())}parseMetadataEvent(n){try{return JSON.parse(n.content)}catch(a){return console.error("Error parsing metadata event:",a),{}}}fetchProjectStats(n){const h=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${n}/stats`;return this.http.get(h).pipe((0,t.M)(f=>this.updateProjectStats(n,f)),(0,g.W)(f=>(console.error(`Error fetching stats for project ${n}:`,f),(0,u.of)({}))))}resetProjects(){this.projectsSubject.next([]),this.noMoreProjectsSubject.next(!1),this.loadingSubject.next(!1),this.projectStatsSubject.next({}),this.offset=this.INITIAL_OFFSET,this.totalProjectsFetched=!1}static{this.\u0275fac=function(a){return new(a||m)(P.KVO(B.Qq),P.KVO(D.F),P.KVO(F.n),P.KVO(C.n))}}static{this.\u0275prov=P.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})()}}]);