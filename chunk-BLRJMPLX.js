import{a as Q,b as ut,f as rs,h as K}from"./chunk-LP5NDBXI.js";function ar(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function cn(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function fr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ar(t.outputLen),ar(t.blockLen)}function ee(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function lr(t,e){cn(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var be=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var ur=t=>t instanceof Uint8Array;var xe=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ht=(t,e)=>t<<32-e|t>>>e,os=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!os)throw new Error("Non little-endian hardware is not supported");function ss(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function le(t){if(typeof t=="string"&&(t=ss(t)),!ur(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function hr(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!ur(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var ne=class{clone(){return this._cloneInto()}},xf={}.toString;function dr(t){let e=r=>t().update(le(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function me(t=32){if(be&&typeof be.getRandomValues=="function")return be.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function is(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Ee=class extends ne{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=xe(this.buffer)}update(e){ee(this);let{view:n,buffer:r,blockLen:o}=this;e=le(e);let s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=xe(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ee(this),lr(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;is(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=xe(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return e.length=o,e.pos=c,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var cs=(t,e,n)=>t&e^~t&n,as=(t,e,n)=>t&e^t&n^e&n,fs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),It=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ut=new Uint32Array(64),an=class extends Ee{constructor(){super(64,32,8,!1),this.A=It[0]|0,this.B=It[1]|0,this.C=It[2]|0,this.D=It[3]|0,this.E=It[4]|0,this.F=It[5]|0,this.G=It[6]|0,this.H=It[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[e,n,r,o,s,i,c,a]}set(e,n,r,o,s,i,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)Ut[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let p=Ut[u-15],y=Ut[u-2],g=ht(p,7)^ht(p,18)^p>>>3,h=ht(y,17)^ht(y,19)^y>>>10;Ut[u]=h+Ut[u-7]+g+Ut[u-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let p=ht(c,6)^ht(c,11)^ht(c,25),y=l+p+cs(c,a,f)+fs[u]+Ut[u]|0,h=(ht(r,2)^ht(r,13)^ht(r,22))+as(r,o,s)|0;l=f,f=a,a=c,c=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,a,f,l)}roundClean(){Ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var ve=dr(()=>new an);var hn={};rs(hn,{bitGet:()=>ys,bitLen:()=>gs,bitMask:()=>ue,bitSet:()=>ws,bytesToHex:()=>Dt,bytesToNumberBE:()=>Y,bytesToNumberLE:()=>_e,concatBytes:()=>At,createHmacDrbg:()=>un,ensureBytes:()=>W,equalBytes:()=>ds,hexToBytes:()=>Wt,hexToNumber:()=>ln,numberToBytesBE:()=>dt,numberToBytesLE:()=>Le,numberToHexUnpadded:()=>yr,numberToVarBytesBE:()=>hs,utf8ToBytes:()=>ps,validateObject:()=>kt});var gr=BigInt(0),Be=BigInt(1),ls=BigInt(2),Ae=t=>t instanceof Uint8Array,us=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Dt(t){if(!Ae(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=us[t[n]];return e}function yr(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function ln(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Wt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Y(t){return ln(Dt(t))}function _e(t){if(!Ae(t))throw new Error("Uint8Array expected");return ln(Dt(Uint8Array.from(t).reverse()))}function dt(t,e){return Wt(t.toString(16).padStart(e*2,"0"))}function Le(t,e){return dt(t,e).reverse()}function hs(t){return Wt(yr(t))}function W(t,e,n){let r;if(typeof e=="string")try{r=Wt(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Ae(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function At(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!Ae(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function ds(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ps(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function gs(t){let e;for(e=0;t>gr;t>>=Be,e+=1);return e}function ys(t,e){return t>>BigInt(e)&Be}var ws=(t,e,n)=>t|(n?Be:gr)<<BigInt(e),ue=t=>(ls<<BigInt(t-1))-Be,fn=t=>new Uint8Array(t),pr=t=>Uint8Array.from(t);function un(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=fn(t),o=fn(t),s=0,i=()=>{r.fill(1),o.fill(0),s=0},c=(...u)=>n(o,r,...u),a=(u=fn())=>{o=c(pr([0]),u),r=c(),u.length!==0&&(o=c(pr([1]),u),r=c())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0,p=[];for(;u<e;){r=c();let y=r.slice();p.push(y),u+=r.length}return At(...p)};return(u,p)=>{i(),a(u);let y;for(;!(y=p(f()));)a();return i(),y}}var bs={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function kt(t,e,n={}){let r=(o,s,i)=>{let c=bs[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);let a=t[o];if(!(i&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(let[o,s]of Object.entries(e))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return t}var Z=BigInt(0),V=BigInt(1),zt=BigInt(2),xs=BigInt(3),dn=BigInt(4),wr=BigInt(5),br=BigInt(8),ms=BigInt(9),Es=BigInt(16);function z(t,e){let n=t%e;return n>=Z?n:e+n}function vs(t,e,n){if(n<=Z||e<Z)throw new Error("Expected power/modulo > 0");if(n===V)return Z;let r=V;for(;e>Z;)e&V&&(r=r*t%n),t=t*t%n,e>>=V;return r}function ot(t,e,n){let r=t;for(;e-- >Z;)r*=r,r%=n;return r}function Se(t,e){if(t===Z||e<=Z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=z(t,e),r=e,o=Z,s=V,i=V,c=Z;for(;n!==Z;){let f=r/n,l=r%n,u=o-i*f,p=s-c*f;r=n,n=l,o=i,s=c,i=u,c=p}if(r!==V)throw new Error("invert: does not exist");return z(o,e)}function Bs(t){let e=(t-V)/zt,n,r,o;for(n=t-V,r=0;n%zt===Z;n/=zt,r++);for(o=zt;o<t&&vs(o,e,t)!==t-V;o++);if(r===1){let i=(t+V)/dn;return function(a,f){let l=a.pow(f,i);if(!a.eql(a.sqr(l),f))throw new Error("Cannot find square root");return l}}let s=(n+V)/zt;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,l=c.pow(c.mul(c.ONE,o),n),u=c.pow(a,s),p=c.pow(a,n);for(;!c.eql(p,c.ONE);){if(c.eql(p,c.ZERO))return c.ZERO;let y=1;for(let h=c.sqr(p);y<f&&!c.eql(h,c.ONE);y++)h=c.sqr(h);let g=c.pow(l,V<<BigInt(f-y-1));l=c.sqr(g),u=c.mul(u,g),p=c.mul(p,l),f=y}return u}}function As(t){if(t%dn===xs){let e=(t+V)/dn;return function(r,o){let s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%br===wr){let e=(t-wr)/br;return function(r,o){let s=r.mul(o,zt),i=r.pow(s,e),c=r.mul(o,i),a=r.mul(r.mul(c,zt),i),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return t%Es,Bs(t)}var _s=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function pn(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=_s.reduce((r,o)=>(r[o]="function",r),e);return kt(t,n)}function Ls(t,e,n){if(n<Z)throw new Error("Expected power > 0");if(n===Z)return t.ONE;if(n===V)return e;let r=t.ONE,o=e;for(;n>Z;)n&V&&(r=t.mul(r,o)),o=t.sqr(o),n>>=V;return r}function Ss(t,e){let n=new Array(e.length),r=e.reduce((s,i,c)=>t.is0(i)?s:(n[c]=s,t.mul(s,i)),t.ONE),o=t.inv(r);return e.reduceRight((s,i,c)=>t.is0(i)?s:(n[c]=t.mul(s,n[c]),t.mul(s,i)),o),n}function gn(t,e){let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function xr(t,e,n=!1,r={}){if(t<=Z)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:o,nByteLength:s}=gn(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=As(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:s,MASK:ue(o),ZERO:Z,ONE:V,create:a=>z(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return Z<=a&&a<t},is0:a=>a===Z,isOdd:a=>(a&V)===V,neg:a=>z(-a,t),eql:(a,f)=>a===f,sqr:a=>z(a*a,t),add:(a,f)=>z(a+f,t),sub:(a,f)=>z(a-f,t),mul:(a,f)=>z(a*f,t),pow:(a,f)=>Ls(c,a,f),div:(a,f)=>z(a*Se(f,t),t),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>Se(a,t),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>Ss(c,a),cmov:(a,f,l)=>l?f:a,toBytes:a=>n?Le(a,s):dt(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return n?_e(a):Y(a)}});return Object.freeze(c)}function mr(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function yn(t){let e=mr(t);return e+Math.ceil(e/2)}function Er(t,e,n=!1){let r=t.length,o=mr(e),s=yn(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);let i=n?Y(t):_e(t),c=z(i,e-V)+V;return n?Le(c,o):dt(c,o)}var Is=BigInt(0),wn=BigInt(1);function vr(t,e){let n=(o,s)=>{let i=s.negate();return o?i:s},r=o=>{let s=Math.ceil(e/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=t.ZERO,c=o;for(;s>Is;)s&wn&&(i=i.add(c)),c=c.double(),s>>=wn;return i},precomputeWindow(o,s){let{windows:i,windowSize:c}=r(s),a=[],f=o,l=f;for(let u=0;u<i;u++){l=f,a.push(l);for(let p=1;p<c;p++)l=l.add(f),a.push(l);f=l.double()}return a},wNAF(o,s,i){let{windows:c,windowSize:a}=r(o),f=t.ZERO,l=t.BASE,u=BigInt(2**o-1),p=2**o,y=BigInt(o);for(let g=0;g<c;g++){let h=g*a,d=Number(i&u);i>>=y,d>a&&(d-=p,i+=wn);let w=h,b=h+Math.abs(d)-1,m=g%2!==0,A=d<0;d===0?l=l.add(n(m,s[w])):f=f.add(n(A,s[b]))}return{p:f,f:l}},wNAFCached(o,s,i,c){let a=o._WINDOW_SIZE||1,f=s.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&s.set(o,c(f))),this.wNAF(a,f,i)}}}function bn(t){return pn(t.Fp),kt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(ut(Q(Q({},gn(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}function Us(t){let e=bn(t);kt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze(Q({},e))}var{bytesToNumberBE:ks,hexToBytes:Os}=hn,Zt={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=Zt;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:ks(r),l:t.subarray(n+2)}},toSig(t){let{Err:e}=Zt,n=typeof t=="string"?Os(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");let{d:o,l:s}=Zt._parseInt(n.subarray(2)),{d:i,l:c}=Zt._parseInt(s);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(t){let e=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{let l=f.toString(16);return l.length&1?`0${l}`:l},r=e(n(t.s)),o=e(n(t.r)),s=r.length/2,i=o.length/2,c=n(s),a=n(i);return`30${n(i+s+4)}02${a}${o}02${c}${r}`}},_t=BigInt(0),ct=BigInt(1),Hf=BigInt(2),Br=BigInt(3),Pf=BigInt(4);function Rs(t){let e=Us(t),{Fp:n}=e,r=e.toBytes||((g,h,d)=>{let w=h.toAffine();return At(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=e.fromBytes||(g=>{let h=g.subarray(1),d=n.fromBytes(h.subarray(0,n.BYTES)),w=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:d,y:w}});function s(g){let{a:h,b:d}=e,w=n.sqr(g),b=n.mul(w,g);return n.add(n.add(b,n.mul(g,h)),d)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function i(g){return typeof g=="bigint"&&_t<g&&g<e.n}function c(g){if(!i(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(g){let{allowedPrivateKeyLengths:h,nByteLength:d,wrapPrivateKey:w,n:b}=e;if(h&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Dt(g)),typeof g!="string"||!h.includes(g.length))throw new Error("Invalid key");g=g.padStart(d*2,"0")}let m;try{m=typeof g=="bigint"?g:Y(W("private key",g,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof g}`)}return w&&(m=z(m,b)),c(m),m}let f=new Map;function l(g){if(!(g instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(h,d,w){if(this.px=h,this.py=d,this.pz=w,h==null||!n.isValid(h))throw new Error("x required");if(d==null||!n.isValid(d))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(h){let{x:d,y:w}=h||{};if(!h||!n.isValid(d)||!n.isValid(w))throw new Error("invalid affine point");if(h instanceof u)throw new Error("projective point not allowed");let b=m=>n.eql(m,n.ZERO);return b(d)&&b(w)?u.ZERO:new u(d,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let d=n.invertBatch(h.map(w=>w.pz));return h.map((w,b)=>w.toAffine(d[b])).map(u.fromAffine)}static fromHex(h){let d=u.fromAffine(o(W("pointHex",h)));return d.assertValidity(),d}static fromPrivateKey(h){return u.BASE.multiply(a(h))}_setWindowSize(h){this._WINDOW_SIZE=h,f.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:h,y:d}=this.toAffine();if(!n.isValid(h)||!n.isValid(d))throw new Error("bad point: x or y not FE");let w=n.sqr(d),b=s(h);if(!n.eql(w,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){l(h);let{px:d,py:w,pz:b}=this,{px:m,py:A,pz:I}=h,B=n.eql(n.mul(d,I),n.mul(m,b)),_=n.eql(n.mul(w,I),n.mul(A,b));return B&&_}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){let{a:h,b:d}=e,w=n.mul(d,Br),{px:b,py:m,pz:A}=this,I=n.ZERO,B=n.ZERO,_=n.ZERO,S=n.mul(b,b),R=n.mul(m,m),k=n.mul(A,A),U=n.mul(b,m);return U=n.add(U,U),_=n.mul(b,A),_=n.add(_,_),I=n.mul(h,_),B=n.mul(w,k),B=n.add(I,B),I=n.sub(R,B),B=n.add(R,B),B=n.mul(I,B),I=n.mul(U,I),_=n.mul(w,_),k=n.mul(h,k),U=n.sub(S,k),U=n.mul(h,U),U=n.add(U,_),_=n.add(S,S),S=n.add(_,S),S=n.add(S,k),S=n.mul(S,U),B=n.add(B,S),k=n.mul(m,A),k=n.add(k,k),S=n.mul(k,U),I=n.sub(I,S),_=n.mul(k,R),_=n.add(_,_),_=n.add(_,_),new u(I,B,_)}add(h){l(h);let{px:d,py:w,pz:b}=this,{px:m,py:A,pz:I}=h,B=n.ZERO,_=n.ZERO,S=n.ZERO,R=e.a,k=n.mul(e.b,Br),U=n.mul(d,m),P=n.mul(w,A),$=n.mul(b,I),j=n.add(d,w),x=n.add(m,A);j=n.mul(j,x),x=n.add(U,P),j=n.sub(j,x),x=n.add(d,b);let E=n.add(m,I);return x=n.mul(x,E),E=n.add(U,$),x=n.sub(x,E),E=n.add(w,b),B=n.add(A,I),E=n.mul(E,B),B=n.add(P,$),E=n.sub(E,B),S=n.mul(R,x),B=n.mul(k,$),S=n.add(B,S),B=n.sub(P,S),S=n.add(P,S),_=n.mul(B,S),P=n.add(U,U),P=n.add(P,U),$=n.mul(R,$),x=n.mul(k,x),P=n.add(P,$),$=n.sub(U,$),$=n.mul(R,$),x=n.add(x,$),U=n.mul(P,x),_=n.add(_,U),U=n.mul(E,x),B=n.mul(j,B),B=n.sub(B,U),U=n.mul(j,P),S=n.mul(E,S),S=n.add(S,U),new u(B,_,S)}subtract(h){return this.add(h.negate())}is0(){return this.equals(u.ZERO)}wNAF(h){return y.wNAFCached(this,f,h,d=>{let w=n.invertBatch(d.map(b=>b.pz));return d.map((b,m)=>b.toAffine(w[m])).map(u.fromAffine)})}multiplyUnsafe(h){let d=u.ZERO;if(h===_t)return d;if(c(h),h===ct)return this;let{endo:w}=e;if(!w)return y.unsafeLadder(this,h);let{k1neg:b,k1:m,k2neg:A,k2:I}=w.splitScalar(h),B=d,_=d,S=this;for(;m>_t||I>_t;)m&ct&&(B=B.add(S)),I&ct&&(_=_.add(S)),S=S.double(),m>>=ct,I>>=ct;return b&&(B=B.negate()),A&&(_=_.negate()),_=new u(n.mul(_.px,w.beta),_.py,_.pz),B.add(_)}multiply(h){c(h);let d=h,w,b,{endo:m}=e;if(m){let{k1neg:A,k1:I,k2neg:B,k2:_}=m.splitScalar(d),{p:S,f:R}=this.wNAF(I),{p:k,f:U}=this.wNAF(_);S=y.constTimeNegate(A,S),k=y.constTimeNegate(B,k),k=new u(n.mul(k.px,m.beta),k.py,k.pz),w=S.add(k),b=R.add(U)}else{let{p:A,f:I}=this.wNAF(d);w=A,b=I}return u.normalizeZ([w,b])[0]}multiplyAndAddUnsafe(h,d,w){let b=u.BASE,m=(I,B)=>B===_t||B===ct||!I.equals(b)?I.multiplyUnsafe(B):I.multiply(B),A=m(this,d).add(m(h,w));return A.is0()?void 0:A}toAffine(h){let{px:d,py:w,pz:b}=this,m=this.is0();h==null&&(h=m?n.ONE:n.inv(b));let A=n.mul(d,h),I=n.mul(w,h),B=n.mul(b,h);if(m)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:A,y:I}}isTorsionFree(){let{h,isTorsionFree:d}=e;if(h===ct)return!0;if(d)return d(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:d}=e;return h===ct?this:d?d(u,this):this.multiplyUnsafe(e.h)}toRawBytes(h=!0){return this.assertValidity(),r(u,this,h)}toHex(h=!0){return Dt(this.toRawBytes(h))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);let p=e.nBitLength,y=vr(u,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:i}}function Cs(t){let e=bn(t);return kt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(Q({lowS:!0},e))}function Ar(t){let e=Cs(t),{Fp:n,n:r}=e,o=n.BYTES+1,s=2*n.BYTES+1;function i(x){return _t<x&&x<n.ORDER}function c(x){return z(x,r)}function a(x){return Se(x,r)}let{ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:p}=Rs(ut(Q({},e),{toBytes(x,E,T){let O=E.toAffine(),v=n.toBytes(O.x),C=At;return T?C(Uint8Array.from([E.hasEvenY()?2:3]),v):C(Uint8Array.from([4]),v,n.toBytes(O.y))},fromBytes(x){let E=x.length,T=x[0],O=x.subarray(1);if(E===o&&(T===2||T===3)){let v=Y(O);if(!i(v))throw new Error("Point is not on curve");let C=u(v),M=n.sqrt(C),q=(M&ct)===ct;return(T&1)===1!==q&&(M=n.neg(M)),{x:v,y:M}}else if(E===s&&T===4){let v=n.fromBytes(O.subarray(0,n.BYTES)),C=n.fromBytes(O.subarray(n.BYTES,2*n.BYTES));return{x:v,y:C}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}})),y=x=>Dt(dt(x,e.nByteLength));function g(x){let E=r>>ct;return x>E}function h(x){return g(x)?c(-x):x}let d=(x,E,T)=>Y(x.slice(E,T));class w{constructor(E,T,O){this.r=E,this.s=T,this.recovery=O,this.assertValidity()}static fromCompact(E){let T=e.nByteLength;return E=W("compactSignature",E,T*2),new w(d(E,0,T),d(E,T,2*T))}static fromDER(E){let{r:T,s:O}=Zt.toSig(W("DER",E));return new w(T,O)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new w(this.r,this.s,E)}recoverPublicKey(E){let{r:T,s:O,recovery:v}=this,C=_(W("msgHash",E));if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");let M=v===2||v===3?T+e.n:T;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let q=v&1?"03":"02",G=f.fromHex(q+y(M)),F=a(M),rt=c(-C*F),it=c(O*F),tt=f.BASE.multiplyAndAddUnsafe(G,rt,it);if(!tt)throw new Error("point at infinify");return tt.assertValidity(),tt}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Wt(this.toDERHex())}toDERHex(){return Zt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Wt(this.toCompactHex())}toCompactHex(){return y(this.r)+y(this.s)}}let b={isValidPrivateKey(x){try{return l(x),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let x=yn(e.n);return Er(e.randomBytes(x),e.n)},precompute(x=8,E=f.BASE){return E._setWindowSize(x),E.multiply(BigInt(3)),E}};function m(x,E=!0){return f.fromPrivateKey(x).toRawBytes(E)}function A(x){let E=x instanceof Uint8Array,T=typeof x=="string",O=(E||T)&&x.length;return E?O===o||O===s:T?O===2*o||O===2*s:x instanceof f}function I(x,E,T=!0){if(A(x))throw new Error("first arg must be private key");if(!A(E))throw new Error("second arg must be public key");return f.fromHex(E).multiply(l(x)).toRawBytes(T)}let B=e.bits2int||function(x){let E=Y(x),T=x.length*8-e.nBitLength;return T>0?E>>BigInt(T):E},_=e.bits2int_modN||function(x){return c(B(x))},S=ue(e.nBitLength);function R(x){if(typeof x!="bigint")throw new Error("bigint expected");if(!(_t<=x&&x<S))throw new Error(`bigint expected < 2^${e.nBitLength}`);return dt(x,e.nByteLength)}function k(x,E,T=U){if(["recovered","canonical"].some(nt=>nt in T))throw new Error("sign() legacy options not supported");let{hash:O,randomBytes:v}=e,{lowS:C,prehash:M,extraEntropy:q}=T;C==null&&(C=!0),x=W("msgHash",x),M&&(x=W("prehashed msgHash",O(x)));let G=_(x),F=l(E),rt=[R(F),R(G)];if(q!=null){let nt=q===!0?v(n.BYTES):q;rt.push(W("extraEntropy",nt))}let it=At(...rt),tt=G;function yt(nt){let Ft=B(nt);if(!p(Ft))return;let sr=a(Ft),wt=f.BASE.multiply(Ft).toAffine(),te=c(wt.x);if(te===_t)return;let we=c(sr*c(tt+te*F));if(we===_t)return;let ir=(wt.x===te?0:2)|Number(wt.y&ct),cr=we;return C&&g(we)&&(cr=h(we),ir^=1),new w(te,cr,ir)}return{seed:it,k2sig:yt}}let U={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function $(x,E,T=U){let{seed:O,k2sig:v}=k(x,E,T),C=e;return un(C.hash.outputLen,C.nByteLength,C.hmac)(O,v)}f.BASE._setWindowSize(8);function j(x,E,T,O=P){let v=x;if(E=W("msgHash",E),T=W("publicKey",T),"strict"in O)throw new Error("options.strict was renamed to lowS");let{lowS:C,prehash:M}=O,q,G;try{if(typeof v=="string"||v instanceof Uint8Array)try{q=w.fromDER(v)}catch(wt){if(!(wt instanceof Zt.Err))throw wt;q=w.fromCompact(v)}else if(typeof v=="object"&&typeof v.r=="bigint"&&typeof v.s=="bigint"){let{r:wt,s:te}=v;q=new w(wt,te)}else throw new Error("PARSE");G=f.fromHex(T)}catch(wt){if(wt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(C&&q.hasHighS())return!1;M&&(E=e.hash(E));let{r:F,s:rt}=q,it=_(E),tt=a(rt),yt=c(it*tt),nt=c(F*tt),Ft=f.BASE.multiplyAndAddUnsafe(G,yt,nt)?.toAffine();return Ft?c(Ft.x)===F:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:I,sign:$,verify:j,ProjectivePoint:f,Signature:w,utils:b}}var Te=class extends ne{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,fr(e);let r=le(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return ee(this),this.iHash.update(e),this}digestInto(e){ee(this),cn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},xn=(t,e,n)=>new Te(t,e).update(n).digest();xn.create=(t,e)=>new Te(t,e);function Ns(t){return{hash:t,hmac:(e,...n)=>xn(t,e,hr(...n)),randomBytes:me}}function _r(t,e){let n=r=>Ar(Q(Q({},t),Ns(r)));return Object.freeze(ut(Q({},n(e)),{create:n}))}var Oe=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ie=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Tr=BigInt(1),Ue=BigInt(2),Lr=(t,e)=>(t+e/Ue)/e;function Ir(t){let e=Oe,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=t*t*t%e,l=f*f*t%e,u=ot(l,n,e)*l%e,p=ot(u,n,e)*l%e,y=ot(p,Ue,e)*f%e,g=ot(y,o,e)*y%e,h=ot(g,s,e)*g%e,d=ot(h,c,e)*h%e,w=ot(d,a,e)*d%e,b=ot(w,c,e)*h%e,m=ot(b,n,e)*l%e,A=ot(m,i,e)*g%e,I=ot(A,r,e)*f%e,B=ot(I,Ue,e);if(!En.eql(En.sqr(B),t))throw new Error("Cannot find square root");return B}var En=xr(Oe,void 0,void 0,{sqrt:Ir}),Ot=_r({a:BigInt(0),b:BigInt(7),Fp:En,n:Ie,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=Ie,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Tr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=Lr(s*t,e),a=Lr(-r*t,e),f=z(t-c*n-a*o,e),l=z(-c*r-a*s,e),u=f>i,p=l>i;if(u&&(f=e-f),p&&(l=e-l),f>i||l>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:f,k2neg:p,k2:l}}}},ve),Re=BigInt(0),Ur=t=>typeof t=="bigint"&&Re<t&&t<Oe,Hs=t=>typeof t=="bigint"&&Re<t&&t<Ie,Sr={};function ke(t,...e){let n=Sr[t];if(n===void 0){let r=ve(Uint8Array.from(t,o=>o.charCodeAt(0)));n=At(r,r),Sr[t]=n}return ve(At(n,...e))}var An=t=>t.toRawBytes(!0).slice(1),vn=t=>dt(t,32),mn=t=>z(t,Oe),he=t=>z(t,Ie),_n=Ot.ProjectivePoint,Ps=(t,e,n)=>_n.BASE.multiplyAndAddUnsafe(t,e,n);function Bn(t){let e=Ot.utils.normPrivateKeyToScalar(t),n=_n.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:he(-e),bytes:An(n)}}function kr(t){if(!Ur(t))throw new Error("bad x: need 0 < x < p");let e=mn(t*t),n=mn(e*t+BigInt(7)),r=Ir(n);r%Ue!==Re&&(r=mn(-r));let o=new _n(t,r,Tr);return o.assertValidity(),o}function Or(...t){return he(Y(ke("BIP0340/challenge",...t)))}function $s(t){return Bn(t).bytes}function qs(t,e,n=me(32)){let r=W("message",t),{bytes:o,scalar:s}=Bn(e),i=W("auxRand",n,32),c=vn(s^Y(ke("BIP0340/aux",i))),a=ke("BIP0340/nonce",c,o,r),f=he(Y(a));if(f===Re)throw new Error("sign failed: k is zero");let{bytes:l,scalar:u}=Bn(f),p=Or(l,o,r),y=new Uint8Array(64);if(y.set(l,0),y.set(vn(he(u+p*s)),32),!Rr(y,r,o))throw new Error("sign: Invalid signature produced");return y}function Rr(t,e,n){let r=W("signature",t,64),o=W("message",e),s=W("publicKey",n,32);try{let i=kr(Y(s)),c=Y(r.subarray(0,32));if(!Ur(c))return!1;let a=Y(r.subarray(32,64));if(!Hs(a))return!1;let f=Or(vn(c),An(i),o),l=Ps(i,a,he(-f));return!(!l||!l.hasEvenY()||l.toAffine().x!==c)}catch{return!1}}var re={getPublicKey:$s,sign:qs,verify:Rr,utils:{randomPrivateKey:Ot.utils.randomPrivateKey,lift_x:kr,pointToBytes:An,numberToBytesBE:dt,bytesToNumberBE:Y,taggedHash:ke,mod:z}};var Ce=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Ln=t=>t instanceof Uint8Array;var Ne=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),pt=(t,e)=>t<<32-e|t>>>e,Ms=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ms)throw new Error("Non little-endian hardware is not supported");var js=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function J(t){if(!Ln(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=js[t[n]];return e}function Gt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Ks(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Rt(t){if(typeof t=="string"&&(t=Ks(t)),!Ln(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function se(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!Ln(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var oe=class{clone(){return this._cloneInto()}};function Sn(t){let e=r=>t().update(Rt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function He(t=32){if(Ce&&typeof Ce.getRandomValues=="function")return Ce.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Tn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Vs(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Cr(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Ds(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Tn(t.outputLen),Tn(t.blockLen)}function Ws(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zs(t,e){Cr(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Zs={number:Tn,bool:Vs,bytes:Cr,hash:Ds,exists:Ws,output:zs},st=Zs;function Gs(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Pe=class extends oe{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ne(this.buffer)}update(e){st.exists(this);let{view:n,buffer:r,blockLen:o}=this;e=Rt(e);let s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=Ne(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){st.exists(this),st.output(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;Gs(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=Ne(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return e.length=o,e.pos=c,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var Js=(t,e,n)=>t&e^~t&n,Ys=(t,e,n)=>t&e^t&n^e&n,Xs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ct=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Nt=new Uint32Array(64),$e=class extends Pe{constructor(){super(64,32,8,!1),this.A=Ct[0]|0,this.B=Ct[1]|0,this.C=Ct[2]|0,this.D=Ct[3]|0,this.E=Ct[4]|0,this.F=Ct[5]|0,this.G=Ct[6]|0,this.H=Ct[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[e,n,r,o,s,i,c,a]}set(e,n,r,o,s,i,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)Nt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let p=Nt[u-15],y=Nt[u-2],g=pt(p,7)^pt(p,18)^p>>>3,h=pt(y,17)^pt(y,19)^y>>>10;Nt[u]=h+Nt[u-7]+g+Nt[u-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let p=pt(c,6)^pt(c,11)^pt(c,25),y=l+p+Js(c,a,f)+Xs[u]+Nt[u]|0,h=(pt(r,2)^pt(r,13)^pt(r,22))+Ys(r,o,s)|0;l=f,f=a,a=c,c=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,a,f,l)}roundClean(){Nt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},In=class extends $e{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Ht=Sn(()=>new $e),ll=Sn(()=>new In);function Jt(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function bt(...t){let e=(o,s)=>i=>o(s(i)),n=Array.from(t).reverse().reduce((o,s)=>o?e(o,s.encode):s.encode,void 0),r=t.reduce((o,s)=>o?e(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Lt(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Jt(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function St(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function je(t,e="="){if(Jt(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Mr(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function Nr(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0,o=[],s=Array.from(t);for(s.forEach(i=>{if(Jt(i),i<0||i>=e)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<s.length;a++){let f=s[a],l=e*i+f;if(!Number.isSafeInteger(l)||e*i/e!==i||l-f!==e*i)throw new Error("convertRadix: carry overflow");if(i=l%n,s[a]=Math.floor(l/n),!Number.isSafeInteger(s[a])||s[a]*n+i!==l)throw new Error("convertRadix: carry overflow");if(c)s[a]?c=!1:r=a;else continue}if(o.push(i),c)break}for(let i=0;i<t.length-1&&t[i]===0;i++)o.push(0);return o.reverse()}var jr=(t,e)=>e?jr(e,t%e):t,qe=(t,e)=>t+(e-jr(t,e));function Un(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(qe(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${qe(e,n)}`);let o=0,s=0,i=2**n-1,c=[];for(let a of t){if(Jt(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function Qs(t){return Jt(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Nr(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Nr(e,t,2**8))}}}function Pt(t,e=!1){if(Jt(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(qe(8,t)>32||qe(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Un(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Un(n,t,8,e))}}}function Hr(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}function Fs(t,e){if(Jt(t),typeof e!="function")throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");let r=e(n).slice(0,t),o=new Uint8Array(n.length+t);return o.set(n),o.set(r,n.length),o},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");let r=n.slice(0,-t),o=e(r).slice(0,t),s=n.slice(-t);for(let i=0;i<t;i++)if(o[i]!==s[i])throw new Error("Invalid checksum");return r}}}var ti=bt(Pt(4),Lt("0123456789ABCDEF"),St("")),ei=bt(Pt(5),Lt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),je(5),St("")),hl=bt(Pt(5),Lt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),je(5),St("")),dl=bt(Pt(5),Lt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),St(""),Mr(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),at=bt(Pt(6),Lt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),je(6),St("")),ni=bt(Pt(6),Lt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),je(6),St("")),On=t=>bt(Qs(58),Lt(t),St("")),Me=On("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),pl=On("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),gl=On("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),Pr=[0,2,3,5,6,7,9,10,11],ri={encode(t){let e="";for(let n=0;n<t.length;n+=8){let r=t.subarray(n,n+8);e+=Me.encode(r).padStart(Pr[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){let r=t.slice(n,n+11),o=Pr.indexOf(r.length),s=Me.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(e)}},yl=t=>bt(Fs(4,e=>t(t(e))),Me),kn=bt(Lt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),St("")),$r=[996825010,642813549,513874426,1027748829,705979059];function de(t){let e=t>>25,n=(t&33554431)<<5;for(let r=0;r<$r.length;r++)(e>>r&1)===1&&(n^=$r[r]);return n}function qr(t,e,n=1){let r=t.length,o=1;for(let s=0;s<r;s++){let i=t.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${t})`);o=de(o)^i>>5}o=de(o);for(let s=0;s<r;s++)o=de(o)^t.charCodeAt(s)&31;for(let s of e)o=de(o)^s;for(let s=0;s<6;s++)o=de(o);return o^=n,kn.encode(Un([o%2**30],30,5,!1))}function Kr(t){let e=t==="bech32"?1:734539939,n=Pt(5),r=n.decode,o=n.encode,s=Hr(r);function i(l,u,p=90){if(typeof l!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof l}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);let y=l.length+7+u.length;if(p!==!1&&y>p)throw new TypeError(`Length ${y} exceeds limit ${p}`);return l=l.toLowerCase(),`${l}1${kn.encode(u)}${qr(l,u,e)}`}function c(l,u=90){if(typeof l!="string")throw new Error(`bech32.decode input should be string, not ${typeof l}`);if(l.length<8||u!==!1&&l.length>u)throw new TypeError(`Wrong string length: ${l.length} (${l}). Expected (8..${u})`);let p=l.toLowerCase();if(l!==p&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");l=p;let y=l.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');let g=l.slice(0,y),h=l.slice(y+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");let d=kn.decode(h).slice(0,-6),w=qr(g,d,e);if(!h.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:g,words:d}}let a=Hr(c);function f(l){let{prefix:u,words:p}=c(l,!1);return{prefix:u,words:p,bytes:r(p)}}return{encode:i,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:s,toWords:o}}var $t=Kr("bech32"),wl=Kr("bech32m"),oi={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},si=bt(Pt(4),Lt("0123456789abcdef"),St(""),Mr(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),ii={utf8:oi,hex:si,base16:ti,base32:ei,base64:at,base64url:ni,base58:Me,base58xmr:ri},bl=`Invalid encoding type. Available types: ${Object.keys(ii).join(", ")}`;function Ke(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Rn(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Cn(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function N(t,...e){if(!Cn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function qt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function pe(t,e){N(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ve=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength);var H=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Mt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ci=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ci)throw new Error("Non little-endian hardware is not supported");function ai(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function xt(t){if(typeof t=="string")t=ai(t);else if(Cn(t))t=t.slice();else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function Vr(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Yt(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var mt=(t,e)=>(Object.assign(e,t),e);function Xt(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Tt=16,Hn=new Uint8Array(16),Et=H(Hn),fi=225,li=(t,e,n,r)=>{let o=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^fi<<24&-(o&1)}},ft=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function ui(t){t.reverse();let e=t[15]&1,n=0;for(let r=0;r<t.length;r++){let o=t[r];t[r]=o>>>1|n,n=(o&1)<<7}return t[0]^=-e&225,t}var hi=t=>t>64*1024?8:t>1024?4:2,De=class{constructor(e,n){this.blockLen=Tt,this.outputLen=Tt,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=xt(e),N(e,16);let r=Mt(e),o=r.getUint32(0,!1),s=r.getUint32(4,!1),i=r.getUint32(8,!1),c=r.getUint32(12,!1),a=[];for(let g=0;g<128;g++)a.push({s0:ft(o),s1:ft(s),s2:ft(i),s3:ft(c)}),{s0:o,s1:s,s2:i,s3:c}=li(o,s,i,c);let f=hi(n||1024);if(![1,2,4,8].includes(f))throw new Error(`ghash: wrong window size=${f}, should be 2, 4 or 8`);this.W=f;let u=128/f,p=this.windowSize=2**f,y=[];for(let g=0;g<u;g++)for(let h=0;h<p;h++){let d=0,w=0,b=0,m=0;for(let A=0;A<f;A++){if(!(h>>>f-A-1&1))continue;let{s0:B,s1:_,s2:S,s3:R}=a[f*g+A];d^=B,w^=_,b^=S,m^=R}y.push({s0:d,s1:w,s2:b,s3:m})}this.t=y}_updateBlock(e,n,r,o){e^=this.s0,n^=this.s1,r^=this.s2,o^=this.s3;let{W:s,t:i,windowSize:c}=this,a=0,f=0,l=0,u=0,p=(1<<s)-1,y=0;for(let g of[e,n,r,o])for(let h=0;h<4;h++){let d=g>>>8*h&255;for(let w=8/s-1;w>=0;w--){let b=d>>>s*w&p,{s0:m,s1:A,s2:I,s3:B}=i[y*c+b];a^=m,f^=A,l^=I,u^=B,y+=1}}this.s0=a,this.s1=f,this.s2=l,this.s3=u}update(e){e=xt(e),qt(this);let n=H(e),r=Math.floor(e.length/Tt),o=e.length%Tt;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return o&&(Hn.set(e.subarray(r*Tt)),this._updateBlock(Et[0],Et[1],Et[2],Et[3]),Et.fill(0)),this}destroy(){let{t:e}=this;for(let n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){qt(this),pe(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e}digest(){let e=new Uint8Array(Tt);return this.digestInto(e),this.destroy(),e}},Nn=class extends De{constructor(e,n){e=xt(e);let r=ui(e.slice());super(r,n),r.fill(0)}update(e){e=xt(e),qt(this);let n=H(e),r=e.length%Tt,o=Math.floor(e.length/Tt);for(let s=0;s<o;s++)this._updateBlock(ft(n[s*4+3]),ft(n[s*4+2]),ft(n[s*4+1]),ft(n[s*4+0]));return r&&(Hn.set(e.subarray(o*Tt)),this._updateBlock(ft(Et[3]),ft(Et[2]),ft(Et[1]),ft(Et[0])),Et.fill(0)),this}digestInto(e){qt(this),pe(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e.reverse()}};function Dr(t){let e=(r,o)=>t(o,r.length).update(xt(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,o)=>t(r,o),e}var Pn=Dr((t,e)=>new De(t,e)),Wr=Dr((t,e)=>new Nn(t,e));var et=16,Mn=4,We=new Uint8Array(et),di=283;function jn(t){return t<<1^di&-(t>>7)}function ie(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=jn(t);return n}var qn=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=jn(r))t[n]=r;let e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),pi=qn.map((t,e)=>qn.indexOf(e)),gi=t=>t<<24|t>>>8,$n=t=>t<<8|t>>>24;function zr(t,e){if(t.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((f,l)=>e(t[l])),r=n.map($n),o=r.map($n),s=o.map($n),i=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let l=0;l<256;l++){let u=f*256+l;i[u]=n[f]^r[l],c[u]=o[f]^s[l],a[u]=t[f]<<8|t[l]}return{sbox:t,sbox2:a,T0:n,T1:r,T2:o,T3:s,T01:i,T23:c}}var Kn=zr(qn,t=>ie(t,3)<<24|t<<16|t<<8|ie(t,2)),Zr=zr(pi,t=>ie(t,11)<<24|ie(t,13)<<16|ie(t,9)<<8|ie(t,14)),yi=(()=>{let t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=jn(n))t[e]=n;return t})();function Kt(t){N(t);let e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);let{sbox2:n}=Kn,r=H(t),o=r.length,s=c=>vt(n,c,c,c,c),i=new Uint32Array(e+28);i.set(r);for(let c=o;c<i.length;c++){let a=i[c-1];c%o===0?a=s(gi(a))^yi[c/o-1]:o>6&&c%o===4&&(a=s(a)),i[c]=i[c-o]^a}return i}function Gr(t){let e=Kt(t),n=e.slice(),r=e.length,{sbox2:o}=Kn,{T0:s,T1:i,T2:c,T3:a}=Zr;for(let f=0;f<r;f+=4)for(let l=0;l<4;l++)n[f+l]=e[r-f-4+l];e.fill(0);for(let f=4;f<r-4;f++){let l=n[f],u=vt(o,l,l,l,l);n[f]=s[u&255]^i[u>>>8&255]^c[u>>>16&255]^a[u>>>24]}return n}function jt(t,e,n,r,o,s){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|s>>>24&255]}function vt(t,e,n,r,o){return t[e&255|n&65280]|t[r>>>16&255|o>>>16&65280]<<16}function lt(t,e,n,r,o){let{sbox2:s,T01:i,T23:c}=Kn,a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];let f=t.length/4-2;for(let g=0;g<f;g++){let h=t[a++]^jt(i,c,e,n,r,o),d=t[a++]^jt(i,c,n,r,o,e),w=t[a++]^jt(i,c,r,o,e,n),b=t[a++]^jt(i,c,o,e,n,r);e=h,n=d,r=w,o=b}let l=t[a++]^vt(s,e,n,r,o),u=t[a++]^vt(s,n,r,o,e),p=t[a++]^vt(s,r,o,e,n),y=t[a++]^vt(s,o,e,n,r);return{s0:l,s1:u,s2:p,s3:y}}function Jr(t,e,n,r,o){let{sbox2:s,T01:i,T23:c}=Zr,a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];let f=t.length/4-2;for(let g=0;g<f;g++){let h=t[a++]^jt(i,c,e,o,r,n),d=t[a++]^jt(i,c,n,e,o,r),w=t[a++]^jt(i,c,r,n,e,o),b=t[a++]^jt(i,c,o,r,n,e);e=h,n=d,r=w,o=b}let l=t[a++]^vt(s,e,o,r,n),u=t[a++]^vt(s,n,e,o,r),p=t[a++]^vt(s,r,n,e,o),y=t[a++]^vt(s,o,r,n,e);return{s0:l,s1:u,s2:p,s3:y}}function ce(t,e){if(!e)return new Uint8Array(t);if(N(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function wi(t,e,n,r){N(e,et),N(n);let o=n.length;r=ce(o,r);let s=e,i=H(s),{s0:c,s1:a,s2:f,s3:l}=lt(t,i[0],i[1],i[2],i[3]),u=H(n),p=H(r);for(let g=0;g+4<=u.length;g+=4){p[g+0]=u[g+0]^c,p[g+1]=u[g+1]^a,p[g+2]=u[g+2]^f,p[g+3]=u[g+3]^l;let h=1;for(let d=s.length-1;d>=0;d--)h=h+(s[d]&255)|0,s[d]=h&255,h>>>=8;({s0:c,s1:a,s2:f,s3:l}=lt(t,i[0],i[1],i[2],i[3]))}let y=et*Math.floor(u.length/Mn);if(y<o){let g=new Uint32Array([c,a,f,l]),h=Ve(g);for(let d=y,w=0;d<o;d++,w++)r[d]=n[d]^h[w]}return r}function ge(t,e,n,r,o){N(n,et),N(r),o=ce(r.length,o);let s=n,i=H(s),c=Mt(s),a=H(r),f=H(o),l=e?0:12,u=r.length,p=c.getUint32(l,e),{s0:y,s1:g,s2:h,s3:d}=lt(t,i[0],i[1],i[2],i[3]);for(let b=0;b+4<=a.length;b+=4)f[b+0]=a[b+0]^y,f[b+1]=a[b+1]^g,f[b+2]=a[b+2]^h,f[b+3]=a[b+3]^d,p=p+1>>>0,c.setUint32(l,p,e),{s0:y,s1:g,s2:h,s3:d}=lt(t,i[0],i[1],i[2],i[3]);let w=et*Math.floor(a.length/Mn);if(w<u){let b=new Uint32Array([y,g,h,d]),m=Ve(b);for(let A=w,I=0;A<u;A++,I++)o[A]=r[A]^m[I]}return o}var Ul=mt({blockSize:16,nonceLength:16},function(e,n){N(e),N(n,et);function r(o,s){let i=Kt(e),c=n.slice(),a=wi(i,c,o,s);return i.fill(0),c.fill(0),a}return{encrypt:(o,s)=>r(o,s),decrypt:(o,s)=>r(o,s)}});function Yr(t){if(N(t),t.length%et!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${et}`)}function Xr(t,e,n){let r=t.length,o=r%et;if(!e&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let s=H(t);if(e){let a=et-o;a||(a=et),r=r+a}let i=ce(r,n),c=H(i);return{b:s,o:c,out:i}}function Qr(t,e){if(!e)return t;let n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);let o=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function Fr(t){let e=new Uint8Array(16),n=H(e);e.set(t);let r=et-t.length;for(let o=et-r;o<et;o++)e[o]=r;return n}var kl=mt({blockSize:16},function(e,n={}){N(e);let r=!n.disablePadding;return{encrypt:(o,s)=>{N(o);let{b:i,o:c,out:a}=Xr(o,r,s),f=Kt(e),l=0;for(;l+4<=i.length;){let{s0:u,s1:p,s2:y,s3:g}=lt(f,i[l+0],i[l+1],i[l+2],i[l+3]);c[l++]=u,c[l++]=p,c[l++]=y,c[l++]=g}if(r){let u=Fr(o.subarray(l*4)),{s0:p,s1:y,s2:g,s3:h}=lt(f,u[0],u[1],u[2],u[3]);c[l++]=p,c[l++]=y,c[l++]=g,c[l++]=h}return f.fill(0),a},decrypt:(o,s)=>{Yr(o);let i=Gr(e),c=ce(o.length,s),a=H(o),f=H(c);for(let l=0;l+4<=a.length;){let{s0:u,s1:p,s2:y,s3:g}=Jr(i,a[l+0],a[l+1],a[l+2],a[l+3]);f[l++]=u,f[l++]=p,f[l++]=y,f[l++]=g}return i.fill(0),Qr(c,r)}}}),Vn=mt({blockSize:16,nonceLength:16},function(e,n,r={}){N(e),N(n,16);let o=!r.disablePadding;return{encrypt:(s,i)=>{let c=Kt(e),{b:a,o:f,out:l}=Xr(s,o,i),u=H(n),p=u[0],y=u[1],g=u[2],h=u[3],d=0;for(;d+4<=a.length;)p^=a[d+0],y^=a[d+1],g^=a[d+2],h^=a[d+3],{s0:p,s1:y,s2:g,s3:h}=lt(c,p,y,g,h),f[d++]=p,f[d++]=y,f[d++]=g,f[d++]=h;if(o){let w=Fr(s.subarray(d*4));p^=w[0],y^=w[1],g^=w[2],h^=w[3],{s0:p,s1:y,s2:g,s3:h}=lt(c,p,y,g,h),f[d++]=p,f[d++]=y,f[d++]=g,f[d++]=h}return c.fill(0),l},decrypt:(s,i)=>{Yr(s);let c=Gr(e),a=H(n),f=ce(s.length,i),l=H(s),u=H(f),p=a[0],y=a[1],g=a[2],h=a[3];for(let d=0;d+4<=l.length;){let w=p,b=y,m=g,A=h;p=l[d+0],y=l[d+1],g=l[d+2],h=l[d+3];let{s0:I,s1:B,s2:_,s3:S}=Jr(c,p,y,g,h);u[d++]=I^w,u[d++]=B^b,u[d++]=_^m,u[d++]=S^A}return c.fill(0),Qr(f,o)}}}),Ol=mt({blockSize:16,nonceLength:16},function(e,n){N(e),N(n,16);function r(o,s,i){let c=Kt(e),a=o.length;i=ce(a,i);let f=H(o),l=H(i),u=s?l:f,p=H(n),y=p[0],g=p[1],h=p[2],d=p[3];for(let b=0;b+4<=f.length;){let{s0:m,s1:A,s2:I,s3:B}=lt(c,y,g,h,d);l[b+0]=f[b+0]^m,l[b+1]=f[b+1]^A,l[b+2]=f[b+2]^I,l[b+3]=f[b+3]^B,y=u[b++],g=u[b++],h=u[b++],d=u[b++]}let w=et*Math.floor(f.length/Mn);if(w<a){({s0:y,s1:g,s2:h,s3:d}=lt(c,y,g,h,d));let b=Ve(new Uint32Array([y,g,h,d]));for(let m=w,A=0;m<a;m++,A++)i[m]=o[m]^b[A];b.fill(0)}return c.fill(0),i}return{encrypt:(o,s)=>r(o,!0,s),decrypt:(o,s)=>r(o,!1,s)}});function to(t,e,n,r,o){let s=t.create(n,r.length+(o?.length||0));o&&s.update(o),s.update(r);let i=new Uint8Array(16),c=Mt(i);return o&&Xt(c,0,BigInt(o.length*8),e),Xt(c,8,BigInt(r.length*8),e),s.update(i),s.digest()}var Rl=mt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){if(N(n),n.length===0)throw new Error("aes/gcm: empty nonce");let o=16;function s(c,a,f){let l=to(Pn,!1,c,f,r);for(let u=0;u<a.length;u++)l[u]^=a[u];return l}function i(){let c=Kt(e),a=We.slice(),f=We.slice();if(ge(c,!1,f,f,a),n.length===12)f.set(n);else{let u=We.slice(),p=Mt(u);Xt(p,8,BigInt(n.length*8),!1),Pn.create(a).update(n).update(u).digestInto(f)}let l=ge(c,!1,f,We);return{xk:c,authKey:a,counter:f,tagMask:l}}return{encrypt:c=>{N(c);let{xk:a,authKey:f,counter:l,tagMask:u}=i(),p=new Uint8Array(c.length+o);ge(a,!1,l,c,p);let y=s(f,u,p.subarray(0,p.length-o));return p.set(y,c.length),a.fill(0),p},decrypt:c=>{if(N(c),c.length<o)throw new Error(`aes/gcm: ciphertext less than tagLen (${o})`);let{xk:a,authKey:f,counter:l,tagMask:u}=i(),p=c.subarray(0,-o),y=c.subarray(-o),g=s(f,u,p);if(!Yt(g,y))throw new Error("aes/gcm: invalid ghash tag");let h=ge(a,!1,l,p);return f.fill(0),u.fill(0),a.fill(0),h}}}),ze=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)},Cl=mt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){let s=ze("AAD",0,68719476736),i=ze("plaintext",0,2**36),c=ze("nonce",12,12),a=ze("ciphertext",16,2**36+16);N(n),c(n.length),r&&(N(r),s(r.length));function f(){let p=e.length;if(p!==16&&p!==24&&p!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${p} bytes`);let y=Kt(e),g=new Uint8Array(p),h=new Uint8Array(16),d=H(n),w=0,b=d[0],m=d[1],A=d[2],I=0;for(let B of[h,g].map(H)){let _=H(B);for(let S=0;S<_.length;S+=2){let{s0:R,s1:k}=lt(y,w,b,m,A);_[S+0]=R,_[S+1]=k,w=++I}}return y.fill(0),{authKey:h,encKey:Kt(g)}}function l(p,y,g){let h=to(Wr,!0,y,g,r);for(let I=0;I<12;I++)h[I]^=n[I];h[15]&=127;let d=H(h),w=d[0],b=d[1],m=d[2],A=d[3];return{s0:w,s1:b,s2:m,s3:A}=lt(p,w,b,m,A),d[0]=w,d[1]=b,d[2]=m,d[3]=A,h}function u(p,y,g){let h=y.slice();return h[15]|=128,ge(p,!0,h,g)}return{encrypt:p=>{N(p),i(p.length);let{encKey:y,authKey:g}=f(),h=l(y,g,p),d=new Uint8Array(p.length+16);return d.set(h,p.length),d.set(u(y,h,p)),y.fill(0),g.fill(0),d},decrypt:p=>{N(p),a(p.length);let y=p.subarray(-16),{encKey:g,authKey:h}=f(),d=u(g,y,p.subarray(0,-16)),w=l(g,h,d);if(g.fill(0),h.fill(0),!Yt(y,w))throw new Error("invalid polyval tag");return d}}});var X=(t,e)=>t[e++]&255|(t[e++]&255)<<8,Dn=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=xt(e),N(e,32);let n=X(e,0),r=X(e,2),o=X(e,4),s=X(e,6),i=X(e,8),c=X(e,10),a=X(e,12),f=X(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|a<<5)&8065,this.r[8]=(a>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=X(e,16+2*l)}process(e,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,c=i[0],a=i[1],f=i[2],l=i[3],u=i[4],p=i[5],y=i[6],g=i[7],h=i[8],d=i[9],w=X(e,n+0),b=X(e,n+2),m=X(e,n+4),A=X(e,n+6),I=X(e,n+8),B=X(e,n+10),_=X(e,n+12),S=X(e,n+14),R=s[0]+(w&8191),k=s[1]+((w>>>13|b<<3)&8191),U=s[2]+((b>>>10|m<<6)&8191),P=s[3]+((m>>>7|A<<9)&8191),$=s[4]+((A>>>4|I<<12)&8191),j=s[5]+(I>>>1&8191),x=s[6]+((I>>>14|B<<2)&8191),E=s[7]+((B>>>11|_<<5)&8191),T=s[8]+((_>>>8|S<<8)&8191),O=s[9]+(S>>>5|o),v=0,C=v+R*c+k*(5*d)+U*(5*h)+P*(5*g)+$*(5*y);v=C>>>13,C&=8191,C+=j*(5*p)+x*(5*u)+E*(5*l)+T*(5*f)+O*(5*a),v+=C>>>13,C&=8191;let M=v+R*a+k*c+U*(5*d)+P*(5*h)+$*(5*g);v=M>>>13,M&=8191,M+=j*(5*y)+x*(5*p)+E*(5*u)+T*(5*l)+O*(5*f),v+=M>>>13,M&=8191;let q=v+R*f+k*a+U*c+P*(5*d)+$*(5*h);v=q>>>13,q&=8191,q+=j*(5*g)+x*(5*y)+E*(5*p)+T*(5*u)+O*(5*l),v+=q>>>13,q&=8191;let G=v+R*l+k*f+U*a+P*c+$*(5*d);v=G>>>13,G&=8191,G+=j*(5*h)+x*(5*g)+E*(5*y)+T*(5*p)+O*(5*u),v+=G>>>13,G&=8191;let F=v+R*u+k*l+U*f+P*a+$*c;v=F>>>13,F&=8191,F+=j*(5*d)+x*(5*h)+E*(5*g)+T*(5*y)+O*(5*p),v+=F>>>13,F&=8191;let rt=v+R*p+k*u+U*l+P*f+$*a;v=rt>>>13,rt&=8191,rt+=j*c+x*(5*d)+E*(5*h)+T*(5*g)+O*(5*y),v+=rt>>>13,rt&=8191;let it=v+R*y+k*p+U*u+P*l+$*f;v=it>>>13,it&=8191,it+=j*a+x*c+E*(5*d)+T*(5*h)+O*(5*g),v+=it>>>13,it&=8191;let tt=v+R*g+k*y+U*p+P*u+$*l;v=tt>>>13,tt&=8191,tt+=j*f+x*a+E*c+T*(5*d)+O*(5*h),v+=tt>>>13,tt&=8191;let yt=v+R*h+k*g+U*y+P*p+$*u;v=yt>>>13,yt&=8191,yt+=j*l+x*f+E*a+T*c+O*(5*d),v+=yt>>>13,yt&=8191;let nt=v+R*d+k*h+U*g+P*y+$*p;v=nt>>>13,nt&=8191,nt+=j*u+x*l+E*f+T*a+O*c,v+=nt>>>13,nt&=8191,v=(v<<2)+v|0,v=v+C|0,C=v&8191,v=v>>>13,M+=v,s[0]=C,s[1]=M,s[2]=q,s[3]=G,s[4]=F,s[5]=rt,s[6]=it,s[7]=tt,s[8]=yt,s[9]=nt}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=o,o=e[c]>>>13,e[c]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=e[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let s=(o^1)-1;for(let c=0;c<10;c++)r[c]&=s;s=~s;for(let c=0;c<10;c++)e[c]=e[c]&s|r[c];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let i=e[0]+n[0];e[0]=i&65535;for(let c=1;c<8;c++)i=(e[c]+n[c]|0)+(i>>>16)|0,e[c]=i&65535}update(e){qt(this);let{buffer:n,blockLen:r}=this;e=xt(e);let o=e.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){qt(this),pe(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)e[s++]=r[i]>>>0,e[s++]=r[i]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function bi(t){let e=(r,o)=>t(o).update(xt(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var eo=bi(t=>new Dn(t));var ro=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),xi=ro("expand 16-byte k"),mi=ro("expand 32-byte k"),Ei=H(xi),oo=H(mi),jl=oo.slice();function L(t,e){return t<<e|t>>>32-e}function Wn(t){return t.byteOffset%4===0}var Ze=64,vi=16,so=2**32-1,no=new Uint32Array;function Bi(t,e,n,r,o,s,i,c){let a=o.length,f=new Uint8Array(Ze),l=H(f),u=Wn(o)&&Wn(s),p=u?H(o):no,y=u?H(s):no;for(let g=0;g<a;i++){if(t(e,n,r,l,i,c),i>=so)throw new Error("arx: counter overflow");let h=Math.min(Ze,a-g);if(u&&h===Ze){let d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,b;w<vi;w++)b=d+w,y[b]=p[b]^l[w];g+=Ze;continue}for(let d=0,w;d<h;d++)w=g+d,s[w]=o[w]^f[d];g+=h}}function zn(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=Vr({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Ke(o),Ke(i),Rn(s),Rn(n),(c,a,f,l,u=0)=>{N(c),N(a),N(f);let p=f.length;if(l||(l=new Uint8Array(p)),N(l),Ke(u),u<0||u>=so)throw new Error("arx: counter overflow");if(l.length<p)throw new Error(`arx: output (${l.length}) is shorter than data (${p})`);let y=[],g=c.length,h,d;if(g===32)h=c.slice(),y.push(h),d=oo;else if(g===16&&n)h=new Uint8Array(32),h.set(c),h.set(c,16),d=Ei,y.push(h);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Wn(a)||(a=a.slice(),y.push(a));let w=H(h);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,w,H(a.subarray(0,16)),w),a=a.subarray(16)}let b=16-o;if(b!==a.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){let A=new Uint8Array(12);A.set(a,s?0:12-a.length),a=A,y.push(a)}let m=H(a);for(Bi(t,d,w,m,f,l,u,i);y.length>0;)y.pop().fill(0);return l}}function ao(t,e,n,r,o,s=20){let i=t[0],c=t[1],a=t[2],f=t[3],l=e[0],u=e[1],p=e[2],y=e[3],g=e[4],h=e[5],d=e[6],w=e[7],b=o,m=n[0],A=n[1],I=n[2],B=i,_=c,S=a,R=f,k=l,U=u,P=p,$=y,j=g,x=h,E=d,T=w,O=b,v=m,C=A,M=I;for(let G=0;G<s;G+=2)B=B+k|0,O=L(O^B,16),j=j+O|0,k=L(k^j,12),B=B+k|0,O=L(O^B,8),j=j+O|0,k=L(k^j,7),_=_+U|0,v=L(v^_,16),x=x+v|0,U=L(U^x,12),_=_+U|0,v=L(v^_,8),x=x+v|0,U=L(U^x,7),S=S+P|0,C=L(C^S,16),E=E+C|0,P=L(P^E,12),S=S+P|0,C=L(C^S,8),E=E+C|0,P=L(P^E,7),R=R+$|0,M=L(M^R,16),T=T+M|0,$=L($^T,12),R=R+$|0,M=L(M^R,8),T=T+M|0,$=L($^T,7),B=B+U|0,M=L(M^B,16),E=E+M|0,U=L(U^E,12),B=B+U|0,M=L(M^B,8),E=E+M|0,U=L(U^E,7),_=_+P|0,O=L(O^_,16),T=T+O|0,P=L(P^T,12),_=_+P|0,O=L(O^_,8),T=T+O|0,P=L(P^T,7),S=S+$|0,v=L(v^S,16),j=j+v|0,$=L($^j,12),S=S+$|0,v=L(v^S,8),j=j+v|0,$=L($^j,7),R=R+k|0,C=L(C^R,16),x=x+C|0,k=L(k^x,12),R=R+k|0,C=L(C^R,8),x=x+C|0,k=L(k^x,7);let q=0;r[q++]=i+B|0,r[q++]=c+_|0,r[q++]=a+S|0,r[q++]=f+R|0,r[q++]=l+k|0,r[q++]=u+U|0,r[q++]=p+P|0,r[q++]=y+$|0,r[q++]=g+j|0,r[q++]=h+x|0,r[q++]=d+E|0,r[q++]=w+T|0,r[q++]=b+O|0,r[q++]=m+v|0,r[q++]=A+C|0,r[q++]=I+M|0}function Ai(t,e,n,r){let o=t[0],s=t[1],i=t[2],c=t[3],a=e[0],f=e[1],l=e[2],u=e[3],p=e[4],y=e[5],g=e[6],h=e[7],d=n[0],w=n[1],b=n[2],m=n[3];for(let I=0;I<20;I+=2)o=o+a|0,d=L(d^o,16),p=p+d|0,a=L(a^p,12),o=o+a|0,d=L(d^o,8),p=p+d|0,a=L(a^p,7),s=s+f|0,w=L(w^s,16),y=y+w|0,f=L(f^y,12),s=s+f|0,w=L(w^s,8),y=y+w|0,f=L(f^y,7),i=i+l|0,b=L(b^i,16),g=g+b|0,l=L(l^g,12),i=i+l|0,b=L(b^i,8),g=g+b|0,l=L(l^g,7),c=c+u|0,m=L(m^c,16),h=h+m|0,u=L(u^h,12),c=c+u|0,m=L(m^c,8),h=h+m|0,u=L(u^h,7),o=o+f|0,m=L(m^o,16),g=g+m|0,f=L(f^g,12),o=o+f|0,m=L(m^o,8),g=g+m|0,f=L(f^g,7),s=s+l|0,d=L(d^s,16),h=h+d|0,l=L(l^h,12),s=s+l|0,d=L(d^s,8),h=h+d|0,l=L(l^h,7),i=i+u|0,w=L(w^i,16),p=p+w|0,u=L(u^p,12),i=i+u|0,w=L(w^i,8),p=p+w|0,u=L(u^p,7),c=c+a|0,b=L(b^c,16),y=y+b|0,a=L(a^y,12),c=c+a|0,b=L(b^c,8),y=y+b|0,a=L(a^y,7);let A=0;r[A++]=o,r[A++]=s,r[A++]=i,r[A++]=c,r[A++]=d,r[A++]=w,r[A++]=b,r[A++]=m}var Ge=zn(ao,{counterRight:!1,counterLength:4,allowShortKeys:!1}),_i=zn(ao,{counterRight:!1,counterLength:8,extendNonceFn:Ai,allowShortKeys:!1});var Li=new Uint8Array(16),io=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(Li.subarray(n))},Si=new Uint8Array(32);function co(t,e,n,r,o){let s=t(e,n,Si),i=eo.create(s);o&&io(i,o),io(i,r);let c=new Uint8Array(16),a=Mt(c);Xt(a,0,BigInt(o?o.length:0),!0),Xt(a,8,BigInt(r.length),!0),i.update(c);let f=i.digest();return s.fill(0),f}var fo=t=>(e,n,r)=>(N(e,32),N(n),{encrypt:(s,i)=>{let c=s.length,a=c+16;i?N(i,a):i=new Uint8Array(a),t(e,n,s,i,1);let f=co(t,e,n,i.subarray(0,-16),r);return i.set(f,c),i},decrypt:(s,i)=>{let c=s.length,a=c-16;if(c<16)throw new Error("encrypted data must be at least 16 bytes");i?N(i,a):i=new Uint8Array(a);let f=s.subarray(0,-16),l=s.subarray(-16),u=co(t,e,n,f,r);if(!Yt(l,u))throw new Error("invalid tag");return t(e,n,f,i,1),i}}),Zl=mt({blockSize:64,nonceLength:12,tagLength:16},fo(Ge)),Gl=mt({blockSize:64,nonceLength:24,tagLength:16},fo(_i));var Je=class extends oe{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,st.hash(e);let r=Rt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return st.exists(this),this.iHash.update(e),this}digestInto(e){st.exists(this),st.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ae=(t,e,n)=>new Je(t,e).update(n).digest();ae.create=(t,e)=>new Je(t,e);function uo(t,e,n){return st.hash(t),n===void 0&&(n=new Uint8Array(t.outputLen)),ae(t,Rt(n),Rt(e))}var Zn=new Uint8Array([0]),lo=new Uint8Array;function ho(t,e,n,r=32){if(st.hash(t),st.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(r/t.outputLen);n===void 0&&(n=lo);let s=new Uint8Array(o*t.outputLen),i=ae.create(t,e),c=i._cloneInto(),a=new Uint8Array(i.outputLen);for(let f=0;f<o;f++)Zn[0]=f+1,c.update(f===0?lo:a).update(n).update(Zn).digestInto(a),s.set(a,t.outputLen*f),i._cloneInto(c);return i.destroy(),c.destroy(),a.fill(0),Zn.fill(0),s.slice(0,r)}var Ti=Object.defineProperty,D=(t,e)=>{for(var n in e)Ti(t,n,{get:e[n],enumerable:!0})},Qt=Symbol("verified"),Ii=t=>t instanceof Object;function po(t){if(!Ii(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var Ui={};D(Ui,{Queue:()=>yo,QueueNode:()=>go,binarySearch:()=>Gn,insertEventIntoAscendingList:()=>Oi,insertEventIntoDescendingList:()=>ki,normalizeURL:()=>fe,utf8Decoder:()=>Bt,utf8Encoder:()=>gt});var Bt=new TextDecoder("utf-8"),gt=new TextEncoder;function fe(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function ki(t,e){let[n,r]=Gn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function Oi(t,e){let[n,r]=Gn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function Gn(t,e){let n=0,r=t.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),s=e(t[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var go=class{value;next=null;prev=null;constructor(t){this.value=t}},yo=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){let e=new go(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let e=this.first;return this.first=null,this.last=null,e.value}let t=this.first;return this.first=t.next,t.value}},Ri=class{generateSecretKey(){return re.utils.randomPrivateKey()}getPublicKey(t){return J(re.getPublicKey(t))}finalizeEvent(t,e){let n=t;return n.pubkey=J(re.getPublicKey(e)),n.id=Xe(n),n.sig=J(re.sign(Xe(n),e)),n[Qt]=!0,n}verifyEvent(t){if(typeof t[Qt]=="boolean")return t[Qt];let e=Xe(t);if(e!==t.id)return t[Qt]=!1,!1;try{let n=re.verify(t.sig,e,t.pubkey);return t[Qt]=n,n}catch{return t[Qt]=!1,!1}}};function Ci(t){if(!po(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Xe(t){let e=Ht(gt.encode(Ci(t)));return J(e)}var Qe=new Ri,iu=Qe.generateSecretKey,cu=Qe.getPublicKey,Vt=Qe.finalizeEvent,Fe=Qe.verifyEvent,Ni={};D(Ni,{Application:()=>Nc,BadgeAward:()=>Di,BadgeDefinition:()=>Tc,BlockedRelaysList:()=>dc,BookmarkList:()=>lc,Bookmarksets:()=>_c,Calendar:()=>Kc,CalendarEventRSVP:()=>Vc,ChannelCreation:()=>Eo,ChannelHideMessage:()=>Ao,ChannelMessage:()=>Bo,ChannelMetadata:()=>vo,ChannelMuteUser:()=>_o,ClassifiedListing:()=>$c,ClientAuth:()=>Lo,CommunitiesList:()=>uc,CommunityDefinition:()=>zc,CommunityPostApproval:()=>Fi,Contacts:()=>Mi,CreateOrUpdateProduct:()=>kc,CreateOrUpdateStall:()=>Uc,Curationsets:()=>Lc,Date:()=>Mc,DraftClassifiedListing:()=>qc,DraftLong:()=>Rc,Emojisets:()=>Cc,EncryptedDirectMessage:()=>ji,EncryptedDirectMessages:()=>Ki,EventDeletion:()=>Vi,FileMetadata:()=>Zi,FileServerPreference:()=>wc,Followsets:()=>vc,GenericRepost:()=>Wi,Genericlists:()=>Bc,HTTPAuth:()=>Xn,Handlerinformation:()=>Wc,Handlerrecommendation:()=>Dc,Highlights:()=>ic,InterestsList:()=>gc,Interestsets:()=>Ic,JobFeedback:()=>nc,JobRequest:()=>tc,JobResult:()=>ec,Label:()=>Qi,LightningPubRPC:()=>xc,LiveChatMessage:()=>Gi,LiveEvent:()=>Hc,LongFormArticle:()=>Oc,Metadata:()=>Pi,Mutelist:()=>cc,NWCWalletInfo:()=>bc,NWCWalletRequest:()=>So,NWCWalletResponse:()=>mc,NostrConnect:()=>Ec,OpenTimestamps:()=>zi,Pinlist:()=>ac,ProblemTracker:()=>Ji,ProfileBadges:()=>Sc,PublicChatsList:()=>hc,Reaction:()=>Yn,RecommendRelay:()=>qi,RelayList:()=>fc,Relaysets:()=>Ac,Report:()=>Yi,Reporting:()=>Xi,Repost:()=>Jn,SearchRelaysList:()=>pc,ShortTextNote:()=>$i,Time:()=>jc,UserEmojiList:()=>yc,UserStatuses:()=>Pc,Zap:()=>sc,ZapGoal:()=>rc,ZapRequest:()=>oc,classifyKind:()=>Hi,isEphemeralKind:()=>xo,isParameterizedReplaceableKind:()=>mo,isRegularKind:()=>wo,isReplaceableKind:()=>bo});function wo(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function bo(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function xo(t){return 2e4<=t&&t<3e4}function mo(t){return 3e4<=t&&t<4e4}function Hi(t){return wo(t)?"regular":bo(t)?"replaceable":xo(t)?"ephemeral":mo(t)?"parameterized":"unknown"}var Pi=0,$i=1,qi=2,Mi=3,ji=4,Ki=4,Vi=5,Jn=6,Yn=7,Di=8,Wi=16,Eo=40,vo=41,Bo=42,Ao=43,_o=44,zi=1040,Zi=1063,Gi=1311,Ji=1971,Yi=1984,Xi=1984,Qi=1985,Fi=4550,tc=5999,ec=6999,nc=7e3,rc=9041,oc=9734,sc=9735,ic=9802,cc=1e4,ac=10001,fc=10002,lc=10003,uc=10004,hc=10005,dc=10006,pc=10007,gc=10015,yc=10030,wc=10096,bc=13194,xc=21e3,Lo=22242,So=23194,mc=23195,Ec=24133,Xn=27235,vc=3e4,Bc=30001,Ac=30002,_c=30003,Lc=30004,Sc=30008,Tc=30009,Ic=30015,Uc=30017,kc=30018,Oc=30023,Rc=30024,Cc=30030,Nc=30078,Hc=30311,Pc=30315,$c=30402,qc=30403,Mc=31922,jc=31923,Kc=31924,Vc=31925,Dc=31989,Wc=31990,zc=34550;function Zc(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=n.slice(1),o=t[`#${r}`];if(o&&!e.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function Gc(t,e){for(let n=0;n<t.length;n++)if(Zc(t[n],e))return!0;return!1}var Jc={};D(Jc,{getHex64:()=>tn,getInt:()=>To,getSubscriptionId:()=>Io,matchEventId:()=>Yc,matchEventKind:()=>Qc,matchEventPubkey:()=>Xc});function tn(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function To(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function Io(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return t.slice(r+1,s)}function Yc(t,e){return e===tn(t,"id")}function Xc(t,e){return e===tn(t,"pubkey")}function Qc(t,e){return e===To(t,"kind")}var Fc={};D(Fc,{makeAuthEvent:()=>Uo});function Uo(t,e){return{kind:Lo,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}function ta(){return K(this,null,function*(){return new Promise(t=>{let e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()})})}var ea=t=>(t[Qt]=!0,!0),ko=class{url;_connected=!1;onclose=null;onnotice=t=>console.debug(`NOTICE from ${this.url}: ${t}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new yo;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=fe(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static connect(t,e){return K(this,null,function*(){let n=new ko(t,e);return yield n.connect(),n})}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}connect(){return K(this,null,function*(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((t,e)=>{this.connectionTimeoutHandle=setTimeout(()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){e(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=()=>K(this,null,function*(){this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))}),this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)})}runQueue(){return K(this,null,function*(){for(this.queueRunning=!0;this.handleNext()!==!1;)yield ta();this.queueRunning=!1})}handleNext(){let t=this.incomingMessageQueue.dequeue();if(!t)return!1;let e=Io(t);if(e){let n=this.openSubs.get(e);if(!n)return;let r=tn(t,"id"),o=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),o)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{let r=this.openSubs.get(n[1]),o=n[2];this.verifyEvent(o)&&Gc(r.filters,o)&&r.onevent(o);return}case"COUNT":{let r=n[1],o=n[2],s=this.openCountRequests.get(r);s&&(s.resolve(o.count),this.openCountRequests.delete(r));return}case"EOSE":{let r=this.openSubs.get(n[1]);if(!r)return;r.receivedEose();return}case"OK":{let r=n[1],o=n[2],s=n[3],i=this.openEventPublishes.get(r);o?i.resolve(s):i.reject(new Error(s)),this.openEventPublishes.delete(r);return}case"CLOSED":{let r=n[1],o=this.openSubs.get(r);if(!o)return;o.closed=!0,o.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1],this._onauth?.(n[1]);return}}}catch{return}}send(t){return K(this,null,function*(){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{this.ws?.send(t)})})}auth(t){return K(this,null,function*(){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");let e=yield t(Uo(this.url,this.challenge)),n=new Promise((r,o)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:o})});return this.send('["AUTH",'+JSON.stringify(e)+"]"),n})}publish(t){return K(this,null,function*(){let e=new Promise((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})});return this.send('["EVENT",'+JSON.stringify(t)+"]"),e})}count(t,e){return K(this,null,function*(){this.serial++;let n=e?.id||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r})}subscribe(t,e){let n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;let n=e.id||"sub:"+this.serial,r=new na(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},na=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},ra;try{ra=WebSocket}catch{}var oa=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}ensureRelay(t,e){return K(this,null,function*(){t=fe(t);let n=this.relays.get(t);return n||(n=new ko(t,{verifyEvent:this.trustedRelayURLs.has(t)?ea:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),yield n.connect(),n})}close(t){t.map(fe).forEach(e=>{this.relays.get(e)?.close()})}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map(r=>[r,e])),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(p,y)=>{let g=this.seenOn.get(y);g||(g=new Set,this.seenOn.set(y,g)),g.add(p)});let n=new Set,r=[],o=Object.keys(t).length,s=[],i=p=>{s[p]=!0,s.filter(y=>y).length===o&&(e.oneose?.(),i=()=>{})},c=[],a=(p,y)=>{i(p),c[p]=y,c.filter(g=>g).length===o&&(e.onclose?.(c),a=()=>{})},f=p=>{if(e.alreadyHaveEvent?.(p))return!0;let y=n.has(p);return n.add(p),y},l=Promise.all(Object.entries(t).map((p,y,g)=>K(this,null,function*(){if(g.indexOf(p)!==y){a(y,"duplicate url");return}let[h,d]=p;h=fe(h);let w;try{w=yield this.ensureRelay(h,{connectionTimeout:e.maxWait?Math.max(e.maxWait*.8,e.maxWait-1e3):void 0})}catch(m){a(y,m?.message||String(m));return}let b=w.subscribe(d,ut(Q({},e),{oneose:()=>i(y),onclose:m=>a(y,m),alreadyHaveEvent:f,eoseTimeout:e.maxWait}));r.push(b)})));return{close(){return K(this,null,function*(){yield l,r.forEach(p=>{p.close()})})}}}subscribeManyEose(t,e,n){let r=this.subscribeMany(t,e,ut(Q({},n),{oneose(){r.close()}}));return r}querySync(t,e,n){return K(this,null,function*(){return new Promise(r=>K(this,null,function*(){let o=[];this.subscribeManyEose(t,[e],ut(Q({},n),{onevent(s){o.push(s)},onclose(s){r(o)}}))}))})}get(t,e,n){return K(this,null,function*(){e.limit=1;let r=yield this.querySync(t,e,n);return r.sort((o,s)=>s.created_at-o.created_at),r[0]||null})}publish(t,e){return t.map(fe).map((n,r,o)=>K(this,null,function*(){return o.indexOf(n)!==r?Promise.reject("duplicate url"):(yield this.ensureRelay(n)).publish(e)}))}listConnectionStatus(){let t=new Map;return this.relays.forEach((e,n)=>t.set(n,e.connected)),t}destroy(){this.relays.forEach(t=>t.close()),this.relays=new Map}},Oo;try{Oo=WebSocket}catch{}var au=class extends oa{constructor(){super({verifyEvent:Fe,websocketImplementation:Oo})}},sa={};D(sa,{BECH32_REGEX:()=>Ro,Bech32MaxSize:()=>Qn,decode:()=>en,encodeBytes:()=>nn,naddrEncode:()=>ha,neventEncode:()=>ua,noteEncode:()=>fa,nprofileEncode:()=>la,npubEncode:()=>aa,nrelayEncode:()=>da,nsecEncode:()=>ca});var Qn=5e3,Ro=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ia(t){let e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function en(t){let{prefix:e,words:n}=$t.decode(t,Qn),r=new Uint8Array($t.fromWords(n));switch(e){case"nprofile":{let o=Ye(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:J(o[0][0]),relays:o[1]?o[1].map(s=>Bt.decode(s)):[]}}}case"nevent":{let o=Ye(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:J(o[0][0]),relays:o[1]?o[1].map(s=>Bt.decode(s)):[],author:o[2]?.[0]?J(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(J(o[3][0]),16):void 0}}}case"naddr":{let o=Ye(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Bt.decode(o[0][0]),pubkey:J(o[2][0]),kind:parseInt(J(o[3][0]),16),relays:o[1]?o[1].map(s=>Bt.decode(s)):[]}}}case"nrelay":{let o=Ye(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Bt.decode(o[0][0])}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:J(r)};default:throw new Error(`unknown prefix ${e}`)}}function Ye(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function ca(t){return nn("nsec",t)}function aa(t){return nn("npub",Gt(t))}function fa(t){return nn("note",Gt(t))}function ye(t,e){let n=$t.toWords(e);return $t.encode(t,n,Qn)}function nn(t,e){return ye(t,e)}function la(t){let e=rn({0:[Gt(t.pubkey)],1:(t.relays||[]).map(n=>gt.encode(n))});return ye("nprofile",e)}function ua(t){let e;t.kind!==void 0&&(e=ia(t.kind));let n=rn({0:[Gt(t.id)],1:(t.relays||[]).map(r=>gt.encode(r)),2:t.author?[Gt(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return ye("nevent",n)}function ha(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=rn({0:[gt.encode(t.identifier)],1:(t.relays||[]).map(r=>gt.encode(r)),2:[Gt(t.pubkey)],3:[new Uint8Array(e)]});return ye("naddr",n)}function da(t){let e=rn({0:[gt.encode(t)]});return ye("nrelay",e)}function rn(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),e.push(s)})}),se(...e)}var pa={};D(pa,{decrypt:()=>ga,encrypt:()=>Co});function Co(t,e,n){return K(this,null,function*(){let r=t instanceof Uint8Array?J(t):t,o=Ot.getSharedSecret(r,"02"+e),s=No(o),i=Uint8Array.from(He(16)),c=gt.encode(n),a=Vn(s,i).encrypt(c),f=at.encode(new Uint8Array(a)),l=at.encode(new Uint8Array(i.buffer));return`${f}?iv=${l}`})}function ga(t,e,n){return K(this,null,function*(){let r=t instanceof Uint8Array?J(t):t,[o,s]=n.split("?iv="),i=Ot.getSharedSecret(r,"02"+e),c=No(i),a=at.decode(s),f=at.decode(o),l=Vn(c,a).decrypt(f);return Bt.decode(l)})}function No(t){return t.slice(1,33)}var ya={};D(ya,{NIP05_REGEX:()=>Ho,isValid:()=>xa,queryProfile:()=>Po,searchDomain:()=>ba,useFetchImplementation:()=>wa});var Ho=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,on;try{on=fetch}catch{}function wa(t){on=t}function ba(t,e=""){return K(this,null,function*(){try{let n=`https://${t}/.well-known/nostr.json?name=${e}`;return(yield(yield on(n,{redirect:"error"})).json()).names}catch{return{}}})}function Po(t){return K(this,null,function*(){let e=t.match(Ho);if(!e)return null;let[n,r="_",o]=e;try{let s=`https://${o}/.well-known/nostr.json?name=${r}`,i=yield(yield on(s,{redirect:"error"})).json(),c=i.names[r];return c?{pubkey:c,relays:i.relays?.[c]}:null}catch{return null}})}function xa(t,e){return K(this,null,function*(){let n=yield Po(e);return n?n.pubkey===t:!1})}var ma={};D(ma,{parse:()=>Ea});function Ea(t){let e={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(let r of t.tags)r[0]==="e"&&r[1]&&n.push(r),r[0]==="p"&&r[1]&&e.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){let o=n[r],[s,i,c,a]=o,f={id:i,relays:c?[c]:[]},l=r===0,u=r===n.length-1;if(a==="root"){e.root=f;continue}if(a==="reply"){e.reply=f;continue}if(a==="mention"){e.mentions.push(f);continue}if(l){e.root=f;continue}if(u){e.reply=f;continue}e.mentions.push(f)}return e}var va={};D(va,{fetchRelayInformation:()=>Aa,useFetchImplementation:()=>Ba});var $o;try{$o=fetch}catch{}function Ba(t){$o=t}function Aa(t){return K(this,null,function*(){return yield(yield fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()})}var _a={};D(_a,{getPow:()=>qo,minePow:()=>La});function qo(t){let e=0;for(let n=0;n<t.length;n++){let r=parseInt(t[n],16);if(r===0)e+=4;else{e+=Math.clz32(r)-28;break}}return e}function La(t,e){let n=0,r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){let s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=Xe(r),qo(r.id)>=e)break}return r}var Sa={};D(Sa,{finishRepostEvent:()=>Ta,getRepostedEvent:()=>Ia,getRepostedEventPointer:()=>Mo});function Ta(t,e,n,r){return Vt({kind:Jn,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function Mo(t){if(t.kind!==Jn)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Ia(t,{skipVerification:e}={}){let n=Mo(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!Fe(r)))return r}var Ua={};D(Ua,{NOSTR_URI_REGEX:()=>sn,parse:()=>Oa,test:()=>ka});var sn=new RegExp(`nostr:(${Ro.source})`);function ka(t){return typeof t=="string"&&new RegExp(`^${sn.source}$`).test(t)}function Oa(t){let e=t.match(new RegExp(`^${sn.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:en(e[1])}}var Ra={};D(Ra,{finishReactionEvent:()=>Ca,getReactedEventPointer:()=>Na});function Ca(t,e,n){let r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return Vt(ut(Q({},t),{kind:Yn,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"}),n)}function Na(t){if(t.kind!==Yn)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Ha={};D(Ha,{matchAll:()=>Pa,regex:()=>Fn,replaceAll:()=>$a});var Fn=()=>new RegExp(`\\b${sn.source}\\b`,"g");function*Pa(t){let e=t.matchAll(Fn());for(let n of e)try{let[r,o]=n;yield{uri:r,value:o,decoded:en(o),start:n.index,end:n.index+r.length}}catch{}}function $a(t,e){return t.replaceAll(Fn(),(n,r)=>e({uri:n,value:r,decoded:en(r)}))}var qa={};D(qa,{channelCreateEvent:()=>Ma,channelHideMessageEvent:()=>Va,channelMessageEvent:()=>Ka,channelMetadataEvent:()=>ja,channelMuteUserEvent:()=>Da});var Ma=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return Vt({kind:Eo,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},ja=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return Vt({kind:vo,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Ka=(t,e)=>{let n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),Vt({kind:Bo,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Va=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return Vt({kind:Ao,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Da=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return Vt({kind:_o,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},Wa={};D(Wa,{EMOJI_SHORTCODE_REGEX:()=>jo,matchAll:()=>za,regex:()=>tr,replaceAll:()=>Za});var jo=/:(\w+):/,tr=()=>new RegExp(`\\B${jo.source}\\B`,"g");function*za(t){let e=t.matchAll(tr());for(let n of e)try{let[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Za(t,e){return t.replaceAll(tr(),(n,r)=>e({shortcode:n,name:r}))}var Ga={};D(Ga,{useFetchImplementation:()=>Ja,validateGithub:()=>Ya});var er;try{er=fetch}catch{}function Ja(t){er=t}function Ya(t,e,n){return K(this,null,function*(){try{return(yield(yield er(`https://gist.github.com/${e}/${n}/raw`)).text())===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}})}var Xa={};D(Xa,{decrypt:()=>Go,encrypt:()=>Zo,getConversationKey:()=>Do,v2:()=>nf});var Ko=1,Vo=65535;function Do(t,e){let n=Ot.getSharedSecret(t,"02"+e).subarray(1,33);return uo(Ht,n,"nip44-v2")}function Wo(t,e){let n=ho(Ht,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function nr(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;let e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Qa(t){if(!Number.isSafeInteger(t)||t<Ko||t>Vo)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function Fa(t){let e=gt.encode(t),n=e.length,r=Qa(n),o=new Uint8Array(nr(n)-n);return se(r,e,o)}function tf(t){let e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Ko||e>Vo||n.length!==e||t.length!==2+nr(e))throw new Error("invalid padding");return Bt.decode(n)}function zo(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=se(n,e);return ae(Ht,t,r)}function ef(t){if(typeof t!="string")throw new Error("payload must be a valid string");let e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=at.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Zo(t,e,n=He(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=Wo(e,n),i=Fa(t),c=Ge(r,o,i),a=zo(s,c,n);return at.encode(se(new Uint8Array([2]),n,c,a))}function Go(t,e){let{nonce:n,ciphertext:r,mac:o}=ef(t),{chacha_key:s,chacha_nonce:i,hmac_key:c}=Wo(e,n),a=zo(c,r,n);if(!Yt(a,o))throw new Error("invalid MAC");let f=Ge(s,i,r);return tf(f)}var nf={utils:{getConversationKey:Do,calcPaddedLen:nr},encrypt:Zo,decrypt:Go},rf={};D(rf,{makeNwcRequestEvent:()=>sf,parseConnectionString:()=>of});function of(t){let{pathname:e,searchParams:n}=new URL(t),r=e,o=n.get("relay"),s=n.get("secret");if(!r||!o||!s)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:s}}function sf(t,e,n){return K(this,null,function*(){let o=yield Co(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:So,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return Vt(s,e)})}var cf={};D(cf,{getZapEndpoint:()=>ff,makeZapReceipt:()=>hf,makeZapRequest:()=>lf,useFetchImplementation:()=>af,validateZapRequest:()=>uf});var rr;try{rr=fetch}catch{}function af(t){rr=t}function ff(t){return K(this,null,function*(){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:i}=$t.decode(n,1e3),c=$t.fromWords(i);e=Bt.decode(c)}else if(r){let[i,c]=r.split("@");e=new URL(`/.well-known/lnurlp/${i}`,`https://${c}`).toString()}else return null;let s=yield(yield rr(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null})}function lf({profile:t,event:e,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function uf(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!po(e))return"Zap request is not a valid Nostr event.";if(!Fe(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function hf({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),s=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}var df={};D(df,{getToken:()=>pf,hashPayload:()=>or,unpackEventFromToken:()=>Yo,validateEvent:()=>ns,validateEventKind:()=>Qo,validateEventMethodTag:()=>ts,validateEventPayloadTag:()=>es,validateEventTimestamp:()=>Xo,validateEventUrlTag:()=>Fo,validateToken:()=>gf});var Jo="Nostr ";function pf(t,e,n,r=!1,o){return K(this,null,function*(){let s={kind:Xn,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",or(o)]);let i=yield n(s);return(r?Jo:"")+at.encode(gt.encode(JSON.stringify(i)))})}function gf(t,e,n){return K(this,null,function*(){let r=yield Yo(t).catch(s=>{throw s});return yield ns(r,e,n).catch(s=>{throw s})})}function Yo(t){return K(this,null,function*(){if(!t)throw new Error("Missing token");t=t.replace(Jo,"");let e=Bt.decode(at.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)})}function Xo(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function Qo(t){return t.kind===Xn}function Fo(t,e){let n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function ts(t,e){let n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function or(t){let e=Ht(gt.encode(JSON.stringify(t)));return J(e)}function es(t,e){let n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;let r=or(e);return n.length>0&&n[1]===r}function ns(t,e,n,r){return K(this,null,function*(){if(!Fe(t))throw new Error("Invalid nostr event, signature invalid");if(!Qo(t))throw new Error("Invalid nostr event, kind invalid");if(!Xo(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Fo(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!ts(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!es(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0})}export{J as a,at as b,yl as c,Xe as d,iu as e,cu as f,Vt as g,au as h,sa as i,pa as j};
