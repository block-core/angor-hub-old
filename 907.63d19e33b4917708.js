"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[907],{5907:(Z,x,i)=>{i.r(x),i.d(x,{default:()=>J});var l=i(467),m=i(8834),$=i(6600),j=i(2102),y=i(9213),P=i(9042),I=i(7575),M=i(2798),b=i(450),N=i(4823),D=i(5167),g=i(177),R=i(1413),S=i(6977),t=i(3953),E=i(9437),C=i(7673),k=i(1626),w=i(833),F=i(4224);let A=(()=>{class s{constructor(e,r,o){this.http=e,this.indexerService=r,this.indexedDBService=o,this.offset=0,this.limit=20,this.totalProjects=0,this.loading=!1,this.projects=[],this.noMoreProjects=!1,this.totalProjectsFetched=!1,this.selectedNetwork="testnet",this.loadNetwork()}loadNetwork(){this.selectedNetwork=this.indexerService.getNetwork()}fetchProjects(){var e=this;return(0,l.A)(function*(){if(e.loading||e.noMoreProjects)return[];e.loading=!0;const r=e.indexerService.getPrimaryIndexer(e.selectedNetwork),o=e.totalProjectsFetched?`${r}api/query/Angor/projects?offset=${e.offset}&limit=${e.limit}`:`${r}api/query/Angor/projects?limit=${e.limit}`;try{const n=yield e.http.get(o,{observe:"response"}).toPromise();if(!e.totalProjectsFetched&&n&&n.headers){const h=n.headers.get("pagination-total");e.totalProjects=h?+h:0,e.totalProjectsFetched=!0,e.offset=Math.max(e.totalProjects-e.limit,0)}const c=n?.body||[];if(!c.length)return e.noMoreProjects=!0,[];const a=c.filter(h=>!e.projects.some(u=>u.projectIdentifier===h.projectIdentifier));if(!a.length)return e.noMoreProjects=!0,[];const d=a.map(function(){var h=(0,l.A)(function*(u){yield e.indexedDBService.saveProject(u)});return function(u){return h.apply(this,arguments)}}()),f=a.map(function(){var h=(0,l.A)(function*(u){try{const v=yield e.indexedDBService.getProjectStats(u.projectIdentifier);return u.totalInvestmentsCount=v?.investorCount??0,u}catch(v){return console.error(`Error fetching details for project ${u.projectIdentifier}:`,v),u}});return function(u){return h.apply(this,arguments)}}());return yield Promise.all([...d,...f]),e.projects=[...e.projects,...a],e.offset=Math.max(e.offset-e.limit,0),a}catch(n){return console.error("Error fetching projects:",n),[]}finally{e.loading=!1}})()}fetchProjectStats(e){const o=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${e}/stats`;return this.http.get(o).pipe((0,E.W)(n=>(console.error(`Error fetching stats for project ${e}:`,n),(0,C.of)({}))))}fetchAndSaveProjectStats(e){var r=this;return(0,l.A)(function*(){try{const o=yield r.fetchProjectStats(e).toPromise();return o&&(yield r.indexedDBService.saveProjectStats(e,o)),o}catch(o){return console.error(`Error fetching and saving stats for project ${e}:`,o),null}})()}fetchProjectDetails(e){const o=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${e}`;return this.http.get(o).pipe((0,E.W)(n=>(console.error(`Error fetching details for project ${e}:`,n),(0,C.of)({}))))}fetchAndSaveProjectDetails(e){var r=this;return(0,l.A)(function*(){try{const o=yield r.fetchProjectDetails(e).toPromise();return o&&(yield r.indexedDBService.saveProject(o)),o}catch(o){return console.error(`Error fetching and saving details for project ${e}:`,o),null}})()}getAllProjectsFromDB(){var e=this;return(0,l.A)(function*(){return e.indexedDBService.getAllProjects()})()}getProjectStatsFromDB(e){var r=this;return(0,l.A)(function*(){return r.indexedDBService.getProjectStats(e)})()}getProjects(){return this.projects}resetProjects(){this.projects=[],this.noMoreProjects=!1,this.offset=0,this.totalProjectsFetched=!1}static#e=this.\u0275fac=function(r){return new(r||s)(t.KVO(k.Qq),t.KVO(w.F),t.KVO(F.n))};static#t=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var B=i(9192),T=i(4412);let U=(()=>{class s{constructor(){this.projects=[],this.projectsSubject=new T.t([])}getProjectsObservable(){return this.projectsSubject.asObservable()}setProjects(e){this.projects=e,this.projectsSubject.next(this.projects)}getProjects(){return this.projects}hasProjects(){return this.projects.length>0}updateProject(e){const r=this.projects.findIndex(o=>o.nostrPubKey===e.nostrPubKey);r>-1?this.projects[r]=e:this.projects.push(e),this.projectsSubject.next(this.projects)}getProjectByPubKey(e){return this.projects.find(r=>r.nostrPubKey===e)}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var G=i(1553),K=i(345),V=i(7253);const X=()=>[],Y=s=>({"-ml-3":s});function _(s,p){if(1&s){const e=t.RV6();t.j41(0,"div",40),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,n=t.XpG();return t.Njj(n.goToProjectDetails(o))}),t.EFF(1),t.k0s()}if(2&s){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e.displayName||e.nostrPubKey," ")}}function O(s,p){if(1&s&&(t.j41(0,"div",34),t.EFF(1),t.k0s()),2&s){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e.displayName||e.nostrPubKey," ")}}function z(s,p){if(1&s){const e=t.RV6();t.j41(0,"div",36)(1,"button",41),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,n=t.XpG();return t.Njj(n.openChat(o.nostrPubKey))}),t.nrm(2,"mat-icon",42),t.k0s()()}2&s&&(t.R7$(2),t.Y8G("svgIcon","heroicons_outline:chat-bubble-left-right"))}function L(s,p){if(1&s&&(t.qex(0),t.nrm(1,"img",44),t.bVm()),2&s){const e=t.XpG().index,r=t.XpG().$implicit;t.R7$(),t.Mz_("alt","Investor avatar ",e+1,""),t.Y8G("ngClass",t.eq3(4,Y,r.totalInvestmentsCount>1&&e>0))("src","images/avatars/avatar-placeholder.png",t.B4B)}}function W(s,p){if(1&s&&(t.qex(0),t.DNE(1,L,2,6,"ng-container",43),t.bVm()),2&s){const e=p.index;t.R7$(),t.Y8G("ngIf",e<10)}}function Q(s,p){if(1&s&&(t.qex(0),t.j41(1,"angor-card",24)(2,"div",25),t.nrm(3,"img",26),t.k0s(),t.j41(4,"div",27)(5,"div",28),t.nrm(6,"img",29),t.k0s()(),t.j41(7,"div",30)(8,"div",31)(9,"div",32),t.DNE(10,_,2,1,"div",33)(11,O,2,1,"div",34),t.j41(12,"div",35),t.EFF(13),t.k0s()(),t.DNE(14,z,3,1,"div",36),t.k0s(),t.nrm(15,"hr",37),t.j41(16,"div",31)(17,"div",38),t.EFF(18),t.k0s(),t.j41(19,"div",39),t.DNE(20,W,2,1,"ng-container",20),t.k0s()()()(),t.bVm()),2&s){const e=p.$implicit,r=t.XpG();t.R7$(3),t.Y8G("src",r.getSafeUrl(null==e?null:e.banner,!0)||"images/pages/profile/cover.jpg",t.B4B),t.R7$(3),t.Y8G("src",r.getSafeUrl(null==e?null:e.picture,!1)||"images/avatars/avatar-placeholder.png",t.B4B),t.R7$(4),t.vxM(e.displayName||e.name?10:-1),t.R7$(),t.vxM(e.name||e.displayName?-1:11),t.R7$(2),t.SpI(" ",e.about||"No description available"," "),t.R7$(),t.vxM(e.displayName||e.name?14:-1),t.R7$(4),t.SpI(" ",e.totalInvestmentsCount||0," investors "),t.R7$(2),t.Y8G("ngForOf",t.lJ4(8,X).constructor(e.totalInvestmentsCount||0))}}function H(s,p){if(1&s&&(t.j41(0,"div",45),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.SpI(" ",e.errorMessage," ")}}const J=[{path:"",component:(()=>{class s{constructor(e,r,o,n,c,a,d,f){this.projectService=e,this.router=r,this.stateService=o,this.metadataService=n,this.indexedDBService=c,this.changeDetectorRef=a,this.sanitizer=d,this._chatService=f,this.projects=[],this.errorMessage="",this.loading=!1,this.metadataLoadLimit=5,this._unsubscribeAll=new R.B,this.filteredProjects=[]}ngOnInit(){var e=this;return(0,l.A)(function*(){e.loadInitialProjects(),e.subscribeToMetadataUpdates()})()}loadInitialProjects(){var e=this;return(0,l.A)(function*(){try{if(e.loading=!0,e.projects=e.stateService.getProjects(),0===e.projects.length)yield e.loadProjectsFromService();else{e.filteredProjects=[...e.projects];const r=e.getProjectsWithoutMetadata();r.length>0&&(yield e.loadMetadataForProjects(r))}}catch{e.handleError("Error loading initial projects")}finally{e.loading=!1,e.changeDetectorRef.detectChanges()}})()}loadProjectsFromService(){var e=this;return(0,l.A)(function*(){try{const r=yield e.projectService.fetchProjects();if(0===r.length)return void(e.errorMessage="No projects found");e.projects=r,e.filteredProjects=[...e.projects],e.stateService.setProjects(e.projects);const o=r.map(n=>n.nostrPubKey);yield e.loadMetadataForProjects(o)}catch{e.handleError("Error fetching projects from service")}})()}subscribeToMetadataUpdates(){this.indexedDBService.getMetadataStream().pipe((0,S.Q)(this._unsubscribeAll)).subscribe(e=>{if(e){const r=this.projects.find(o=>o.nostrPubKey===e.pubkey);r&&this.updateProjectMetadata(r,e.metadata)}})}getProjectsWithoutMetadata(){return this.projects.filter(e=>!e.displayName||!e.about).map(e=>e.nostrPubKey)}loadMetadataForProjects(e){var r=this;return(0,l.A)(function*(){const o=e.map(function(){var a=(0,l.A)(function*(d){const f=yield r.indexedDBService.getUserMetadata(d);return f?{pubkey:d,metadata:f}:null});return function(d){return a.apply(this,arguments)}}()),n=yield Promise.all(o),c=n.filter(a=>null===a).map((a,d)=>e[d]);n.forEach(a=>{if(a&&a.metadata){const d=r.projects.find(f=>f.nostrPubKey===a.pubkey);d&&r.updateProjectMetadata(d,a.metadata)}}),c.length>0&&(yield r.metadataService.fetchMetadataForMultipleKeys(c).then(a=>{a.forEach(d=>{const f=r.projects.find(h=>h.nostrPubKey===d.pubkey);f&&r.updateProjectMetadata(f,d)}),r.changeDetectorRef.detectChanges()}).catch(a=>{console.error("Error fetching metadata for projects:",a)}))})()}loadProjects(){var e=this;return(0,l.A)(function*(){e.loading||"No more projects found"===e.errorMessage||(e.loading=!0,e.projectService.fetchProjects().then(function(){var r=(0,l.A)(function*(o){if(0===o.length&&0===e.projects.length)e.errorMessage="No projects found";else if(0===o.length)e.errorMessage="No more projects found";else{e.projects=[...e.projects,...o],e.filteredProjects=[...e.projects];const n=o.map(c=>c.nostrPubKey);yield e.loadMetadataForProjects(n),e.stateService.setProjects(e.projects),e.projects.forEach(c=>e.subscribeToProjectMetadata(c))}e.loading=!1,e.changeDetectorRef.detectChanges()});return function(o){return r.apply(this,arguments)}}()).catch(r=>{console.error("Error fetching projects:",r),e.errorMessage="Error fetching projects. Please try again later.",e.loading=!1,e.changeDetectorRef.detectChanges()}))})()}loadMetadataForProject(e){var r=this;return(0,l.A)(function*(){try{const o=yield r.metadataService.fetchMetadataWithCache(e.nostrPubKey);o?r.updateProjectMetadata(e,o):console.warn(`No metadata found for project ${e.nostrPubKey}`)}catch(o){console.error(`Error fetching metadata for project ${e.nostrPubKey}:`,o)}})()}updateProjectMetadata(e,r){const o={...e,displayName:r.name||"",about:r.about?r.about.replace(/<\/?[^>]+(>|$)/g,""):"",picture:r.picture||"",banner:r.banner||""},n=this.projects.findIndex(c=>c.projectIdentifier===e.projectIdentifier);-1!==n&&(this.projects[n]=o,this.projects=[...this.projects]),this.filteredProjects=[...this.projects],this.changeDetectorRef.detectChanges()}subscribeToProjectMetadata(e){this.metadataService.getMetadataStream().pipe((0,S.Q)(this._unsubscribeAll)).subscribe(r=>{r&&r.pubkey===e.nostrPubKey&&this.updateProjectMetadata(e,r.metadata)})}goToProjectDetails(e){this.loading=!0,this.projectService.fetchAndSaveProjectStats(e.projectIdentifier).then(r=>{r?this.navigateToProfile(e.nostrPubKey):(console.error("Failed to fetch project stats from API"),this.handleError("Error fetching project stats"))}).catch(r=>{this.handleError("Error fetching project stats from server")}).finally(()=>{this.loading=!1})}navigateToProfile(e){this.router.navigate(["/profile",e])}filterByQuery(e){if(!e||""===e.trim())return this.filteredProjects=[...this.projects],void this.changeDetectorRef.detectChanges();const r=e.toLowerCase();this.filteredProjects=this.projects.filter(o=>o.displayName&&o.displayName.toLowerCase().includes(r)||o.about&&o.about.toLowerCase().includes(r)||o.displayName&&o.displayName.toLowerCase().includes(r)||o.nostrPubKey&&o.nostrPubKey.toLowerCase().includes(r)||o.projectIdentifier&&o.projectIdentifier.toLowerCase().includes(r)),this.changeDetectorRef.detectChanges()}toggleCompleted(e){}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}handleError(e){console.error(e),this.errorMessage=e,this.loading=!1,this.changeDetectorRef.detectChanges()}getSafeUrl(e,r){return e&&"string"==typeof e&&this.isImageUrl(e)?this.sanitizer.bypassSecurityTrustUrl(e):this.sanitizer.bypassSecurityTrustUrl(r?"/images/pages/profile/cover.jpg":"images/avatars/avatar-placeholder.png")}isImageUrl(e){return/\.(jpeg|jpg|gif|png|svg|bmp|webp|tiff|ico)$/i.test(e)}openChat(e){var r=this;return(0,l.A)(function*(){try{const o=yield r.metadataService.fetchMetadataWithCache(e);if(o){const n={pubKey:e,name:o.name||"Unknown",picture:o.picture||"/images/avatars/avatar-placeholder.png",about:o.about||"",displayName:o.displayName||o.name||"Unknown"};r._chatService.getChatById(n.pubKey,n).subscribe(c=>{r.router.navigate(["/chat",n.pubKey])})}else console.error("No metadata found for the public key:",e)}catch(o){console.error("Error opening chat:",o)}})()}static#e=this.\u0275fac=function(r){return new(r||s)(t.rXU(A),t.rXU(B.Ix),t.rXU(U),t.rXU(G.T),t.rXU(F.n),t.rXU(t.gRc),t.rXU(K.up),t.rXU(V.m))};static#t=this.\u0275cmp=t.VBU({type:s,selectors:[["explore"]],standalone:!0,features:[t.aNF],decls:29,vars:7,consts:[["query",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-y-auto"],[1,"dark","relative","flex-0","overflow-hidden","bg-gray-800","px-4","py-8","sm:p-16"],["viewBox","0 0 960 540","width","100%","height","100%","preserveAspectRatio","xMidYMax slice","xmlns","http://www.w3.org/2000/svg",1,"pointer-events-none","absolute","inset-0"],["fill","none","stroke","currentColor","stroke-width","100",1,"text-gray-700","opacity-25"],["r","234","cx","196","cy","23"],["r","234","cx","790","cy","491"],[1,"relative","z-10","flex","flex-col","items-center"],[1,"text-xl","font-semibold"],[1,"mt-1","text-center","text-4xl","font-extrabold","leading-tight","tracking-tight","sm:text-7xl"],[1,"text-secondary","mt-6","max-w-2xl","text-center","tracking-tight","sm:text-2xl"],[1,"p-6","sm:p-10"],[1,"mx-auto","flex","w-full","max-w-xs","flex-auto","flex-col","sm:max-w-5xl"],[1,"flex","w-full","max-w-xs","flex-col","items-center","justify-between","sm:max-w-none","sm:flex-row"],[1,"mt-4","w-full","sm:mt-0","sm:w-72",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["placeholder","Search ...","matInput","",3,"keyup.enter"],[1,"mt-8","sm:ml-auto","sm:mt-0",3,"change","color"],[1,"mx-auto","flex","w-full","flex-auto","flex-col","sm:max-w-5xl"],[1,"mt-10","grid","w-full","min-w-0","grid-cols-1","gap-6","sm:grid-cols-1","md:grid-cols-1","lg:grid-cols-2"],[4,"ngFor","ngForOf"],[1,"mt-10","flex","justify-center"],["mat-raised-button","","color","primary",3,"click","disabled"],["class","error-message",4,"ngIf"],[1,"filter-info","flex","w-full","flex-col"],[1,"flex","h-32"],["onerror","this.onerror=null; this.src='/images/pages/profile/cover.jpg';","alt","Card cover image",1,"object-cover",3,"src"],[1,"flex","px-8"],[1,"bg-card","-mt-12","rounded-full","p-1"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Project logo",1,"h-24","w-24","rounded-full","object-cover",3,"src"],[1,"flex","flex-col","px-8","pb-6","pt-4"],[1,"flex","items-center","justify-between"],[1,"mr-4","min-w-0","flex-1"],["role","button",1,"truncate","text-2xl","font-semibold","leading-tight"],[1,"truncate","text-2xl","font-semibold","leading-tight"],[1,"text-secondary","mt-1","truncate","leading-tight"],[1,"flex","h-10","w-10","items-center","justify-center","rounded-full","border"],[1,"my-6","w-full","border-t"],[1,"text-secondary","mr-3","text-md","font-medium"],[1,"flex","items-center"],["role","button",1,"truncate","text-2xl","font-semibold","leading-tight",3,"click"],["mat-icon-button","",3,"click"],[1,"icon-size-5",3,"svgIcon"],[4,"ngIf"],[1,"text-card","ring-bg-card","m-0.5","h-6","w-6","rounded-full","ring-2",3,"ngClass","src","alt"],[1,"error-message"]],template:function(r,o){if(1&r){const n=t.RV6();t.j41(0,"div",1)(1,"div",2),t.qSk(),t.j41(2,"svg",3)(3,"g",4),t.nrm(4,"circle",5)(5,"circle",6),t.k0s()(),t.joV(),t.j41(6,"div",7)(7,"h2",8),t.EFF(8,"Explore Projects"),t.k0s(),t.j41(9,"div",9),t.EFF(10," What\u2019s your next investment? "),t.k0s(),t.j41(11,"div",10),t.EFF(12," Check out our projects and find your next investment opportunity. "),t.k0s()()(),t.j41(13,"div",11)(14,"div",12)(15,"div",13)(16,"mat-form-field",14),t.nrm(17,"mat-icon",15),t.j41(18,"input",16,0),t.bIt("keyup.enter",function(){t.eBV(n);const a=t.sdS(19);return t.Njj(o.filterByQuery(a.value))}),t.k0s()(),t.j41(20,"mat-slide-toggle",17),t.bIt("change",function(a){return t.eBV(n),t.Njj(o.toggleCompleted(a))}),t.EFF(21," Hide completed "),t.k0s()()(),t.j41(22,"div",18)(23,"div",19),t.DNE(24,Q,21,9,"ng-container",20),t.k0s(),t.j41(25,"div",21)(26,"button",22),t.bIt("click",function(){return t.eBV(n),t.Njj(o.loadProjects())}),t.EFF(27),t.k0s()(),t.DNE(28,H,2,1,"div",23),t.k0s()()()}2&r&&(t.R7$(16),t.Y8G("subscriptSizing","dynamic"),t.R7$(),t.Y8G("svgIcon","heroicons_solid:magnifying-glass"),t.R7$(3),t.Y8G("color","primary"),t.R7$(4),t.Y8G("ngForOf",o.filteredProjects),t.R7$(2),t.Y8G("disabled",o.loading),t.R7$(),t.SpI(" ",o.loading?"Loading...":"Load More Projects"," "),t.R7$(),t.Y8G("ngIf",!o.loading&&o.errorMessage))},dependencies:[m.Hl,m.$z,m.iY,y.m_,y.An,D.n,j.RG,j.rl,j.JW,M.Ve,$.Sy,P.fS,P.fg,b.mV,b.sG,g.YU,N.uc,I.PO,g.MD,g.Sq,g.bT],encapsulation:2})}return s})()}]}}]);