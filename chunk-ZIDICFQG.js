import{a as ae,b as re,c as ce,d as le}from"./chunk-LKKRLEHJ.js";import{a as se,b as me,c as de,d as pe}from"./chunk-TXXDQLF3.js";import{h as We}from"./chunk-3Q7ZV3LD.js";import{b as et}from"./chunk-ZSOMQRTJ.js";import{t as Xe,v as Ye}from"./chunk-PWH2GQNP.js";import{A as Ke,B as Qe,D as Ze,H as Ge,L as qe,T as Je,V as L,W,q as He,t as oe,y as H,z as U}from"./chunk-4AZPYN7Q.js";import"./chunk-7WK6GZSZ.js";import{$ as A,X as Ue,Z as D,_ as Le,ba as S,ca as k}from"./chunk-MH4Z64LL.js";import{$a as u,Aa as I,Ab as Ae,Ba as a,Bb as _,Ca as M,D as ye,Db as J,Eb as X,F as we,Fb as Y,Hb as x,Ib as je,Jb as Be,Kb as B,Mb as Oe,Ob as Q,P as _e,Pa as h,Q as C,Qb as Z,Rb as Ve,S as ge,Ua as s,W as Me,Wa as ve,Wb as ee,Z as z,_ as $,_a as P,ab as N,ba as v,bb as R,cb as r,db as c,dc as te,eb as m,gc as ze,h as xe,hb as Ee,ia as y,ib as K,ic as $e,j as Ce,ja as w,k as T,ka as Se,l as V,lb as g,nb as p,oc as Pe,q as be,qa as ke,r as q,t as he,tb as Fe,tc as Ne,ub as Te,vb as De,wc as ie,xc as Re,yb as j,yc as ne,za as Ie,zb as d}from"./chunk-LP5NDBXI.js";var tt=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=v({type:n,selectors:[["chat"]],standalone:!0,features:[x],decls:3,vars:0,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex","flex-auto","overflow-hidden"]],template:function(t,l){t&1&&(r(0,"div",0)(1,"div",1),m(2,"router-outlet"),c()())},dependencies:[ie],encapsulation:2,changeDetection:0});let e=n;return e})();var b=(()=>{let n=class n{constructor(i,t,l,f,E){this._httpClient=i,this._metadataService=t,this._signerService=l,this._indexedDBService=f,this._sanitizer=E,this._chat=new V(null),this._chats=new V(null),this._contact=new V(null),this._contacts=new V(null),this._profile=new V(null),this._unsubscribeAll=new T}get chat$(){return this._chat.asObservable()}get chats$(){return this._chats.asObservable()}get contact$(){return this._contact.asObservable()}get contacts$(){return this._contacts.asObservable()}get profile$(){return this._profile.asObservable()}getChats(){return this._httpClient.get("api/apps/chat/chats").pipe(ge(i=>{this._chats.next(i)}))}getContact(i){return this._httpClient.get("api/apps/chat/contacts",{params:{id:i}}).pipe(ge(t=>{this._contact.next(t)}))}getContacts(){return new Ce(i=>(this._indexedDBService.getAllUsers().then(t=>{t.length>0&&(this._contacts.next(t),i.next(t));let l=t.map(f=>f.pubKey);l.length>0&&this.subscribeToRealTimeContacts(l,i)}).catch(t=>{console.error("Error loading cached contacts:",t),i.error(t)}),()=>{}))}subscribeToRealTimeContacts(i,t){this._metadataService.fetchMetadataForMultipleKeys(i).then(l=>{l.forEach(f=>{let E=this._contacts.value?.find(F=>F.pubKey===f.pubkey);if(E)E.displayName=f.name,E.picture=f.picture,E.about=f.about;else{let F=[...this._contacts.value||[],{pubKey:f.pubkey,displayName:f.name,picture:f.picture,about:f.about}];this._contacts.next(F),t.next(F)}}),t.next(this._contacts.value||[])}).catch(l=>{console.error("Error fetching metadata for contacts:",l),t.error(l)})}getProfile(){return xe(this,null,function*(){try{let i=this._signerService.getPublicKey(),t=yield this._metadataService.fetchMetadataWithCache(i);t&&(this._profile.next(t),this._indexedDBService.getMetadataStream().pipe(C(this._unsubscribeAll)).subscribe(l=>{l&&l.pubkey===i&&this._profile.next(l.metadata)}))}catch(i){console.error("Error fetching profile metadata:",i)}})}getChatById(i){return this._httpClient.get("api/apps/chat/chat",{params:{id:i}}).pipe(he(t=>(this._chat.next(t),t)),_e(t=>t?be(t):q("Could not find chat with id "+i)))}updateChat(i,t){return this.chats$.pipe(we(1),_e(l=>this._httpClient.patch("api/apps/chat/chat",{id:i,chat:t}).pipe(he(f=>{if(l){let E=l.findIndex(F=>F.id===i);E!==-1&&(l[E]=f,this._chats.next(l))}return f}))))}resetChat(){this._chat.next(null)}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}};n.\u0275fac=function(t){return new(t||n)(z(Pe),z(Ye),z(et),z(Xe),z(Ne))},n.\u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function mt(e,n){if(e&1&&(r(0,"div",8),d(1),c()),e&2){let o=p().$implicit;a(),_(" ",o.name.charAt(0)," ")}}function dt(e,n){if(e&1&&m(0,"img",10),e&2){let o=p().$implicit;s("src",o.picture||"/images/avatars/avatar-placeholder.png",I)}}function pt(e,n){if(e&1&&(r(0,"div",11),d(1),c()),e&2){let o=p().$implicit;a(),_(" ",o.name.charAt(0)," ")}}function ut(e,n){if(e&1&&(h(0,mt,2,1,"div",8),r(1,"div",7)(2,"div",9),h(3,dt,1,1,"img",10)(4,pt,2,1,"div",11),c(),r(5,"div",12)(6,"div",13),d(7),c(),r(8,"div",14),d(9),c()()()),e&2){let o=n.$implicit,i=n.$index,t=p(2);u(i===0||o.name.charAt(0)!==t.contacts[i-1].name.charAt(0)?0:-1),a(3),u(o.picture?3:-1),a(),u(o.picture?-1:4),a(3),_(" ",o.name," "),a(2),_(" ",o.about," ")}}function ft(e,n){if(e&1&&N(0,ut,10,5,"div",7,P().trackByFn,!0),e&2){let o=p();R(o.contacts)}}function ht(e,n){e&1&&(r(0,"div",6),d(1," There are no contacts! "),c())}var it=(()=>{let n=class n{constructor(i){this._chatService=i,this.contacts=[],this._unsubscribeAll=new T}ngOnInit(){this._chatService.contacts$.pipe(C(this._unsubscribeAll)).subscribe(i=>{this.contacts=i})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}trackByFn(i,t){return t.id||i}};n.\u0275fac=function(t){return new(t||n)(M(b))},n.\u0275cmp=v({type:n,selectors:[["chat-new-chat"]],inputs:{drawer:"drawer"},standalone:!0,features:[x],decls:9,vars:2,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","overflow-hidden","dark:bg-default"],[1,"-mb-px","flex","h-18","flex-0","items-center","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"relative","overflow-y-auto"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","dark:hover:bg-hover","hover:bg-gray-100","md:px-8"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-100","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","overflow-hidden","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"]],template:function(t,l){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return l.drawer.close()}),m(3,"mat-icon",3),c(),r(4,"div",4),d(5,"New chat"),c()(),r(6,"div",5),h(7,ft,2,0)(8,ht,2,0,"div",6),c()()),t&2&&(a(3),s("svgIcon","heroicons_outline:arrow-long-left"),a(4),u(l.contacts.length?7:8))},dependencies:[A,D,k,S],encapsulation:2,changeDetection:0});let e=n;return e})();function _t(e,n){if(e&1&&m(0,"img",10),e&2){let o=p();s("src",o.profile.picture||"/images/avatars/avatar-placeholder.png",I)("alt","Profile picture")}}function gt(e,n){if(e&1&&(r(0,"div",11),d(1),c()),e&2){let o=p();a(),_(" ",o.profile.name.charAt(0)," ")}}var at=(()=>{let n=class n{constructor(i){this._chatService=i,this._unsubscribeAll=new T}ngOnInit(){this._chatService.profile$.pipe(C(this._unsubscribeAll)).subscribe(i=>{this.profile=i})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}};n.\u0275fac=function(t){return new(t||n)(M(b))},n.\u0275cmp=v({type:n,selectors:[["chat-profile"]],inputs:{drawer:"drawer"},standalone:!0,features:[x],decls:35,vars:11,consts:[[1,"bg-card","flex","flex-auto","flex-col","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"px-6"],[1,"group","relative","mx-auto","mt-8","flex","h-40","w-40","flex-0","rounded-full"],[1,"absolute","inset-0","hidden","cursor-pointer","flex-col","items-center","justify-center","rounded-full","bg-gray-800","bg-opacity-80","backdrop-blur","backdrop-filter","group-hover:flex"],[1,"text-white",3,"svgIcon"],[1,"mx-6","mt-2","text-center","font-medium","text-white"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mx-2","mt-8","flex","flex-col"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"ngModel"],[1,"mt-4","flex","items-center","justify-end"],["mat-button","",3,"click"],["mat-flat-button","",1,"ml-2",3,"color"]],template:function(t,l){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return l.drawer.close()}),m(3,"mat-icon",3),c(),r(4,"div",4),d(5,"Profile"),c()(),r(6,"div",5)(7,"div",6)(8,"div",7),m(9,"mat-icon",8),r(10,"div",9),d(11," Change Profile Photo "),c()(),h(12,_t,1,2,"img",10)(13,gt,2,1,"div",11),c(),r(14,"div",12)(15,"mat-form-field")(16,"mat-label"),d(17,"Name"),c(),m(18,"mat-icon",13)(19,"input",14),c(),r(20,"mat-form-field")(21,"mat-label"),d(22,"Username"),c(),m(23,"mat-icon",13)(24,"input",14),c(),r(25,"mat-form-field")(26,"mat-label"),d(27,"About"),c(),m(28,"mat-icon",13)(29,"input",14),c(),r(30,"div",15)(31,"button",16),g("click",function(){return l.drawer.close()}),d(32,"Cancel"),c(),r(33,"button",17),d(34," Save "),c()()()()()),t&2&&(a(3),s("svgIcon","heroicons_outline:arrow-long-left"),a(6),s("svgIcon","heroicons_outline:camera"),a(3),u(l.profile.picture?12:-1),a(),u(l.profile.picture?-1:13),a(5),s("svgIcon","heroicons_solid:user-circle"),a(),s("ngModel",l.profile.name),a(4),s("svgIcon","heroicons_solid:at-symbol"),a(),s("ngModel",l.profile.username),a(4),s("svgIcon","heroicons_solid:identification"),a(),s("ngModel",l.profile.about),a(4),s("color","primary"))},dependencies:[A,Ue,D,k,S,U,H,He,oe,W,L,Je,Ze,Ge,qe],encapsulation:2,changeDetection:0});let e=n;return e})();var Ct=(e,n)=>({"dark:hover:bg-hover hover:bg-gray-100":e,"bg-primary-50 dark:bg-hover":n}),bt=e=>[e],yt=(e,n)=>({"absolute inset-0 z-20 flex lg:static lg:inset-auto":e,"hidden lg:flex":n});function wt(e,n){if(e&1&&m(0,"chat-new-chat",6),e&2){p();let o=j(3);s("drawer",o)}}function Mt(e,n){if(e&1&&m(0,"chat-profile",6),e&2){p();let o=j(3);s("drawer",o)}}function St(e,n){if(e&1&&m(0,"img",15),e&2){let o=p(2);s("src",o.profile.picture||"/images/avatars/avatar-placeholder.png",I)}}function kt(e,n){if(e&1&&(r(0,"div",16),d(1),c()),e&2){let o=p(2);a(),_(" ",o.profile.name.charAt(0)," ")}}function It(e,n){if(e&1&&m(0,"div",38),e&2){let o=p().$implicit,i=p(3);ve("ring-primary-50",i.selectedChat&&i.selectedChat.id===o.id)}}function Et(e,n){if(e&1&&m(0,"img",31),e&2){let o=p().$implicit;s("src",o.contact||"/images/avatars/avatar-placeholder.png",I)}}function Ft(e,n){if(e&1&&(r(0,"div",16),d(1),c()),e&2){let o=p().$implicit;a(),_(" ",o.contact.name.charAt(0)," ")}}function Tt(e,n){e&1&&m(0,"mat-icon",37),e&2&&s("svgIcon","heroicons_solid:speaker-x-mark")}function Dt(e,n){if(e&1&&(r(0,"a",28)(1,"div",29),h(2,It,1,2,"div",30)(3,Et,1,1,"img",31)(4,Ft,2,1,"div",16),c(),r(5,"div",32)(6,"div",33),d(7),c(),r(8,"div",34),d(9),c()(),r(10,"div",35)(11,"div",36),d(12),c(),h(13,Tt,1,1,"mat-icon",37),c()()),e&2){let o=n.$implicit,i=p(3);s("ngClass",B(13,Ct,!i.selectedChat||i.selectedChat.id!==o.id,i.selectedChat&&i.selectedChat.id===o.id))("routerLink",Be(16,bt,o.id)),a(2),u(o.unreadCount>0?2:-1),a(),u(o.contact.picture?3:-1),a(),u(o.contact.picture?-1:4),a(3),_(" ",o.contact.name," "),a(),ve("text-primary",o.unreadCount>0)("dark:text-primary-500",o.unreadCount>0),a(),_(" ",o.lastMessage," "),a(3),_(" ",o.lastMessageAt," "),a(),u(o.muted?13:-1)}}function At(e,n){if(e&1&&N(0,Dt,14,18,"a",28,P().trackByFn,!0),e&2){let o=p(2);R(o.filteredChats)}}function jt(e,n){e&1&&(r(0,"div",9),m(1,"mat-icon",39),r(2,"div",40),d(3," No chats "),c()()),e&2&&(a(),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Bt(e,n){if(e&1){let o=K();r(0,"div",8)(1,"div",11)(2,"div",12)(3,"div",13),g("click",function(){y(o);let t=p();return w(t.openProfile())}),r(4,"div",14),h(5,St,1,1,"img",15)(6,kt,2,1,"div",16),c(),r(7,"div",17),d(8),c()(),r(9,"button",18),g("click",function(){y(o);let t=p();return w(t.openNewChat())}),m(10,"mat-icon",19),c(),r(11,"button",20),m(12,"mat-icon",19),r(13,"mat-menu",null,1)(15,"button",21),m(16,"mat-icon",19),d(17," New group "),c(),r(18,"button",21),m(19,"mat-icon",19),d(20," Create a room "),c(),r(21,"button",22),g("click",function(){y(o);let t=p();return w(t.openProfile())}),m(22,"mat-icon",19),d(23," Profile "),c(),r(24,"button",21),m(25,"mat-icon",19),d(26," Archived "),c(),r(27,"button",21),m(28,"mat-icon",19),d(29," Starred "),c(),r(30,"button",21),m(31,"mat-icon",19),d(32," Settings "),c()()()(),r(33,"div",23)(34,"mat-form-field",24),m(35,"mat-icon",25),r(36,"input",26,2),g("input",function(){y(o);let t=j(37),l=p();return w(l.filterChats(t.value))}),c()()()(),r(38,"div",27),h(39,At,2,0)(40,jt,4,1,"div",9),c()()}if(e&2){let o=j(14),i=p();a(5),u(i.profile.picture?5:-1),a(),u(i.profile.picture?-1:6),a(2),_(" ",i.profile.name," "),a(2),s("svgIcon","heroicons_outline:plus-circle"),a(),s("matMenuTriggerFor",o),a(),s("svgIcon","heroicons_outline:ellipsis-vertical"),a(4),s("svgIcon","heroicons_outline:user-group"),a(3),s("svgIcon","heroicons_outline:chat-bubble-left-right"),a(3),s("svgIcon","heroicons_outline:user-circle"),a(3),s("svgIcon","heroicons_outline:archive-box"),a(3),s("svgIcon","heroicons_outline:star"),a(3),s("svgIcon","heroicons_outline:cog-8-tooth"),a(3),s("subscriptSizing","dynamic"),a(),s("svgIcon","heroicons_solid:magnifying-glass"),a(),s("autocomplete","off")("placeholder","Search or start new chat"),a(3),u(i.filteredChats.length>0?39:40)}}function Ot(e,n){e&1&&(r(0,"div",9),m(1,"mat-icon",39),r(2,"div",40),d(3," No chats "),c()()),e&2&&(a(),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Vt(e,n){if(e&1&&(r(0,"div",10),m(1,"router-outlet"),c()),e&2){let o=p();s("ngClass",B(1,yt,o.selectedChat&&o.selectedChat.id,!o.selectedChat||!o.selectedChat.id))}}var rt=(()=>{let n=class n{constructor(i,t){this._chatService=i,this._changeDetectorRef=t,this.drawerOpened=!1,this._unsubscribeAll=new T}ngOnInit(){this._chatService.chats$.pipe(C(this._unsubscribeAll)).subscribe(i=>{this.chats=this.filteredChats=i,this._changeDetectorRef.markForCheck()}),this._chatService.profile$.pipe(C(this._unsubscribeAll)).subscribe(i=>{this.profile=i,this._changeDetectorRef.markForCheck()}),this._chatService.chat$.pipe(C(this._unsubscribeAll)).subscribe(i=>{this.selectedChat=i,this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete(),this._chatService.resetChat()}filterChats(i){if(!i){this.filteredChats=this.chats;return}this.filteredChats=this.chats.filter(t=>t.contact.name.toLowerCase().includes(i.toLowerCase()))}openNewChat(){this.drawerComponent="new-chat",this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}openProfile(){this.drawerComponent="profile",this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}trackByFn(i,t){return t.id||i}};n.\u0275fac=function(t){return new(t||n)(M(b),M(ee))},n.\u0275cmp=v({type:n,selectors:[["chat-chats"]],standalone:!0,features:[x],decls:10,vars:7,consts:[["drawer",""],["chatsHeaderMenu",""],["searchField",""],[1,"bg-card","relative","flex","w-full","flex-auto","dark:bg-transparent"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-r","lg:shadow-none",3,"openedChange","autoFocus","opened"],[3,"drawer"],[1,"flex","overflow-hidden"],[1,"bg-card","relative","flex","w-full","min-w-0","flex-auto","flex-col","dark:bg-transparent","lg:min-w-100","lg:max-w-100"],[1,"flex","h-full","flex-auto","flex-col","items-center","justify-center"],[1,"flex-auto","border-l",3,"ngClass"],[1,"flex","flex-0","flex-col","border-b","bg-gray-50","px-8","py-4","dark:bg-transparent"],[1,"flex","items-center"],[1,"mr-1","flex","cursor-pointer","items-center",3,"click"],[1,"h-10","w-10"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Profile picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","font-medium"],["mat-icon-button","",1,"ml-auto",3,"click"],[3,"svgIcon"],["mat-icon-button","",1,"-mr-4","ml-1",3,"matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"mt-4"],[1,"angor-mat-rounded","angor-mat-dense","w-full",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],[1,"flex-auto","overflow-y-auto"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-8","py-5",3,"ngClass","routerLink"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900",3,"ring-primary-50"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"],[1,"ml-auto","flex","flex-col","items-end","self-start","pl-2"],[1,"text-secondary","text-sm","leading-5"],[1,"text-hint","icon-size-5",3,"svgIcon"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(t,l){if(t&1){let f=K();r(0,"div",3)(1,"mat-drawer-container",4)(2,"mat-drawer",5,0),Y("openedChange",function(F){return y(f),X(l.drawerOpened,F)||(l.drawerOpened=F),w(F)}),h(4,wt,1,1,"chat-new-chat",6)(5,Mt,1,1,"chat-profile",6),c(),r(6,"mat-drawer-content",7),h(7,Bt,41,17,"div",8)(8,Ot,4,1,"div",9)(9,Vt,2,4,"div",10),c()()()}t&2&&(a(),s("hasBackdrop",!1),a(),s("autoFocus",!1),J("opened",l.drawerOpened),a(2),u(l.drawerComponent==="new-chat"?4:-1),a(),u(l.drawerComponent==="profile"?5:-1),a(2),u(l.chats&&l.chats.length>0?7:8),a(2),u(l.chats&&l.chats.length>0?9:-1))},dependencies:[pe,me,de,se,it,at,A,D,k,S,le,re,ae,ce,U,H,oe,W,L,te,ne,ie],encapsulation:2,changeDetection:0});let e=n;return e})();function zt(e,n){if(e&1&&m(0,"img",8),e&2){let o=p();s("src",o.chat.contact.picture||"/images/avatars/avatar-placeholder.png",I)("alt","Contact picture")}}function $t(e,n){if(e&1&&(r(0,"div",9),d(1),c()),e&2){let o=p();a(),_(" ",o.chat.contact.name.charAt(0)," ")}}var ct=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=v({type:n,selectors:[["chat-contact-info"]],inputs:{chat:"chat",drawer:"drawer"},standalone:!0,features:[x],decls:15,vars:5,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-lg","font-medium"],[1,"overflow-y-auto"],[1,"mt-8","flex","flex-col","items-center"],[1,"h-40","w-40","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mt-4","text-lg","font-medium"],[1,"text-secondary","mt-0.5","text-md"]],template:function(t,l){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return l.drawer.close()}),m(3,"mat-icon",3),c(),r(4,"div",4),d(5,"Contact info"),c()(),r(6,"div",5)(7,"div",6)(8,"div",7),h(9,zt,1,2,"img",8)(10,$t,2,1,"div",9),c(),r(11,"div",10),d(12),c(),r(13,"div",11),d(14),c()()()()),t&2&&(a(3),s("svgIcon","heroicons_outline:x-mark"),a(6),u(l.chat.contact.picture?9:-1),a(),u(l.chat.contact.picture?-1:10),a(2),Ae(l.chat.contact.name),a(2),_(" ",l.chat.contact.about," "))},dependencies:[A,D,k,S],encapsulation:2,changeDetection:0});let e=n;return e})();var Pt=["messageInput"],Nt=()=>["./"],Rt=(e,n,o,i)=>({"items-end":e,"items-start":n,"mt-0.5":o,"mt-3":i}),Ht=(e,n)=>({"bg-blue-500 text-blue-50":e,"bg-gray-500 text-gray-50":n}),Ut=(e,n)=>({"-right-1 -mr-px mb-px text-blue-500":e,"-left-1 -ml-px mb-px -scale-x-1 text-gray-500":n}),Lt=(e,n)=>({"mr-3":e,"ml-3":n});function Wt(e,n){if(e&1&&m(0,"img",15),e&2){let o=p(2);s("src",o.chat.contact.picture||"/images/avatars/avatar-placeholder.png",I)}}function Kt(e,n){if(e&1&&(r(0,"div",16),d(1),c()),e&2){let o=p(2);a(),_(" ",o.chat.contact.name.charAt(0)," ")}}function Qt(e,n){e&1&&(m(0,"mat-icon",12),d(1," Mute notifications ")),e&2&&s("svgIcon","heroicons_outline:speaker-x-mark")}function Zt(e,n){e&1&&(m(0,"mat-icon",12),d(1," Unmute notifications ")),e&2&&s("svgIcon","heroicons_outline:speaker-wave")}function Gt(e,n){if(e&1&&(r(0,"div",31),m(1,"div",36),r(2,"div",37),d(3),Q(4,"date"),c(),m(5,"div",36),c()),e&2){let o=p().$implicit;a(3),_(" ",Z(4,1,o.createdAt,"longDate")," ")}}function qt(e,n){e&1&&Ee(0)}function Jt(e,n){if(e&1&&(r(0,"div",33),h(1,qt,1,0,"ng-container",38),c()),e&2){let o=p().$implicit;p(2);let i=j(4);s("ngClass",B(2,Ut,o.isMine,!o.isMine)),a(),s("ngTemplateOutlet",i)}}function Xt(e,n){if(e&1&&(r(0,"div",35),d(1),Q(2,"date"),c()),e&2){let o=p().$implicit;s("ngClass",B(5,Lt,o.isMine,!o.isMine)),a(),_(" ",Z(2,2,o.createdAt,"HH:mm")," ")}}function Yt(e,n){if(e&1&&(h(0,Gt,6,4,"div",31),Q(1,"date"),Q(2,"date"),r(3,"div",23)(4,"div",32),h(5,Jt,2,5,"div",33),m(6,"div",34),c(),h(7,Xt,3,8,"div",35),c()),e&2){let o=n.$implicit,i=n.$index,t=n.$count,l=p(2);u(i===0||Z(1,6,l.chat.messages[i-1].createdAt,"d")!==Z(2,9,o.createdAt,"d")?0:-1),a(3),s("ngClass",Oe(12,Rt,o.isMine,!o.isMine,i>0&&l.chat.messages[i-1].isMine===o.isMine,i>0&&l.chat.messages[i-1].isMine!==o.isMine)),a(),s("ngClass",B(17,Ht,o.isMine,!o.isMine)),a(),u(i===t-1||l.chat.messages[i+1].isMine!==o.isMine?5:-1),a(),s("innerHTML",o.value,Ie),a(),u(i===0||i===t-1||l.chat.messages[i+1].isMine!==o.isMine||l.chat.messages[i+1].createdAt!==o.createdAt?7:-1)}}function ei(e,n){if(e&1){let o=K();r(0,"mat-drawer-container",5)(1,"mat-drawer",7,1),Y("openedChange",function(t){y(o);let l=p();return X(l.drawerOpened,t)||(l.drawerOpened=t),w(t)}),m(3,"chat-contact-info",8),c(),r(4,"mat-drawer-content",9)(5,"div",10)(6,"a",11),g("click",function(){y(o);let t=p();return w(t.resetChat())}),m(7,"mat-icon",12),c(),r(8,"div",13),g("click",function(){y(o);let t=p();return w(t.openContactInfo())}),r(9,"div",14),h(10,Wt,1,1,"img",15)(11,Kt,2,1,"div",16),c(),r(12,"div",17),d(13),c()(),r(14,"button",18),m(15,"mat-icon",12),r(16,"mat-menu",null,2)(18,"button",19),g("click",function(){y(o);let t=p();return w(t.openContactInfo())}),m(19,"mat-icon",12),d(20," Contact info "),c(),r(21,"button",20),m(22,"mat-icon",12),d(23," Select messages "),c(),r(24,"button",19),g("click",function(){y(o);let t=p();return w(t.toggleMuteNotifications())}),h(25,Qt,2,1)(26,Zt,2,1),c(),r(27,"button",20),m(28,"mat-icon",12),d(29," Clear messages "),c(),r(30,"button",20),m(31,"mat-icon",12),d(32," Delete chat "),c()()()(),r(33,"div",21)(34,"div",22),N(35,Yt,8,20,"div",23,P().trackByFn,!0),c()(),r(37,"div",24)(38,"div",25)(39,"button",26),m(40,"mat-icon",12),c(),r(41,"button",27),m(42,"mat-icon",12),c()(),r(43,"mat-form-field",28),m(44,"textarea",29,3),c(),r(46,"div",30)(47,"button",26),m(48,"mat-icon",12),c()()()()()}if(e&2){let o=j(2),i=j(17),t=p();s("hasBackdrop",!1),a(),s("autoFocus",!1)("mode",t.drawerMode)("position","end"),J("opened",t.drawerOpened),a(2),s("drawer",o)("chat",t.chat),a(3),s("routerLink",je(23,Nt)),a(),s("svgIcon","heroicons_outline:arrow-long-left"),a(3),u(t.chat.contact.picture?10:-1),a(),u(t.chat.contact.picture?-1:11),a(2),_(" ",t.chat.contact.name," "),a(),s("matMenuTriggerFor",i),a(),s("svgIcon","heroicons_outline:ellipsis-vertical"),a(4),s("svgIcon","heroicons_outline:user-circle"),a(3),s("svgIcon","heroicons_outline:check-circle"),a(3),u(t.chat.muted?-1:25),a(),u(t.chat.muted?26:-1),a(2),s("svgIcon","heroicons_outline:backspace"),a(3),s("svgIcon","heroicons_outline:trash"),a(4),R(t.chat.messages),a(5),s("svgIcon","heroicons_outline:face-smile"),a(2),s("svgIcon","heroicons_outline:paper-clip"),a(6),s("svgIcon","heroicons_outline:paper-airplane")}}function ti(e,n){e&1&&(r(0,"div",6),m(1,"mat-icon",39),r(2,"div",40),d(3," Select a conversation or start a new chat "),c()()),e&2&&(a(),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function ii(e,n){e&1&&(Se(),r(0,"svg",41)(1,"g",42),m(2,"path",43),c()())}var lt=(()=>{let n=class n{constructor(i,t,l,f){this._changeDetectorRef=i,this._chatService=t,this._angorMediaWatcherService=l,this._ngZone=f,this.drawerMode="side",this.drawerOpened=!1,this._unsubscribeAll=new T}_resizeMessageInput(){this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.messageInput.nativeElement.style.height="auto",this._changeDetectorRef.detectChanges(),this.messageInput.nativeElement.style.height=`${this.messageInput.nativeElement.scrollHeight}px`,this._changeDetectorRef.detectChanges()})})}ngOnInit(){this._chatService.chat$.pipe(C(this._unsubscribeAll)).subscribe(i=>{this.chat=i,this._changeDetectorRef.markForCheck()}),this._angorMediaWatcherService.onMediaChange$.pipe(C(this._unsubscribeAll)).subscribe(({matchingAliases:i})=>{i.includes("lg")?this.drawerMode="side":this.drawerMode="over",this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}openContactInfo(){this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}resetChat(){this._chatService.resetChat(),this.drawerOpened=!1,this._changeDetectorRef.markForCheck()}toggleMuteNotifications(){this.chat.muted=!this.chat.muted,this._chatService.updateChat(this.chat.id,this.chat).subscribe()}trackByFn(i,t){return t.id||i}};n.\u0275fac=function(t){return new(t||n)(M(ee),M(b),M(We),M(ke))},n.\u0275cmp=v({type:n,selectors:[["chat-conversation"]],viewQuery:function(t,l){if(t&1&&Fe(Pt,5),t&2){let f;Te(f=De())&&(l.messageInput=f.first)}},hostBindings:function(t,l){t&1&&g("input",function(){return l._resizeMessageInput()})("ngModelChange",function(){return l._resizeMessageInput()})},standalone:!0,features:[x],decls:5,vars:1,consts:[["speechBubbleExtension",""],["drawer",""],["conversationHeaderMenu",""],["messageInput",""],[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-l","lg:shadow-none",3,"openedChange","autoFocus","mode","position","opened"],[3,"drawer","chat"],[1,"flex","flex-col","overflow-hidden"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent","md:px-6"],["mat-icon-button","",1,"md:-ml-2","lg:hidden",3,"click","routerLink"],[3,"svgIcon"],[1,"ml-2","mr-2","flex","cursor-pointer","items-center","lg:ml-0",3,"click"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","text-lg","font-medium","leading-5"],["mat-icon-button","",1,"ml-auto",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],[1,"flex","flex-col-reverse","overflow-y-auto"],[1,"bg-card","flex","flex-auto","shrink","flex-col","p-6","dark:bg-transparent"],[1,"flex","flex-col",3,"ngClass"],[1,"flex","items-end","border-t","bg-gray-50","p-4","dark:bg-transparent"],[1,"my-px","flex","h-11","items-center"],["mat-icon-button",""],["mat-icon-button","",1,"ml-0.5"],["subscriptSizing","dynamic",1,"angor-mat-dense","angor-mat-rounded","angor-mat-bold","ml-4","w-full"],["matInput","","cdkTextareaAutosize",""],[1,"my-px","ml-4","flex","h-11","items-center"],[1,"-mx-6","my-3","flex","items-center","justify-center"],[1,"relative","max-w-3/4","rounded-lg","px-3","py-2",3,"ngClass"],[1,"absolute","bottom-0","w-3",3,"ngClass"],[1,"min-w-4","leading-5",3,"innerHTML"],[1,"text-secondary","my-0.5","text-sm","font-medium",3,"ngClass"],[1,"flex-auto","border-b"],[1,"text-secondary","mx-4","flex-0","text-sm","font-medium","leading-5"],[4,"ngTemplateOutlet"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"],["width","100%","height","100%","viewBox","0 0 66 66","xmlns","http://www.w3.org/2000/svg"],["id","Page-1","stroke","none","stroke-width","1","fill","none","fill-rule","evenodd"],["d","M1.01522827,0.516204834 C-8.83532715,54.3062744 61.7609863,70.5215302 64.8009949,64.3061218 C68.8074951,54.8859711 30.1663208,52.9997559 37.5036011,0.516204834 L1.01522827,0.516204834 Z","fill","currentColor","fill-rule","nonzero"]],template:function(t,l){t&1&&(r(0,"div",4),h(1,ei,49,24,"mat-drawer-container",5)(2,ti,4,1,"div",6)(3,ii,3,0,"ng-template",null,0,Ve),c()),t&2&&(a(),u(l.chat?1:2))},dependencies:[pe,me,de,se,ct,A,Le,D,ne,k,S,le,re,ae,ce,te,ze,U,H,W,L,Ke,Qe,$e],encapsulation:2,changeDetection:0});let e=n;return e})();var st=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=v({type:n,selectors:[["chat-empty-conversation"]],standalone:!0,features:[x],decls:5,vars:1,consts:[[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(t,l){t&1&&(r(0,"div",0)(1,"div",1),m(2,"mat-icon",2),r(3,"div",3),d(4," Select a conversation or start a new chat "),c()()()),t&2&&(a(2),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))},dependencies:[k,S],encapsulation:2,changeDetection:0});let e=n;return e})();var ni=(e,n)=>{let o=$(b),i=$(Re);return o.getChatById(e.paramMap.get("id")).pipe(ye(t=>{console.error(t);let l=n.url.split("/").slice(0,-1).join("/");return i.navigateByUrl(l),q(t)}))},pn=[{path:"",component:tt,resolve:{chats:()=>$(b).getChats(),contacts:()=>$(b).getContacts(),profile:()=>$(b).getProfile()},children:[{path:"",component:rt,children:[{path:"",pathMatch:"full",component:st},{path:":id",component:lt,resolve:{conversation:ni}}]}]}];export{pn as default};
