import{b as oe}from"./chunk-3GP6KE3R.js";import{a as pe}from"./chunk-5GAFSB5U.js";import{b as ie,c as ae,d as ce}from"./chunk-6YKNGFVA.js";import"./chunk-JY734I6P.js";import{d as J}from"./chunk-3YOWYAIA.js";import{c as le,d as de,e as me}from"./chunk-PG5WUWHQ.js";import"./chunk-OCVFWT7P.js";import"./chunk-TKFXSBHP.js";import{T as ne,U as se,s as W,x as G,y as Y}from"./chunk-SVUMTFP2.js";import"./chunk-QKRGR4YZ.js";import{$ as ee,V as Q,X,Z,ba as te,ca as re}from"./chunk-LXFTENSE.js";import{Aa as T,Ba as L,Bb as $,Cc as q,Eb as P,Gb as B,Hc as H,K as S,Ob as O,Pa as I,Pb as m,Ra as c,Rb as x,Sa as u,Wb as z,a as C,b as _,ba as w,h as y,ha as g,ib as K,kb as d,ma as M,mc as U,n as k,o as N,qa as F,t as b,vb as n,wb as a,wc as V,xb as h,xc as R,ya as j,yb as D,za as v,zb as A}from"./chunk-7QMWPNHP.js";var he=(()=>{let i=class i{constructor(){this.mainnetLocalStorageKey="mainnetIndexers",this.testnetLocalStorageKey="testnetIndexers",this.mainnetPrimaryIndexerKey="mainnetPrimaryIndexer",this.testnetPrimaryIndexerKey="testnetPrimaryIndexer",this.networkStorageKey="selectedNetwork",this.defaultMainnetIndexer="https://btc.indexer.angor.io/",this.defaultTestnetIndexer="https://tbtc.indexer.angor.io/",this.initializeDefaultIndexers()}initializeDefaultIndexers(){this.getIndexers("mainnet").length===0&&(this.addIndexer(this.defaultMainnetIndexer,"mainnet"),this.setPrimaryIndexer(this.defaultMainnetIndexer,"mainnet")),this.getIndexers("testnet").length===0&&(this.addIndexer(this.defaultTestnetIndexer,"testnet"),this.setPrimaryIndexer(this.defaultTestnetIndexer,"testnet"))}addIndexer(e,t){let r=this.getIndexers(t);r.includes(e)||(r.push(e),this.saveIndexers(r,t))}getIndexers(e){let t=e==="mainnet"?this.mainnetLocalStorageKey:this.testnetLocalStorageKey;return JSON.parse(localStorage.getItem(t)||"[]")}saveIndexers(e,t){let r=t==="mainnet"?this.mainnetLocalStorageKey:this.testnetLocalStorageKey;localStorage.setItem(r,JSON.stringify(e))}setPrimaryIndexer(e,t){if(this.getIndexers(t).includes(e)){let r=t==="mainnet"?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;localStorage.setItem(r,e)}}getPrimaryIndexer(e){let t=e==="mainnet"?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;return localStorage.getItem(t)}removeIndexer(e,t){let r=this.getIndexers(t),s=r.indexOf(e);if(s!==-1&&(r.splice(s,1),this.saveIndexers(r,t),e===this.getPrimaryIndexer(t))){let l=t==="mainnet"?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;localStorage.removeItem(l)}}clearAllIndexers(e){let t=e==="mainnet"?this.mainnetLocalStorageKey:this.testnetLocalStorageKey,r=e==="mainnet"?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;localStorage.removeItem(t),localStorage.removeItem(r)}setNetwork(e){localStorage.setItem(this.networkStorageKey,e)}getNetwork(){return localStorage.getItem(this.networkStorageKey)||"testnet"}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var fe=(()=>{let i=class i{constructor(e,t){this.http=e,this.indexerService=t,this.offset=0,this.limit=45,this.totalProjects=0,this.loading=!1,this.projects=[],this.noMoreProjects=!1,this.totalProjectsFetched=!1,this.selectedNetwork="testnet",this.loadNetwork()}loadNetwork(){this.selectedNetwork=this.indexerService.getNetwork()}fetchProjects(){return y(this,null,function*(){if(this.loading||this.noMoreProjects)return[];this.loading=!0;let e=this.indexerService.getPrimaryIndexer(this.selectedNetwork),t=this.totalProjectsFetched?`${e}api/query/Angor/projects?offset=${this.offset}&limit=${this.limit}`:`${e}api/query/Angor/projects?limit=${this.limit}`;try{let r=yield this.http.get(t,{observe:"response"}).toPromise();if(!this.totalProjectsFetched&&r&&r.headers){let l=r.headers.get("pagination-total");this.totalProjects=l?+l:0,this.totalProjectsFetched=!0,this.offset=Math.max(this.totalProjects-this.limit,0)}let s=r?.body||[];if(!s||s.length===0)return this.noMoreProjects=!0,[];{let l=s.filter(f=>!this.projects.some(xe=>xe.projectIdentifier===f.projectIdentifier));return l.length>0?(this.projects=[...this.projects,...l],this.offset=Math.max(this.offset-this.limit,0),l):(this.noMoreProjects=!0,[])}}catch(r){return console.error("Error fetching projects:",r),[]}finally{this.loading=!1}})}fetchProjectStats(e){let r=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${e}/stats`;return this.http.get(r).pipe(S(s=>(console.error(`Error fetching stats for project ${e}:`,s),b({}))))}fetchProjectDetails(e){let r=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${e}`;return this.http.get(r).pipe(S(s=>(console.error(`Error fetching details for project ${e}:`,s),b({}))))}getProjects(){return this.projects}resetProjects(){this.projects=[],this.noMoreProjects=!1,this.offset=0,this.totalProjectsFetched=!1}};i.\u0275fac=function(t){return new(t||i)(M(H),M(he))},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var ue=(()=>{let i=class i{constructor(){this.projects=[],this.projectsSubject=new N([])}getProjectsObservable(){return this.projectsSubject.asObservable()}setProjects(e){this.projects=e,this.projectsSubject.next(this.projects)}getProjects(){return this.projects}hasProjects(){return this.projects.length>0}updateProject(e){let t=this.projects.findIndex(r=>r.nostrPubKey===e.nostrPubKey);t>-1?this.projects[t]=e:this.projects.push(e),this.projectsSubject.next(this.projects)}getProjectByPubKey(e){return this.projects.find(t=>t.nostrPubKey===e)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function Ie(o,i){if(o&1&&(D(0),n(1,"angor-card",24)(2,"div",25),h(3,"img",26),a(),n(4,"div",27)(5,"div",28),h(6,"img",29),a()(),n(7,"div",30)(8,"div",31)(9,"div",32)(10,"div",33),m(11),a(),n(12,"div",34),m(13),a()(),n(14,"div",35)(15,"button",36),h(16,"mat-icon",37),a()()(),h(17,"hr",38),n(18,"div",31)(19,"div",39),m(20),a(),n(21,"div",40),h(22,"img",41),a()()()(),A()),o&2){let p=i.$implicit;c(3),d("src",(p==null?null:p.banner)||"images/pages/profile/cover.jpg",I),c(3),d("src",(p==null?null:p.picture)||"images/avatars/avatar-placeholder.png",I),c(5),x(" ",p.displayName||p.nostrPubKey," "),c(2),x(" ",p.about||"No description available"," "),c(3),d("svgIcon","heroicons_solid:user-plus"),c(4),x(" ",p.totalInvestmentsCount||0," investors "),c(2),d("src","images/avatars/avatar-placeholder.png",I)}}function Pe(o,i){o&1&&(n(0,"div",42),m(1,"Loading Projects..."),a())}function be(o,i){if(o&1&&(n(0,"div",43),m(1),a()),o&2){let p=B();c(),x(" ",p.errorMessage," ")}}var ge=(()=>{let i=class i{constructor(e,t,r,s,l,f){this.projectService=e,this.router=t,this.stateService=r,this.metadataService=s,this._indexedDBService=l,this._changeDetectorRef=f,this.projects=[],this.errorMessage="",this.loading=!1,this.metadataLoadLimit=5,this._unsubscribeAll=new k,this.filteredProjects=[]}ngOnInit(){this.projects=this.stateService.getProjects(),this.filteredProjects=[...this.projects],this.projects.length===0?this.loadProjects():(this.loading=!1,this.projects.forEach(e=>this.subscribeToProjectMetadata(e))),this._indexedDBService.getMetadataStream().pipe(w(this._unsubscribeAll)).subscribe(e=>{if(e){let t=this.projects.find(r=>r.nostrPubKey===e.pubkey);t&&this.updateProjectMetadata(t,e.metadata)}})}loadProjects(){this.loading||this.errorMessage==="No more projects found"||(this.loading=!0,this.projectService.fetchProjects().then(e=>y(this,null,function*(){if(e.length===0&&this.projects.length===0)this.errorMessage="No projects found";else if(e.length===0)this.errorMessage="No more projects found";else{this.projects=[...this.projects,...e],this.filteredProjects=[...this.projects];let t=e.map(r=>r.nostrPubKey);yield this.metadataService.fetchMetadataForMultipleKeys(t),this.stateService.setProjects(this.projects),this.projects.forEach(r=>this.subscribeToProjectMetadata(r))}this.loading=!1,this._changeDetectorRef.detectChanges()})).catch(e=>{console.error("Error fetching projects:",e),this.errorMessage="Error fetching projects. Please try again later.",this.loading=!1,this._changeDetectorRef.detectChanges()}))}loadMetadataForProject(e){return y(this,null,function*(){try{let t=yield this.metadataService.fetchMetadataWithCache(e.nostrPubKey);t?this.updateProjectMetadata(e,t):console.warn(`No metadata found for project ${e.nostrPubKey}`)}catch(t){console.error(`Error fetching metadata for project ${e.nostrPubKey}:`,t)}})}updateProjectMetadata(e,t){let r=_(C({},e),{displayName:t.name,about:t.about,picture:t.picture,banner:t.banner}),s=this.projects.findIndex(l=>l.projectIdentifier===e.projectIdentifier);s!==-1&&(this.projects[s]=r,this.projects=[...this.projects]),this.filteredProjects=[...this.projects],this._changeDetectorRef.detectChanges()}subscribeToProjectMetadata(e){this.metadataService.getMetadataStream().pipe(w(this._unsubscribeAll)).subscribe(t=>{t&&t.pubkey===e.nostrPubKey&&this.updateProjectMetadata(e,t.metadata)})}goToProjectDetails(e){this.router.navigate(["/projects",e.projectIdentifier])}filterByQuery(e){if(!e){this.filteredProjects=[...this.projects];return}this.filteredProjects=this.projects.filter(t=>t.displayName?.toLowerCase().includes(e.toLowerCase())||t.about?.toLowerCase().includes(e.toLowerCase()))}toggleCompleted(e){}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}};i.\u0275fac=function(t){return new(t||i)(u(fe),u(J),u(ue),u(ce),u(ae),u(U))},i.\u0275cmp=F({type:i,selectors:[["explore"]],standalone:!0,features:[z],decls:29,vars:8,consts:[["query",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-y-auto"],[1,"dark","relative","flex-0","overflow-hidden","bg-gray-800","px-4","py-8","sm:p-16"],["viewBox","0 0 960 540","width","100%","height","100%","preserveAspectRatio","xMidYMax slice","xmlns","http://www.w3.org/2000/svg",1,"absolute","inset-0","pointer-events-none"],["fill","none","stroke","currentColor","stroke-width","100",1,"text-gray-700","opacity-25"],["r","234","cx","196","cy","23"],["r","234","cx","790","cy","491"],[1,"relative","z-10","flex","flex-col","items-center"],[1,"text-xl","font-semibold"],[1,"mt-1","text-center","text-4xl","font-extrabold","leading-tight","tracking-tight","sm:text-7xl"],[1,"text-secondary","mt-6","max-w-2xl","text-center","tracking-tight","sm:text-2xl"],[1,"flex","flex-auto","p-6","sm:p-10"],[1,"mx-auto","flex","w-full","max-w-xs","flex-auto","flex-col","sm:max-w-5xl"],[1,"flex","w-full","max-w-xs","flex-col","items-center","justify-between","sm:max-w-none","sm:flex-row"],[1,"mt-4","w-full","sm:mt-0","sm:w-72",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["placeholder","Search ...","matInput","",3,"input"],[1,"mt-8","sm:ml-auto","sm:mt-0",3,"change","color"],[1,"grid","w-full","min-w-0","grid-cols-1","gap-6","sm:grid-cols-2","md:grid-cols-2","lg:grid-cols-3","mt-10"],[4,"ngFor","ngForOf"],[1,"flex","justify-center","mt-10"],["mat-raised-button","","color","primary",3,"click","disabled"],["class","loading-spinner",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"filter-info","flex","w-full","flex-col"],[1,"flex","h-32"],["onerror","this.onerror=null; this.src='/images/pages/profile/cover.jpg';","alt","Card cover image",1,"object-cover",3,"src"],[1,"flex","px-8"],[1,"bg-card","-mt-12","rounded-full","p-1"],["alt","Project logo",1,"h-24","w-24","rounded-full",3,"src"],[1,"flex","flex-col","px-8","pb-6","pt-4"],[1,"flex","items-center","justify-between"],[1,"mr-4"],[1,"text-2xl","font-semibold","leading-tight"],[1,"text-secondary","mt-1","leading-tight"],[1,"flex","h-10","w-10","items-center","justify-center","rounded-full","border"],["mat-icon-button",""],[1,"icon-size-5",3,"svgIcon"],[1,"my-6","w-full","border-t"],[1,"text-secondary","mr-3","text-md","font-medium"],[1,"flex","items-center"],["alt","Investor avatar",1,"text-card","ring-bg-card","m-0.5","-ml-3","h-6","w-6","rounded-full","ring-2",3,"src"],[1,"loading-spinner"],[1,"error-message"]],template:function(t,r){if(t&1){let s=$();n(0,"div",1)(1,"div",2),T(),n(2,"svg",3)(3,"g",4),h(4,"circle",5)(5,"circle",6),a()(),L(),n(6,"div",7)(7,"h2",8),m(8,"Explore Projects"),a(),n(9,"div",9),m(10," What\u2019s your next investment? "),a(),n(11,"div",10),m(12," Check out our projects and find your next investment opportunity. "),a()()(),n(13,"div",11)(14,"div",12)(15,"div",13)(16,"mat-form-field",14),h(17,"mat-icon",15),n(18,"input",16,0),P("input",function(){j(s);let f=O(19);return v(r.filterByQuery(f.value))}),a()(),n(20,"mat-slide-toggle",17),P("change",function(f){return j(s),v(r.toggleCompleted(f))}),m(21," Hide completed "),a()(),n(22,"div",18),K(23,Ie,23,7,"ng-container",19),a(),n(24,"div",20)(25,"button",21),P("click",function(){return j(s),v(r.loadProjects())}),m(26),a()(),K(27,Pe,2,0,"div",22)(28,be,2,1,"div",23),a()()()}t&2&&(c(16),d("subscriptSizing","dynamic"),c(),d("svgIcon","heroicons_solid:magnifying-glass"),c(3),d("color","primary"),c(3),d("ngForOf",r.projects),c(2),d("disabled",r.loading),c(),x(" ",r.loading?"Loading...":"Load More Projects"," "),c(),d("ngIf",r.loading),c(),d("ngIf",!r.loading&&r.errorMessage))},dependencies:[ee,X,Z,re,te,pe,Y,G,W,le,Q,se,ne,me,de,ie,oe,q,V,R],encapsulation:2});let o=i;return o})();var lt=[{path:"",component:ge}];export{lt as default};
