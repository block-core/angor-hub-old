"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[621],{4621:(tt,x,i)=>{i.r(x),i.d(x,{default:()=>q});var c=i(467),I=i(5167),p=i(177),m=i(8834),$=i(6600),v=i(2102),y=i(9213),b=i(9042),k=i(7575),F=i(2798),P=i(450),R=i(4823),M=i(1413),S=i(6977),t=i(4438),C=i(7673),E=i(9437),N=i(1626),w=i(833),_=i(7291);let G=(()=>{class n{constructor(e,r,o){this.http=e,this.indexerService=r,this.storageService=o,this.offset=0,this.limit=20,this.totalProjects=0,this.loading=!1,this.projects=[],this.noMoreProjects=!1,this.totalProjectsFetched=!1,this.selectedNetwork="testnet",this.loadNetwork()}loadNetwork(){this.selectedNetwork=this.indexerService.getNetwork()}fetchProjects(){var e=this;return(0,c.A)(function*(){if(e.loading||e.noMoreProjects)return[];e.loading=!0;const r=e.indexerService.getPrimaryIndexer(e.selectedNetwork),o=e.totalProjectsFetched?`${r}api/query/Angor/projects?offset=${e.offset}&limit=${e.limit}`:`${r}api/query/Angor/projects?limit=${e.limit}`;try{const s=yield e.http.get(o,{observe:"response"}).toPromise();if(!e.totalProjectsFetched&&s&&s.headers){const h=s.headers.get("pagination-total");e.totalProjects=h?+h:0,e.totalProjectsFetched=!0,e.offset=Math.max(e.totalProjects-e.limit,0)}const l=s?.body||[];if(!l.length)return e.noMoreProjects=!0,[];const a=l.filter(h=>!e.projects.some(u=>u.projectIdentifier===h.projectIdentifier));if(!a.length)return e.noMoreProjects=!0,[];const f=a.map(function(){var h=(0,c.A)(function*(u){yield e.storageService.saveProject(u)});return function(u){return h.apply(this,arguments)}}()),g=a.map(function(){var h=(0,c.A)(function*(u){try{const j=yield e.storageService.getProjectStats(u.projectIdentifier);return u.totalInvestmentsCount=j?.investorCount??0,u}catch(j){return console.error(`Error fetching details for project ${u.projectIdentifier}:`,j),u}});return function(u){return h.apply(this,arguments)}}());return yield Promise.all([...f,...g]),e.projects=[...e.projects,...a],e.offset=Math.max(e.offset-e.limit,0),a}catch(s){return console.error("Error fetching projects:",s),[]}finally{e.loading=!1}})()}fetchProjectStats(e){const o=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${e}/stats`;return this.http.get(o).pipe((0,E.W)(s=>(console.error(`Error fetching stats for project ${e}:`,s),(0,C.of)({}))))}fetchAndSaveProjectStats(e){var r=this;return(0,c.A)(function*(){try{const o=yield r.fetchProjectStats(e).toPromise();return o&&(yield r.storageService.saveProjectStats(e,o)),o}catch(o){return console.error(`Error fetching and saving stats for project ${e}:`,o),null}})()}fetchProjectDetails(e){const o=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${e}`;return this.http.get(o).pipe((0,E.W)(s=>(console.error(`Error fetching details for project ${e}:`,s),(0,C.of)({}))))}fetchAndSaveProjectDetails(e){var r=this;return(0,c.A)(function*(){try{const o=yield r.fetchProjectDetails(e).toPromise();return o&&(yield r.storageService.saveProject(o)),o}catch(o){return console.error(`Error fetching and saving details for project ${e}:`,o),null}})()}getAllProjectsFromDB(){var e=this;return(0,c.A)(function*(){return e.storageService.getAllProjects()})()}getProjectStatsFromDB(e){var r=this;return(0,c.A)(function*(){return r.storageService.getProjectStats(e)})()}getProjects(){return this.projects}resetProjects(){this.projects=[],this.noMoreProjects=!1,this.offset=0,this.totalProjectsFetched=!1}static#t=this.\u0275fac=function(r){return new(r||n)(t.KVO(N.Qq),t.KVO(w.F),t.KVO(_.n))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var T=i(9192),A=i(2827),B=i(345),U=i(7253);const D=()=>[],V=n=>({"-ml-3":n});function Y(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",27),t.bIt("click",function(){t.eBV(e);const o=t.XpG(),s=t.sdS(20);return t.Njj(o.resetSearch(s))}),t.nrm(1,"mat-icon",28),t.k0s()}2&n&&(t.R7$(),t.Y8G("svgIcon","heroicons_solid:x-mark"))}function K(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){t.eBV(e);const o=t.XpG(),s=t.sdS(20);return t.Njj(o.filterByQuery(s.value))}),t.nrm(1,"mat-icon",28),t.k0s()}2&n&&(t.R7$(),t.Y8G("svgIcon","heroicons_solid:magnifying-glass"))}function X(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",46),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,s=t.XpG();return t.Njj(s.goToProjectDetails(o))}),t.EFF(1),t.k0s()}if(2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e.displayName||e.nostrPubKey," ")}}function z(n,d){if(1&n&&(t.j41(0,"div",40),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e.displayName||e.nostrPubKey," ")}}function L(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",42)(1,"button",47),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,s=t.XpG();return t.Njj(s.openChat(o.nostrPubKey))}),t.nrm(2,"mat-icon",48),t.k0s()()}2&n&&(t.R7$(2),t.Y8G("svgIcon","heroicons_outline:chat-bubble-left-right"))}function O(n,d){if(1&n&&(t.qex(0),t.nrm(1,"img",49),t.bVm()),2&n){const e=t.XpG().index,r=t.XpG().$implicit;t.R7$(),t.Mz_("alt","Investor avatar ",e+1,""),t.Y8G("ngClass",t.eq3(4,V,r.totalInvestmentsCount>1&&e>0))("src","images/avatars/avatar-placeholder.png",t.B4B)}}function Q(n,d){if(1&n&&(t.qex(0),t.DNE(1,O,2,6,"ng-container",24),t.bVm()),2&n){const e=d.index;t.R7$(),t.Y8G("ngIf",e<10)}}function W(n,d){if(1&n&&(t.qex(0),t.j41(1,"angor-card",30)(2,"div",31),t.nrm(3,"img",32),t.k0s(),t.j41(4,"div",33)(5,"div",34),t.nrm(6,"img",35),t.k0s()(),t.j41(7,"div",36)(8,"div",37)(9,"div",38),t.DNE(10,X,2,1,"div",39)(11,z,2,1,"div",40),t.j41(12,"div",41),t.EFF(13),t.k0s()(),t.DNE(14,L,3,1,"div",42),t.k0s(),t.nrm(15,"hr",43),t.j41(16,"div",37)(17,"div",44),t.EFF(18),t.k0s(),t.j41(19,"div",45),t.DNE(20,Q,2,1,"ng-container",23),t.k0s()()()(),t.bVm()),2&n){const e=d.$implicit,r=t.XpG();t.R7$(3),t.Y8G("src",r.getSafeUrl(null==e?null:e.banner,!0)||"images/pages/profile/cover.jpg",t.B4B),t.R7$(3),t.Y8G("src",r.getSafeUrl(null==e?null:e.picture,!1)||"images/avatars/avatar-placeholder.png",t.B4B),t.R7$(4),t.vxM(e.displayName||e.name?10:-1),t.R7$(),t.vxM(e.name||e.displayName?-1:11),t.R7$(2),t.SpI(" ",e.about||"No description available"," "),t.R7$(),t.vxM(e.displayName||e.name?14:-1),t.R7$(4),t.SpI(" ",e.totalInvestmentsCount||0," investors "),t.R7$(2),t.Y8G("ngForOf",t.lJ4(8,D).constructor(e.totalInvestmentsCount||0))}}function H(n,d){1&n&&(t.qex(0),t.j41(1,"div",50),t.nrm(2,"mat-icon",51),t.j41(3,"div",52),t.EFF(4," No project "),t.k0s()(),t.bVm()),2&n&&(t.R7$(2),t.Y8G("svgIcon","heroicons_outline:archive-box-x-mark"))}function J(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",53)(1,"button",54),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.loadProjects())}),t.EFF(2),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(),t.Y8G("disabled",e.loading),t.R7$(),t.SpI(" ",e.loading?"Loading...":"Load More Projects"," ")}}function Z(n,d){if(1&n&&(t.j41(0,"div",55),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.errorMessage," ")}}const q=[{path:"",component:(()=>{class n{constructor(e,r,o,s,l,a,f){this.projectService=e,this.router=r,this.metadataService=o,this.storageService=s,this.changeDetectorRef=l,this.sanitizer=a,this._chatService=f,this.projects=[],this.errorMessage="",this.loading=!1,this.metadataLoadLimit=5,this._unsubscribeAll=new M.B,this.filteredProjects=[],this.showCloseSearchButton=!1}ngOnInit(){var e=this;return(0,c.A)(function*(){e.loadInitialProjects(),e.subscribeToMetadataUpdates()})()}loadInitialProjects(){var e=this;return(0,c.A)(function*(){try{if(e.loading=!0,0===e.projects.length)yield e.loadProjectsFromService();else{e.filteredProjects=[...e.projects];const r=e.getProjectsWithoutMetadata();r.length>0&&(yield e.loadMetadataForProjects(r))}}catch{e.handleError("Error loading initial projects")}finally{e.loading=!1,e.changeDetectorRef.detectChanges()}})()}loadProjectsFromService(){var e=this;return(0,c.A)(function*(){try{const r=yield e.projectService.fetchProjects();if(0===r.length)return void(e.errorMessage="No projects found");e.projects=r,e.filteredProjects=[...e.projects];const o=r.map(s=>s.nostrPubKey);yield e.loadMetadataForProjects(o)}catch{e.handleError("Error fetching projects from service")}})()}subscribeToMetadataUpdates(){this.storageService.getMetadataStream().pipe((0,S.Q)(this._unsubscribeAll)).subscribe(e=>{if(e){const r=this.projects.find(o=>o.nostrPubKey===e.pubkey);r&&this.updateProjectMetadata(r,e.metadata)}})}getProjectsWithoutMetadata(){return this.projects.filter(e=>!e.displayName||!e.about).map(e=>e.nostrPubKey)}loadMetadataForProjects(e){var r=this;return(0,c.A)(function*(){const o=e.map(function(){var a=(0,c.A)(function*(f){const g=yield r.storageService.getUserMetadata(f);return g?{pubkey:f,metadata:g}:null});return function(f){return a.apply(this,arguments)}}()),s=yield Promise.all(o),l=s.filter(a=>null===a).map((a,f)=>e[f]);s.forEach(a=>{if(a&&a.metadata){const f=r.projects.find(g=>g.nostrPubKey===a.pubkey);f&&r.updateProjectMetadata(f,a.metadata)}}),l.length>0&&(yield r.metadataService.fetchMetadataForMultipleKeys(l).then(a=>{a.forEach(f=>{const g=r.projects.find(h=>h.nostrPubKey===f.pubkey);g&&r.updateProjectMetadata(g,f)}),r.changeDetectorRef.detectChanges()}).catch(a=>{console.error("Error fetching metadata for projects:",a)}))})()}loadProjects(){var e=this;return(0,c.A)(function*(){e.loading||"No more projects found"===e.errorMessage||(e.loading=!0,e.projectService.fetchProjects().then(function(){var r=(0,c.A)(function*(o){if(0===o.length&&0===e.projects.length)e.errorMessage="No projects found";else if(0===o.length)e.errorMessage="No more projects found";else{e.projects=[...e.projects,...o],e.filteredProjects=[...e.projects];const s=o.map(l=>l.nostrPubKey);yield e.loadMetadataForProjects(s),e.projects.forEach(l=>e.subscribeToProjectMetadata(l))}e.loading=!1,e.changeDetectorRef.detectChanges()});return function(o){return r.apply(this,arguments)}}()).catch(r=>{console.error("Error fetching projects:",r),e.errorMessage="Error fetching projects. Please try again later.",e.loading=!1,e.changeDetectorRef.detectChanges()}))})()}loadMetadataForProject(e){var r=this;return(0,c.A)(function*(){try{const o=yield r.metadataService.fetchMetadataWithCache(e.nostrPubKey);o?r.updateProjectMetadata(e,o):console.warn(`No metadata found for project ${e.nostrPubKey}`)}catch(o){console.error(`Error fetching metadata for project ${e.nostrPubKey}:`,o)}})()}updateProjectMetadata(e,r){const o={...e,displayName:r.name||"",about:r.about?r.about.replace(/<\/?[^>]+(>|$)/g,""):"",picture:r.picture||"",banner:r.banner||""},s=this.projects.findIndex(l=>l.projectIdentifier===e.projectIdentifier);-1!==s&&(this.projects[s]=o,this.projects=[...this.projects]),this.filteredProjects=[...this.projects],this.changeDetectorRef.detectChanges()}subscribeToProjectMetadata(e){this.metadataService.getMetadataStream().pipe((0,S.Q)(this._unsubscribeAll)).subscribe(r=>{r&&r.pubkey===e.nostrPubKey&&this.updateProjectMetadata(e,r.metadata)})}goToProjectDetails(e){this.loading=!0,this.projectService.fetchAndSaveProjectStats(e.projectIdentifier).then(r=>{r?this.navigateToProfile(e.nostrPubKey):(console.error("Failed to fetch project stats from API"),this.handleError("Error fetching project stats"))}).catch(r=>{this.handleError("Error fetching project stats from server")}).finally(()=>{this.loading=!1})}navigateToProfile(e){this.router.navigate(["/profile",e])}filterByQuery(e){if(!e||""===e.trim())return this.filteredProjects=[...this.projects],this.showCloseSearchButton=!1,void this.changeDetectorRef.detectChanges();const r=e.toLowerCase();this.filteredProjects=this.projects.filter(o=>o.displayName&&o.displayName.toLowerCase().includes(r)||o.about&&o.about.toLowerCase().includes(r)||o.displayName&&o.displayName.toLowerCase().includes(r)||o.nostrPubKey&&o.nostrPubKey.toLowerCase().includes(r)||o.projectIdentifier&&o.projectIdentifier.toLowerCase().includes(r)),this.showCloseSearchButton=this.projects.length>0,this.changeDetectorRef.detectChanges()}resetSearch(e){e.value="",this.filterByQuery(""),this.showCloseSearchButton=!1}toggleCompleted(e){}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}handleError(e){console.error(e),this.errorMessage=e,this.loading=!1,this.changeDetectorRef.detectChanges()}getSafeUrl(e,r){return e&&"string"==typeof e&&this.isImageUrl(e)?this.sanitizer.bypassSecurityTrustUrl(e):this.sanitizer.bypassSecurityTrustUrl(r?"/images/pages/profile/cover.jpg":"images/avatars/avatar-placeholder.png")}isImageUrl(e){return/\.(jpeg|jpg|gif|png|svg|bmp|webp|tiff|ico)$/i.test(e)}openChat(e){var r=this;return(0,c.A)(function*(){try{const o=yield r.metadataService.fetchMetadataWithCache(e);if(o){const s={pubKey:e,name:o.name||"Unknown",picture:o.picture||"/images/avatars/avatar-placeholder.png",about:o.about||"",displayName:o.displayName||o.name||"Unknown"};r._chatService.getChatById(s.pubKey,s).subscribe(l=>{r.router.navigate(["/chat",s.pubKey])})}else console.error("No metadata found for the public key:",e)}catch(o){console.error("Error opening chat:",o)}})()}static#t=this.\u0275fac=function(r){return new(r||n)(t.rXU(G),t.rXU(T.Ix),t.rXU(A.T),t.rXU(_.n),t.rXU(t.gRc),t.rXU(B.up),t.rXU(U.m))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["explore"]],standalone:!0,features:[t.aNF],decls:31,vars:9,consts:[["query",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-y-auto"],[1,"dark","relative","flex-0","overflow-hidden","bg-gray-800","px-4","py-8","sm:p-16"],["viewBox","0 0 960 540","width","100%","height","100%","preserveAspectRatio","xMidYMax slice","xmlns","http://www.w3.org/2000/svg",1,"pointer-events-none","absolute","inset-0"],["fill","none","stroke","currentColor","stroke-width","100",1,"text-gray-700","opacity-25"],["r","234","cx","196","cy","23"],["r","234","cx","790","cy","491"],[1,"relative","z-10","flex","flex-col","items-center"],[1,"text-xl","font-semibold"],[1,"mt-1","text-center","text-4xl","font-extrabold","leading-tight","tracking-tight","sm:text-7xl"],[1,"text-secondary","mt-6","max-w-2xl","text-center","tracking-tight","sm:text-2xl"],[1,"p-6","sm:p-10"],[1,"mx-auto","flex","w-full","max-w-xs","flex-auto","flex-col","sm:max-w-5xl"],[1,"flex","w-full","max-w-xs","flex-col","items-center","justify-between","sm:max-w-none","sm:flex-row"],[1,"flex","w-full","items-center","space-x-2","sm:w-auto"],[1,"mt-4","w-full","sm:w-80",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["placeholder","Search ...","matInput","",3,"keyup.enter"],["mat-icon-button","","color","warn","class","mt-4",3,"click",4,"ngIf"],["mat-icon-button","","color","success","class","mt-4",3,"click",4,"ngIf"],[1,"mt-8","sm:ml-auto","sm:mt-0",3,"change","color"],[1,"mx-auto","flex","w-full","flex-auto","flex-col","sm:max-w-5xl"],[1,"mt-10","grid","w-full","min-w-0","grid-cols-1","gap-6","sm:grid-cols-1","md:grid-cols-1","lg:grid-cols-2"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","mt-10 flex justify-center",4,"ngIf"],["class","error-message",4,"ngIf"],["mat-icon-button","","color","warn",1,"mt-4",3,"click"],[3,"svgIcon"],["mat-icon-button","","color","success",1,"mt-4",3,"click"],[1,"filter-info","flex","w-full","flex-col"],[1,"flex","h-32"],["onerror","this.onerror=null; this.src='/images/pages/profile/cover.jpg';","alt","Card cover image",1,"object-cover",3,"src"],[1,"flex","px-8"],[1,"bg-card","-mt-12","rounded-full","p-1"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Project logo",1,"h-24","w-24","rounded-full","object-cover",3,"src"],[1,"flex","flex-col","px-8","pb-6","pt-4"],[1,"flex","items-center","justify-between"],[1,"mr-4","min-w-0","flex-1"],["role","button",1,"truncate","text-2xl","font-semibold","leading-tight"],[1,"truncate","text-2xl","font-semibold","leading-tight"],[1,"text-secondary","mt-1","truncate","leading-tight"],[1,"flex","h-10","w-10","items-center","justify-center","rounded-full","border"],[1,"my-6","w-full","border-t"],[1,"text-secondary","mr-3","text-md","font-medium"],[1,"flex","items-center"],["role","button",1,"truncate","text-2xl","font-semibold","leading-tight",3,"click"],["mat-icon-button","",3,"click"],[1,"icon-size-5",3,"svgIcon"],[1,"text-card","ring-bg-card","m-0.5","h-6","w-6","rounded-full","ring-2",3,"ngClass","src","alt"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"],[1,"mt-10","flex","justify-center"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"error-message"]],template:function(r,o){if(1&r){const s=t.RV6();t.j41(0,"div",1)(1,"div",2),t.qSk(),t.j41(2,"svg",3)(3,"g",4),t.nrm(4,"circle",5)(5,"circle",6),t.k0s()(),t.joV(),t.j41(6,"div",7)(7,"h2",8),t.EFF(8,"Explore Projects"),t.k0s(),t.j41(9,"div",9),t.EFF(10," What\u2019s your next investment? "),t.k0s(),t.j41(11,"div",10),t.EFF(12," Check out our projects and find your next investment opportunity. "),t.k0s()()(),t.j41(13,"div",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"mat-form-field",15),t.nrm(18,"mat-icon",16),t.j41(19,"input",17,0),t.bIt("keyup.enter",function(){t.eBV(s);const a=t.sdS(20);return t.Njj(o.filterByQuery(a.value))}),t.k0s()(),t.DNE(21,Y,2,1,"button",18)(22,K,2,1,"button",19),t.k0s(),t.j41(23,"mat-slide-toggle",20),t.bIt("change",function(a){return t.eBV(s),t.Njj(o.toggleCompleted(a))}),t.EFF(24," Hide completed "),t.k0s()()(),t.j41(25,"div",21)(26,"div",22),t.DNE(27,W,21,9,"ng-container",23),t.k0s(),t.DNE(28,H,5,1,"ng-container",24)(29,J,3,2,"div",25)(30,Z,2,1,"div",26),t.k0s()()()}2&r&&(t.R7$(17),t.Y8G("subscriptSizing","dynamic"),t.R7$(),t.Y8G("svgIcon","heroicons_solid:magnifying-glass"),t.R7$(3),t.Y8G("ngIf",o.showCloseSearchButton),t.R7$(),t.Y8G("ngIf",!o.showCloseSearchButton),t.R7$(),t.Y8G("color","primary"),t.R7$(4),t.Y8G("ngForOf",o.filteredProjects),t.R7$(),t.Y8G("ngIf",0==o.filteredProjects.length),t.R7$(),t.Y8G("ngIf",o.filteredProjects.length>0),t.R7$(),t.Y8G("ngIf",!o.loading&&o.errorMessage))},dependencies:[m.Hl,m.$z,m.iY,y.m_,y.An,I.n,v.RG,v.rl,v.JW,F.Ve,$.Sy,b.fS,b.fg,P.mV,P.sG,p.YU,R.uc,k.PO,p.MD,p.Sq,p.bT],encapsulation:2})}return n})()}]}}]);