"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[551],{2747:(S,v,o)=>{o.d(v,{n:()=>R});var u=o(1648),e=o(4085),r=o(4438);const b=[[["","angorCardFront",""]],[["","angorCardBack",""]],"*",[["","angorCardExpansion",""]]],x=["[angorCardFront]","[angorCardBack]","*","[angorCardExpansion]"];function w(i,y){1&i&&(r.j41(0,"div",0),r.SdG(1),r.k0s(),r.j41(2,"div",1),r.SdG(3,1),r.k0s())}function E(i,y){1&i&&(r.j41(0,"div",2),r.SdG(1,3),r.k0s()),2&i&&r.Y8G("@expandCollapse",void 0)}function C(i,y){if(1&i&&(r.SdG(0,2),r.DNE(1,E,2,1,"div",2)),2&i){const c=r.XpG();r.R7$(),r.vxM(c.expanded?1:-1)}}let R=(()=>{class i{constructor(){this.expanded=!1,this.face="front",this.flippable=!1}get classList(){return{"angor-card-expanded":this.expanded,"angor-card-face-back":this.flippable&&"back"===this.face,"angor-card-face-front":this.flippable&&"front"===this.face,"angor-card-flippable":this.flippable}}ngOnChanges(c){"expanded"in c&&(this.expanded=(0,e.he)(c.expanded.currentValue)),"flippable"in c&&(this.flippable=(0,e.he)(c.flippable.currentValue))}static{this.\u0275fac=function(p){return new(p||i)}}static{this.\u0275cmp=r.VBU({type:i,selectors:[["angor-card"]],hostVars:2,hostBindings:function(p,f){2&p&&r.HbH(f.classList)},inputs:{expanded:"expanded",face:"face",flippable:"flippable"},exportAs:["angorCard"],standalone:!0,features:[r.OA$,r.aNF],ngContentSelectors:x,decls:2,vars:2,consts:[[1,"angor-card-front"],[1,"angor-card-back"],[1,"angor-card-expansion"]],template:function(p,f){1&p&&(r.NAR(b),r.DNE(0,w,4,0)(1,C,2,1)),2&p&&(r.vxM(f.flippable?0:-1),r.R7$(),r.vxM(f.flippable?-1:1))},styles:["angor-card{position:relative;display:flex;overflow:hidden;--tw-bg-opacity: 1;background-color:rgba(var(--angor-bg-card-rgb),var(--tw-bg-opacity));border-radius:1rem;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable{border-radius:0;overflow:visible;transform-style:preserve-3d;transition:transform 1s;perspective:600px;background:transparent;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable.angor-card-face-back .angor-card-front{visibility:hidden;opacity:0;transform:rotateY(180deg)}angor-card.angor-card-flippable.angor-card-face-back .angor-card-back{visibility:visible;opacity:1;transform:rotateY(360deg)}angor-card.angor-card-flippable .angor-card-front,angor-card.angor-card-flippable .angor-card-back{display:flex;flex-direction:column;flex:1 1 auto;z-index:10;transition:transform .5s ease-out 0s,visibility 0s ease-in .2s,opacity 0s ease-in .2s;backface-visibility:hidden;--tw-bg-opacity: 1;background-color:rgba(var(--angor-bg-card-rgb),var(--tw-bg-opacity));border-radius:1rem;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable .angor-card-front{position:relative;opacity:1;visibility:visible;transform:rotateY(0);overflow:hidden}angor-card.angor-card-flippable .angor-card-back{position:absolute;inset:0;opacity:0;visibility:hidden;transform:rotateY(180deg);overflow:hidden auto}\n"],encapsulation:2,data:{animation:u.F}})}}return i})()},8551:(S,v,o)=>{o.r(v),o.d(v,{default:()=>D});var u=o(467),e=o(4438),r=o(9417),b=o(177),x=o(2102),w=o(9042),E=o(8834),C=o(9213),R=o(2798),i=o(7403),y=o(6324),c=o(6231),p=o(719),f=o(2747),A=o(5766),Z=o(9706);function T(l,k){1&l&&(e.j41(0,"div",6)(1,"label",7),e.EFF(2,"Comment (Optional)"),e.k0s(),e.nrm(3,"textarea",17),e.k0s())}function j(l,k){if(1&l&&(e.j41(0,"div",18)(1,"h3",19),e.EFF(2,"Invoice Created:"),e.k0s(),e.j41(3,"p",20),e.EFF(4),e.k0s()()),2&l){const t=e.XpG();e.R7$(4),e.JRh(t.invoice.pr)}}function I(l,k){if(1&l&&(e.j41(0,"div",21)(1,"p",22),e.EFF(2),e.k0s()()),2&l){const t=e.XpG();e.R7$(2),e.JRh(t.error)}}const D=[{path:"",component:(()=>{class l{constructor(t){this.util=t,this.formBuilder=(0,e.WQX)(r.ok),this.signerService=(0,e.WQX)(y.A),this.relayService=(0,e.WQX)(c.b),this.payRequest=null,this.invoice={pr:""},this.canZap=!1,this.loading=!1,this.error=""}ngOnInit(){this.initializeForm()}initializeForm(){this.sendZapForm=this.formBuilder.group({lightningAddress:["",[r.k0.required,this.validateLightningAddress]],eventId:[""],amount:["",[r.k0.required,r.k0.min(1)]],comment:[""]})}validateLightningAddress(t){return t.value.includes("@")?null:{invalidFormat:!0}}getCallbackUrl(t){if(t.includes("@")){const[a,n]=t.split("@");return`https://${n}/.well-known/lnurlp/${a}`}return t.toLowerCase().startsWith("lnurl")?this.util.convertBech32ToText(t).toString():null}fetchPayRequest(){var t=this;return(0,u.A)(function*(){t.resetState();const a=t.sendZapForm.get("lightningAddress")?.value;if(!a)return void t.setError("Lightning Address is required.");const n=t.getCallbackUrl(a);try{const s=yield fetch(n);if(!s.ok)throw new Error("Failed to fetch pay request.");const d=yield s.json();if("ERROR"===d.status)return void t.setError(d.reason||"Error fetching the pay request.");t.payRequest=d,t.canZap=!0,t.configureAmountValidators()}catch(s){t.setError(s.message||"Error connecting to the server.")}finally{t.loading=!1}})()}configureAmountValidators(){if(!this.payRequest)return;const t=(this.payRequest.minSendable||1e3)/1e3,a=(this.payRequest.maxSendable||21e6)/1e3,n=this.sendZapForm.get("amount");n?.setValidators([r.k0.required,r.k0.min(t),r.k0.max(a)]),n?.updateValueAndValidity()}onSubmit(){var t=this;return(0,u.A)(function*(){if(t.sendZapForm.invalid)return void t.setError("Please fill out the form correctly.");t.resetState();const{eventId:n,amount:s,comment:d}=t.sendZapForm.value;if(!t.payRequest)return void t.setError("Pay request is not loaded.");const m=new URL(t.payRequest.callback),h=new URLSearchParams({amount:(1e3*s).toString()});if(d&&t.payRequest.commentAllowed&&h.set("comment",d),n){const g=yield t.createAndSignZapRequest(n,d);h.set("nostr",JSON.stringify(g))}try{const g=yield fetch(`${m.origin}${m.pathname}?${h.toString()}`);if(!g.ok)throw new Error("Failed to fetch invoice.");const F=yield g.json();if("ERROR"===F.status)return void t.setError(F.reason||"Error fetching the invoice.");t.invoice=F}catch(g){t.setError(g.message||"Error fetching the invoice.")}})()}createAndSignZapRequest(t,a){var n=this;return(0,u.A)(function*(){try{const s=n.createZapRequestData(t,a);let d;if(n.signerService.isUsingSecretKey()){const m=yield n.signerService.getDecryptedSecretKey();if(!m)throw new Error("Private key could not be retrieved.");const h=(0,A.aT)(m);d=(0,p.pC)(s,h)}else d=yield n.signerService.signEventWithExtension(s);if(!d)throw new Error("Signing failed. Signed event is null.");return d}catch(s){throw console.error("Error creating and signing zap request:",s),new Error("Failed to create and sign zap request.")}})()}createZapRequestData(t,a){return{kind:9734,content:a||"",tags:[["e",t],["p",this.payRequest?.nostrPubkey||""],["relays",...this.relayService.getConnectedRelays()]],pubkey:this.signerService.getPublicKey(),created_at:Math.floor(Date.now()/1e3)}}sendZapToRelay(t){var a=this;return(0,u.A)(function*(){try{yield a.relayService.publishEventToWriteRelays(t),console.log("Zap event sent successfully")}catch(n){a.setError("Failed to send zap event to relays"),console.error("Error sending zap event:",n)}})()}resetState(){this.error="",this.loading=!0,this.invoice={pr:""}}setError(t){this.error=t,this.loading=!1}static{this.\u0275fac=function(a){return new(a||l)(e.rXU(Z.FP))}}static{this.\u0275cmp=e.VBU({type:l,selectors:[["app-zap"]],standalone:!0,features:[e.aNF],decls:27,vars:6,consts:[[1,"mx-auto","w-full","max-w-5xl","p-6","sm:p-8"],[1,"flex","w-full","max-w-140","m-auto","flex-col","items-start"],[1,"mb-8","flex","flex-col","items-start","p-6","sm:p-8","transition-all","duration-300","w-full","pb-6"],[1,"flex","items-center","justify-center","mb-6","w-full"],[1,"text-2xl","font-semibold","text-center"],[1,"w-full","space-y-4",3,"ngSubmit","formGroup"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-600","mb-1"],[1,"flex","items-center"],["type","text","formControlName","lightningAddress","placeholder","username@domain.com",1,"flex-grow","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["type","button",1,"ml-2","px-4","py-2","text-sm","bg-gray-800","text-white","rounded","hover:bg-gray-700",3,"click"],["type","text","formControlName","eventId","placeholder","Event ID for specific zap",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["type","number","formControlName","amount","placeholder","Amount",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["class","form-group",4,"ngIf"],["type","submit",1,"w-full","py-2","text-sm","font-semibold","bg-gray-800","text-white","rounded","hover:bg-gray-700","disabled:bg-gray-400",3,"disabled"],["class","invoice mt-6 p-4 border rounded-lg bg-gray-50 shadow w-full",4,"ngIf"],["class","error mt-6 p-4 border rounded-lg bg-red-50 shadow w-full",4,"ngIf"],["formControlName","comment","placeholder","Add a comment...","rows","3",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],[1,"invoice","mt-6","p-4","border","rounded-lg","bg-gray-50","shadow","w-full"],[1,"text-lg","font-semibold","text-gray-800"],[1,"text-gray-700","break-words"],[1,"error","mt-6","p-4","border","rounded-lg","bg-red-50","shadow","w-full"],[1,"text-red-600","font-medium"]],template:function(a,n){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"angor-card",2)(3,"div",3)(4,"h2",4),e.EFF(5,"Send a Zap"),e.k0s()(),e.j41(6,"form",5),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.j41(7,"div",6)(8,"label",7),e.EFF(9,"Lightning Address"),e.k0s(),e.j41(10,"div",8),e.nrm(11,"input",9),e.j41(12,"button",10),e.bIt("click",function(){return n.fetchPayRequest()}),e.EFF(13," Fetch "),e.k0s()()(),e.j41(14,"div",6)(15,"label",7),e.EFF(16,"Event ID (Optional)"),e.k0s(),e.nrm(17,"input",11),e.k0s(),e.j41(18,"div",6)(19,"label",7),e.EFF(20,"Amount (in Satoshis)"),e.k0s(),e.nrm(21,"input",12),e.k0s(),e.DNE(22,T,4,0,"div",13),e.j41(23,"button",14),e.EFF(24),e.k0s()(),e.DNE(25,j,5,1,"div",15)(26,I,3,1,"div",16),e.k0s()()()),2&a&&(e.R7$(6),e.Y8G("formGroup",n.sendZapForm),e.R7$(16),e.Y8G("ngIf",null==n.payRequest?null:n.payRequest.commentAllowed),e.R7$(),e.Y8G("disabled",n.sendZapForm.invalid||n.loading),e.R7$(),e.SpI(" ",n.loading?"Sending...":"Send Zap"," "),e.R7$(),e.Y8G("ngIf",n.invoice.pr),e.R7$(),e.Y8G("ngIf",n.error))},dependencies:[b.MD,b.bT,x.RG,w.fS,E.Hl,C.m_,R.Ve,i.EE,r.X1,r.qT,r.me,r.Q0,r.BC,r.cb,r.j4,r.JD,f.n]})}}return l})()}]}}]);