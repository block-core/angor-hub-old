"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[76],{7112:(U,b,s)=>{s.d(b,{U:()=>i});var d=s(3014),f=s(1217),h=s(3107),g=s(8078);let i=(()=>{class o{constructor(e){this._signerService=e,this.STORAGE_KEY="userBookmarkedProjects",this.bookmarksSubject=new f.t([]),this.bookmarks$=this.bookmarksSubject.asObservable(),this.currentUserPubKey=null,window.addEventListener("storage",t=>{t.key===this.STORAGE_KEY&&this.refreshBookmarksForCurrentUser()})}initializeForCurrentUser(){var e=this;return(0,d.A)(function*(){e.clearBookmarks(),e.currentUserPubKey=yield e._signerService.getPublicKey(),e.currentUserPubKey&&(yield e.loadBookmarksForCurrentUser())})()}clearBookmarks(){this.bookmarksSubject.next([])}loadBookmarksForCurrentUser(){var e=this;return(0,d.A)(function*(){if(!e.currentUserPubKey)return;const u=e.getUserBookmarks()[e.currentUserPubKey]||[];e.bookmarksSubject.next(u)})()}getUserBookmarks(){const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):{}}saveUserBookmarks(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}addBookmark(e){var t=this;return(0,d.A)(function*(){if(!t.currentUserPubKey&&(t.currentUserPubKey=yield t._signerService.getPublicKey(),!t.currentUserPubKey))return void console.warn("No public key found for the current user.");const u=t.getUserBookmarks(),y=u[t.currentUserPubKey]||[];y.includes(e)||(y.push(e),u[t.currentUserPubKey]=y,t.saveUserBookmarks(u),t.bookmarksSubject.next(y))})()}removeBookmark(e){var t=this;return(0,d.A)(function*(){if(!t.currentUserPubKey&&(t.currentUserPubKey=yield t._signerService.getPublicKey(),!t.currentUserPubKey))return void console.warn("No public key found for the current user.");const u=t.getUserBookmarks(),P=(u[t.currentUserPubKey]||[]).filter(I=>I!==e);u[t.currentUserPubKey]=P,t.saveUserBookmarks(u),t.bookmarksSubject.next(P)})()}isBookmarked(e){var t=this;return(0,d.A)(function*(){return t.currentUserPubKey||(t.currentUserPubKey=yield t._signerService.getPublicKey(),t.currentUserPubKey)?(t.getUserBookmarks()[t.currentUserPubKey]||[]).includes(e):(console.warn("No public key found for the current user."),!1)})()}getBookmarks(){var e=this;return(0,d.A)(function*(){return e.currentUserPubKey||(e.currentUserPubKey=yield e._signerService.getPublicKey(),e.currentUserPubKey)?e.getUserBookmarks()[e.currentUserPubKey]||[]:(console.warn("No public key found for the current user."),[])})()}removeAllBookmarks(){var e=this;return(0,d.A)(function*(){if(!e.currentUserPubKey&&(e.currentUserPubKey=yield e._signerService.getPublicKey(),!e.currentUserPubKey))return void console.warn("No public key found for the current user.");const t=e.getUserBookmarks();t[e.currentUserPubKey]=[],e.saveUserBookmarks(t),e.bookmarksSubject.next([])})()}refreshBookmarksForCurrentUser(){this.currentUserPubKey&&this.loadBookmarksForCurrentUser()}static{this.\u0275fac=function(t){return new(t||o)(h.KVO(g.A))}}static{this.\u0275prov=h.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})()},1128:(U,b,s)=>{s.d(b,{F:()=>f});var d=s(3107);let f=(()=>{class h{constructor(){this.mainnetLocalStorageKey="mainnetIndexers",this.testnetLocalStorageKey="testnetIndexers",this.mainnetPrimaryIndexerKey="mainnetPrimaryIndexer",this.testnetPrimaryIndexerKey="testnetPrimaryIndexer",this.networkStorageKey="selectedNetwork",this.defaultMainnetIndexer="https://btc.indexer.angor.io/",this.defaultTestnetIndexer="https://tbtc.indexer.angor.io/",this.initializeDefaultIndexers()}initializeDefaultIndexers(){0===this.getIndexers("mainnet").length&&(this.addIndexer(this.defaultMainnetIndexer,"mainnet"),this.setPrimaryIndexer(this.defaultMainnetIndexer,"mainnet")),0===this.getIndexers("testnet").length&&(this.addIndexer(this.defaultTestnetIndexer,"testnet"),this.setPrimaryIndexer(this.defaultTestnetIndexer,"testnet"))}addIndexer(i,o){let c=this.getIndexers(o);c.includes(i)||(c.push(i),this.saveIndexers(c,o))}getIndexers(i){return JSON.parse(localStorage.getItem("mainnet"===i?this.mainnetLocalStorageKey:this.testnetLocalStorageKey)||"[]")}saveIndexers(i,o){localStorage.setItem("mainnet"===o?this.mainnetLocalStorageKey:this.testnetLocalStorageKey,JSON.stringify(i))}setPrimaryIndexer(i,o){this.getIndexers(o).includes(i)&&localStorage.setItem("mainnet"===o?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey,i)}getPrimaryIndexer(i){return localStorage.getItem("mainnet"===i?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey)}removeIndexer(i,o){let c=this.getIndexers(o);const e=c.indexOf(i);-1!==e&&(c.splice(e,1),this.saveIndexers(c,o),i===this.getPrimaryIndexer(o))&&localStorage.removeItem("mainnet"===o?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey)}clearAllIndexers(i){const c="mainnet"===i?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;localStorage.removeItem("mainnet"===i?this.mainnetLocalStorageKey:this.testnetLocalStorageKey),localStorage.removeItem(c)}setNetwork(i){localStorage.setItem(this.networkStorageKey,i)}getNetwork(){return localStorage.getItem(this.networkStorageKey)||"testnet"}static{this.\u0275fac=function(o){return new(o||h)}}static{this.\u0275prov=d.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},9528:(U,b,s)=>{s.d(b,{i:()=>D});var d=s(3014),f=s(1217),h=s(3016),g=s(1787),i=s(8915),o=s(8249),c=s(5903),e=s(2040),t=s(7947),u=s(5823),y=s(2867),P=s(7178),I=s(1483),E=s(36),B=s(5351);const O=(l,k)=>(l.push(k),l);function K(){return(0,B.N)((l,k)=>{(function M(l,k){return(0,B.N)((0,E.S)(l,k,arguments.length>=2,!1,!0))})(O,[])(l).subscribe(k)})}var S=s(3107),T=s(7691),A=s(1128),F=s(3149),L=s(5506);let D=(()=>{class l{constructor(r,n,a,m){this.http=r,this.indexerService=n,this.storageService=a,this.subscriptionService=m,this.INITIAL_OFFSET=0,this.LIMIT=50,this.offset=this.INITIAL_OFFSET,this.totalProjects=0,this.totalProjectsFetched=!1,this.projectsSubject=new f.t([]),this.projects$=this.projectsSubject.asObservable().pipe((0,o.t)(1)),this.loadingSubject=new f.t(!1),this.loading$=this.loadingSubject.asObservable(),this.noMoreProjectsSubject=new f.t(!1),this.noMoreProjects$=this.noMoreProjectsSubject.asObservable(),this.projectStatsSubject=new f.t({}),this.projectStats$=this.projectStatsSubject.asObservable().pipe((0,o.t)(1)),this.selectedNetwork=this.indexerService.getNetwork(),console.log("Selected network:",this.selectedNetwork)}fetchProjects(){if(this.loadingSubject.value||this.noMoreProjectsSubject.value)return console.log("Skipping fetch: Already loading or no more projects."),(0,h.of)([]);this.loadingSubject.next(!0);const n=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects?${this.totalProjectsFetched?`offset=${this.offset}&`:""}limit=${this.LIMIT}`;return this.http.get(n,{observe:"response"}).pipe((0,c.L)(3),(0,e.M)(a=>this.handlePaginationResponse(a)),(0,t.T)(a=>a.body||[]),(0,u.Z)(this.filterUniqueProjects.bind(this)),(0,y.n)(this.processNewProjects.bind(this)),(0,P.W)(this.handleError.bind(this)),(0,e.M)(()=>this.loadingSubject.next(!1)))}handlePaginationResponse(r){if(!this.totalProjectsFetched&&r?.headers){const n=r.headers.get("pagination-total");this.totalProjects=n?+n:0,this.totalProjectsFetched=!0,this.offset=Math.max(this.totalProjects-this.LIMIT,0)}}filterUniqueProjects(r){return(0,g.H)(r).pipe((0,I.p)(n=>!this.projectsSubject.value.some(a=>a.projectIdentifier===n.projectIdentifier)),K())}processNewProjects(r){if(!r.length)return this.noMoreProjectsSubject.next(!0),(0,h.of)([]);const n=(0,g.H)(r).pipe((0,u.Z)(m=>(0,g.H)(this.storageService.saveProject(m))),K()),a=(0,g.H)(r).pipe((0,u.Z)(this.fetchProjectDetails.bind(this)),K());return n.pipe((0,y.n)(()=>a),(0,e.M)(this.updateProjectsList.bind(this)))}fetchProjectDetails(r){return(0,g.H)(this.storageService.getProjectStats(r.projectIdentifier)).pipe((0,t.T)(n=>(this.updateProjectStats(r.projectIdentifier,n),r)),(0,P.W)(n=>(console.error(`Error fetching details for project ${r.projectIdentifier}:`,n),(0,h.of)(r))))}updateProjectsList(r){const n=[...this.projectsSubject.value,...r];this.projectsSubject.next(n),this.subscribeToProjectDetails(r.map(a=>a.nostrEventId)),this.offset=Math.max(this.offset-this.LIMIT,0)}updateProjectStats(r,n){this.projectStatsSubject.next({...this.projectStatsSubject.value,[r]:n})}handleError(r){return console.error("Error fetching projects:",r),this.loadingSubject.next(!1),(0,i.$)(()=>new Error("Failed to fetch projects. Please try again later."))}subscribeToProjectsMetadata(r){this.subscriptionService.addSubscriptions([{kinds:[0],authors:r}],a=>{const m=this.parseMetadataEvent(a);this.storageService.saveProfile(a.pubkey,m)})}subscribeToProjectDetails(r){var n=this;this.subscriptionService.addSubscriptions([{kinds:[30078],ids:r}],function(){var m=(0,d.A)(function*(v){try{const x=Array.isArray(v)?v:[v],j=[];for(const N of x){const p=n.parseMetadataEvent(N);yield n.storageService.saveProjectDetails(p),p.nostrPubKey&&!j.includes(p.nostrPubKey)&&j.push(p.nostrPubKey)}j.length>0&&n.subscribeToProjectsMetadata(j)}catch(x){console.error("Error handling project details subscription:",x)}});return function(v){return m.apply(this,arguments)}}())}parseMetadataEvent(r){try{return JSON.parse(r.content)}catch(n){return console.error("Error parsing metadata event:",n),{}}}fetchProjectStats(r){const a=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${r}/stats`;return this.http.get(a).pipe((0,e.M)(m=>this.updateProjectStats(r,m)),(0,P.W)(m=>(console.error(`Error fetching stats for project ${r}:`,m),(0,h.of)({}))))}resetProjects(){this.projectsSubject.next([]),this.noMoreProjectsSubject.next(!1),this.loadingSubject.next(!1),this.projectStatsSubject.next({}),this.offset=this.INITIAL_OFFSET,this.totalProjectsFetched=!1}static{this.\u0275fac=function(n){return new(n||l)(S.KVO(T.Qq),S.KVO(A.F),S.KVO(F.n),S.KVO(L.n))}}static{this.\u0275prov=S.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()}}]);