"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[477],{2477:(wt,N,c)=>{c.r(N),c.d(N,{default:()=>bt});var e=c(4438),_=c(5245);let O=(()=>{class i{constructor(){}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat"]],standalone:!0,features:[e.aNF],decls:3,vars:0,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex","flex-auto","overflow-hidden"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"router-outlet"),e.k0s()())},dependencies:[_.n3],encapsulation:2,changeDetection:0})}}return i})();var f=c(467),I=c(4412),j=c(1413),V=c(1985),S=c(8810),B=c(6648),L=c(7673),Y=c(5964),A=c(6697),$=c(5558),D=c(6354),G=c(9437),Q=c(719),R=c(8418),z=c(2827),H=c(4930),X=c(7291),W=c(6231),Z=c(152),x=c(6977),J=c(5645);let q=(()=>{class i{constructor(t,n){this.subscriptionService=t,this.storageService=n,this.publicKeyQueue=new Set,this.updateSubject=new j.B,this._unsubscribeAll=new j.B,this.initializeService()}initializeService(){var t=this;return(0,f.A)(function*(){yield t.loadStoredPublicKeys(),t.updateSubject.pipe((0,Z.B)(2e3),(0,x.Q)(t._unsubscribeAll)).subscribe(()=>t.processQueue())})()}addPublicKey(t){this.publicKeyQueue.has(t)||(this.publicKeyQueue.add(t),this.updateSubject.next())}loadStoredPublicKeys(){var t=this;return(0,f.A)(function*(){try{(yield t.storageService.getAllProfiles()).forEach(o=>{o.pubKey&&t.publicKeyQueue.add(o.pubKey)}),t.updateSubject.next()}catch(n){console.error("Error loading stored public keys:",n)}})()}processQueue(){if(0===this.publicKeyQueue.size)return;const t=Array.from(this.publicKeyQueue);this.publicKeyQueue.clear();const o=this.subscriptionService.addSubscriptions([{kinds:[0],authors:t}],r=>{const a=this.parseMetadataEvent(r);a&&this.storageService.saveProfile(r.pubkey,a),this.subscriptionService.removeSubscriptionById(o)})}parseMetadataEvent(t){try{return JSON.parse(t.content)}catch(n){return console.error("Error parsing metadata event:",n),null}}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(J.n),e.KVO(X.n))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),y=(()=>{class i{constructor(t,n,o,r,a){this._metadataService=t,this._signerService=n,this._storageService=o,this._relayService=r,this._metadataQueueService=a,this.chatList=[],this.latestMessageTimestamps={},this.messageQueue=[],this.isDecrypting=!1,this.decryptedPrivateKey="",this._chat=new I.t(null),this._chats=new I.t(null),this._contact=new I.t(null),this._contacts=new I.t(null),this._profile=new I.t(null),this._unsubscribeAll=new j.B}get profile$(){return this._profile.asObservable()}get chat$(){return this._chat.asObservable()}get chats$(){return this._chats.asObservable()}get contact$(){return this._contact.asObservable()}get contacts$(){return this._contacts.asObservable()}checkCurrentChatOnPageRefresh(t){t&&this.getChatById(t).subscribe(o=>{o&&(this._chat.next(o),this.loadAndFetchChatHistory(t))})}getContact(t){var n=this;return(0,f.A)(function*(){try{if(!t)return;const o=yield n._metadataService.fetchMetadataWithCache(t);o&&n._contact.next({pubKey:t,displayName:o.name?o.name:"Unknown",picture:o.picture,about:o.about})}catch(o){console.error("Error fetching contact metadata:",o)}})()}getContacts(){return new V.c(t=>(this._storageService.getAllProfiles().then(n=>{if(n&&n.length>0){const o=n.map(r=>(r.pubKey||console.error("Contact is missing pubKey:",r),r));this._contacts.next(o),t.next(o)}else t.next([]);t.complete()}).catch(n=>{console.error("Error loading cached contacts from IndexedDB:",n),t.next([]),t.complete()}),{unsubscribe(){}}))}getProfile(){var t=this;return(0,f.A)(function*(){try{t._storageService.profile$.subscribe(n=>{n&&n.pubKey&&n.metadata&&n.pubKey===t._signerService.getPublicKey()&&t._profile.next(n.metadata)}),t._storageService.getProfile(t._signerService.getPublicKey()).then(n=>{t._profile.next(n)})}catch(n){console.error("Error fetching profile metadata:",n)}})()}getChats(){var t=this;return(0,f.A)(function*(){const n=t._signerService.getPublicKey(),o=yield t._signerService.isUsingExtension(),r=yield t._signerService.isUsingSecretKey();return t.decryptedPrivateKey=r?yield t._signerService.getDecryptedSecretKey():"",yield Promise.all([t.subscribeToChatList(n,o,r,t.decryptedPrivateKey)]),t.getChatListStream()})()}subscribeToChatList(t,n,o,r){var a=this;return this._relayService.ensureConnectedRelays().then((0,f.A)(function*(){const u=[{kinds:[R.rV],authors:[t],limit:1500},{kinds:[R.rV],"#p":[t],limit:1500}];var l;a._relayService.getPool().subscribeMany(a._relayService.getConnectedRelays(),u,{onevent:(l=(0,f.A)(function*(d){const h=d.pubkey===t?d.tags.find(M=>"p"===M[0])?.[1]||"":d.pubkey;h&&d.created_at>(a.latestMessageTimestamps[h]||0)&&(a.messageQueue.push(d),a.processNextMessage(t,n,o,r))}),function(h){return l.apply(this,arguments)}),oneose:()=>{(a.chatList||[]).length>0&&a._chats.next(a.chatList)}})})),this.getChatListStream()}processNextMessage(t,n,o,r){var a=this;return(0,f.A)(function*(){if(!a.isDecrypting&&0!==a.messageQueue.length){a.isDecrypting=!0;try{for(;a.messageQueue.length>0;){const u=a.messageQueue.shift();if(!u)continue;const l=u.pubkey===t,d=l?u.tags.find(F=>"p"===F[0])?.[1]||"":u.pubkey;if(!d)continue;const h=yield a.decryptReceivedMessage(u,n,o,r,d);h&&a.addOrUpdateChatList(d,h,u.created_at,l)}}catch{}finally{a.isDecrypting=!1}}})()}addOrUpdateChatList(t,n,o,r){const a=this.chatList.find(l=>l.contact?.pubKey===t),u={id:`${t}-${o}`,chatId:t,contactId:t,isMine:r,value:n,createdAt:new Date(1e3*o).toISOString()};if(a)a.messages?.some(d=>d.id===u.id)||(a.messages=[...a.messages||[],u].sort((d,h)=>new Date(d.createdAt).getTime()-new Date(h.createdAt).getTime()),Number(a.lastMessageAt)<o&&(a.lastMessage=n,a.lastMessageAt=o.toString()));else{this._metadataQueueService.addPublicKey(t);const l=this._contacts.value?.find(h=>h.pubKey===t)||{pubKey:t},d={id:t,contact:{pubKey:l.pubKey,name:l.name||"Unknown",picture:l.picture||"/images/avatars/avatar-placeholder.png",about:l.about||"",displayName:l.displayName||l.name||"Unknown"},lastMessage:n,lastMessageAt:o.toString(),messages:[u]};this.chatList.push(d)}this.chatList.sort((l,d)=>Number(d.lastMessageAt)-Number(l.lastMessageAt)),this._chats.next(this.chatList),this._storageService.profile$.pipe((0,Y.p)(l=>l&&l.pubKey===t)).subscribe(l=>{const d=this.chatList.find(h=>h.contact?.pubKey===t);d&&(d.contact={...d.contact,name:l.metadata?.name||d.contact.name,picture:l.metadata?.picture||d.contact.picture,about:l.metadata?.about||d.contact.about,displayName:l.metadata?.displayName||l.metadata?.name||d.contact.displayName},this._chats.next(this.chatList))})}getChatListStream(){return this._chats.asObservable()}decryptReceivedMessage(t,n,o,r,a){var u=this;return(0,f.A)(function*(){return n&&!o?yield u._signerService.decryptMessageWithExtension(a,t.content):o&&!n?yield u._signerService.decryptMessage(r,a,t.content):void 0})()}loadAndFetchChatHistory(t,n=!1){var o=this;return(0,f.A)(function*(){const r=o._signerService.getPublicKey(),a=[{kinds:[R.rV],authors:[r],"#p":[t],limit:10},{kinds:[R.rV],authors:[t],"#p":[r],limit:10}],u=[];if(o._relayService.getPool().subscribeMany(o._relayService.getConnectedRelays(),a,{onevent:(l=(0,f.A)(function*(d){const h=d.pubkey===r,F=h?t:d.pubkey,M=yield o._signerService.isUsingExtension(),xt=yield o._signerService.isUsingSecretKey(),T=yield o.decryptReceivedMessage(d,M,xt,o.decryptedPrivateKey,F);if(T){const U=Math.floor(d.created_at),yt={id:d.id,chatId:t,contactId:F,isMine:h,value:T,createdAt:new Date(1e3*U).toISOString()};n&&u.push(yt),o.addOrUpdateChatList(t,T,U,h),o._chat.next(o.chatList.find(kt=>kt.id===t))}}),function(h){return l.apply(this,arguments)}),oneose:()=>{}}),n)return yield new Promise(l=>setTimeout(l,1e3)),u;var l})()}updateChat(t,n){return this.chats$.pipe((0,A.s)(1),(0,$.n)(o=>{const r=n.contact?.pubKey;if(!r)return(0,S.$)("No public key found for this chat");const a={kind:4,pubkey:r,content:JSON.stringify(n),created_at:Math.floor(Date.now()/1e3),tags:[["p",r]]};return a.id=(0,Q.dq)(a),(0,B.H)(this._relayService.publishEventToWriteRelays(a)).pipe((0,D.T)(()=>{if(o){const u=o.findIndex(l=>l.id===t);-1!==u&&(o[u]=n,this._chats.next(o))}return n}),(0,G.W)(u=>(console.error("Failed to update chat via Nostr:",u),(0,S.$)(u))))}))}getChatById(t,n=null){return this.recipientPublicKey=t,(0,B.H)(Promise.all([this._signerService.getPublicKey()])).pipe((0,$.n)(()=>this.chats$.pipe((0,A.s)(1),(0,$.n)(o=>{if(!o||0===o.length)return this.createNewChat(t,n);const r=o.find(a=>a.id===t);return r?(this._chat.next(r),this.loadAndFetchChatHistory(this.recipientPublicKey),(0,L.of)(r)):this.createNewChat(t,n)}))),(0,G.W)(o=>(console.error("Error fetching chat by id from Nostr:",o),(0,S.$)(o))))}createNewChat(t,n=null){const o={id:t||"",contact:n?{pubKey:n.pubKey||t,name:n.name||"Unknown",picture:n.picture||"/images/avatars/avatar-placeholder.png"}:{pubKey:t,name:"Unknown",picture:"/images/avatars/avatar-placeholder.png"},lastMessage:"new chat...",lastMessageAt:Math.floor(Date.now()/1e3).toString()||"0",messages:[]};return this._metadataQueueService.addPublicKey(t),this._storageService.profile$.pipe((0,Y.p)(r=>r&&r.pubKey===t),(0,D.T)(r=>(o.contact={pubKey:t,name:r.metadata?.name||"Unknown",picture:r.metadata?.picture||"/images/avatars/avatar-placeholder.png",about:r.metadata?.about||"",displayName:r.metadata?.displayName||r.metadata?.name||"Unknown"},o)))}resetChat(){this._chat.next(null)}sendPrivateMessage(t){var n=this;return(0,f.A)(function*(){try{n.message=t;const o=yield n._signerService.isUsingExtension(),r=yield n._signerService.isUsingSecretKey();if(o&&!r)yield n.handleMessageSendingWithExtension();else if(!o&&r){if(!n.isValidMessageSetup())return void console.error("Message, sender private key, or recipient public key is not properly set.");const a=yield n._signerService.encryptMessage(n.decryptedPrivateKey,n.recipientPublicKey,n.message),u=n._signerService.getUnsignedEvent(4,[["p",n.recipientPublicKey]],a),l=n._signerService.getSignedEvent(u,n.decryptedPrivateKey);(yield n._relayService.publishEventToWriteRelays(l))?n.message="":console.error("Failed to send the message.")}}catch(o){console.error("Error sending private message:",o)}})()}handleMessageSendingWithExtension(){var t=this;return(0,f.A)(function*(){try{const n=yield t._signerService.encryptMessageWithExtension(t.message,t.recipientPublicKey),o=yield t._signerService.signEventWithExtension({kind:4,pubkey:t._signerService.getPublicKey(),tags:[["p",t.recipientPublicKey]],content:n,created_at:Math.floor(Date.now()/1e3)});(yield t._relayService.publishEventToWriteRelays(o))?t.message="":console.error("Failed to send the message with extension.")}catch(n){console.error("Error sending message with extension:",n)}})()}isValidMessageSetup(){return""!==this.message.trim()&&""!==this.recipientPublicKey}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(z.T),e.KVO(H.A),e.KVO(X.n),e.KVO(W.b),e.KVO(q))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var v=c(177),m=c(8834),p=c(2102),g=c(9213),k=c(9042),w=c(9115),C=c(882),ee=c(8703);let te=(()=>{class i{transform(t){return/\.(jpeg|jpg|gif|png|bmp|svg|webp|tiff)$/i.test(t)?"\u{1f304} image":/\.(mp4|mov|avi|mkv|webm|flv|wmv|mpeg|3gp)$/i.test(t)?"\u{1f3ac} video":/\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(t)?"\u{1f3b5} audio":/\.pdf$/i.test(t)?"\u{1f4c1} pdf":/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/.test(t)?"\u{1f4fd}\ufe0f youtube":/https?:\/\/(www\.)?vimeo.com\/(\d+)/.test(t)?"\u{1f4fd}\ufe0f vimeo":/https?:\/\/(www\.)?instagram.com\/p\/[a-zA-Z0-9_-]+/.test(t)?"\u{1f52e} instagram":/https?:\/\/(www\.)?twitter.com\/[a-zA-Z0-9_]+\/status\/[0-9]+/.test(t)?"\u{1f426} twitter":/(https?:\/\/[^\s]+)/.test(t)?"\u{1f310} url":t}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275pipe=e.EJ8({name:"checkmessage",type:i,pure:!0,standalone:!0})}}return i})();function ne(i,s){if(1&i){const t=e.RV6();e.j41(0,"div",16),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.openChat(o))}),e.EFF(1),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.name.charAt(0)," ")}}function ie(i,s){if(1&i&&e.nrm(0,"img",11),2&i){const t=e.XpG().$implicit;e.Y8G("src",t.picture,e.B4B)}}function oe(i,s){if(1&i&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.name.charAt(0)," ")}}function re(i,s){if(1&i){const t=e.RV6();e.DNE(0,ne,2,1,"div",8),e.j41(1,"div",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.openChat(o))}),e.j41(2,"div",10),e.DNE(3,ie,1,1,"img",11)(4,oe,2,1,"div",12),e.k0s(),e.j41(5,"div",13)(6,"div",14),e.EFF(7),e.k0s(),e.j41(8,"div",15),e.EFF(9),e.k0s()()()}if(2&i){const t=s.$implicit,n=s.$index,o=e.XpG(2);e.vxM(0===n||t.name.charAt(0)!==o.contacts[n-1].name.charAt(0)?0:-1),e.R7$(3),e.vxM(t.picture?3:-1),e.R7$(),e.vxM(t.picture?-1:4),e.R7$(3),e.SpI(" ",t.name," "),e.R7$(2),e.SpI(" ",t.about," ")}}function se(i,s){if(1&i&&e.Z7z(0,re,10,5,"div",7,e.BUC().trackByFn,!0),2&i){const t=e.XpG();e.Dyx(t.contacts)}}function ae(i,s){1&i&&(e.j41(0,"div",6),e.EFF(1," There are no contacts! "),e.k0s())}let ce=(()=>{class i{constructor(t,n){this._chatService=t,this.router=n,this.contacts=[],this._unsubscribeAll=new j.B}ngOnInit(){this._chatService.contacts$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(t=>{this.contacts=t})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}trackByFn(t,n){return n.id||t}openChat(t){this._chatService.getChatById(t.pubKey,t).subscribe({next:n=>{console.log("Chat loaded or created:",n),this.router.navigate(["/chat",t.pubKey])},error:n=>{console.error("Error loading or creating chat:",n)},complete:()=>{this.drawer.close()}})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(y),e.rXU(_.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat-new-chat"]],inputs:{drawer:"drawer"},standalone:!0,features:[e.aNF],decls:9,vars:2,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","overflow-hidden","dark:bg-default"],[1,"-mb-px","flex","h-18","flex-0","items-center","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"relative","overflow-y-auto"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","dark:hover:bg-hover","hover:bg-gray-100","md:px-8"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-100","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","dark:hover:bg-hover","hover:bg-gray-100","md:px-8",3,"click"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","overflow-hidden","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-100","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return o.drawer.close()}),e.nrm(3,"mat-icon",3),e.k0s(),e.j41(4,"div",4),e.EFF(5,"New chat"),e.k0s()(),e.j41(6,"div",5),e.DNE(7,se,2,0)(8,ae,2,0,"div",6),e.k0s()()),2&n&&(e.R7$(3),e.Y8G("svgIcon","heroicons_outline:arrow-long-left"),e.R7$(4),e.vxM(o.contacts.length?7:8))},dependencies:[m.Hl,m.iY,g.m_,g.An],encapsulation:2,changeDetection:0})}}return i})();var b=c(9417);function le(i,s){if(1&i&&e.nrm(0,"img",10),2&i){const t=e.XpG();e.Y8G("src",t.profile.picture,e.B4B)("alt","Profile picture")}}function de(i,s){if(1&i&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI(" ",t.profile.name.charAt(0)," ")}}let ue=(()=>{class i{constructor(t){this._chatService=t,this._unsubscribeAll=new j.B}ngOnInit(){this._chatService.profile$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(t=>{this.profile=t})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(y))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat-profile"]],inputs:{drawer:"drawer"},standalone:!0,features:[e.aNF],decls:35,vars:11,consts:[[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"px-6"],[1,"group","relative","mx-auto","mt-8","flex","h-40","w-40","flex-0","rounded-full"],[1,"absolute","inset-0","hidden","cursor-pointer","flex-col","items-center","justify-center","rounded-full","bg-gray-800","bg-opacity-80","backdrop-blur","backdrop-filter","group-hover:flex"],[1,"text-white",3,"svgIcon"],[1,"mx-6","mt-2","text-center","font-medium","text-white"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mx-2","mt-8","flex","flex-col"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"ngModel"],[1,"mt-4","flex","items-center","justify-end"],["mat-button","",3,"click"],["mat-flat-button","",1,"ml-2",3,"color"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return o.drawer.close()}),e.nrm(3,"mat-icon",3),e.k0s(),e.j41(4,"div",4),e.EFF(5,"Profile"),e.k0s()(),e.j41(6,"div",5)(7,"div",6)(8,"div",7),e.nrm(9,"mat-icon",8),e.j41(10,"div",9),e.EFF(11," Change Profile Photo "),e.k0s()(),e.DNE(12,le,1,2,"img",10)(13,de,2,1,"div",11),e.k0s(),e.j41(14,"div",12)(15,"mat-form-field")(16,"mat-label"),e.EFF(17,"Name"),e.k0s(),e.nrm(18,"mat-icon",13)(19,"input",14),e.k0s(),e.j41(20,"mat-form-field")(21,"mat-label"),e.EFF(22,"Username"),e.k0s(),e.nrm(23,"mat-icon",13)(24,"input",14),e.k0s(),e.j41(25,"mat-form-field")(26,"mat-label"),e.EFF(27,"About"),e.k0s(),e.nrm(28,"mat-icon",13)(29,"input",14),e.k0s(),e.j41(30,"div",15)(31,"button",16),e.bIt("click",function(){return o.drawer.close()}),e.EFF(32,"Cancel"),e.k0s(),e.j41(33,"button",17),e.EFF(34," Save "),e.k0s()()()()()),2&n&&(e.R7$(3),e.Y8G("svgIcon","heroicons_outline:arrow-long-left"),e.R7$(6),e.Y8G("svgIcon","heroicons_outline:camera"),e.R7$(3),e.vxM(o.profile.picture?12:-1),e.R7$(),e.vxM(o.profile.picture?-1:13),e.R7$(5),e.Y8G("svgIcon","heroicons_solid:user-circle"),e.R7$(),e.Y8G("ngModel",o.profile.name),e.R7$(4),e.Y8G("svgIcon","heroicons_solid:envelope"),e.R7$(),e.Y8G("ngModel",o.profile.username),e.R7$(4),e.Y8G("svgIcon","heroicons_solid:identification"),e.R7$(),e.Y8G("ngModel",o.profile.about),e.R7$(4),e.Y8G("color","primary"))},dependencies:[m.Hl,m.$z,m.iY,g.m_,g.An,p.RG,p.rl,p.nJ,p.JW,k.fS,k.fg,b.YN,b.me,b.BC,b.vS],encapsulation:2,changeDetection:0})}}return i})();var he=c(7857);const me=(i,s)=>({"dark:hover:bg-hover hover:bg-gray-100":i,"bg-primary-50 dark:bg-hover":s}),pe=i=>[i],ge=(i,s)=>({"absolute inset-0 z-20 flex lg:static lg:inset-auto":i,"hidden lg:flex":s});function fe(i,s){if(1&i&&e.nrm(0,"chat-new-chat",6),2&i){e.XpG();const t=e.sdS(3);e.Y8G("drawer",t)}}function ve(i,s){if(1&i&&e.nrm(0,"chat-profile",6),2&i){e.XpG();const t=e.sdS(3);e.Y8G("drawer",t)}}function _e(i,s){if(1&i&&e.nrm(0,"img",15),2&i){const t=e.XpG(2);e.Y8G("src",null==t.profile?null:t.profile.picture,e.B4B)}}function Ce(i,s){if(1&i&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",null==t.profile||null==t.profile.name?null:t.profile.name.charAt(0)," ")}}function be(i,s){if(1&i&&e.nrm(0,"div",39),2&i){const t=e.XpG().$implicit,n=e.XpG(3);e.AVh("ring-primary-50",n.selectedChat&&n.selectedChat.id===t.id)}}function xe(i,s){if(1&i){const t=e.RV6();e.j41(0,"img",40),e.bIt("error",function(){e.eBV(t);const o=e.XpG(4);return e.Njj(o.src="/images/avatars/avatar-placeholder.png")}),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.Y8G("src",null==t.contact?null:t.contact.picture,e.B4B)}}function ye(i,s){if(1&i&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",null==t.contact||null==t.contact.name?null:t.contact.name.charAt(0)," ")}}function ke(i,s){1&i&&e.nrm(0,"mat-icon",38),2&i&&e.Y8G("svgIcon","heroicons_solid:speaker-x-mark")}function we(i,s){if(1&i&&(e.j41(0,"a",28)(1,"div",29),e.DNE(2,be,1,2,"div",30)(3,xe,1,1,"img",31)(4,ye,2,1,"div",32),e.k0s(),e.j41(5,"div",33)(6,"div",34),e.EFF(7),e.k0s(),e.j41(8,"div",35),e.EFF(9),e.nI1(10,"checkmessage"),e.k0s()(),e.j41(11,"div",36)(12,"div",37),e.EFF(13),e.nI1(14,"ago"),e.k0s(),e.DNE(15,ke,1,1,"mat-icon",38),e.k0s()()),2&i){const t=s.$implicit,n=e.XpG(3);e.Y8G("ngClass",e.l_i(17,me,!n.selectedChat||n.selectedChat.id!==t.id,n.selectedChat&&n.selectedChat.id===t.id))("routerLink",e.eq3(20,pe,t.id)),e.R7$(2),e.vxM(t.unreadCount>0?2:-1),e.R7$(),e.Y8G("ngIf",null==t.contact?null:t.contact.picture),e.R7$(),e.Y8G("ngIf",!(null!=t.contact&&t.contact.picture)),e.R7$(3),e.SpI(" ",null==t.contact?null:t.contact.name," "),e.R7$(),e.AVh("text-primary",t.unreadCount>0)("dark:text-primary-500",t.unreadCount>0),e.R7$(),e.SpI(" ",e.bMT(10,13,t.lastMessage)," "),e.R7$(4),e.SpI(" ",e.bMT(14,15,t.lastMessageAt)," "),e.R7$(2),e.vxM(t.muted?15:-1)}}function Fe(i,s){if(1&i&&e.Z7z(0,we,16,22,"a",28,e.BUC().trackByFn,!0),2&i){const t=e.XpG(2);e.Dyx(t.filteredChats)}}function je(i,s){1&i&&(e.j41(0,"div",9),e.nrm(1,"mat-icon",41),e.j41(2,"div",42),e.EFF(3," No chats "),e.k0s()()),2&i&&(e.R7$(),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Ie(i,s){if(1&i){const t=e.RV6();e.j41(0,"div",8)(1,"div",11)(2,"div",12)(3,"div",13),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openProfile())}),e.j41(4,"div",14),e.DNE(5,_e,1,1,"img",15)(6,Ce,2,1,"div",16),e.k0s(),e.j41(7,"div",17),e.EFF(8),e.k0s()(),e.j41(9,"button",18),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openNewChat())}),e.nrm(10,"mat-icon",19),e.k0s(),e.j41(11,"button",20),e.nrm(12,"mat-icon",19),e.j41(13,"mat-menu",null,1)(15,"button",21),e.nrm(16,"mat-icon",19),e.EFF(17," New group "),e.k0s(),e.j41(18,"button",21),e.nrm(19,"mat-icon",19),e.EFF(20," Create a room "),e.k0s(),e.j41(21,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openProfile())}),e.nrm(22,"mat-icon",19),e.EFF(23," Profile "),e.k0s(),e.j41(24,"button",21),e.nrm(25,"mat-icon",19),e.EFF(26," Archived "),e.k0s(),e.j41(27,"button",21),e.nrm(28,"mat-icon",19),e.EFF(29," Starred "),e.k0s(),e.j41(30,"button",21),e.nrm(31,"mat-icon",19),e.EFF(32," Settings "),e.k0s()()()(),e.j41(33,"div",23)(34,"mat-form-field",24),e.nrm(35,"mat-icon",25),e.j41(36,"input",26,2),e.bIt("input",function(){e.eBV(t);const o=e.sdS(37),r=e.XpG();return e.Njj(r.filterChats(o.value))}),e.k0s()()()(),e.j41(38,"div",27),e.DNE(39,Fe,2,0)(40,je,4,1,"div",9),e.k0s()()}if(2&i){const t=e.sdS(14),n=e.XpG();e.R7$(5),e.vxM(null!=n.profile&&n.profile.picture?5:-1),e.R7$(),e.vxM(null!=n.profile&&n.profile.picture?-1:6),e.R7$(2),e.SpI(" ",null==n.profile?null:n.profile.name," "),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:plus-circle"),e.R7$(),e.Y8G("matMenuTriggerFor",t),e.R7$(),e.Y8G("svgIcon","heroicons_outline:ellipsis-vertical"),e.R7$(4),e.Y8G("svgIcon","heroicons_outline:user-group"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:chat-bubble-left-right"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:user-circle"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:archive-box"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:star"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:cog-8-tooth"),e.R7$(3),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","heroicons_solid:magnifying-glass"),e.R7$(),e.Y8G("autocomplete","off")("placeholder","Search or start new chat"),e.R7$(3),e.vxM(n.filteredChats.length>0?39:40)}}function Se(i,s){1&i&&(e.j41(0,"div",9),e.nrm(1,"mat-icon",41),e.j41(2,"div",42),e.EFF(3," No chats "),e.k0s()()),2&i&&(e.R7$(),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Re(i,s){if(1&i&&(e.j41(0,"div",10),e.nrm(1,"router-outlet"),e.k0s()),2&i){const t=e.XpG();e.Y8G("ngClass",e.l_i(1,ge,t.selectedChat&&t.selectedChat.id,!t.selectedChat||!t.selectedChat.id))}}let $e=(()=>{class i{constructor(t,n,o,r){this._chatService=t,this._changeDetectorRef=n,this.route=o,this._angorNavigationService=r,this.chats=[],this.filteredChats=[],this.drawerOpened=!1,this._unsubscribeAll=new j.B}updateNavigationBadge(){const t=this._angorNavigationService.getComponent("mainNavigation");t&&(this._angorNavigationService.getItem("chat",t.navigation).badge.title="0",t.refresh())}ngOnInit(){this.updateNavigationBadge(),this._chatService.chats$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(n=>{this.chats=this.filteredChats=n,this._markForCheck()}),this._chatService.profile$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(n=>{this.profile=n,this._markForCheck()}),this._chatService.chat$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(n=>{this.selectedChat=n,this._markForCheck()});const t=localStorage.getItem("currentChatId");t&&this._chatService.checkCurrentChatOnPageRefresh(t)}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete(),this._chatService.resetChat(),localStorage.removeItem("currentChatId")}filterChats(t){if(t){const n=t.toLowerCase();this.filteredChats=this.chats.filter(o=>o.contact?.name.toLowerCase().includes(n))}else this.filteredChats=this.chats;this._markForCheck()}openNewChat(){this.drawerComponent="new-chat",this.drawerOpened=!0,this._markForCheck()}openProfile(){this.drawerComponent="profile",this.drawerOpened=!0,this._markForCheck()}trackByFn(t,n){return n.id||t}_markForCheck(){this._changeDetectorRef.markForCheck()}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(y),e.rXU(e.gRc),e.rXU(_.nX),e.rXU(he.lX))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat-chats"]],standalone:!0,features:[e.aNF],decls:10,vars:7,consts:[["drawer",""],["chatsHeaderMenu",""],["searchField",""],[1,"bg-card","relative","flex","w-full","flex-auto","dark:bg-transparent"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-r","lg:shadow-none",3,"openedChange","autoFocus","opened"],[3,"drawer"],[1,"flex","overflow-hidden"],[1,"bg-card","relative","flex","w-full","min-w-0","flex-auto","flex-col","dark:bg-transparent","lg:min-w-100","lg:max-w-100"],[1,"flex","h-full","flex-auto","flex-col","items-center","justify-center"],[1,"flex-auto","border-l",3,"ngClass"],[1,"flex","flex-0","flex-col","border-b","bg-gray-50","px-8","py-4","dark:bg-transparent"],[1,"flex","items-center"],[1,"mr-1","flex","cursor-pointer","items-center",3,"click"],[1,"h-10","w-10"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Profile picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","font-medium"],["mat-icon-button","",1,"ml-auto",3,"click"],[3,"svgIcon"],["mat-icon-button","",1,"-mr-4","ml-1",3,"matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"mt-4"],[1,"angor-mat-rounded","angor-mat-dense","w-full",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],[1,"flex-auto","overflow-y-auto"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-8","py-5",3,"ngClass","routerLink"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900",3,"ring-primary-50"],["class","h-full w-full rounded-full object-cover","alt","Contact picture",3,"src","error",4,"ngIf"],["class","flex h-full w-full items-center justify-center rounded-full bg-gray-200 text-lg uppercase text-gray-600 dark:bg-gray-700 dark:text-gray-200",4,"ngIf"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"],[1,"ml-auto","flex","flex-col","items-end","self-start","pl-2"],[1,"text-secondary","overflow-hidden","whitespace-nowrap","text-sm","leading-5"],[1,"text-hint","icon-size-5",3,"svgIcon"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900"],["alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"error","src"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(n,o){if(1&n){const r=e.RV6();e.j41(0,"div",3)(1,"mat-drawer-container",4)(2,"mat-drawer",5,0),e.mxI("openedChange",function(u){return e.eBV(r),e.DH7(o.drawerOpened,u)||(o.drawerOpened=u),e.Njj(u)}),e.DNE(4,fe,1,1,"chat-new-chat",6)(5,ve,1,1,"chat-profile",6),e.k0s(),e.j41(6,"mat-drawer-content",7),e.DNE(7,Ie,41,17,"div",8)(8,Se,4,1,"div",9)(9,Re,2,4,"div",10),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("hasBackdrop",!1),e.R7$(),e.Y8G("autoFocus",!1),e.R50("opened",o.drawerOpened),e.R7$(2),e.vxM("new-chat"===o.drawerComponent?4:-1),e.R7$(),e.vxM("profile"===o.drawerComponent?5:-1),e.R7$(2),e.vxM(o.chats&&o.chats.length>0?7:8),e.R7$(2),e.vxM(o.chats&&o.chats.length>0?9:-1))},dependencies:[C.vg,C.qe,C.$C,C.$l,ce,ue,m.Hl,m.iY,g.m_,g.An,w.Cn,w.kk,w.fb,w.Cp,p.RG,p.rl,p.JW,k.fS,k.fg,v.YU,_.Wk,_.n3,ee.g,v.MD,v.bT,te],encapsulation:2,changeDetection:0})}}return i})(),Ge=(()=>{class i{constructor(){}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat-empty-conversation"]],standalone:!0,features:[e.aNF],decls:5,vars:1,consts:[[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"mat-icon",2),e.j41(3,"div",3),e.EFF(4," Select a conversation or start a new chat "),e.k0s()()()),2&n&&(e.R7$(2),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))},dependencies:[g.m_,g.An],encapsulation:2,changeDetection:0})}}return i})();var P=c(7403),Ee=c(8865),E=c(5351),Me=c(2798),K=c(1626);let Te=(()=>{class i{constructor(t){this.http=t}getTopGifs(t,n){const r=(new K.Nl).append("key",n).append("q",t);return this.http.get("https://g.tenor.com/v1/search",{params:r})}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(K.Qq))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Ne(i,s){if(1&i){const t=e.RV6();e.j41(0,"div",8),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectGif(o))}),e.nrm(1,"img",9),e.k0s()}if(2&i){const t=s.$implicit;e.R7$(),e.Y8G("src",t,e.B4B)}}function Be(i,s){if(1&i&&(e.j41(0,"div",6),e.DNE(1,Ne,2,1,"div",7),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.gifsFound)}}let Ye=(()=>{class i{constructor(t,n,o,r){this.gifService=t,this.dialogRef=n,this._changeDetectorRef=o,this.data=r,this.gifSearch="",this.gifsFound=[]}searchGif(){this.gifSearch&&""!==this.gifSearch.trim()?this.data.apiKey?this.gifService.getTopGifs(this.gifSearch,this.data.apiKey).subscribe(t=>{this.gifsFound=t.results.map(n=>n.media[0].gif.url),this._changeDetectorRef.detectChanges()},t=>{console.error("Error fetching GIFs:",t)}):console.error("API key is missing."):console.error("Search term is empty.")}selectGif(t){this.dialogRef.close(t)}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(Te),e.rXU(E.CP),e.rXU(e.gRc),e.rXU(E.Vh))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["gif-dialog"]],standalone:!0,features:[e.aNF],decls:10,vars:3,consts:[["mat-dialog-content",""],["appearance","outline",1,"full-width"],["matInput","","placeholder","keyword...",3,"ngModelChange","keyup.enter","ngModel"],["mat-icon-button","","matSuffix","",1,"ml-2","mr-2",3,"click"],[3,"svgIcon"],["class","results-container mt-4 grid grid-cols-3 gap-4",4,"ngIf"],[1,"results-container","mt-4","grid","grid-cols-3","gap-4"],["class","gif-preview h-24 w-full cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"gif-preview","h-24","w-full","cursor-pointer",3,"click"],[1,"h-full","w-full","object-cover",3,"src"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),e.EFF(3,"Search GIF"),e.k0s(),e.j41(4,"input",2),e.mxI("ngModelChange",function(a){return e.DH7(o.gifSearch,a)||(o.gifSearch=a),a}),e.bIt("keyup.enter",function(){return o.searchGif()}),e.k0s(),e.j41(5,"button",3),e.bIt("click",function(){return o.searchGif()}),e.nrm(6,"mat-icon",4),e.k0s(),e.j41(7,"mat-hint"),e.EFF(8,'Enter a keyword like "funny" or "cat" and hit search!'),e.k0s()(),e.DNE(9,Be,2,1,"div",5),e.k0s()),2&n&&(e.R7$(4),e.R50("ngModel",o.gifSearch),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:magnifying-glass"),e.R7$(3),e.Y8G("ngIf",o.gifsFound.length>0))},dependencies:[C.vg,m.Hl,m.iY,g.m_,g.An,b.YN,b.me,b.BC,b.vS,p.nJ,p.rl,b.X1,v.MD,v.Sq,v.bT,Me.Ve,p.MV,p.yw,p.RG,k.fS,k.fg],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.results-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;overflow-x:hidden}.gif-preview[_ngcontent-%COMP%]{transition:transform .2s}.gif-preview[_ngcontent-%COMP%]:hover{transform:scale(1.1)}"],changeDetection:0})}}return i})();const Ae=i=>["/profile",i];function De(i,s){if(1&i&&e.nrm(0,"img",8),2&i){const t=e.XpG();e.Y8G("src",null==t.chat.contact?null:t.chat.contact.picture,e.B4B)("alt","Contact picture")}}function Xe(i,s){if(1&i&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI(" ",null==t.chat.contact?null:t.chat.contact.name.charAt(0)," ")}}let Pe=(()=>{class i{constructor(){}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat-contact-info"]],inputs:{chat:"chat",drawer:"drawer"},standalone:!0,features:[e.aNF],decls:16,vars:8,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-lg","font-medium"],[1,"overflow-y-auto"],[1,"mt-8","flex","flex-col","items-center"],[1,"h-40","w-40","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mt-4","text-lg","font-medium"],[3,"routerLink"],[1,"text-secondary","ml-4","mr-4","mt-0.5","text-md"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return o.drawer.close()}),e.nrm(3,"mat-icon",3),e.k0s(),e.j41(4,"div",4),e.EFF(5,"Contact info"),e.k0s()(),e.j41(6,"div",5)(7,"div",6)(8,"div",7),e.DNE(9,De,1,2,"img",8)(10,Xe,2,1,"div",9),e.k0s(),e.j41(11,"div",10)(12,"a",11),e.EFF(13),e.k0s()(),e.j41(14,"div",12),e.EFF(15),e.k0s()()()()),2&n&&(e.R7$(3),e.Y8G("svgIcon","heroicons_outline:x-mark"),e.R7$(6),e.vxM(null!=o.chat.contact&&o.chat.contact.picture?9:-1),e.R7$(),e.vxM(null!=o.chat.contact&&o.chat.contact.picture?-1:10),e.R7$(2),e.Y8G("routerLink",e.eq3(6,Ae,null==o.chat.contact?null:o.chat.contact.pubKey)),e.R7$(),e.SpI(" ",null==o.chat.contact?null:o.chat.contact.name," "),e.R7$(2),e.SpI(" ",null==o.chat.contact?null:o.chat.contact.about," "))},dependencies:[m.Hl,m.iY,g.m_,g.An,_.iI,_.Wk],encapsulation:2,changeDetection:0})}}return i})();var Ke=c(4977),Ue=c(881),Oe=c(345),Ve=c(2914);const Le=["messageInput"],Qe=()=>["./"],ze=i=>({active:i}),He=(i,s,t,n)=>({"items-end":i,"items-start":s,"mt-0.5":t,"mt-3":n}),We=(i,s)=>({"bg-gray-400 text-blue-50":i,"bg-gray-500 text-gray-50":s}),Ze=(i,s)=>({"-right-1 -mr-px mb-px text-gray-400":i,"-left-1 -ml-px mb-px -scale-x-1 text-gray-500":s}),Je=(i,s)=>({"mr-3":i,"ml-3":s});function qe(i,s){if(1&i&&e.nrm(0,"img",15),2&i){const t=e.XpG(2);e.Y8G("src",null==t.chat.contact?null:t.chat.contact.picture,e.B4B)}}function et(i,s){if(1&i&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",null==t.chat.contact?null:t.chat.contact.name.charAt(0)," ")}}function tt(i,s){1&i&&(e.nrm(0,"mat-icon",12),e.EFF(1," Mute notifications ")),2&i&&e.Y8G("svgIcon","heroicons_outline:speaker-x-mark")}function nt(i,s){1&i&&(e.nrm(0,"mat-icon",12),e.EFF(1," Unmute notifications ")),2&i&&e.Y8G("svgIcon","heroicons_outline:speaker-wave")}function it(i,s){if(1&i&&(e.j41(0,"div",31),e.nrm(1,"div",33),e.j41(2,"div",34),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.nrm(5,"div",33),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(3),e.SpI(" ",e.i5U(4,1,t.createdAt,"longDate")," ")}}function ot(i,s){1&i&&e.eu8(0)}function rt(i,s){if(1&i&&(e.j41(0,"div",37),e.DNE(1,ot,1,0,"ng-container",40),e.k0s()),2&i){const t=e.XpG(2).$implicit;e.XpG(2);const n=e.sdS(4);e.Y8G("ngClass",e.l_i(2,Ze,t.isMine,!t.isMine)),e.R7$(),e.Y8G("ngTemplateOutlet",n)}}function st(i,s){if(1&i&&(e.j41(0,"div",44),e.nrm(1,"iframe",45),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("src",t.safeWord,e.f$h)}}function at(i,s){if(1&i&&(e.j41(0,"div",44),e.nrm(1,"img",46),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("src",t.safeWord,e.B4B)}}function ct(i,s){if(1&i&&(e.j41(0,"div",44)(1,"video",47),e.nrm(2,"source",48),e.EFF(3," Your browser does not support the video tag. "),e.k0s()()),2&i){const t=e.XpG().$implicit;e.R7$(2),e.Y8G("src",t.safeWord,e.B4B)}}function lt(i,s){if(1&i&&(e.j41(0,"div",44)(1,"audio",49),e.nrm(2,"source",50),e.EFF(3," Your browser does not support the audio element. "),e.k0s()()),2&i){const t=e.XpG().$implicit;e.R7$(2),e.Y8G("src",t.safeWord,e.B4B)}}function dt(i,s){if(1&i&&(e.j41(0,"div",51)(1,"a",52),e.EFF(2),e.k0s()()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("href",t.word,e.B4B),e.R7$(),e.JRh(t.word)}}function ut(i,s){if(1&i&&(e.j41(0,"span",51),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.JRh(t)}}function ht(i,s){if(1&i&&(e.j41(0,"div",41),e.DNE(1,st,2,1,"div",42)(2,at,2,1,"div",42)(3,ct,4,1,"div",42)(4,lt,4,1,"div",42)(5,dt,3,2,"div",43)(6,ut,2,1,"span",43),e.k0s()),2&i){const t=s.$implicit;e.R7$(),e.Y8G("ngIf","youtube"===t.token),e.R7$(),e.Y8G("ngIf","image"===t.token),e.R7$(),e.Y8G("ngIf","video"===t.token),e.R7$(),e.Y8G("ngIf","audio"===t.token),e.R7$(),e.Y8G("ngIf","link"===t.token),e.R7$(),e.Y8G("ngIf",!t.token)}}function mt(i,s){if(1&i&&(e.j41(0,"div",39),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=e.XpG(2).$implicit;e.Y8G("ngClass",e.l_i(5,Je,t.isMine,!t.isMine)),e.R7$(),e.SpI(" ",e.i5U(2,2,t.createdAt,"HH:mm")," ")}}function pt(i,s){if(1&i&&(e.j41(0,"div")(1,"div",35)(2,"div",36),e.DNE(3,rt,2,5,"div",37)(4,ht,7,6,"div",38),e.k0s(),e.DNE(5,mt,3,8,"div",39),e.k0s()()),2&i){const t=e.XpG(),n=t.$implicit,o=t.$index,r=t.$count,a=e.XpG(2);e.R7$(),e.Y8G("ngClass",e.ziG(6,He,n.isMine,!n.isMine,o>0&&a.chat.messages[o-1].isMine===n.isMine,o>0&&a.chat.messages[o-1].isMine!==n.isMine)),e.R7$(),e.Y8G("ngClass",e.l_i(11,We,n.isMine,!n.isMine)),e.R7$(),e.vxM(o===r-1||a.chat.messages[o+1].isMine!==n.isMine?3:-1),e.R7$(),e.Y8G("ngForOf",a.parseContent.parseContent(n.value))("ngForTrackBy",a.trackByFn),e.R7$(),e.vxM(0===o||o===r-1||a.chat.messages[o+1].isMine!==n.isMine||a.chat.messages[o+1].createdAt!==n.createdAt?5:-1)}}function gt(i,s){if(1&i&&(e.DNE(0,it,6,4,"div",31),e.nI1(1,"date"),e.nI1(2,"date"),e.DNE(3,pt,6,14,"div",32)),2&i){const t=s.$implicit,n=s.$index,o=e.XpG(2);e.vxM(0===n||e.i5U(1,2,o.chat.messages[n-1].createdAt,"d")!==e.i5U(2,5,t.createdAt,"d")?0:-1),e.R7$(3),e.Y8G("ngIf",!t.id.includes("new-chat"))}}function ft(i,s){if(1&i){const t=e.RV6();e.j41(0,"div",53)(1,"emoji-mart",54),e.bIt("emojiClick",function(o){e.eBV(t);const r=e.XpG(2);return e.Njj(r.addEmoji(o))}),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(),e.Y8G("darkMode",t.darkMode)}}function vt(i,s){if(1&i){const t=e.RV6();e.j41(0,"mat-drawer-container",5)(1,"mat-drawer",7,1),e.mxI("openedChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.drawerOpened,o)||(r.drawerOpened=o),e.Njj(o)}),e.nrm(3,"chat-contact-info",8),e.k0s(),e.j41(4,"mat-drawer-content",9)(5,"div",10)(6,"a",11),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.resetChat())}),e.nrm(7,"mat-icon",12),e.k0s(),e.j41(8,"div",13),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openContactInfo())}),e.j41(9,"div",14),e.DNE(10,qe,1,1,"img",15)(11,et,2,1,"div",16),e.k0s(),e.j41(12,"div",17),e.EFF(13),e.k0s()(),e.j41(14,"button",18),e.nrm(15,"mat-icon",12),e.j41(16,"mat-menu",null,2)(18,"button",19),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openContactInfo())}),e.nrm(19,"mat-icon",12),e.EFF(20," Contact info "),e.k0s(),e.j41(21,"button",20),e.nrm(22,"mat-icon",12),e.EFF(23," Select messages "),e.k0s(),e.j41(24,"button",19),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.toggleMuteNotifications())}),e.DNE(25,tt,2,1)(26,nt,2,1),e.k0s(),e.j41(27,"button",20),e.nrm(28,"mat-icon",12),e.EFF(29," Clear messages "),e.k0s(),e.j41(30,"button",20),e.nrm(31,"mat-icon",12),e.EFF(32," Delete chat "),e.k0s()()()(),e.j41(33,"div",21)(34,"div",22),e.Z7z(35,gt,4,8,"div",null,e.BUC().trackByFn,!0),e.k0s()(),e.j41(37,"div",23)(38,"div",24)(39,"button",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openGifDialog())}),e.nrm(40,"mat-icon",12),e.k0s(),e.j41(41,"button",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.toggleEmojiPicker())}),e.nrm(42,"mat-icon",12),e.k0s(),e.DNE(43,ft,2,1,"div",26),e.j41(44,"button",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.toggleSpeechRecognition())}),e.nrm(45,"mat-icon",27),e.k0s()(),e.j41(46,"mat-form-field",28)(47,"textarea",29,3),e.bIt("keydown",function(o){e.eBV(t);const r=e.XpG();return e.Njj(r.handleKeyDown(o))}),e.k0s()(),e.j41(49,"div",30)(50,"button",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.sendMessage())}),e.nrm(51,"mat-icon",12),e.k0s()()()()()}if(2&i){const t=e.sdS(2),n=e.sdS(17),o=e.XpG();e.Y8G("hasBackdrop",!1),e.R7$(),e.Y8G("autoFocus",!1)("mode",o.drawerMode)("position","end"),e.R50("opened",o.drawerOpened),e.R7$(2),e.Y8G("drawer",t)("chat",o.chat),e.R7$(3),e.Y8G("routerLink",e.lJ4(26,Qe)),e.R7$(),e.Y8G("svgIcon","heroicons_outline:arrow-long-left"),e.R7$(3),e.vxM(null!=o.chat.contact&&o.chat.contact.picture?10:-1),e.R7$(),e.vxM(null!=o.chat.contact&&o.chat.contact.picture?-1:11),e.R7$(2),e.SpI(" ",null==o.chat.contact?null:o.chat.contact.name," "),e.R7$(),e.Y8G("matMenuTriggerFor",n),e.R7$(),e.Y8G("svgIcon","heroicons_outline:ellipsis-vertical"),e.R7$(4),e.Y8G("svgIcon","heroicons_outline:user-circle"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:check-circle"),e.R7$(3),e.vxM(o.chat.muted?-1:25),e.R7$(),e.vxM(o.chat.muted?26:-1),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:backspace"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:trash"),e.R7$(4),e.Dyx(o.chat.messages),e.R7$(5),e.Y8G("svgIcon","heroicons_outline:gif"),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:face-smile"),e.R7$(),e.Y8G("ngIf",o.showEmojiPicker),e.R7$(2),e.Y8G("ngClass",e.eq3(27,ze,o.isListening))("svgIcon",o.isListening?"heroicons_solid:microphone":"heroicons_outline:microphone"),e.R7$(6),e.Y8G("svgIcon","heroicons_outline:paper-airplane")}}function _t(i,s){1&i&&(e.j41(0,"div",6),e.nrm(1,"mat-icon",55),e.j41(2,"div",56),e.EFF(3," Select a conversation or start a new chat "),e.k0s()()),2&i&&(e.R7$(),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Ct(i,s){1&i&&(e.qSk(),e.j41(0,"svg",57)(1,"g",58),e.nrm(2,"path",59),e.k0s()())}const bt=[{path:"",component:O,resolve:{chats:()=>(0,e.WQX)(y).getChats(),contacts:()=>(0,e.WQX)(y).getContacts(),profile:()=>(0,e.WQX)(y).getProfile()},children:[{path:"",component:$e,children:[{path:"",pathMatch:"full",component:Ge},{path:":id",component:(()=>{class i{constructor(t,n,o,r,a,u,l,d){this._changeDetectorRef=t,this._chatService=n,this._angorMediaWatcherService=o,this._ngZone=r,this._angorConfigService=a,this.dialog=u,this.sanitizer=l,this.parseContent=d,this.drawerMode="side",this.drawerOpened=!1,this._unsubscribeAll=new j.B,this.showEmojiPicker=!1,this.darkMode=!1,this.finalTranscript="",this.isListening=!1,this.userEdited=!1;const h=window.SpeechRecognition||window.webkitSpeechRecognition;h?(this.recognition=new h,this.recognition.lang="en-US",this.recognition.continuous=!0,this.recognition.interimResults=!0,this.setupRecognitionEvents()):console.error("Speech recognition is not supported in this browser.")}openGifDialog(){this.dialog.open(Ye,{width:"600px",maxHeight:"80vh",data:{apiKey:"LIVDSRZULELA"}}).afterClosed().subscribe(n=>{if(n){const o=n;o&&(this.messageInput.nativeElement.value="",this._chatService.sendPrivateMessage(o).then(()=>{this.messageInput.nativeElement.value="",this.finalTranscript=""}).catch(r=>{console.error("Failed to send message:",r)}),this.finalTranscript="",this.userEdited=!1)}})}ngOnInit(){this._angorConfigService.config$.subscribe(t=>{"auto"===t.scheme?this.detectSystemTheme():this.darkMode="dark"===t.scheme}),this._chatService.chat$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(t=>{this.chat=t,this._changeDetectorRef.markForCheck()}),this._angorMediaWatcherService.onMediaChange$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(({matchingAliases:t})=>{this.drawerMode=t.includes("lg")?"side":"over",this._changeDetectorRef.markForCheck()})}_resizeMessageInput(){this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.messageInput.nativeElement.style.height="auto",this._changeDetectorRef.detectChanges(),this.messageInput.nativeElement.style.height=`${this.messageInput.nativeElement.scrollHeight}px`,this._changeDetectorRef.detectChanges()})})}setupRecognitionEvents(){this.recognition.onresult=t=>{let n="";for(let o=t.resultIndex;o<t.results.length;o++){const r=t.results[o][0].transcript;t.results[o].isFinal?this.finalTranscript+=r:n+=r}this.userEdited||(this.messageInput.nativeElement.value=this.finalTranscript+n)},this.recognition.onerror=t=>{console.error("Speech recognition error detected: ",t.error)},this.recognition.onend=()=>{this.isListening=!1}}toggleSpeechRecognition(){this.finalTranscript="",this.isListening?(this.recognition.stop(),this.isListening=!1):(this.recognition.start(),this.isListening=!0,this.userEdited=!1)}handleUserInput(t){this.userEdited=!0}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}openContactInfo(){this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}resetChat(){this._chatService.resetChat(),this.drawerOpened=!1,this._changeDetectorRef.markForCheck()}toggleMuteNotifications(){this.chat.muted=!this.chat.muted,this._chatService.updateChat(this.chat.id,this.chat).subscribe()}trackByFn(t,n){return n.id||t}detectSystemTheme(){const t=window.matchMedia("(prefers-color-scheme: dark)");this.darkMode=t.matches,t.addEventListener("change",n=>{this.darkMode=n.matches})}handleKeyDown(t){"Enter"===t.key&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}sendMessage(){const t=this.messageInput.nativeElement.value.trim();t&&(this.messageInput.nativeElement.value="",this._chatService.sendPrivateMessage(t).then(()=>{this.messageInput.nativeElement.value="",this.finalTranscript=""}).catch(n=>{console.error("Failed to send message:",n)}),this.finalTranscript="",this.userEdited=!1)}addEmoji(t){this.messageInput.nativeElement.value+=t.emoji.native,this.showEmojiPicker=!1}toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(e.gRc),e.rXU(y),e.rXU(Ke.l),e.rXU(e.SKi),e.rXU(Ue.P),e.rXU(E.bZ),e.rXU(Oe.up),e.rXU(Ve.m))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["chat-conversation"]],viewQuery:function(n,o){if(1&n&&e.GBs(Le,5),2&n){let r;e.mGM(r=e.lsd())&&(o.messageInput=r.first)}},hostBindings:function(n,o){1&n&&e.bIt("input",function(){return o._resizeMessageInput()})("ngModelChange",function(){return o._resizeMessageInput()})},standalone:!0,features:[e.aNF],decls:5,vars:1,consts:[["speechBubbleExtension",""],["drawer",""],["conversationHeaderMenu",""],["messageInput",""],[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-l","lg:shadow-none",3,"openedChange","autoFocus","mode","position","opened"],[3,"drawer","chat"],[1,"flex","flex-col","overflow-hidden"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent","md:px-6"],["mat-icon-button","",1,"md:-ml-2","lg:hidden",3,"click","routerLink"],[3,"svgIcon"],[1,"ml-2","mr-2","flex","cursor-pointer","items-center","lg:ml-0",3,"click"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","text-lg","font-medium","leading-5"],["mat-icon-button","",1,"ml-auto",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],[1,"flex","h-full","flex-col-reverse","overflow-y-auto"],[1,"bg-card","flex","flex-auto","shrink","flex-col","p-6","dark:bg-transparent"],[1,"flex","items-end","border-t","bg-gray-50","p-4","dark:bg-transparent"],[1,"my-px","flex","h-11","items-center"],["mat-icon-button","",3,"click"],["class","emoji-picker-container",4,"ngIf"],[3,"ngClass","svgIcon"],["subscriptSizing","dynamic",1,"angor-mat-dense","angor-mat-rounded","angor-mat-bold","ml-4","w-full"],["matInput","","cdkTextareaAutosize","",1,"max-h-20",3,"keydown"],[1,"my-px","ml-4","flex","h-11","items-center"],[1,"-mx-6","my-3","flex","items-center","justify-center"],[4,"ngIf"],[1,"flex-auto","border-b"],[1,"text-secondary","mx-4","flex-0","text-sm","font-medium","leading-5"],[1,"flex","flex-col",3,"ngClass"],[1,"relative","max-w-3/4","rounded-lg","px-2","py-2",3,"ngClass"],[1,"absolute","bottom-0","w-3",3,"ngClass"],["style","display: inline-block; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap;",4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-secondary","my-0.5","text-sm","font-medium",3,"ngClass"],[4,"ngTemplateOutlet"],[2,"display","inline-block","word-break","break-all","overflow-wrap","break-word","white-space","pre-wrap"],["style","display: block;",4,"ngIf"],["style","display: inline-block; word-break: break-all; overflow-wrap: break-word;",4,"ngIf"],[2,"display","block"],["width","560","height","315","frameborder","0","allowfullscreen","",3,"src"],["alt","Embedded Image",2,"max-width","100%",3,"src"],["controls","",2,"max-width","100%"],["type","video/mp4",3,"src"],["controls",""],["type","audio/mpeg",3,"src"],[2,"display","inline-block","word-break","break-all","overflow-wrap","break-word"],["target","_blank",3,"href"],[1,"emoji-picker-container"],[3,"emojiClick","darkMode"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"],["width","100%","height","100%","viewBox","0 0 66 66","xmlns","http://www.w3.org/2000/svg"],["id","Page-1","stroke","none","stroke-width","1","fill","none","fill-rule","evenodd"],["d","M1.01522827,0.516204834 C-8.83532715,54.3062744 61.7609863,70.5215302 64.8009949,64.3061218 C68.8074951,54.8859711 30.1663208,52.9997559 37.5036011,0.516204834 L1.01522827,0.516204834 Z","fill","currentColor","fill-rule","nonzero"]],template:function(n,o){1&n&&(e.j41(0,"div",4),e.DNE(1,vt,52,29,"mat-drawer-container",5)(2,_t,4,1,"div",6)(3,Ct,3,0,"ng-template",null,0,e.C5r),e.k0s()),2&n&&(e.R7$(),e.vxM(o.chat?1:2))},dependencies:[C.vg,C.qe,C.$C,C.$l,Pe,m.Hl,m.pQ,m.iY,_.Wk,g.m_,g.An,w.Cn,w.kk,w.fb,w.Cp,v.YU,v.T3,p.RG,p.rl,k.fS,k.fg,P.xb,P.EE,v.vh,Ee.Ic,v.MD,v.Sq,v.bT],styles:[".c-img,.c-video{max-width:100%;border-radius:10px}\n"],encapsulation:2,changeDetection:0})}}return i})(),resolve:{conversation:(i,s)=>{const t=(0,e.WQX)(y),n=(0,e.WQX)(_.Ix);let o=i.paramMap.get("id")||localStorage.getItem("currentChatId");if(!o){const r=s.url.split("/").slice(0,-1).join("/");return n.navigateByUrl(r),(0,S.$)("No chat ID provided")}return localStorage.setItem("currentChatId",o),t.getChatById(o).pipe((0,G.W)(r=>{console.error("Error fetching conversation:",r);const a=s.url.split("/").slice(0,-1).join("/");return n.navigateByUrl(a),(0,S.$)(r)}))}}}]}]}]}}]);