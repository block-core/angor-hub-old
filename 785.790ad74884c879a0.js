"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[785],{2773:(k,v,a)=>{a.d(v,{n:()=>w});var c=a(6146),h=a(3022),o=a(3107);const t=[[["","angorCardFront",""]],[["","angorCardBack",""]],"*",[["","angorCardExpansion",""]]],l=["[angorCardFront]","[angorCardBack]","*","[angorCardExpansion]"];function x(e,r){1&e&&(o.j41(0,"div",0),o.SdG(1),o.k0s(),o.j41(2,"div",1),o.SdG(3,1),o.k0s())}function b(e,r){1&e&&(o.j41(0,"div",2),o.SdG(1,3),o.k0s()),2&e&&o.Y8G("@expandCollapse",void 0)}function g(e,r){if(1&e&&(o.SdG(0,2),o.DNE(1,b,2,1,"div",2)),2&e){const i=o.XpG();o.R7$(),o.vxM(i.expanded?1:-1)}}let w=(()=>{class e{constructor(){this.expanded=!1,this.face="front",this.flippable=!1}get classList(){return{"angor-card-expanded":this.expanded,"angor-card-face-back":this.flippable&&"back"===this.face,"angor-card-face-front":this.flippable&&"front"===this.face,"angor-card-flippable":this.flippable}}ngOnChanges(i){"expanded"in i&&(this.expanded=(0,h.he)(i.expanded.currentValue)),"flippable"in i&&(this.flippable=(0,h.he)(i.flippable.currentValue))}static{this.\u0275fac=function(p){return new(p||e)}}static{this.\u0275cmp=o.VBU({type:e,selectors:[["angor-card"]],hostVars:2,hostBindings:function(p,y){2&p&&o.HbH(y.classList)},inputs:{expanded:"expanded",face:"face",flippable:"flippable"},exportAs:["angorCard"],features:[o.OA$],ngContentSelectors:l,decls:2,vars:2,consts:[[1,"angor-card-front"],[1,"angor-card-back"],[1,"angor-card-expansion"]],template:function(p,y){1&p&&(o.NAR(t),o.DNE(0,x,4,0)(1,g,2,1)),2&p&&(o.vxM(y.flippable?0:-1),o.R7$(),o.vxM(y.flippable?-1:1))},styles:["angor-card{position:relative;display:flex;overflow:hidden;--tw-bg-opacity: 1;background-color:rgba(var(--angor-bg-card-rgb),var(--tw-bg-opacity));border-radius:1rem;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable{border-radius:0;overflow:visible;transform-style:preserve-3d;transition:transform 1s;perspective:600px;background:transparent;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable.angor-card-face-back .angor-card-front{visibility:hidden;opacity:0;transform:rotateY(180deg)}angor-card.angor-card-flippable.angor-card-face-back .angor-card-back{visibility:visible;opacity:1;transform:rotateY(360deg)}angor-card.angor-card-flippable .angor-card-front,angor-card.angor-card-flippable .angor-card-back{display:flex;flex-direction:column;flex:1 1 auto;z-index:10;transition:transform .5s ease-out 0s,visibility 0s ease-in .2s,opacity 0s ease-in .2s;backface-visibility:hidden;--tw-bg-opacity: 1;background-color:rgba(var(--angor-bg-card-rgb),var(--tw-bg-opacity));border-radius:1rem;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}angor-card.angor-card-flippable .angor-card-front{position:relative;opacity:1;visibility:visible;transform:rotateY(0);overflow:hidden}angor-card.angor-card-flippable .angor-card-back{position:absolute;inset:0;opacity:0;visibility:hidden;transform:rotateY(180deg);overflow:hidden auto}\n"],encapsulation:2,data:{animation:c.F}})}}return e})()},8166:(k,v,a)=>{a.r(v),a.d(v,{default:()=>D});var c=a(3014),h=a(708),o=a(4460),t=a(3107),l=a(936),x=a(9471),b=a(6071),g=a(3904),w=a(6389),e=a(2675),r=a(8378),i=a(3125),p=a(8078),y=a(5821),F=a(5492),T=a(2773);function I(f,A){1&f&&(t.j41(0,"div",6)(1,"label",7),t.EFF(2,"Comment (Optional)"),t.k0s(),t.nrm(3,"textarea",17),t.k0s())}function U(f,A){if(1&f&&(t.j41(0,"div",18)(1,"h3",19),t.EFF(2,"Invoice Created:"),t.k0s(),t.j41(3,"p",20),t.EFF(4),t.k0s()()),2&f){const n=t.XpG();t.R7$(4),t.JRh(n.invoice.pr)}}function B(f,A){if(1&f&&(t.j41(0,"div",21)(1,"p",22),t.EFF(2),t.k0s()()),2&f){const n=t.XpG();t.R7$(2),t.JRh(n.error)}}const D=[{path:"",component:(()=>{class f{constructor(){this.formBuilder=(0,t.WQX)(l.ok),this.signerService=(0,t.WQX)(p.A),this.relayService=(0,t.WQX)(i.b),this.utilities=(0,t.WQX)(y.FP),this.payRequest=null,this.invoice={pr:""},this.canZap=!1,this.loading=!1,this.error=null}ngOnInit(){this.initializeForm()}initializeForm(){this.sendZapForm=this.formBuilder.group({lightningAddress:["",[l.k0.required,this.validateLightningAddress]],eventId:[""],amount:["",[l.k0.required,l.k0.min(1)]],comment:[""]})}validateLightningAddress(n){return n.value.includes("@")?null:{invalidFormat:!0}}getCallbackUrl(n){try{if(n.includes("@")){const[d,s]=n.split("@");return`https://${s}/.well-known/lnurlp/${d}`}return n.toLowerCase().startsWith("lnurl")?this.utilities.convertBech32ToText(n).toString():null}catch(d){return console.error("Error generating callback URL:",d),null}}fetchPayRequest(){var n=this;return(0,c.A)(function*(){n.resetState();const d=n.sendZapForm.get("lightningAddress")?.value;if(!d)return void n.setError("Lightning Address is required.");const s=n.getCallbackUrl(d);if(s)try{const u=yield fetch(s);if(!u.ok)throw new Error(`Failed to fetch pay request: ${u.statusText}`);const m=yield u.json();if("ERROR"===m.status)throw new Error(m.reason||"Error fetching the pay request.");n.payRequest=m,n.canZap=!0,n.configureAmountValidators()}catch(u){n.setError(u.message||"Error connecting to the server.")}finally{n.loading=!1}else n.setError("Invalid Lightning Address.")})()}configureAmountValidators(){if(!this.payRequest)return;const n=(this.payRequest.minSendable||1e3)/1e3,d=(this.payRequest.maxSendable||21e6)/1e3,s=this.sendZapForm.get("amount");s?.setValidators([l.k0.required,l.k0.min(n),l.k0.max(d)]),s?.updateValueAndValidity()}onSubmit(){var n=this;return(0,c.A)(function*(){if(n.sendZapForm.invalid)return void n.setError("Please fill out the form correctly.");n.resetState();const{eventId:s,amount:u,comment:m}=n.sendZapForm.value;if(n.payRequest)try{const E=new URL(n.payRequest.callback),C=new URLSearchParams({amount:(1e3*u).toString()});if(m&&n.payRequest.commentAllowed&&C.set("comment",m),s){const P=yield n.createAndSignZapRequest(s,m);C.set("nostr",JSON.stringify(P))}const R=yield fetch(`${E.origin}${E.pathname}?${C.toString()}`);if(!R.ok)throw new Error(`Failed to fetch invoice: ${R.statusText}`);const S=yield R.json();if("ERROR"===S.status)throw new Error(S.reason||"Error fetching the invoice.");n.invoice=S}catch(E){n.setError(E.message||"Error processing the zap request.")}finally{n.loading=!1}else n.setError("Pay request is not loaded.")})()}createAndSignZapRequest(n,d){var s=this;return(0,c.A)(function*(){try{const u=s.createZapRequestData(n,d),m=s.signerService.isUsingSecretKey()?(0,F.pC)(u,(0,r.aT)(yield s.signerService.getDecryptedSecretKey())):yield s.signerService.signEventWithExtension(u);if(!m)throw new Error("Signing failed. Signed event is null.");return m}catch(u){throw console.error("Error creating and signing zap request:",u),new Error("Failed to create and sign zap request.")}})()}createZapRequestData(n,d){return{kind:9734,content:d||"",tags:[["e",n],["p",this.payRequest?.nostrPubkey||""],["relays",...this.relayService.getConnectedRelays()]],pubkey:this.signerService.getPublicKey(),created_at:Math.floor(Date.now()/1e3)}}resetState(){this.error=null,this.loading=!0,this.invoice={pr:""}}setError(n){this.error=n,this.loading=!1}static{this.\u0275fac=function(d){return new(d||f)}}static{this.\u0275cmp=t.VBU({type:f,selectors:[["app-zap"]],decls:27,vars:6,consts:[[1,"mx-auto","w-full","max-w-5xl","p-6","sm:p-8"],[1,"flex","w-full","max-w-140","m-auto","flex-col","items-start"],[1,"mb-8","flex","flex-col","items-start","p-6","sm:p-8","transition-all","duration-300","w-full","pb-6"],[1,"flex","items-center","justify-center","mb-6","w-full"],[1,"text-2xl","font-semibold","text-center"],[1,"w-full","space-y-4",3,"ngSubmit","formGroup"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-600","mb-1"],[1,"flex","items-center"],["type","text","formControlName","lightningAddress","placeholder","username@domain.com",1,"flex-grow","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["type","button",1,"ml-2","px-4","py-2","text-sm","bg-gray-800","text-white","rounded","hover:bg-gray-700",3,"click"],["type","text","formControlName","eventId","placeholder","Event ID for specific zap",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["type","number","formControlName","amount","placeholder","Amount",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],["class","form-group",4,"ngIf"],["type","submit",1,"w-full","py-2","text-sm","font-semibold","bg-gray-800","text-white","rounded","hover:bg-gray-700","disabled:bg-gray-400",3,"disabled"],["class","invoice mt-6 p-4 border rounded-lg bg-gray-50 shadow w-full",4,"ngIf"],["class","error mt-6 p-4 border rounded-lg bg-red-50 shadow w-full",4,"ngIf"],["formControlName","comment","placeholder","Add a comment...","rows","3",1,"w-full","p-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-gray-500"],[1,"invoice","mt-6","p-4","border","rounded-lg","bg-gray-50","shadow","w-full"],[1,"text-lg","font-semibold","text-gray-800"],[1,"text-gray-700","break-words"],[1,"error","mt-6","p-4","border","rounded-lg","bg-red-50","shadow","w-full"],[1,"text-red-600","font-medium"]],template:function(d,s){1&d&&(t.j41(0,"div",0)(1,"div",1)(2,"angor-card",2)(3,"div",3)(4,"h2",4),t.EFF(5,"Send a Zap"),t.k0s()(),t.j41(6,"form",5),t.bIt("ngSubmit",function(){return s.onSubmit()}),t.j41(7,"div",6)(8,"label",7),t.EFF(9,"Lightning Address"),t.k0s(),t.j41(10,"div",8),t.nrm(11,"input",9),t.j41(12,"button",10),t.bIt("click",function(){return s.fetchPayRequest()}),t.EFF(13," Fetch "),t.k0s()()(),t.j41(14,"div",6)(15,"label",7),t.EFF(16,"Event ID (Optional)"),t.k0s(),t.nrm(17,"input",11),t.k0s(),t.j41(18,"div",6)(19,"label",7),t.EFF(20,"Amount (in Satoshis)"),t.k0s(),t.nrm(21,"input",12),t.k0s(),t.DNE(22,I,4,0,"div",13),t.j41(23,"button",14),t.EFF(24),t.k0s()(),t.DNE(25,U,5,1,"div",15)(26,B,3,1,"div",16),t.k0s()()()),2&d&&(t.R7$(6),t.Y8G("formGroup",s.sendZapForm),t.R7$(16),t.Y8G("ngIf",null==s.payRequest?null:s.payRequest.commentAllowed),t.R7$(),t.Y8G("disabled",s.sendZapForm.invalid||s.loading),t.R7$(),t.SpI(" ",s.loading?"Sending...":"Send Zap"," "),t.R7$(),t.Y8G("ngIf",s.invoice.pr),t.R7$(),t.Y8G("ngIf",s.error))},dependencies:[o.MD,o.bT,b.RG,w.fS,x.Hl,g.m_,e.Ve,h.EE,l.X1,l.qT,l.me,l.Q0,l.BC,l.cb,l.j4,l.JD,T.n],encapsulation:2})}}return f})()}]},5821:(k,v,a)=>{a.d(v,{FP:()=>b});var c=a(1998),h=a(3107),o=a(7859),t=a(6388);let b=(()=>{class g{constructor(e,r){this.snackBar=e,this.sanitizer=r,this.defaultBackground="url(/assets/gradient.jpg)"}unsubscribe(e){if(e)for(let r=0;r<e.length;r++)e[r].unsubscribe()}now(){return Math.floor(Date.now()/1e3)}reduceProfile(e){return{name:e.name,about:e.about,picture:e.picture,banner:e.banner,nip05:e.nip05,lud06:e.lud06,lud16:e.lud16,display_name:e.display_name,website:e.website}}getBannerBackgroundStyle(e){if(!e)return this.defaultBackground;if("string"==typeof e){const r=this.sanitizeImageUrl(e);return r?`url(${r})`:this.defaultBackground}return`url(${this.bypassStyle(e)})`}getProfileDisplayName(e){return e.display_name?e.display_name:e.name?e.name:e.npub}getProfileTitle(e){return e.name?`@${e.name}`:`@${e.npub}`}millisatoshisToSatoshis(e){return Math.floor(e/1e3)}getRelayUrls(e){let r=e;if(Array.isArray(r)){r={};for(let p=0;p<e.length;p++)r[e[p]]={}}return Object.keys(r)}getNostrIdentifier(e){try{const r=this.hexToArray(e);return this.convertToBech32(r,"npub")}catch{return e}}ensureHexIdentifier(e){return e.startsWith("npub")&&(e=this.arrayToHex(this.convertFromBech32(e))),e}getHexIdentifier(e){const r=this.hexToArray(e);return this.convertToBech32(r,"npub")}getShortenedIdentifier(e){const r=this.getNostrIdentifier(e);return`${r.substring(5,13)}:${r.substring(r.length-8)}`}convertToBech32(e,r){const i=c.I.toWords(e);return c.I.encode(r,i)}hexToArray(e){return new Uint8Array(e.match(/.{1,2}/g)?.map(r=>parseInt(r,16))||[])}arrayToHex(e){return Array.from(e).map(r=>r.toString(16).padStart(2,"0")).join("")}convertFromBech32(e){const r=c.I.decode(e);return c.I.fromWords(r.words)}convertFromBech32ToHex(e){const r=c.I.decode(e),i=c.I.fromWords(r.words);return this.arrayToHex(i)}convertBech32ToText(e){const r=c.I.decode(e,1e3),i=c.I.fromWords(r.words);return(new TextDecoder).decode(Uint8Array.from(i))}keyToHex(e){return Array.from(e).map(r=>r.toString(16).padStart(2,"0")).join("")}sanitizeLUD06(e){if(e&&!e.startsWith("http"))return this.bypassUrl(e)}sanitizeUrlAndBypass(e){const r=this.sanitizeUrl(e);return this.bypassUrl(r)}sanitizeUrlAndBypassFrame(e){const r=this.sanitizeUrl(e);return this.bypassFrameUrl(r)}sanitizeUrl(e,r){if(!e)return"";if(!e?.startsWith("http")){if(!r)return e.startsWith("/assets")?e:"";e="https://"+e}return e}sanitizeImageUrl(e){if(!(e=this.sanitizeUrl(e)))return;let r=e.toLowerCase();return r=r.split("?")[0],r.endsWith("jpg")||r.endsWith("jpeg")||r.endsWith("png")||r.endsWith("webp")||r.endsWith("gif")?e:void 0}bypassUrl(e){return this.sanitizer.bypassSecurityTrustUrl(e)}bypassStyle(e){return this.sanitizer.bypassSecurityTrustStyle(e)}bypassFrameUrl(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}static{this.\u0275fac=function(r){return new(r||g)(h.KVO(o.UG),h.KVO(t.up))}}static{this.\u0275prov=h.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()}}]);