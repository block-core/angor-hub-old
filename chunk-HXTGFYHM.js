import{a as se,b as me,c as de,d as pe}from"./chunk-LKKRLEHJ.js";import{a as ue,b as he,c as fe,d as ge}from"./chunk-TXXDQLF3.js";import{h as Ze}from"./chunk-3Q7ZV3LD.js";import{b as at}from"./chunk-ZSOMQRTJ.js";import{t as tt,u as it,v as nt}from"./chunk-PWH2GQNP.js";import{A as Ge,B as qe,D as Je,H as Xe,L as Ye,T as et,V as W,W as Q,q as Ke,t as le,y as H,z as K}from"./chunk-4AZPYN7Q.js";import"./chunk-7WK6GZSZ.js";import{$ as B,X as We,Z as A,_ as Qe,ba as k,ca as E}from"./chunk-MH4Z64LL.js";import{$a as h,Aa as D,Ab as Pe,Ba as o,Bb as v,Ca as I,D as Se,Db as te,Eb as ie,F as Ie,Fb as ne,Hb as y,Ib as je,Jb as Le,Kb as L,Mb as Oe,Ob as J,P as Ce,Pa as g,Q as C,Qb as X,Rb as Ne,Ua as s,W as ke,Wa as be,Wb as ae,Z as j,_ as V,_a as z,a as G,ab as $,ba as b,bb as U,cb as c,db as l,dc as oe,eb as m,gc as Ve,h as P,hb as Fe,ia as M,ib as q,ic as ze,j as we,ja as S,k as F,ka as Ee,l as N,lb as x,nb as u,oc as $e,q as Me,qa as Te,r as ee,t as xe,tb as Ae,tc as Ue,ub as Be,vb as Re,wc as re,xc as He,yb as R,yc as ce,za as De,zb as p}from"./chunk-LP5NDBXI.js";var ot=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["chat"]],standalone:!0,features:[y],decls:3,vars:0,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex","flex-auto","overflow-hidden"]],template:function(i,r){i&1&&(c(0,"div",0)(1,"div",1),m(2,"router-outlet"),l()())},dependencies:[re],encapsulation:2,changeDetection:0});let e=n;return e})();var ye=4;var w=(()=>{let n=class n{constructor(t,i,r,d,f,_){this._httpClient=t,this._metadataService=i,this._signerService=r,this._indexedDBService=d,this._relayService=f,this._sanitizer=_,this.chatList=[],this.latestMessageTimestamps={},this.messageQueue=[],this.isDecrypting=!1,this._chat=new N(null),this._chats=new N(null),this._contact=new N(null),this._contacts=new N(null),this._profile=new N(null),this._unsubscribeAll=new F}get chat$(){return this._chat.asObservable()}get chats$(){return this._chats.asObservable()}get contact$(){return this._contact.asObservable()}get contacts$(){return this._contacts.asObservable()}get profile$(){return this._profile.asObservable()}getContact(t){return P(this,null,function*(){try{let i=yield this._metadataService.fetchMetadataWithCache(t);if(i){let r={pubKey:t,displayName:i.name,picture:i.picture,about:i.about};this._contact.next(r),this._indexedDBService.getMetadataStream().pipe(C(this._unsubscribeAll)).subscribe(d=>{if(d&&d.pubkey===t){let f={pubKey:t,displayName:d.metadata.name,picture:d.metadata.picture,about:d.metadata.about};this._contact.next(f)}})}}catch(i){console.error("Error fetching contact metadata:",i)}})}getContacts(){return new we(t=>(this._indexedDBService.getAllUsers().then(i=>{i.length>0&&(this._contacts.next(i),t.next(i));let r=i.map(d=>d.pubKey);r.length>0&&this.subscribeToRealTimeContacts(r,t)}).catch(i=>{console.error("Error loading cached contacts from IndexedDB:",i),t.error(i)}),()=>{console.log("Unsubscribing from contacts updates.")}))}subscribeToRealTimeContacts(t,i){this._metadataService.fetchMetadataForMultipleKeys(t).then(r=>{let d=[...this._contacts.value||[]];r.forEach(f=>{let _=d.findIndex(Z=>Z.pubKey===f.pubkey),T={pubKey:f.pubkey,displayName:f.name,picture:f.picture,about:f.about};_!==-1?d[_]=G(G({},d[_]),T):d.push(T)}),this._contacts.next(d),i.next(d)}).catch(r=>{console.error("Error fetching metadata for contacts:",r),i.error(r)})}getProfile(){return P(this,null,function*(){try{let t=this._signerService.getPublicKey(),i=yield this._metadataService.fetchMetadataWithCache(t);i&&(this._profile.next(i),this._indexedDBService.getMetadataStream().pipe(C(this._unsubscribeAll)).subscribe(r=>{r&&r.pubkey===t&&this._profile.next(r.metadata)}))}catch(t){console.error("Error fetching profile metadata:",t)}})}getChatById(t){return this._httpClient.get("api/apps/chat/chat",{params:{id:t}}).pipe(xe(i=>(this._chat.next(i),i)),Ce(i=>i?Me(i):ee("Could not find chat with id "+t)))}getChats(){return P(this,null,function*(){let t=this._signerService.getPublicKey(),i=yield this._signerService.isUsingExtension(),r=yield this._signerService.getSecretKey("123");return this.subscribeToChatList(t,i,r),this.getChatListStream()})}subscribeToChatList(t,i,r){return this._relayService.ensureConnectedRelays().then(()=>{let d=[{kinds:[ye],authors:[t]},{kinds:[ye],"#p":[t]}];this._relayService.getPool().subscribeMany(this._relayService.getConnectedRelays(),d,{onevent:f=>P(this,null,function*(){let _=f.pubkey===t?f.tags.find(Z=>Z[0]==="p")?.[1]||"":f.pubkey;if(!_)return;let T=this.latestMessageTimestamps[_]||0;f.created_at>T&&(this.latestMessageTimestamps[_]=f.created_at,this.messageQueue.push(f),this.processNextMessage(t,i,r))}),oneose:()=>{console.log("Subscription closed"),this._chats.next(this.chatList)}})}),this.getChatListStream()}processNextMessage(t,i,r){return P(this,null,function*(){if(this.isDecrypting||this.messageQueue.length===0)return;this.isDecrypting=!0;let d=this.messageQueue.shift();if(!d){this.isDecrypting=!1;return}let _=d.pubkey===t?d.tags.find(T=>T[0]==="p")?.[1]||"":d.pubkey;if(!_){this.isDecrypting=!1;return}try{let T=yield this.decryptReceivedMessage(d,i,r,_);if(T){let Z=d.created_at*1e3;this.addOrUpdateChatList(_,T,Z)}}catch(T){console.error("Failed to decrypt message:",T)}finally{this.isDecrypting=!1,this.processNextMessage(t,i,r)}})}addOrUpdateChatList(t,i,r){let d=this.chatList.find(f=>f.contact?.pubKey===t);if(d)d.lastMessageAt&&new Date(d.lastMessageAt).getTime()<r&&(d.lastMessage=i,d.lastMessageAt=new Date(r).toISOString());else{let f={contact:{pubKey:t},lastMessage:i,lastMessageAt:new Date(r).toISOString()};this.chatList.push(f),this.fetchMetadataForPubKey(t)}this.chatList.sort((f,_)=>new Date(_.lastMessageAt).getTime()-new Date(f.lastMessageAt).getTime()),this._chats.next(this.chatList)}fetchMetadataForPubKey(t){this._metadataService.fetchMetadataWithCache(t).then(i=>{let r=this.chatList.find(d=>d.contact?.pubKey===t);r&&i&&(r.contact=G(G({},r.contact),i),this._chats.next(this.chatList))}).catch(i=>{console.error(`Failed to fetch metadata for pubKey: ${t}`,i)})}getChatListStream(){return this._chats.asObservable()}decryptReceivedMessage(t,i,r,d){return P(this,null,function*(){return"Decrypted message"})}updateChat(t,i){return this.chats$.pipe(Ie(1),Ce(r=>this._httpClient.patch("api/apps/chat/chat",{id:t,chat:i}).pipe(xe(d=>{if(r){let f=r.findIndex(_=>_.id===t);f!==-1&&(r[f]=d,this._chats.next(r))}return d}))))}resetChat(){this._chat.next(null)}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}};n.\u0275fac=function(i){return new(i||n)(j($e),j(nt),j(at),j(tt),j(it),j(Ue))},n.\u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function ht(e,n){if(e&1&&(c(0,"div",8),p(1),l()),e&2){let a,t=u().$implicit;o(),v(" ",(a=t==null||t.name==null?null:t.name.charAt(0))!==null&&a!==void 0?a:""," ")}}function ft(e,n){if(e&1&&m(0,"img",10),e&2){let a=u().$implicit;s("src",a.picture||"/images/avatars/avatar-placeholder.png",D)}}function gt(e,n){if(e&1&&(c(0,"div",11),p(1),l()),e&2){let a=u().$implicit;o(),v(" ",a.name.charAt(0)," ")}}function vt(e,n){if(e&1&&(g(0,ht,2,1,"div",8),c(1,"div",7)(2,"div",9),g(3,ft,1,1,"img",10)(4,gt,2,1,"div",11),l(),c(5,"div",12)(6,"div",13),p(7),l(),c(8,"div",14),p(9),l()()()),e&2){let a,t=n.$implicit,i=n.$index,r=u(2);h(i===0||((a=t==null||t.name==null?null:t.name.charAt(0))!==null&&a!==void 0?a:"")!==((a=r.contacts[i-1]==null||r.contacts[i-1].name==null?null:r.contacts[i-1].name.charAt(0))!==null&&a!==void 0?a:"")?0:-1),o(3),h(t.picture?3:-1),o(),h(t.picture?-1:4),o(3),v(" ",t.name," "),o(2),v(" ",t.about," ")}}function _t(e,n){if(e&1&&$(0,vt,10,5,"div",7,z().trackByFn,!0),e&2){let a=u();U(a.contacts)}}function xt(e,n){e&1&&(c(0,"div",6),p(1," There are no contacts! "),l())}var rt=(()=>{let n=class n{constructor(t){this._chatService=t,this.contacts=[],this._unsubscribeAll=new F}ngOnInit(){this._chatService.contacts$.pipe(C(this._unsubscribeAll)).subscribe(t=>{this.contacts=t})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}trackByFn(t,i){return i.id||t}};n.\u0275fac=function(i){return new(i||n)(I(w))},n.\u0275cmp=b({type:n,selectors:[["chat-new-chat"]],inputs:{drawer:"drawer"},standalone:!0,features:[y],decls:9,vars:2,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","overflow-hidden","dark:bg-default"],[1,"-mb-px","flex","h-18","flex-0","items-center","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"relative","overflow-y-auto"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","dark:hover:bg-hover","hover:bg-gray-100","md:px-8"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-100","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","overflow-hidden","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"]],template:function(i,r){i&1&&(c(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return r.drawer.close()}),m(3,"mat-icon",3),l(),c(4,"div",4),p(5,"New chat"),l()(),c(6,"div",5),g(7,_t,2,0)(8,xt,2,0,"div",6),l()()),i&2&&(o(3),s("svgIcon","heroicons_outline:arrow-long-left"),o(4),h(r.contacts.length?7:8))},dependencies:[B,A,E,k],encapsulation:2,changeDetection:0});let e=n;return e})();function Ct(e,n){if(e&1&&m(0,"img",10),e&2){let a=u();s("src",a.profile.picture||"/images/avatars/avatar-placeholder.png",D)("alt","Profile picture")}}function bt(e,n){if(e&1&&(c(0,"div",11),p(1),l()),e&2){let a=u();o(),v(" ",a.profile.name.charAt(0)," ")}}var st=(()=>{let n=class n{constructor(t){this._chatService=t,this._unsubscribeAll=new F}ngOnInit(){this._chatService.profile$.pipe(C(this._unsubscribeAll)).subscribe(t=>{this.profile=t})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}};n.\u0275fac=function(i){return new(i||n)(I(w))},n.\u0275cmp=b({type:n,selectors:[["chat-profile"]],inputs:{drawer:"drawer"},standalone:!0,features:[y],decls:35,vars:11,consts:[[1,"bg-card","flex","flex-auto","flex-col","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"px-6"],[1,"group","relative","mx-auto","mt-8","flex","h-40","w-40","flex-0","rounded-full"],[1,"absolute","inset-0","hidden","cursor-pointer","flex-col","items-center","justify-center","rounded-full","bg-gray-800","bg-opacity-80","backdrop-blur","backdrop-filter","group-hover:flex"],[1,"text-white",3,"svgIcon"],[1,"mx-6","mt-2","text-center","font-medium","text-white"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mx-2","mt-8","flex","flex-col"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"ngModel"],[1,"mt-4","flex","items-center","justify-end"],["mat-button","",3,"click"],["mat-flat-button","",1,"ml-2",3,"color"]],template:function(i,r){i&1&&(c(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return r.drawer.close()}),m(3,"mat-icon",3),l(),c(4,"div",4),p(5,"Profile"),l()(),c(6,"div",5)(7,"div",6)(8,"div",7),m(9,"mat-icon",8),c(10,"div",9),p(11," Change Profile Photo "),l()(),g(12,Ct,1,2,"img",10)(13,bt,2,1,"div",11),l(),c(14,"div",12)(15,"mat-form-field")(16,"mat-label"),p(17,"Name"),l(),m(18,"mat-icon",13)(19,"input",14),l(),c(20,"mat-form-field")(21,"mat-label"),p(22,"Username"),l(),m(23,"mat-icon",13)(24,"input",14),l(),c(25,"mat-form-field")(26,"mat-label"),p(27,"About"),l(),m(28,"mat-icon",13)(29,"input",14),l(),c(30,"div",15)(31,"button",16),x("click",function(){return r.drawer.close()}),p(32,"Cancel"),l(),c(33,"button",17),p(34," Save "),l()()()()()),i&2&&(o(3),s("svgIcon","heroicons_outline:arrow-long-left"),o(6),s("svgIcon","heroicons_outline:camera"),o(3),h(r.profile.picture?12:-1),o(),h(r.profile.picture?-1:13),o(5),s("svgIcon","heroicons_solid:user-circle"),o(),s("ngModel",r.profile.name),o(4),s("svgIcon","heroicons_solid:at-symbol"),o(),s("ngModel",r.profile.username),o(4),s("svgIcon","heroicons_solid:identification"),o(),s("ngModel",r.profile.about),o(4),s("color","primary"))},dependencies:[B,We,A,E,k,K,H,Ke,le,Q,W,et,Je,Xe,Ye],encapsulation:2,changeDetection:0});let e=n;return e})();var Mt=(e,n)=>({"dark:hover:bg-hover hover:bg-gray-100":e,"bg-primary-50 dark:bg-hover":n}),St=e=>[e],It=(e,n)=>({"absolute inset-0 z-20 flex lg:static lg:inset-auto":e,"hidden lg:flex":n});function kt(e,n){if(e&1&&m(0,"chat-new-chat",6),e&2){u();let a=R(3);s("drawer",a)}}function Et(e,n){if(e&1&&m(0,"chat-profile",6),e&2){u();let a=R(3);s("drawer",a)}}function Tt(e,n){if(e&1&&m(0,"img",15),e&2){let a=u(2);s("src",a.profile.picture||"/images/avatars/avatar-placeholder.png",D)}}function Dt(e,n){if(e&1&&(c(0,"div",16),p(1),l()),e&2){let a=u(2);o(),v(" ",a.profile.name?a.profile.name.charAt(0):""," ")}}function Ft(e,n){if(e&1&&m(0,"div",38),e&2){let a=u().$implicit,t=u(3);be("ring-primary-50",t.selectedChat&&t.selectedChat.id===a.id)}}function At(e,n){if(e&1&&m(0,"img",31),e&2){let a=u().$implicit;s("src",a.contact||"/images/avatars/avatar-placeholder.png",D)}}function Bt(e,n){if(e&1&&(c(0,"div",16),p(1),l()),e&2){let a=u().$implicit;o(),v(" ",!(a==null||a.contact==null)&&a.contact.name?a.contact.name.charAt(0):""," ")}}function Rt(e,n){e&1&&m(0,"mat-icon",37),e&2&&s("svgIcon","heroicons_solid:speaker-x-mark")}function Pt(e,n){if(e&1&&(c(0,"a",28)(1,"div",29),g(2,Ft,1,2,"div",30)(3,At,1,1,"img",31)(4,Bt,2,1,"div",16),l(),c(5,"div",32)(6,"div",33),p(7),l(),c(8,"div",34),p(9),l()(),c(10,"div",35)(11,"div",36),p(12),l(),g(13,Rt,1,1,"mat-icon",37),l()()),e&2){let a=n.$implicit,t=u(3);s("ngClass",L(13,Mt,!t.selectedChat||t.selectedChat.id!==a.id,t.selectedChat&&t.selectedChat.id===a.id))("routerLink",Le(16,St,a.id)),o(2),h(a.unreadCount>0?2:-1),o(),h(a.contact.picture?3:-1),o(),h(a.contact.picture?-1:4),o(3),v(" ",a.contact.name," "),o(),be("text-primary",a.unreadCount>0)("dark:text-primary-500",a.unreadCount>0),o(),v(" ",a.lastMessage," "),o(3),v(" ",a.lastMessageAt," "),o(),h(a.muted?13:-1)}}function jt(e,n){if(e&1&&$(0,Pt,14,18,"a",28,z().trackByFn,!0),e&2){let a=u(2);U(a.filteredChats)}}function Lt(e,n){e&1&&(c(0,"div",9),m(1,"mat-icon",39),c(2,"div",40),p(3," No chats "),l()()),e&2&&(o(),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Ot(e,n){if(e&1){let a=q();c(0,"div",8)(1,"div",11)(2,"div",12)(3,"div",13),x("click",function(){M(a);let i=u();return S(i.openProfile())}),c(4,"div",14),g(5,Tt,1,1,"img",15)(6,Dt,2,1,"div",16),l(),c(7,"div",17),p(8),l()(),c(9,"button",18),x("click",function(){M(a);let i=u();return S(i.openNewChat())}),m(10,"mat-icon",19),l(),c(11,"button",20),m(12,"mat-icon",19),c(13,"mat-menu",null,1)(15,"button",21),m(16,"mat-icon",19),p(17," New group "),l(),c(18,"button",21),m(19,"mat-icon",19),p(20," Create a room "),l(),c(21,"button",22),x("click",function(){M(a);let i=u();return S(i.openProfile())}),m(22,"mat-icon",19),p(23," Profile "),l(),c(24,"button",21),m(25,"mat-icon",19),p(26," Archived "),l(),c(27,"button",21),m(28,"mat-icon",19),p(29," Starred "),l(),c(30,"button",21),m(31,"mat-icon",19),p(32," Settings "),l()()()(),c(33,"div",23)(34,"mat-form-field",24),m(35,"mat-icon",25),c(36,"input",26,2),x("input",function(){M(a);let i=R(37),r=u();return S(r.filterChats(i.value))}),l()()()(),c(38,"div",27),g(39,jt,2,0)(40,Lt,4,1,"div",9),l()()}if(e&2){let a=R(14),t=u();o(5),h(t.profile.picture?5:-1),o(),h(t.profile.picture?-1:6),o(2),v(" ",t.profile.name," "),o(2),s("svgIcon","heroicons_outline:plus-circle"),o(),s("matMenuTriggerFor",a),o(),s("svgIcon","heroicons_outline:ellipsis-vertical"),o(4),s("svgIcon","heroicons_outline:user-group"),o(3),s("svgIcon","heroicons_outline:chat-bubble-left-right"),o(3),s("svgIcon","heroicons_outline:user-circle"),o(3),s("svgIcon","heroicons_outline:archive-box"),o(3),s("svgIcon","heroicons_outline:star"),o(3),s("svgIcon","heroicons_outline:cog-8-tooth"),o(3),s("subscriptSizing","dynamic"),o(),s("svgIcon","heroicons_solid:magnifying-glass"),o(),s("autocomplete","off")("placeholder","Search or start new chat"),o(3),h(t.filteredChats.length>0?39:40)}}function Nt(e,n){e&1&&(c(0,"div",9),m(1,"mat-icon",39),c(2,"div",40),p(3," No chats "),l()()),e&2&&(o(),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function Vt(e,n){if(e&1&&(c(0,"div",10),m(1,"router-outlet"),l()),e&2){let a=u();s("ngClass",L(1,It,a.selectedChat&&a.selectedChat.id,!a.selectedChat||!a.selectedChat.id))}}var mt=(()=>{let n=class n{constructor(t,i){this._chatService=t,this._changeDetectorRef=i,this.drawerOpened=!1,this._unsubscribeAll=new F}ngOnInit(){this._chatService.chats$.pipe(C(this._unsubscribeAll)).subscribe(t=>{this.chats=this.filteredChats=t,this._changeDetectorRef.markForCheck()}),this._chatService.profile$.pipe(C(this._unsubscribeAll)).subscribe(t=>{this.profile=t,this._changeDetectorRef.markForCheck()}),this._chatService.chat$.pipe(C(this._unsubscribeAll)).subscribe(t=>{this.selectedChat=t,this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete(),this._chatService.resetChat()}filterChats(t){if(!t){this.filteredChats=this.chats;return}this.filteredChats=this.chats.filter(i=>i.contact.name.toLowerCase().includes(t.toLowerCase()))}openNewChat(){this.drawerComponent="new-chat",this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}openProfile(){this.drawerComponent="profile",this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}trackByFn(t,i){return i.id||t}};n.\u0275fac=function(i){return new(i||n)(I(w),I(ae))},n.\u0275cmp=b({type:n,selectors:[["chat-chats"]],standalone:!0,features:[y],decls:10,vars:7,consts:[["drawer",""],["chatsHeaderMenu",""],["searchField",""],[1,"bg-card","relative","flex","w-full","flex-auto","dark:bg-transparent"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-r","lg:shadow-none",3,"openedChange","autoFocus","opened"],[3,"drawer"],[1,"flex","overflow-hidden"],[1,"bg-card","relative","flex","w-full","min-w-0","flex-auto","flex-col","dark:bg-transparent","lg:min-w-100","lg:max-w-100"],[1,"flex","h-full","flex-auto","flex-col","items-center","justify-center"],[1,"flex-auto","border-l",3,"ngClass"],[1,"flex","flex-0","flex-col","border-b","bg-gray-50","px-8","py-4","dark:bg-transparent"],[1,"flex","items-center"],[1,"mr-1","flex","cursor-pointer","items-center",3,"click"],[1,"h-10","w-10"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Profile picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","font-medium"],["mat-icon-button","",1,"ml-auto",3,"click"],[3,"svgIcon"],["mat-icon-button","",1,"-mr-4","ml-1",3,"matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"mt-4"],[1,"angor-mat-rounded","angor-mat-dense","w-full",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],[1,"flex-auto","overflow-y-auto"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-8","py-5",3,"ngClass","routerLink"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900",3,"ring-primary-50"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"],[1,"ml-auto","flex","flex-col","items-end","self-start","pl-2"],[1,"text-secondary","text-sm","leading-5"],[1,"text-hint","icon-size-5",3,"svgIcon"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(i,r){if(i&1){let d=q();c(0,"div",3)(1,"mat-drawer-container",4)(2,"mat-drawer",5,0),ne("openedChange",function(_){return M(d),ie(r.drawerOpened,_)||(r.drawerOpened=_),S(_)}),g(4,kt,1,1,"chat-new-chat",6)(5,Et,1,1,"chat-profile",6),l(),c(6,"mat-drawer-content",7),g(7,Ot,41,17,"div",8)(8,Nt,4,1,"div",9)(9,Vt,2,4,"div",10),l()()()}i&2&&(o(),s("hasBackdrop",!1),o(),s("autoFocus",!1),te("opened",r.drawerOpened),o(2),h(r.drawerComponent==="new-chat"?4:-1),o(),h(r.drawerComponent==="profile"?5:-1),o(2),h(r.chats&&r.chats.length>0?7:8),o(2),h(r.chats&&r.chats.length>0?9:-1))},dependencies:[ge,he,fe,ue,rt,st,B,A,E,k,pe,me,se,de,K,H,le,Q,W,oe,ce,re],encapsulation:2,changeDetection:0});let e=n;return e})();function zt(e,n){if(e&1&&m(0,"img",8),e&2){let a=u();s("src",a.chat.contact.picture||"/images/avatars/avatar-placeholder.png",D)("alt","Contact picture")}}function $t(e,n){if(e&1&&(c(0,"div",9),p(1),l()),e&2){let a=u();o(),v(" ",!(a.chat==null||a.chat.contact==null)&&a.chat.contact.name?a.chat.contact.name.charAt(0):""," ")}}var dt=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["chat-contact-info"]],inputs:{chat:"chat",drawer:"drawer"},standalone:!0,features:[y],decls:15,vars:5,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-lg","font-medium"],[1,"overflow-y-auto"],[1,"mt-8","flex","flex-col","items-center"],[1,"h-40","w-40","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mt-4","text-lg","font-medium"],[1,"text-secondary","mt-0.5","text-md"]],template:function(i,r){i&1&&(c(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return r.drawer.close()}),m(3,"mat-icon",3),l(),c(4,"div",4),p(5,"Contact info"),l()(),c(6,"div",5)(7,"div",6)(8,"div",7),g(9,zt,1,2,"img",8)(10,$t,2,1,"div",9),l(),c(11,"div",10),p(12),l(),c(13,"div",11),p(14),l()()()()),i&2&&(o(3),s("svgIcon","heroicons_outline:x-mark"),o(6),h(r.chat.contact.picture?9:-1),o(),h(r.chat.contact.picture?-1:10),o(2),Pe(r.chat.contact.name),o(2),v(" ",r.chat.contact.about," "))},dependencies:[B,A,E,k],encapsulation:2,changeDetection:0});let e=n;return e})();var Ut=["messageInput"],Ht=()=>["./"],Kt=(e,n,a,t)=>({"items-end":e,"items-start":n,"mt-0.5":a,"mt-3":t}),Wt=(e,n)=>({"bg-blue-500 text-blue-50":e,"bg-gray-500 text-gray-50":n}),Qt=(e,n)=>({"-right-1 -mr-px mb-px text-blue-500":e,"-left-1 -ml-px mb-px -scale-x-1 text-gray-500":n}),Zt=(e,n)=>({"mr-3":e,"ml-3":n});function Gt(e,n){if(e&1&&m(0,"img",15),e&2){let a=u(2);s("src",a.chat.contact.picture||"/images/avatars/avatar-placeholder.png",D)}}function qt(e,n){if(e&1&&(c(0,"div",16),p(1),l()),e&2){let a,t=u(2);o(),v(" ",(a=t.chat==null||t.chat.contact==null||t.chat.contact.name==null?null:t.chat.contact.name.charAt(0))!==null&&a!==void 0?a:""," ")}}function Jt(e,n){e&1&&(m(0,"mat-icon",12),p(1," Mute notifications ")),e&2&&s("svgIcon","heroicons_outline:speaker-x-mark")}function Xt(e,n){e&1&&(m(0,"mat-icon",12),p(1," Unmute notifications ")),e&2&&s("svgIcon","heroicons_outline:speaker-wave")}function Yt(e,n){if(e&1&&(c(0,"div",31),m(1,"div",36),c(2,"div",37),p(3),J(4,"date"),l(),m(5,"div",36),l()),e&2){let a=u().$implicit;o(3),v(" ",X(4,1,a.createdAt,"longDate")," ")}}function ei(e,n){e&1&&Fe(0)}function ti(e,n){if(e&1&&(c(0,"div",33),g(1,ei,1,0,"ng-container",38),l()),e&2){let a=u().$implicit;u(2);let t=R(4);s("ngClass",L(2,Qt,a.isMine,!a.isMine)),o(),s("ngTemplateOutlet",t)}}function ii(e,n){if(e&1&&(c(0,"div",35),p(1),J(2,"date"),l()),e&2){let a=u().$implicit;s("ngClass",L(5,Zt,a.isMine,!a.isMine)),o(),v(" ",X(2,2,a.createdAt,"HH:mm")," ")}}function ni(e,n){if(e&1&&(g(0,Yt,6,4,"div",31),J(1,"date"),J(2,"date"),c(3,"div",23)(4,"div",32),g(5,ti,2,5,"div",33),m(6,"div",34),l(),g(7,ii,3,8,"div",35),l()),e&2){let a=n.$implicit,t=n.$index,i=n.$count,r=u(2);h(t===0||X(1,6,r.chat.messages[t-1].createdAt,"d")!==X(2,9,a.createdAt,"d")?0:-1),o(3),s("ngClass",Oe(12,Kt,a.isMine,!a.isMine,t>0&&r.chat.messages[t-1].isMine===a.isMine,t>0&&r.chat.messages[t-1].isMine!==a.isMine)),o(),s("ngClass",L(17,Wt,a.isMine,!a.isMine)),o(),h(t===i-1||r.chat.messages[t+1].isMine!==a.isMine?5:-1),o(),s("innerHTML",a.value,De),o(),h(t===0||t===i-1||r.chat.messages[t+1].isMine!==a.isMine||r.chat.messages[t+1].createdAt!==a.createdAt?7:-1)}}function ai(e,n){if(e&1){let a=q();c(0,"mat-drawer-container",5)(1,"mat-drawer",7,1),ne("openedChange",function(i){M(a);let r=u();return ie(r.drawerOpened,i)||(r.drawerOpened=i),S(i)}),m(3,"chat-contact-info",8),l(),c(4,"mat-drawer-content",9)(5,"div",10)(6,"a",11),x("click",function(){M(a);let i=u();return S(i.resetChat())}),m(7,"mat-icon",12),l(),c(8,"div",13),x("click",function(){M(a);let i=u();return S(i.openContactInfo())}),c(9,"div",14),g(10,Gt,1,1,"img",15)(11,qt,2,1,"div",16),l(),c(12,"div",17),p(13),l()(),c(14,"button",18),m(15,"mat-icon",12),c(16,"mat-menu",null,2)(18,"button",19),x("click",function(){M(a);let i=u();return S(i.openContactInfo())}),m(19,"mat-icon",12),p(20," Contact info "),l(),c(21,"button",20),m(22,"mat-icon",12),p(23," Select messages "),l(),c(24,"button",19),x("click",function(){M(a);let i=u();return S(i.toggleMuteNotifications())}),g(25,Jt,2,1)(26,Xt,2,1),l(),c(27,"button",20),m(28,"mat-icon",12),p(29," Clear messages "),l(),c(30,"button",20),m(31,"mat-icon",12),p(32," Delete chat "),l()()()(),c(33,"div",21)(34,"div",22),$(35,ni,8,20,"div",23,z().trackByFn,!0),l()(),c(37,"div",24)(38,"div",25)(39,"button",26),m(40,"mat-icon",12),l(),c(41,"button",27),m(42,"mat-icon",12),l()(),c(43,"mat-form-field",28),m(44,"textarea",29,3),l(),c(46,"div",30)(47,"button",26),m(48,"mat-icon",12),l()()()()()}if(e&2){let a=R(2),t=R(17),i=u();s("hasBackdrop",!1),o(),s("autoFocus",!1)("mode",i.drawerMode)("position","end"),te("opened",i.drawerOpened),o(2),s("drawer",a)("chat",i.chat),o(3),s("routerLink",je(23,Ht)),o(),s("svgIcon","heroicons_outline:arrow-long-left"),o(3),h(i.chat.contact.picture?10:-1),o(),h(i.chat.contact.picture?-1:11),o(2),v(" ",i.chat.contact.name," "),o(),s("matMenuTriggerFor",t),o(),s("svgIcon","heroicons_outline:ellipsis-vertical"),o(4),s("svgIcon","heroicons_outline:user-circle"),o(3),s("svgIcon","heroicons_outline:check-circle"),o(3),h(i.chat.muted?-1:25),o(),h(i.chat.muted?26:-1),o(2),s("svgIcon","heroicons_outline:backspace"),o(3),s("svgIcon","heroicons_outline:trash"),o(4),U(i.chat.messages),o(5),s("svgIcon","heroicons_outline:face-smile"),o(2),s("svgIcon","heroicons_outline:paper-clip"),o(6),s("svgIcon","heroicons_outline:paper-airplane")}}function oi(e,n){e&1&&(c(0,"div",6),m(1,"mat-icon",39),c(2,"div",40),p(3," Select a conversation or start a new chat "),l()()),e&2&&(o(),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function ri(e,n){e&1&&(Ee(),c(0,"svg",41)(1,"g",42),m(2,"path",43),l()())}var pt=(()=>{let n=class n{constructor(t,i,r,d){this._changeDetectorRef=t,this._chatService=i,this._angorMediaWatcherService=r,this._ngZone=d,this.drawerMode="side",this.drawerOpened=!1,this._unsubscribeAll=new F}_resizeMessageInput(){this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.messageInput.nativeElement.style.height="auto",this._changeDetectorRef.detectChanges(),this.messageInput.nativeElement.style.height=`${this.messageInput.nativeElement.scrollHeight}px`,this._changeDetectorRef.detectChanges()})})}ngOnInit(){this._chatService.chat$.pipe(C(this._unsubscribeAll)).subscribe(t=>{this.chat=t,this._changeDetectorRef.markForCheck()}),this._angorMediaWatcherService.onMediaChange$.pipe(C(this._unsubscribeAll)).subscribe(({matchingAliases:t})=>{t.includes("lg")?this.drawerMode="side":this.drawerMode="over",this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}openContactInfo(){this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}resetChat(){this._chatService.resetChat(),this.drawerOpened=!1,this._changeDetectorRef.markForCheck()}toggleMuteNotifications(){this.chat.muted=!this.chat.muted,this._chatService.updateChat(this.chat.id,this.chat).subscribe()}trackByFn(t,i){return i.id||t}};n.\u0275fac=function(i){return new(i||n)(I(ae),I(w),I(Ze),I(Te))},n.\u0275cmp=b({type:n,selectors:[["chat-conversation"]],viewQuery:function(i,r){if(i&1&&Ae(Ut,5),i&2){let d;Be(d=Re())&&(r.messageInput=d.first)}},hostBindings:function(i,r){i&1&&x("input",function(){return r._resizeMessageInput()})("ngModelChange",function(){return r._resizeMessageInput()})},standalone:!0,features:[y],decls:5,vars:1,consts:[["speechBubbleExtension",""],["drawer",""],["conversationHeaderMenu",""],["messageInput",""],[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-l","lg:shadow-none",3,"openedChange","autoFocus","mode","position","opened"],[3,"drawer","chat"],[1,"flex","flex-col","overflow-hidden"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent","md:px-6"],["mat-icon-button","",1,"md:-ml-2","lg:hidden",3,"click","routerLink"],[3,"svgIcon"],[1,"ml-2","mr-2","flex","cursor-pointer","items-center","lg:ml-0",3,"click"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","text-lg","font-medium","leading-5"],["mat-icon-button","",1,"ml-auto",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],[1,"flex","flex-col-reverse","overflow-y-auto"],[1,"bg-card","flex","flex-auto","shrink","flex-col","p-6","dark:bg-transparent"],[1,"flex","flex-col",3,"ngClass"],[1,"flex","items-end","border-t","bg-gray-50","p-4","dark:bg-transparent"],[1,"my-px","flex","h-11","items-center"],["mat-icon-button",""],["mat-icon-button","",1,"ml-0.5"],["subscriptSizing","dynamic",1,"angor-mat-dense","angor-mat-rounded","angor-mat-bold","ml-4","w-full"],["matInput","","cdkTextareaAutosize",""],[1,"my-px","ml-4","flex","h-11","items-center"],[1,"-mx-6","my-3","flex","items-center","justify-center"],[1,"relative","max-w-3/4","rounded-lg","px-3","py-2",3,"ngClass"],[1,"absolute","bottom-0","w-3",3,"ngClass"],[1,"min-w-4","leading-5",3,"innerHTML"],[1,"text-secondary","my-0.5","text-sm","font-medium",3,"ngClass"],[1,"flex-auto","border-b"],[1,"text-secondary","mx-4","flex-0","text-sm","font-medium","leading-5"],[4,"ngTemplateOutlet"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"],["width","100%","height","100%","viewBox","0 0 66 66","xmlns","http://www.w3.org/2000/svg"],["id","Page-1","stroke","none","stroke-width","1","fill","none","fill-rule","evenodd"],["d","M1.01522827,0.516204834 C-8.83532715,54.3062744 61.7609863,70.5215302 64.8009949,64.3061218 C68.8074951,54.8859711 30.1663208,52.9997559 37.5036011,0.516204834 L1.01522827,0.516204834 Z","fill","currentColor","fill-rule","nonzero"]],template:function(i,r){i&1&&(c(0,"div",4),g(1,ai,49,24,"mat-drawer-container",5)(2,oi,4,1,"div",6)(3,ri,3,0,"ng-template",null,0,Ne),l()),i&2&&(o(),h(r.chat?1:2))},dependencies:[ge,he,fe,ue,dt,B,Qe,A,ce,E,k,pe,me,se,de,oe,Ve,K,H,Q,W,Ge,qe,ze],encapsulation:2,changeDetection:0});let e=n;return e})();var ut=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["chat-empty-conversation"]],standalone:!0,features:[y],decls:5,vars:1,consts:[[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(i,r){i&1&&(c(0,"div",0)(1,"div",1),m(2,"mat-icon",2),c(3,"div",3),p(4," Select a conversation or start a new chat "),l()()()),i&2&&(o(2),s("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))},dependencies:[E,k],encapsulation:2,changeDetection:0});let e=n;return e})();var ci=(e,n)=>{let a=V(w),t=V(He);return a.getChatById(e.paramMap.get("id")).pipe(Se(i=>{console.error(i);let r=n.url.split("/").slice(0,-1).join("/");return t.navigateByUrl(r),ee(i)}))},xn=[{path:"",component:ot,resolve:{chats:()=>V(w).getChats(),contacts:()=>V(w).getContacts(),profile:()=>V(w).getProfile()},children:[{path:"",component:mt,children:[{path:"",pathMatch:"full",component:ut},{path:":id",component:pt,resolve:{conversation:ci}}]}]}];export{xn as default};
