"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[183],{6183:(wt,Y,c)=>{c.r(Y),c.d(Y,{default:()=>yt});var e=c(4438),C=c(5245);let V=(()=>{class o{constructor(){}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat"]],standalone:!0,features:[e.aNF],decls:3,vars:0,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex","flex-auto","overflow-hidden"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"router-outlet"),e.k0s()())},dependencies:[C.n3],encapsulation:2,changeDetection:0})}}return o})();var m=c(467),j=c(4412),F=c(1413),Q=c(1985),$=c(8810),A=c(6648),L=c(7673),P=c(5964),D=c(6697),T=c(5558),X=c(6354),B=c(9437),z=c(719),G=c(8418),H=c(6324),K=c(7291),W=c(6231),Z=c(152),J=c(2498),x=c(6977),q=c(5645);let ee=(()=>{class o{constructor(t,n){this.subscriptionService=t,this.storageService=n,this.BATCH_SIZE=50,this.PROCESS_INTERVAL=3e3,this.MAX_RETRY_ATTEMPTS=3,this.publicKeyQueue=new Set,this.processingSubject=new F.B,this._unsubscribeAll=new F.B,this.processingStatus=new j.t([]),this.processingStatus$=this.processingStatus.asObservable(),this.initializeService()}initializeService(){var t=this;return(0,m.A)(function*(){try{yield t.loadStoredPublicKeys(),t.setupQueueProcessor()}catch(n){console.error("Failed to initialize metadata service:",n)}})()}setupQueueProcessor(){this.processingSubject.pipe((0,Z.B)(this.PROCESS_INTERVAL),(0,J.L)(this.MAX_RETRY_ATTEMPTS),(0,x.Q)(this._unsubscribeAll)).subscribe(()=>this.processQueue())}addPublicKey(t){this.isValidPublicKey(t)?this.publicKeyQueue.has(t)||(this.publicKeyQueue.add(t),this.processingSubject.next()):console.warn("Invalid public key format:",t)}addPublicKeys(t){const n=t.filter(i=>this.isValidPublicKey(i));n.forEach(i=>this.publicKeyQueue.add(i)),n.length>0&&this.processingSubject.next()}isValidPublicKey(t){return/^[0-9a-f]{64}$/.test(t)}loadStoredPublicKeys(){var t=this;return(0,m.A)(function*(){try{const i=(yield t.storageService.getAllProfiles()).filter(r=>r.pubKey&&t.isValidPublicKey(r.pubKey));i.forEach(r=>{t.publicKeyQueue.add(r.pubKey)}),i.length>0&&t.processingSubject.next()}catch(n){throw console.error("Error loading stored public keys:",n),n}})()}processQueue(){var t=this;return(0,m.A)(function*(){if(0===t.publicKeyQueue.size)return;const n=t.getBatches(Array.from(t.publicKeyQueue));t.publicKeyQueue.clear();const i=[];for(const r of n)try{yield t.processBatch(r,i)}catch(a){console.error("Error processing batch:",a),r.forEach(l=>{i.push({success:!1,pubkey:l,error:"Batch processing failed"})})}t.processingStatus.next(i)})()}getBatches(t){const n=[];for(let i=0;i<t.length;i+=this.BATCH_SIZE)n.push(t.slice(i,i+this.BATCH_SIZE));return n}processBatch(t,n){var i=this;return(0,m.A)(function*(){const r={kinds:[G.OS],authors:t};return new Promise(a=>{let l=0;const u=t.length,h=setTimeout(()=>{I("Batch processing timeout")},1e4),_=i.subscriptionService.addSubscriptions([r],E=>{l++,i.handleMetadataEvent(E,n),l===u&&I()},()=>{I()}),I=E=>{clearTimeout(h),i.subscriptionService.removeSubscriptionById(_),t.forEach(R=>{n.some(M=>M.pubkey===R)||n.push({success:!1,pubkey:R,error:E||"Event not received"})}),a()}})})()}handleMetadataEvent(t,n){try{const i=this.parseMetadataEvent(t);i?(this.storageService.saveProfile(t.pubkey,i),n.push({success:!0,pubkey:t.pubkey})):n.push({success:!1,pubkey:t.pubkey,error:"Invalid metadata format"})}catch{n.push({success:!1,pubkey:t.pubkey,error:"Processing error"})}}parseMetadataEvent(t){try{const n=JSON.parse(t.content);if("object"!=typeof n||null===n)return null;if(n.name&&(n.name=n.name.trim()),n.about&&(n.about=n.about.trim()),n.picture)try{new URL(n.picture)}catch{delete n.picture}return n}catch{return null}}clearQueue(){this.publicKeyQueue.clear()}ngOnDestroy(){this.clearQueue(),this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(q.n),e.KVO(K.n))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),k=(()=>{class o{constructor(t,n,i,r){this._signerService=t,this._storageService=n,this._relayService=i,this._metadataQueueService=r,this.chatList=[],this.latestMessageTimestamps={},this.messageQueue=[],this.isDecrypting=!1,this.decryptedPrivateKey="",this._chat=new j.t(null),this._chats=new j.t(null),this._contact=new j.t(null),this._contacts=new j.t(null),this._profile=new j.t(null),this._unsubscribeAll=new F.B}get profile$(){return this._profile.asObservable()}get chat$(){return this._chat.asObservable()}get chats$(){return this._chats.asObservable()}get contact$(){return this._contact.asObservable()}get contacts$(){return this._contacts.asObservable()}checkCurrentChatOnPageRefresh(t){t&&this.getChatById(t).subscribe(i=>{i&&(this._chat.next(i),this.loadAndFetchChatHistory(t))})}getContact(t){var n=this;return(0,m.A)(function*(){try{if(!t)return;n._storageService.profile$.subscribe(i=>{i&&i.pubKey&&i.metadata&&i.pubKey===t&&n._contact.next({pubKey:t,displayName:i.metadata.name?i.metadata.name:"Unknown",picture:i.metadata.picture,about:i.metadata.about})})}catch(i){console.error("Error fetching contact metadata:",i)}})()}getContacts(){return new Q.c(t=>(this._storageService.getAllProfiles().then(n=>{if(n&&n.length>0){const i=n.map(r=>(r.pubKey||console.error("Contact is missing pubKey:",r),r));this._contacts.next(i),t.next(i)}else t.next([]);t.complete()}).catch(n=>{console.error("Error loading cached contacts from IndexedDB:",n),t.next([]),t.complete()}),{unsubscribe(){}}))}getProfile(){var t=this;return(0,m.A)(function*(){try{t._storageService.profile$.subscribe(n=>{n&&n.pubKey&&n.metadata&&n.pubKey===t._signerService.getPublicKey()&&t._profile.next(n.metadata)}),t._storageService.getProfile(t._signerService.getPublicKey()).then(n=>{t._profile.next(n)})}catch(n){console.error("Error fetching profile metadata:",n)}})()}getChats(){var t=this;return(0,m.A)(function*(){const n=t._signerService.getPublicKey(),i=yield t._signerService.isUsingExtension(),r=yield t._signerService.isUsingSecretKey();return t.decryptedPrivateKey=r?yield t._signerService.getDecryptedSecretKey():"",yield Promise.all([t.subscribeToChatList(n,i,r,t.decryptedPrivateKey)]),t.getChatListStream()})()}subscribeToChatList(t,n,i,r){var a=this;return this._relayService.ensureConnectedRelays().then((0,m.A)(function*(){const l=[{kinds:[G.rV],authors:[t],limit:1500},{kinds:[G.rV],"#p":[t],limit:1500}];var u;a._relayService.getPool().subscribeMany(a._relayService.getConnectedRelays(),l,{onevent:(u=(0,m.A)(function*(d){const h=d.pubkey===t?d.tags.find(I=>"p"===I[0])?.[1]||"":d.pubkey;h&&d.created_at>(a.latestMessageTimestamps[h]||0)&&(a.messageQueue.push(d),a.processNextMessage(t,n,i,r))}),function(h){return u.apply(this,arguments)}),oneose:()=>{(a.chatList||[]).length>0&&a._chats.next(a.chatList)}})})),this.getChatListStream()}processNextMessage(t,n,i,r){var a=this;return(0,m.A)(function*(){if(!a.isDecrypting&&0!==a.messageQueue.length){a.isDecrypting=!0;try{for(;a.messageQueue.length>0;){const l=a.messageQueue.shift();if(!l)continue;const u=l.pubkey===t,d=u?l.tags.find(_=>"p"===_[0])?.[1]||"":l.pubkey;if(!d)continue;const h=yield a.decryptReceivedMessage(l,n,i,r,d);h&&a.addOrUpdateChatList(d,h,l.created_at,u)}}catch{}finally{a.isDecrypting=!1}}})()}addOrUpdateChatList(t,n,i,r){const a=this.chatList.find(u=>u.contact?.pubKey===t),l={id:`${t}-${i}`,chatId:t,contactId:t,isMine:r,value:n,createdAt:new Date(1e3*i).toISOString()};if(a)a.messages?.some(d=>d.id===l.id)||(a.messages=[...a.messages||[],l].sort((d,h)=>new Date(d.createdAt).getTime()-new Date(h.createdAt).getTime()),Number(a.lastMessageAt)<i&&(a.lastMessage=n,a.lastMessageAt=i.toString()));else{this._metadataQueueService.addPublicKey(t);const u=this._contacts.value?.find(h=>h.pubKey===t)||{pubKey:t},d={id:t,contact:{pubKey:u.pubKey,name:u.name||"Unknown",picture:u.picture||"/images/avatars/avatar-placeholder.png",about:u.about||"",displayName:u.displayName||u.name||"Unknown"},lastMessage:n,lastMessageAt:i.toString(),messages:[l]};this.chatList.push(d)}this.chatList.sort((u,d)=>Number(d.lastMessageAt)-Number(u.lastMessageAt)),this._chats.next(this.chatList),this._storageService.profile$.pipe((0,P.p)(u=>u&&u.pubKey===t)).subscribe(u=>{const d=this.chatList.find(h=>h.contact?.pubKey===t);d&&(d.contact={...d.contact,name:u.metadata?.name||d.contact.name,picture:u.metadata?.picture||d.contact.picture,about:u.metadata?.about||d.contact.about,displayName:u.metadata?.displayName||u.metadata?.name||d.contact.displayName},this._chats.next(this.chatList))})}getChatListStream(){return this._chats.asObservable()}decryptReceivedMessage(t,n,i,r,a){var l=this;return(0,m.A)(function*(){return n&&!i?yield l._signerService.decryptMessageWithExtension(a,t.content):i&&!n?yield l._signerService.decryptMessage(r,a,t.content):void 0})()}loadAndFetchChatHistory(t,n=!1){var i=this;return(0,m.A)(function*(){const r=i._signerService.getPublicKey(),a=[{kinds:[G.rV],authors:[r],"#p":[t],limit:10},{kinds:[G.rV],authors:[t],"#p":[r],limit:10}],l=[];if(i._relayService.getPool().subscribeMany(i._relayService.getConnectedRelays(),a,{onevent:(u=(0,m.A)(function*(d){const h=d.pubkey===r,_=h?t:d.pubkey,I=yield i._signerService.isUsingExtension(),E=yield i._signerService.isUsingSecretKey(),R=yield i.decryptReceivedMessage(d,I,E,i.decryptedPrivateKey,_);if(R){const M=Math.floor(d.created_at),xt={id:d.id,chatId:t,contactId:_,isMine:h,value:R,createdAt:new Date(1e3*M).toISOString()};n&&l.push(xt),i.addOrUpdateChatList(t,R,M,h),i._chat.next(i.chatList.find(kt=>kt.id===t))}}),function(h){return u.apply(this,arguments)}),oneose:()=>{}}),n)return yield new Promise(u=>setTimeout(u,1e3)),l;var u})()}updateChat(t,n){return this.chats$.pipe((0,D.s)(1),(0,T.n)(i=>{const r=n.contact?.pubKey;if(!r)return(0,$.$)("No public key found for this chat");const a={kind:4,pubkey:r,content:JSON.stringify(n),created_at:Math.floor(Date.now()/1e3),tags:[["p",r]]};return a.id=(0,z.dq)(a),(0,A.H)(this._relayService.publishEventToWriteRelays(a)).pipe((0,X.T)(()=>{if(i){const l=i.findIndex(u=>u.id===t);-1!==l&&(i[l]=n,this._chats.next(i))}return n}),(0,B.W)(l=>(console.error("Failed to update chat via Nostr:",l),(0,$.$)(l))))}))}getChatById(t,n=null){return this.recipientPublicKey=t,(0,A.H)(Promise.all([this._signerService.getPublicKey()])).pipe((0,T.n)(()=>this.chats$.pipe((0,D.s)(1),(0,T.n)(i=>{if(!i||0===i.length)return this.createNewChat(t,n);const r=i.find(a=>a.id===t);return r?(this._chat.next(r),this.loadAndFetchChatHistory(this.recipientPublicKey),(0,L.of)(r)):this.createNewChat(t,n)}))),(0,B.W)(i=>(console.error("Error fetching chat by id from Nostr:",i),(0,$.$)(i))))}createNewChat(t,n=null){const i={id:t||"",contact:n?{pubKey:n.pubKey||t,name:n.name||"Unknown",picture:n.picture||"/images/avatars/avatar-placeholder.png"}:{pubKey:t,name:"Unknown",picture:"/images/avatars/avatar-placeholder.png"},lastMessage:"new chat...",lastMessageAt:Math.floor(Date.now()/1e3).toString()||"0",messages:[]};return this._metadataQueueService.addPublicKey(t),this._storageService.profile$.pipe((0,P.p)(r=>r&&r.pubKey===t),(0,X.T)(r=>(i.contact={pubKey:t,name:r.metadata?.name||"Unknown",picture:r.metadata?.picture||"/images/avatars/avatar-placeholder.png",about:r.metadata?.about||"",displayName:r.metadata?.displayName||r.metadata?.name||"Unknown"},i)))}resetChat(){this._chat.next(null)}sendPrivateMessage(t){var n=this;return(0,m.A)(function*(){try{n.message=t;const i=yield n._signerService.isUsingExtension(),r=yield n._signerService.isUsingSecretKey();if(i&&!r)yield n.handleMessageSendingWithExtension();else if(!i&&r){if(!n.isValidMessageSetup())return void console.error("Message, sender private key, or recipient public key is not properly set.");const a=yield n._signerService.encryptMessage(n.decryptedPrivateKey,n.recipientPublicKey,n.message),l=n._signerService.getUnsignedEvent(4,[["p",n.recipientPublicKey]],a),u=n._signerService.getSignedEvent(l,n.decryptedPrivateKey);(yield n._relayService.publishEventToWriteRelays(u))?n.message="":console.error("Failed to send the message.")}}catch(i){console.error("Error sending private message:",i)}})()}handleMessageSendingWithExtension(){var t=this;return(0,m.A)(function*(){try{const n=yield t._signerService.encryptMessageWithExtension(t.message,t.recipientPublicKey),i=yield t._signerService.signEventWithExtension({kind:4,pubkey:t._signerService.getPublicKey(),tags:[["p",t.recipientPublicKey]],content:n,created_at:Math.floor(Date.now()/1e3)});(yield t._relayService.publishEventToWriteRelays(i))?t.message="":console.error("Failed to send the message with extension.")}catch(n){console.error("Error sending message with extension:",n)}})()}isValidMessageSetup(){return""!==this.message.trim()&&""!==this.recipientPublicKey}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(H.A),e.KVO(K.n),e.KVO(W.b),e.KVO(ee))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var v=c(177),p=c(8834),g=c(2102),f=c(9213),w=c(9042),S=c(9115),b=c(882),te=c(8703);let ne=(()=>{class o{transform(t){return/\.(jpeg|jpg|gif|png|bmp|svg|webp|tiff)$/i.test(t)?"\u{1f304} image":/\.(mp4|mov|avi|mkv|webm|flv|wmv|mpeg|3gp)$/i.test(t)?"\u{1f3ac} video":/\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(t)?"\u{1f3b5} audio":/\.pdf$/i.test(t)?"\u{1f4c1} pdf":/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/.test(t)?"\u{1f4fd}\ufe0f youtube":/https?:\/\/(www\.)?vimeo.com\/(\d+)/.test(t)?"\u{1f4fd}\ufe0f vimeo":/https?:\/\/(www\.)?instagram.com\/p\/[a-zA-Z0-9_-]+/.test(t)?"\u{1f52e} instagram":/https?:\/\/(www\.)?twitter.com\/[a-zA-Z0-9_]+\/status\/[0-9]+/.test(t)?"\u{1f426} twitter":/(https?:\/\/[^\s]+)/.test(t)?"\u{1f310} url":t}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275pipe=e.EJ8({name:"checkmessage",type:o,pure:!0,standalone:!0})}}return o})();function ie(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",16),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.openChat(i))}),e.EFF(1),e.k0s()}if(2&o){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.name.charAt(0)," ")}}function oe(o,s){if(1&o&&e.nrm(0,"img",11),2&o){const t=e.XpG().$implicit;e.Y8G("src",t.picture,e.B4B)}}function re(o,s){if(1&o&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.name.charAt(0)," ")}}function se(o,s){if(1&o){const t=e.RV6();e.DNE(0,ie,2,1,"div",8),e.j41(1,"div",9),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.openChat(i))}),e.j41(2,"div",10),e.DNE(3,oe,1,1,"img",11)(4,re,2,1,"div",12),e.k0s(),e.j41(5,"div",13)(6,"div",14),e.EFF(7),e.k0s(),e.j41(8,"div",15),e.EFF(9),e.k0s()()()}if(2&o){const t=s.$implicit,n=s.$index,i=e.XpG(2);e.vxM(0===n||t.name.charAt(0)!==i.contacts[n-1].name.charAt(0)?0:-1),e.R7$(3),e.vxM(t.picture?3:-1),e.R7$(),e.vxM(t.picture?-1:4),e.R7$(3),e.SpI(" ",t.name," "),e.R7$(2),e.SpI(" ",t.about," ")}}function ae(o,s){if(1&o&&e.Z7z(0,se,10,5,"div",7,e.BUC().trackByFn,!0),2&o){const t=e.XpG();e.Dyx(t.contacts)}}function ce(o,s){1&o&&(e.j41(0,"div",6),e.EFF(1," There are no contacts! "),e.k0s())}let le=(()=>{class o{constructor(t,n){this._chatService=t,this.router=n,this.contacts=[],this._unsubscribeAll=new F.B}ngOnInit(){this._chatService.contacts$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(t=>{this.contacts=t})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}trackByFn(t,n){return n.id||t}openChat(t){this._chatService.getChatById(t.pubKey,t).subscribe({next:n=>{console.log("Chat loaded or created:",n),this.router.navigate(["/chat",t.pubKey])},error:n=>{console.error("Error loading or creating chat:",n)},complete:()=>{this.drawer.close()}})}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(k),e.rXU(C.Ix))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat-new-chat"]],inputs:{drawer:"drawer"},standalone:!0,features:[e.aNF],decls:9,vars:2,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","overflow-hidden","dark:bg-default"],[1,"-mb-px","flex","h-18","flex-0","items-center","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"relative","overflow-y-auto"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","dark:hover:bg-hover","hover:bg-gray-100","md:px-8"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-100","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","dark:hover:bg-hover","hover:bg-gray-100","md:px-8",3,"click"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","overflow-hidden","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-100","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8",3,"click"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return i.drawer.close()}),e.nrm(3,"mat-icon",3),e.k0s(),e.j41(4,"div",4),e.EFF(5,"New chat"),e.k0s()(),e.j41(6,"div",5),e.DNE(7,ae,2,0)(8,ce,2,0,"div",6),e.k0s()()),2&n&&(e.R7$(3),e.Y8G("svgIcon","heroicons_outline:arrow-long-left"),e.R7$(4),e.vxM(i.contacts.length?7:8))},dependencies:[p.Hl,p.iY,f.m_,f.An],encapsulation:2,changeDetection:0})}}return o})();var y=c(9417);function ue(o,s){if(1&o&&e.nrm(0,"img",10),2&o){const t=e.XpG();e.Y8G("src",t.profile.picture,e.B4B)("alt","Profile picture")}}function de(o,s){if(1&o&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.SpI(" ",t.profile.name.charAt(0)," ")}}let he=(()=>{class o{constructor(t){this._chatService=t,this._unsubscribeAll=new F.B}ngOnInit(){this._chatService.profile$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(t=>{this.profile=t})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(k))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat-profile"]],inputs:{drawer:"drawer"},standalone:!0,features:[e.aNF],decls:35,vars:11,consts:[[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-6","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-2xl","font-semibold"],[1,"px-6"],[1,"group","relative","mx-auto","mt-8","flex","h-40","w-40","flex-0","rounded-full"],[1,"absolute","inset-0","hidden","cursor-pointer","flex-col","items-center","justify-center","rounded-full","bg-gray-800","bg-opacity-80","backdrop-blur","backdrop-filter","group-hover:flex"],[1,"text-white",3,"svgIcon"],[1,"mx-6","mt-2","text-center","font-medium","text-white"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mx-2","mt-8","flex","flex-col"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"ngModel"],[1,"mt-4","flex","items-center","justify-end"],["mat-button","",3,"click"],["mat-flat-button","",1,"ml-2",3,"color"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return i.drawer.close()}),e.nrm(3,"mat-icon",3),e.k0s(),e.j41(4,"div",4),e.EFF(5,"Profile"),e.k0s()(),e.j41(6,"div",5)(7,"div",6)(8,"div",7),e.nrm(9,"mat-icon",8),e.j41(10,"div",9),e.EFF(11," Change Profile Photo "),e.k0s()(),e.DNE(12,ue,1,2,"img",10)(13,de,2,1,"div",11),e.k0s(),e.j41(14,"div",12)(15,"mat-form-field")(16,"mat-label"),e.EFF(17,"Name"),e.k0s(),e.nrm(18,"mat-icon",13)(19,"input",14),e.k0s(),e.j41(20,"mat-form-field")(21,"mat-label"),e.EFF(22,"Username"),e.k0s(),e.nrm(23,"mat-icon",13)(24,"input",14),e.k0s(),e.j41(25,"mat-form-field")(26,"mat-label"),e.EFF(27,"About"),e.k0s(),e.nrm(28,"mat-icon",13)(29,"input",14),e.k0s(),e.j41(30,"div",15)(31,"button",16),e.bIt("click",function(){return i.drawer.close()}),e.EFF(32,"Cancel"),e.k0s(),e.j41(33,"button",17),e.EFF(34," Save "),e.k0s()()()()()),2&n&&(e.R7$(3),e.Y8G("svgIcon","heroicons_outline:arrow-long-left"),e.R7$(6),e.Y8G("svgIcon","heroicons_outline:camera"),e.R7$(3),e.vxM(i.profile.picture?12:-1),e.R7$(),e.vxM(i.profile.picture?-1:13),e.R7$(5),e.Y8G("svgIcon","heroicons_solid:user-circle"),e.R7$(),e.Y8G("ngModel",i.profile.name),e.R7$(4),e.Y8G("svgIcon","heroicons_solid:envelope"),e.R7$(),e.Y8G("ngModel",i.profile.username),e.R7$(4),e.Y8G("svgIcon","heroicons_solid:identification"),e.R7$(),e.Y8G("ngModel",i.profile.about),e.R7$(4),e.Y8G("color","primary"))},dependencies:[p.Hl,p.$z,p.iY,f.m_,f.An,g.RG,g.rl,g.nJ,g.JW,w.fS,w.fg,y.YN,y.me,y.BC,y.vS],encapsulation:2,changeDetection:0})}}return o})();var me=c(7857);const pe=(o,s)=>({"dark:hover:bg-hover hover:bg-gray-100":o,"bg-primary-50 dark:bg-hover":s}),ge=o=>[o],fe=(o,s)=>({"absolute inset-0 z-20 flex lg:static lg:inset-auto":o,"hidden lg:flex":s});function ve(o,s){if(1&o&&e.nrm(0,"chat-new-chat",6),2&o){e.XpG();const t=e.sdS(3);e.Y8G("drawer",t)}}function _e(o,s){if(1&o&&e.nrm(0,"chat-profile",6),2&o){e.XpG();const t=e.sdS(3);e.Y8G("drawer",t)}}function Ce(o,s){if(1&o&&e.nrm(0,"img",15),2&o){const t=e.XpG(2);e.Y8G("src",null==t.profile?null:t.profile.picture,e.B4B)}}function be(o,s){if(1&o&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI(" ",null==t.profile||null==t.profile.name?null:t.profile.name.charAt(0)," ")}}function ye(o,s){if(1&o&&e.nrm(0,"div",39),2&o){const t=e.XpG().$implicit,n=e.XpG(3);e.AVh("ring-primary-50",n.selectedChat&&n.selectedChat.id===t.id)}}function xe(o,s){if(1&o){const t=e.RV6();e.j41(0,"img",40),e.bIt("error",function(){e.eBV(t);const i=e.XpG(4);return e.Njj(i.src="/images/avatars/avatar-placeholder.png")}),e.k0s()}if(2&o){const t=e.XpG().$implicit;e.Y8G("src",null==t.contact?null:t.contact.picture,e.B4B)}}function ke(o,s){if(1&o&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",null==t.contact||null==t.contact.name?null:t.contact.name.charAt(0)," ")}}function we(o,s){1&o&&e.nrm(0,"mat-icon",38),2&o&&e.Y8G("svgIcon","heroicons_solid:speaker-x-mark")}function Se(o,s){if(1&o&&(e.j41(0,"a",28)(1,"div",29),e.DNE(2,ye,1,2,"div",30)(3,xe,1,1,"img",31)(4,ke,2,1,"div",32),e.k0s(),e.j41(5,"div",33)(6,"div",34),e.EFF(7),e.k0s(),e.j41(8,"div",35),e.EFF(9),e.nI1(10,"checkmessage"),e.k0s()(),e.j41(11,"div",36)(12,"div",37),e.EFF(13),e.nI1(14,"ago"),e.k0s(),e.DNE(15,we,1,1,"mat-icon",38),e.k0s()()),2&o){const t=s.$implicit,n=e.XpG(3);e.Y8G("ngClass",e.l_i(17,pe,!n.selectedChat||n.selectedChat.id!==t.id,n.selectedChat&&n.selectedChat.id===t.id))("routerLink",e.eq3(20,ge,t.id)),e.R7$(2),e.vxM(t.unreadCount>0?2:-1),e.R7$(),e.Y8G("ngIf",null==t.contact?null:t.contact.picture),e.R7$(),e.Y8G("ngIf",!(null!=t.contact&&t.contact.picture)),e.R7$(3),e.SpI(" ",null==t.contact?null:t.contact.name," "),e.R7$(),e.AVh("text-primary",t.unreadCount>0)("dark:text-primary-500",t.unreadCount>0),e.R7$(),e.SpI(" ",e.bMT(10,13,t.lastMessage)," "),e.R7$(4),e.SpI(" ",e.bMT(14,15,t.lastMessageAt)," "),e.R7$(2),e.vxM(t.muted?15:-1)}}function Fe(o,s){if(1&o&&e.Z7z(0,Se,16,22,"a",28,e.BUC().trackByFn,!0),2&o){const t=e.XpG(2);e.Dyx(t.filteredChats)}}function Ie(o,s){1&o&&(e.j41(0,"div",9),e.nrm(1,"mat-icon",41),e.j41(2,"div",42),e.EFF(3," No chats "),e.k0s()()),2&o&&(e.R7$(),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function je(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",8)(1,"div",11)(2,"div",12)(3,"div",13),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openProfile())}),e.j41(4,"div",14),e.DNE(5,Ce,1,1,"img",15)(6,be,2,1,"div",16),e.k0s(),e.j41(7,"div",17),e.EFF(8),e.k0s()(),e.j41(9,"button",18),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openNewChat())}),e.nrm(10,"mat-icon",19),e.k0s(),e.j41(11,"button",20),e.nrm(12,"mat-icon",19),e.j41(13,"mat-menu",null,1)(15,"button",21),e.nrm(16,"mat-icon",19),e.EFF(17," New group "),e.k0s(),e.j41(18,"button",21),e.nrm(19,"mat-icon",19),e.EFF(20," Create a room "),e.k0s(),e.j41(21,"button",22),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openProfile())}),e.nrm(22,"mat-icon",19),e.EFF(23," Profile "),e.k0s(),e.j41(24,"button",21),e.nrm(25,"mat-icon",19),e.EFF(26," Archived "),e.k0s(),e.j41(27,"button",21),e.nrm(28,"mat-icon",19),e.EFF(29," Starred "),e.k0s(),e.j41(30,"button",21),e.nrm(31,"mat-icon",19),e.EFF(32," Settings "),e.k0s()()()(),e.j41(33,"div",23)(34,"mat-form-field",24),e.nrm(35,"mat-icon",25),e.j41(36,"input",26,2),e.bIt("input",function(){e.eBV(t);const i=e.sdS(37),r=e.XpG();return e.Njj(r.filterChats(i.value))}),e.k0s()()()(),e.j41(38,"div",27),e.DNE(39,Fe,2,0)(40,Ie,4,1,"div",9),e.k0s()()}if(2&o){const t=e.sdS(14),n=e.XpG();e.R7$(5),e.vxM(null!=n.profile&&n.profile.picture?5:-1),e.R7$(),e.vxM(null!=n.profile&&n.profile.picture?-1:6),e.R7$(2),e.SpI(" ",null==n.profile?null:n.profile.name," "),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:plus-circle"),e.R7$(),e.Y8G("matMenuTriggerFor",t),e.R7$(),e.Y8G("svgIcon","heroicons_outline:ellipsis-vertical"),e.R7$(4),e.Y8G("svgIcon","heroicons_outline:user-group"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:chat-bubble-left-right"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:user-circle"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:archive-box"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:star"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:cog-8-tooth"),e.R7$(3),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","heroicons_solid:magnifying-glass"),e.R7$(),e.Y8G("autocomplete","off")("placeholder","Search or start new chat"),e.R7$(3),e.vxM(n.filteredChats.length>0?39:40)}}function Re(o,s){1&o&&(e.j41(0,"div",9),e.nrm(1,"mat-icon",41),e.j41(2,"div",42),e.EFF(3," No chats "),e.k0s()()),2&o&&(e.R7$(),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function $e(o,s){if(1&o&&(e.j41(0,"div",10),e.nrm(1,"router-outlet"),e.k0s()),2&o){const t=e.XpG();e.Y8G("ngClass",e.l_i(1,fe,t.selectedChat&&t.selectedChat.id,!t.selectedChat||!t.selectedChat.id))}}let Ge=(()=>{class o{constructor(t,n,i,r){this._chatService=t,this._changeDetectorRef=n,this.route=i,this._angorNavigationService=r,this.chats=[],this.filteredChats=[],this.drawerOpened=!1,this._unsubscribeAll=new F.B}updateNavigationBadge(){const t=this._angorNavigationService.getComponent("mainNavigation");t&&(this._angorNavigationService.getItem("chat",t.navigation).badge.title="0",t.refresh())}ngOnInit(){this.updateNavigationBadge(),this._chatService.chats$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(n=>{this.chats=this.filteredChats=n,this._markForCheck()}),this._chatService.profile$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(n=>{this.profile=n,this._markForCheck()}),this._chatService.chat$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(n=>{this.selectedChat=n,this._markForCheck()});const t=localStorage.getItem("currentChatId");t&&this._chatService.checkCurrentChatOnPageRefresh(t)}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete(),this._chatService.resetChat(),localStorage.removeItem("currentChatId")}filterChats(t){if(t){const n=t.toLowerCase();this.filteredChats=this.chats.filter(i=>i.contact?.name.toLowerCase().includes(n))}else this.filteredChats=this.chats;this._markForCheck()}openNewChat(){this.drawerComponent="new-chat",this.drawerOpened=!0,this._markForCheck()}openProfile(){this.drawerComponent="profile",this.drawerOpened=!0,this._markForCheck()}trackByFn(t,n){return n.id||t}_markForCheck(){this._changeDetectorRef.markForCheck()}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(k),e.rXU(e.gRc),e.rXU(C.nX),e.rXU(me.lX))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat-chats"]],standalone:!0,features:[e.aNF],decls:10,vars:7,consts:[["drawer",""],["chatsHeaderMenu",""],["searchField",""],[1,"bg-card","relative","flex","w-full","flex-auto","dark:bg-transparent"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-r","lg:shadow-none",3,"openedChange","autoFocus","opened"],[3,"drawer"],[1,"flex","overflow-hidden"],[1,"bg-card","relative","flex","w-full","min-w-0","flex-auto","flex-col","dark:bg-transparent","lg:min-w-100","lg:max-w-100"],[1,"flex","h-full","flex-auto","flex-col","items-center","justify-center"],[1,"flex-auto","border-l",3,"ngClass"],[1,"flex","flex-0","flex-col","border-b","bg-gray-50","px-8","py-4","dark:bg-transparent"],[1,"flex","items-center"],[1,"mr-1","flex","cursor-pointer","items-center",3,"click"],[1,"h-10","w-10"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Profile picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","font-medium"],["mat-icon-button","",1,"ml-auto",3,"click"],[3,"svgIcon"],["mat-icon-button","",1,"-mr-4","ml-1",3,"matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"mt-4"],[1,"angor-mat-rounded","angor-mat-dense","w-full",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],[1,"flex-auto","overflow-y-auto"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-8","py-5",3,"ngClass","routerLink"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900",3,"ring-primary-50"],["class","h-full w-full rounded-full object-cover","alt","Contact picture",3,"src","error",4,"ngIf"],["class","flex h-full w-full items-center justify-center rounded-full bg-gray-200 text-lg uppercase text-gray-600 dark:bg-gray-700 dark:text-gray-200",4,"ngIf"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"],[1,"text-secondary","truncate","leading-5"],[1,"ml-auto","flex","flex-col","items-end","self-start","pl-2"],[1,"text-secondary","overflow-hidden","whitespace-nowrap","text-sm","leading-5"],[1,"text-hint","icon-size-5",3,"svgIcon"],[1,"ring-bg-card","absolute","bottom-0","right-0","-ml-0.5","h-2","w-2","flex-0","rounded-full","bg-primary","text-on-primary","ring-2","dark:bg-primary-500","dark:ring-gray-900"],["alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"error","src"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",3)(1,"mat-drawer-container",4)(2,"mat-drawer",5,0),e.mxI("openedChange",function(l){return e.eBV(r),e.DH7(i.drawerOpened,l)||(i.drawerOpened=l),e.Njj(l)}),e.DNE(4,ve,1,1,"chat-new-chat",6)(5,_e,1,1,"chat-profile",6),e.k0s(),e.j41(6,"mat-drawer-content",7),e.DNE(7,je,41,17,"div",8)(8,Re,4,1,"div",9)(9,$e,2,4,"div",10),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("hasBackdrop",!1),e.R7$(),e.Y8G("autoFocus",!1),e.R50("opened",i.drawerOpened),e.R7$(2),e.vxM("new-chat"===i.drawerComponent?4:-1),e.R7$(),e.vxM("profile"===i.drawerComponent?5:-1),e.R7$(2),e.vxM(i.chats&&i.chats.length>0?7:8),e.R7$(2),e.vxM(i.chats&&i.chats.length>0?9:-1))},dependencies:[b.vg,b.qe,b.$C,b.$l,le,he,p.Hl,p.iY,f.m_,f.An,S.Cn,S.kk,S.fb,S.Cp,g.RG,g.rl,g.JW,w.fS,w.fg,v.YU,C.Wk,C.n3,te.g,v.MD,v.bT,ne],encapsulation:2,changeDetection:0})}}return o})(),Ee=(()=>{class o{constructor(){}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat-empty-conversation"]],standalone:!0,features:[e.aNF],decls:5,vars:1,consts:[[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"mat-icon",2),e.j41(3,"div",3),e.EFF(4," Select a conversation or start a new chat "),e.k0s()()()),2&n&&(e.R7$(2),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))},dependencies:[f.m_,f.An],encapsulation:2,changeDetection:0})}}return o})();var U=c(7403),Me=c(8865),N=c(5351),Te=c(2798),O=c(1626);let Be=(()=>{class o{constructor(t){this.http=t}getTopGifs(t,n){const r=(new O.Nl).append("key",n).append("q",t);return this.http.get("https://g.tenor.com/v1/search",{params:r})}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(O.Qq))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Ne(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",8),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectGif(i))}),e.nrm(1,"img",9),e.k0s()}if(2&o){const t=s.$implicit;e.R7$(),e.Y8G("src",t,e.B4B)}}function Ye(o,s){if(1&o&&(e.j41(0,"div",6),e.DNE(1,Ne,2,1,"div",7),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.gifsFound)}}let Ae=(()=>{class o{constructor(t,n,i,r){this.gifService=t,this.dialogRef=n,this._changeDetectorRef=i,this.data=r,this.gifSearch="",this.gifsFound=[]}searchGif(){this.gifSearch&&""!==this.gifSearch.trim()?this.data.apiKey?this.gifService.getTopGifs(this.gifSearch,this.data.apiKey).subscribe(t=>{this.gifsFound=t.results.map(n=>n.media[0].gif.url),this._changeDetectorRef.detectChanges()},t=>{console.error("Error fetching GIFs:",t)}):console.error("API key is missing."):console.error("Search term is empty.")}selectGif(t){this.dialogRef.close(t)}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(Be),e.rXU(N.CP),e.rXU(e.gRc),e.rXU(N.Vh))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["gif-dialog"]],standalone:!0,features:[e.aNF],decls:10,vars:3,consts:[["mat-dialog-content",""],["appearance","outline",1,"full-width"],["matInput","","placeholder","keyword...",3,"ngModelChange","keyup.enter","ngModel"],["mat-icon-button","","matSuffix","",1,"ml-2","mr-2",3,"click"],[3,"svgIcon"],["class","results-container mt-4 grid grid-cols-3 gap-4",4,"ngIf"],[1,"results-container","mt-4","grid","grid-cols-3","gap-4"],["class","gif-preview h-24 w-full cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"gif-preview","h-24","w-full","cursor-pointer",3,"click"],[1,"h-full","w-full","object-cover",3,"src"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),e.EFF(3,"Search GIF"),e.k0s(),e.j41(4,"input",2),e.mxI("ngModelChange",function(a){return e.DH7(i.gifSearch,a)||(i.gifSearch=a),a}),e.bIt("keyup.enter",function(){return i.searchGif()}),e.k0s(),e.j41(5,"button",3),e.bIt("click",function(){return i.searchGif()}),e.nrm(6,"mat-icon",4),e.k0s(),e.j41(7,"mat-hint"),e.EFF(8,'Enter a keyword like "funny" or "cat" and hit search!'),e.k0s()(),e.DNE(9,Ye,2,1,"div",5),e.k0s()),2&n&&(e.R7$(4),e.R50("ngModel",i.gifSearch),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:magnifying-glass"),e.R7$(3),e.Y8G("ngIf",i.gifsFound.length>0))},dependencies:[b.vg,p.Hl,p.iY,f.m_,f.An,y.YN,y.me,y.BC,y.vS,g.nJ,g.rl,y.X1,v.MD,v.Sq,v.bT,Te.Ve,g.MV,g.yw,g.RG,w.fS,w.fg],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.results-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;overflow-x:hidden}.gif-preview[_ngcontent-%COMP%]{transition:transform .2s}.gif-preview[_ngcontent-%COMP%]:hover{transform:scale(1.1)}"],changeDetection:0})}}return o})();const Pe=o=>["/profile",o];function De(o,s){if(1&o&&e.nrm(0,"img",8),2&o){const t=e.XpG();e.Y8G("src",null==t.chat.contact?null:t.chat.contact.picture,e.B4B)("alt","Contact picture")}}function Xe(o,s){if(1&o&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.SpI(" ",null==t.chat.contact?null:t.chat.contact.name.charAt(0)," ")}}let Ke=(()=>{class o{constructor(){}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat-contact-info"]],inputs:{chat:"chat",drawer:"drawer"},standalone:!0,features:[e.aNF],decls:16,vars:8,consts:[[1,"bg-card","flex","h-full","flex-auto","flex-col","dark:bg-default"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"ml-2","text-lg","font-medium"],[1,"overflow-y-auto"],[1,"mt-8","flex","flex-col","items-center"],[1,"h-40","w-40","rounded-full"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';",1,"h-full","w-full","rounded-full","object-cover",3,"src","alt"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-8xl","font-semibold","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"mt-4","text-lg","font-medium"],[3,"routerLink"],[1,"text-secondary","ml-4","mr-4","mt-0.5","text-md"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return i.drawer.close()}),e.nrm(3,"mat-icon",3),e.k0s(),e.j41(4,"div",4),e.EFF(5,"Contact info"),e.k0s()(),e.j41(6,"div",5)(7,"div",6)(8,"div",7),e.DNE(9,De,1,2,"img",8)(10,Xe,2,1,"div",9),e.k0s(),e.j41(11,"div",10)(12,"a",11),e.EFF(13),e.k0s()(),e.j41(14,"div",12),e.EFF(15),e.k0s()()()()),2&n&&(e.R7$(3),e.Y8G("svgIcon","heroicons_outline:x-mark"),e.R7$(6),e.vxM(null!=i.chat.contact&&i.chat.contact.picture?9:-1),e.R7$(),e.vxM(null!=i.chat.contact&&i.chat.contact.picture?-1:10),e.R7$(2),e.Y8G("routerLink",e.eq3(6,Pe,null==i.chat.contact?null:i.chat.contact.pubKey)),e.R7$(),e.SpI(" ",null==i.chat.contact?null:i.chat.contact.name," "),e.R7$(2),e.SpI(" ",null==i.chat.contact?null:i.chat.contact.about," "))},dependencies:[p.Hl,p.iY,f.m_,f.An,C.iI,C.Wk],encapsulation:2,changeDetection:0})}}return o})();var Ue=c(4977),Oe=c(881),Ve=c(345),Qe=c(413);const Le=["messageInput"],ze=()=>["./"],He=o=>({active:o}),We=(o,s,t,n)=>({"items-end":o,"items-start":s,"mt-0.5":t,"mt-3":n}),Ze=(o,s)=>({"bg-gray-400 text-blue-50":o,"bg-gray-500 text-gray-50":s}),Je=(o,s)=>({"-right-1 -mr-px mb-px text-gray-400":o,"-left-1 -ml-px mb-px -scale-x-1 text-gray-500":s}),qe=(o,s)=>({"mr-3":o,"ml-3":s});function et(o,s){if(1&o&&e.nrm(0,"img",15),2&o){const t=e.XpG(2);e.Y8G("src",null==t.chat.contact?null:t.chat.contact.picture,e.B4B)}}function tt(o,s){if(1&o&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI(" ",null==t.chat.contact?null:t.chat.contact.name.charAt(0)," ")}}function nt(o,s){1&o&&(e.nrm(0,"mat-icon",12),e.EFF(1," Mute notifications ")),2&o&&e.Y8G("svgIcon","heroicons_outline:speaker-x-mark")}function it(o,s){1&o&&(e.nrm(0,"mat-icon",12),e.EFF(1," Unmute notifications ")),2&o&&e.Y8G("svgIcon","heroicons_outline:speaker-wave")}function ot(o,s){if(1&o&&(e.j41(0,"div",31),e.nrm(1,"div",33),e.j41(2,"div",34),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.nrm(5,"div",33),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(3),e.SpI(" ",e.i5U(4,1,t.createdAt,"longDate")," ")}}function rt(o,s){1&o&&e.eu8(0)}function st(o,s){if(1&o&&(e.j41(0,"div",37),e.DNE(1,rt,1,0,"ng-container",40),e.k0s()),2&o){const t=e.XpG(2).$implicit;e.XpG(2);const n=e.sdS(4);e.Y8G("ngClass",e.l_i(2,Je,t.isMine,!t.isMine)),e.R7$(),e.Y8G("ngTemplateOutlet",n)}}function at(o,s){if(1&o&&(e.j41(0,"div",44),e.nrm(1,"iframe",45),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.Y8G("src",t.safeWord,e.f$h)}}function ct(o,s){if(1&o&&(e.j41(0,"div",44),e.nrm(1,"img",46),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.Y8G("src",t.safeWord,e.B4B)}}function lt(o,s){if(1&o&&(e.j41(0,"div",44)(1,"video",47),e.nrm(2,"source",48),e.EFF(3," Your browser does not support the video tag. "),e.k0s()()),2&o){const t=e.XpG().$implicit;e.R7$(2),e.Y8G("src",t.safeWord,e.B4B)}}function ut(o,s){if(1&o&&(e.j41(0,"div",44)(1,"audio",49),e.nrm(2,"source",50),e.EFF(3," Your browser does not support the audio element. "),e.k0s()()),2&o){const t=e.XpG().$implicit;e.R7$(2),e.Y8G("src",t.safeWord,e.B4B)}}function dt(o,s){if(1&o&&(e.j41(0,"div",51)(1,"a",52),e.EFF(2),e.k0s()()),2&o){const t=e.XpG().$implicit;e.R7$(),e.Y8G("href",t.word,e.B4B),e.R7$(),e.JRh(t.word)}}function ht(o,s){if(1&o&&(e.j41(0,"span",51),e.EFF(1),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.JRh(t)}}function mt(o,s){if(1&o&&(e.j41(0,"div",41),e.DNE(1,at,2,1,"div",42)(2,ct,2,1,"div",42)(3,lt,4,1,"div",42)(4,ut,4,1,"div",42)(5,dt,3,2,"div",43)(6,ht,2,1,"span",43),e.k0s()),2&o){const t=s.$implicit;e.R7$(),e.Y8G("ngIf","youtube"===t.token),e.R7$(),e.Y8G("ngIf","image"===t.token),e.R7$(),e.Y8G("ngIf","video"===t.token),e.R7$(),e.Y8G("ngIf","audio"===t.token),e.R7$(),e.Y8G("ngIf","link"===t.token),e.R7$(),e.Y8G("ngIf",!t.token)}}function pt(o,s){if(1&o&&(e.j41(0,"div",39),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&o){const t=e.XpG(2).$implicit;e.Y8G("ngClass",e.l_i(5,qe,t.isMine,!t.isMine)),e.R7$(),e.SpI(" ",e.i5U(2,2,t.createdAt,"HH:mm")," ")}}function gt(o,s){if(1&o&&(e.j41(0,"div")(1,"div",35)(2,"div",36),e.DNE(3,st,2,5,"div",37)(4,mt,7,6,"div",38),e.k0s(),e.DNE(5,pt,3,8,"div",39),e.k0s()()),2&o){const t=e.XpG(),n=t.$implicit,i=t.$index,r=t.$count,a=e.XpG(2);e.R7$(),e.Y8G("ngClass",e.ziG(6,We,n.isMine,!n.isMine,i>0&&a.chat.messages[i-1].isMine===n.isMine,i>0&&a.chat.messages[i-1].isMine!==n.isMine)),e.R7$(),e.Y8G("ngClass",e.l_i(11,Ze,n.isMine,!n.isMine)),e.R7$(),e.vxM(i===r-1||a.chat.messages[i+1].isMine!==n.isMine?3:-1),e.R7$(),e.Y8G("ngForOf",a.parseContent.parseContent(n.value))("ngForTrackBy",a.trackByFn),e.R7$(),e.vxM(0===i||i===r-1||a.chat.messages[i+1].isMine!==n.isMine||a.chat.messages[i+1].createdAt!==n.createdAt?5:-1)}}function ft(o,s){if(1&o&&(e.DNE(0,ot,6,4,"div",31),e.nI1(1,"date"),e.nI1(2,"date"),e.DNE(3,gt,6,14,"div",32)),2&o){const t=s.$implicit,n=s.$index,i=e.XpG(2);e.vxM(0===n||e.i5U(1,2,i.chat.messages[n-1].createdAt,"d")!==e.i5U(2,5,t.createdAt,"d")?0:-1),e.R7$(3),e.Y8G("ngIf",!t.id.includes("new-chat"))}}function vt(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",53)(1,"emoji-mart",54),e.bIt("emojiClick",function(i){e.eBV(t);const r=e.XpG(2);return e.Njj(r.addEmoji(i))}),e.k0s()()}if(2&o){const t=e.XpG(2);e.R7$(),e.Y8G("darkMode",t.darkMode)}}function _t(o,s){if(1&o){const t=e.RV6();e.j41(0,"mat-drawer-container",5)(1,"mat-drawer",7,1),e.mxI("openedChange",function(i){e.eBV(t);const r=e.XpG();return e.DH7(r.drawerOpened,i)||(r.drawerOpened=i),e.Njj(i)}),e.nrm(3,"chat-contact-info",8),e.k0s(),e.j41(4,"mat-drawer-content",9)(5,"div",10)(6,"a",11),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.resetChat())}),e.nrm(7,"mat-icon",12),e.k0s(),e.j41(8,"div",13),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openContactInfo())}),e.j41(9,"div",14),e.DNE(10,et,1,1,"img",15)(11,tt,2,1,"div",16),e.k0s(),e.j41(12,"div",17),e.EFF(13),e.k0s()(),e.j41(14,"button",18),e.nrm(15,"mat-icon",12),e.j41(16,"mat-menu",null,2)(18,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openContactInfo())}),e.nrm(19,"mat-icon",12),e.EFF(20," Contact info "),e.k0s(),e.j41(21,"button",20),e.nrm(22,"mat-icon",12),e.EFF(23," Select messages "),e.k0s(),e.j41(24,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleMuteNotifications())}),e.DNE(25,nt,2,1)(26,it,2,1),e.k0s(),e.j41(27,"button",20),e.nrm(28,"mat-icon",12),e.EFF(29," Clear messages "),e.k0s(),e.j41(30,"button",20),e.nrm(31,"mat-icon",12),e.EFF(32," Delete chat "),e.k0s()()()(),e.j41(33,"div",21)(34,"div",22),e.Z7z(35,ft,4,8,"div",null,e.BUC().trackByFn,!0),e.k0s()(),e.j41(37,"div",23)(38,"div",24)(39,"button",25),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openGifDialog())}),e.nrm(40,"mat-icon",12),e.k0s(),e.j41(41,"button",25),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleEmojiPicker())}),e.nrm(42,"mat-icon",12),e.k0s(),e.DNE(43,vt,2,1,"div",26),e.j41(44,"button",25),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleSpeechRecognition())}),e.nrm(45,"mat-icon",27),e.k0s()(),e.j41(46,"mat-form-field",28)(47,"textarea",29,3),e.bIt("keydown",function(i){e.eBV(t);const r=e.XpG();return e.Njj(r.handleKeyDown(i))}),e.k0s()(),e.j41(49,"div",30)(50,"button",25),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.sendMessage())}),e.nrm(51,"mat-icon",12),e.k0s()()()()()}if(2&o){const t=e.sdS(2),n=e.sdS(17),i=e.XpG();e.Y8G("hasBackdrop",!1),e.R7$(),e.Y8G("autoFocus",!1)("mode",i.drawerMode)("position","end"),e.R50("opened",i.drawerOpened),e.R7$(2),e.Y8G("drawer",t)("chat",i.chat),e.R7$(3),e.Y8G("routerLink",e.lJ4(26,ze)),e.R7$(),e.Y8G("svgIcon","heroicons_outline:arrow-long-left"),e.R7$(3),e.vxM(null!=i.chat.contact&&i.chat.contact.picture?10:-1),e.R7$(),e.vxM(null!=i.chat.contact&&i.chat.contact.picture?-1:11),e.R7$(2),e.SpI(" ",null==i.chat.contact?null:i.chat.contact.name," "),e.R7$(),e.Y8G("matMenuTriggerFor",n),e.R7$(),e.Y8G("svgIcon","heroicons_outline:ellipsis-vertical"),e.R7$(4),e.Y8G("svgIcon","heroicons_outline:user-circle"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:check-circle"),e.R7$(3),e.vxM(i.chat.muted?-1:25),e.R7$(),e.vxM(i.chat.muted?26:-1),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:backspace"),e.R7$(3),e.Y8G("svgIcon","heroicons_outline:trash"),e.R7$(4),e.Dyx(i.chat.messages),e.R7$(5),e.Y8G("svgIcon","heroicons_outline:gif"),e.R7$(2),e.Y8G("svgIcon","heroicons_outline:face-smile"),e.R7$(),e.Y8G("ngIf",i.showEmojiPicker),e.R7$(2),e.Y8G("ngClass",e.eq3(27,He,i.isListening))("svgIcon",i.isListening?"heroicons_solid:microphone":"heroicons_outline:microphone"),e.R7$(6),e.Y8G("svgIcon","heroicons_outline:paper-airplane")}}function Ct(o,s){1&o&&(e.j41(0,"div",6),e.nrm(1,"mat-icon",55),e.j41(2,"div",56),e.EFF(3," Select a conversation or start a new chat "),e.k0s()()),2&o&&(e.R7$(),e.Y8G("svgIcon","heroicons_outline:chat-bubble-oval-left-ellipsis"))}function bt(o,s){1&o&&(e.qSk(),e.j41(0,"svg",57)(1,"g",58),e.nrm(2,"path",59),e.k0s()())}const yt=[{path:"",component:V,resolve:{chats:()=>(0,e.WQX)(k).getChats(),contacts:()=>(0,e.WQX)(k).getContacts(),profile:()=>(0,e.WQX)(k).getProfile()},children:[{path:"",component:Ge,children:[{path:"",pathMatch:"full",component:Ee},{path:":id",component:(()=>{class o{constructor(t,n,i,r,a,l,u,d){this._changeDetectorRef=t,this._chatService=n,this._angorMediaWatcherService=i,this._ngZone=r,this._angorConfigService=a,this.dialog=l,this.sanitizer=u,this.parseContent=d,this.drawerMode="side",this.drawerOpened=!1,this._unsubscribeAll=new F.B,this.showEmojiPicker=!1,this.darkMode=!1,this.finalTranscript="",this.isListening=!1,this.userEdited=!1;const h=window.SpeechRecognition||window.webkitSpeechRecognition;h?(this.recognition=new h,this.recognition.lang="en-US",this.recognition.continuous=!0,this.recognition.interimResults=!0,this.setupRecognitionEvents()):console.error("Speech recognition is not supported in this browser.")}openGifDialog(){this.dialog.open(Ae,{width:"600px",maxHeight:"80vh",data:{apiKey:"LIVDSRZULELA"}}).afterClosed().subscribe(n=>{if(n){const i=n;i&&(this.messageInput.nativeElement.value="",this._chatService.sendPrivateMessage(i).then(()=>{this.messageInput.nativeElement.value="",this.finalTranscript=""}).catch(r=>{console.error("Failed to send message:",r)}),this.finalTranscript="",this.userEdited=!1)}})}ngOnInit(){this._angorConfigService.config$.subscribe(t=>{"auto"===t.scheme?this.detectSystemTheme():this.darkMode="dark"===t.scheme}),this._chatService.chat$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(t=>{this.chat=t,this._changeDetectorRef.markForCheck()}),this._angorMediaWatcherService.onMediaChange$.pipe((0,x.Q)(this._unsubscribeAll)).subscribe(({matchingAliases:t})=>{this.drawerMode=t.includes("lg")?"side":"over",this._changeDetectorRef.markForCheck()})}_resizeMessageInput(){this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.messageInput.nativeElement.style.height="auto",this._changeDetectorRef.detectChanges(),this.messageInput.nativeElement.style.height=`${this.messageInput.nativeElement.scrollHeight}px`,this._changeDetectorRef.detectChanges()})})}setupRecognitionEvents(){this.recognition.onresult=t=>{let n="";for(let i=t.resultIndex;i<t.results.length;i++){const r=t.results[i][0].transcript;t.results[i].isFinal?this.finalTranscript+=r:n+=r}this.userEdited||(this.messageInput.nativeElement.value=this.finalTranscript+n)},this.recognition.onerror=t=>{console.error("Speech recognition error detected: ",t.error)},this.recognition.onend=()=>{this.isListening=!1}}toggleSpeechRecognition(){this.finalTranscript="",this.isListening?(this.recognition.stop(),this.isListening=!1):(this.recognition.start(),this.isListening=!0,this.userEdited=!1)}handleUserInput(t){this.userEdited=!0}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}openContactInfo(){this.drawerOpened=!0,this._changeDetectorRef.markForCheck()}resetChat(){this._chatService.resetChat(),this.drawerOpened=!1,this._changeDetectorRef.markForCheck()}toggleMuteNotifications(){this.chat.muted=!this.chat.muted,this._chatService.updateChat(this.chat.id,this.chat).subscribe()}trackByFn(t,n){return n.id||t}detectSystemTheme(){const t=window.matchMedia("(prefers-color-scheme: dark)");this.darkMode=t.matches,t.addEventListener("change",n=>{this.darkMode=n.matches})}handleKeyDown(t){"Enter"===t.key&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}sendMessage(){const t=this.messageInput.nativeElement.value.trim();t&&(this.messageInput.nativeElement.value="",this._chatService.sendPrivateMessage(t).then(()=>{this.messageInput.nativeElement.value="",this.finalTranscript=""}).catch(n=>{console.error("Failed to send message:",n)}),this.finalTranscript="",this.userEdited=!1)}addEmoji(t){this.messageInput.nativeElement.value+=t.emoji.native,this.showEmojiPicker=!1}toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(e.gRc),e.rXU(k),e.rXU(Ue.l),e.rXU(e.SKi),e.rXU(Oe.P),e.rXU(N.bZ),e.rXU(Ve.up),e.rXU(Qe.m))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["chat-conversation"]],viewQuery:function(n,i){if(1&n&&e.GBs(Le,5),2&n){let r;e.mGM(r=e.lsd())&&(i.messageInput=r.first)}},hostBindings:function(n,i){1&n&&e.bIt("input",function(){return i._resizeMessageInput()})("ngModelChange",function(){return i._resizeMessageInput()})},standalone:!0,features:[e.aNF],decls:5,vars:1,consts:[["speechBubbleExtension",""],["drawer",""],["conversationHeaderMenu",""],["messageInput",""],[1,"bg-card","flex","flex-auto","flex-col","overflow-y-auto","dark:bg-default","lg:overflow-hidden"],[1,"h-full","flex-auto",3,"hasBackdrop"],[1,"flex","flex-auto","flex-col","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"w-full","dark:bg-gray-900","sm:w-100","lg:border-l","lg:shadow-none",3,"openedChange","autoFocus","mode","position","opened"],[3,"drawer","chat"],[1,"flex","flex-col","overflow-hidden"],[1,"flex","h-18","flex-0","items-center","border-b","bg-gray-50","px-4","dark:bg-transparent","md:px-6"],["mat-icon-button","",1,"md:-ml-2","lg:hidden",3,"click","routerLink"],[3,"svgIcon"],[1,"ml-2","mr-2","flex","cursor-pointer","items-center","lg:ml-0",3,"click"],[1,"relative","flex","h-10","w-10","flex-0","items-center","justify-center"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Contact picture",1,"h-full","w-full","rounded-full","object-cover",3,"src"],[1,"flex","h-full","w-full","items-center","justify-center","rounded-full","bg-gray-200","text-lg","uppercase","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","truncate","text-lg","font-medium","leading-5"],["mat-icon-button","",1,"ml-auto",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],[1,"flex","h-full","flex-col-reverse","overflow-y-auto"],[1,"bg-card","flex","flex-auto","shrink","flex-col","p-6","dark:bg-transparent"],[1,"flex","items-end","border-t","bg-gray-50","p-4","dark:bg-transparent"],[1,"my-px","flex","h-11","items-center"],["mat-icon-button","",3,"click"],["class","emoji-picker-container",4,"ngIf"],[3,"ngClass","svgIcon"],["subscriptSizing","dynamic",1,"angor-mat-dense","angor-mat-rounded","angor-mat-bold","ml-4","w-full"],["matInput","","cdkTextareaAutosize","",1,"max-h-20",3,"keydown"],[1,"my-px","ml-4","flex","h-11","items-center"],[1,"-mx-6","my-3","flex","items-center","justify-center"],[4,"ngIf"],[1,"flex-auto","border-b"],[1,"text-secondary","mx-4","flex-0","text-sm","font-medium","leading-5"],[1,"flex","flex-col",3,"ngClass"],[1,"relative","max-w-3/4","rounded-lg","px-2","py-2",3,"ngClass"],[1,"absolute","bottom-0","w-3",3,"ngClass"],["style","display: inline-block; overflow-wrap: break-word; white-space: pre-wrap;",4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-secondary","my-0.5","text-sm","font-medium",3,"ngClass"],[4,"ngTemplateOutlet"],[2,"display","inline-block","overflow-wrap","break-word","white-space","pre-wrap"],["style","display: block;",4,"ngIf"],["style","display: inline-block; overflow-wrap: break-word;",4,"ngIf"],[2,"display","block"],["width","560","height","315","frameborder","0","allowfullscreen","",3,"src"],["alt","Embedded Image",2,"max-width","100%",3,"src"],["controls","",2,"max-width","100%"],["type","video/mp4",3,"src"],["controls",""],["type","audio/mpeg",3,"src"],[2,"display","inline-block","overflow-wrap","break-word"],["target","_blank",3,"href"],[1,"emoji-picker-container"],[3,"emojiClick","darkMode"],[1,"icon-size-24",3,"svgIcon"],[1,"text-secondary","mt-4","text-2xl","font-semibold","tracking-tight"],["width","100%","height","100%","viewBox","0 0 66 66","xmlns","http://www.w3.org/2000/svg"],["id","Page-1","stroke","none","stroke-width","1","fill","none","fill-rule","evenodd"],["d","M1.01522827,0.516204834 C-8.83532715,54.3062744 61.7609863,70.5215302 64.8009949,64.3061218 C68.8074951,54.8859711 30.1663208,52.9997559 37.5036011,0.516204834 L1.01522827,0.516204834 Z","fill","currentColor","fill-rule","nonzero"]],template:function(n,i){1&n&&(e.j41(0,"div",4),e.DNE(1,_t,52,29,"mat-drawer-container",5)(2,Ct,4,1,"div",6)(3,bt,3,0,"ng-template",null,0,e.C5r),e.k0s()),2&n&&(e.R7$(),e.vxM(i.chat?1:2))},dependencies:[b.vg,b.qe,b.$C,b.$l,Ke,p.Hl,p.pQ,p.iY,C.Wk,f.m_,f.An,S.Cn,S.kk,S.fb,S.Cp,v.YU,v.T3,g.RG,g.rl,w.fS,w.fg,U.xb,U.EE,v.vh,Me.Ic,v.MD,v.Sq,v.bT],styles:[".c-img,.c-video{max-width:100%;border-radius:10px}\n"],encapsulation:2,changeDetection:0})}}return o})(),resolve:{conversation:(o,s)=>{const t=(0,e.WQX)(k),n=(0,e.WQX)(C.Ix);let i=o.paramMap.get("id")||localStorage.getItem("currentChatId");if(!i){const r=s.url.split("/").slice(0,-1).join("/");return n.navigateByUrl(r),(0,$.$)("No chat ID provided")}return localStorage.setItem("currentChatId",i),t.getChatById(i).pipe((0,B.W)(r=>{console.error("Error fetching conversation:",r);const a=s.url.split("/").slice(0,-1).join("/");return n.navigateByUrl(a),(0,$.$)(r)}))}}}]}]}]}}]);