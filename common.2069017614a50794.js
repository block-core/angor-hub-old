"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[76],{8098:(I,b,a)=>{a.d(b,{U:()=>o});var c=a(467),_=a(4412),h=a(4438),f=a(4930);let o=(()=>{class n{constructor(e){this._signerService=e,this.STORAGE_KEY="userBookmarkedProjects",this.bookmarksSubject=new _.t([]),this.bookmarks$=this.bookmarksSubject.asObservable(),this.currentUserPubKey=null,window.addEventListener("storage",t=>{t.key===this.STORAGE_KEY&&this.refreshBookmarksForCurrentUser()})}initializeForCurrentUser(){var e=this;return(0,c.A)(function*(){e.clearBookmarks(),e.currentUserPubKey=yield e._signerService.getPublicKey(),e.currentUserPubKey&&(yield e.loadBookmarksForCurrentUser())})()}clearBookmarks(){this.bookmarksSubject.next([])}loadBookmarksForCurrentUser(){var e=this;return(0,c.A)(function*(){if(!e.currentUserPubKey)return;const l=e.getUserBookmarks()[e.currentUserPubKey]||[];e.bookmarksSubject.next(l)})()}getUserBookmarks(){const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):{}}saveUserBookmarks(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}addBookmark(e){var t=this;return(0,c.A)(function*(){if(!t.currentUserPubKey&&(t.currentUserPubKey=yield t._signerService.getPublicKey(),!t.currentUserPubKey))return void console.warn("No public key found for the current user.");const l=t.getUserBookmarks(),m=l[t.currentUserPubKey]||[];m.includes(e)||(m.push(e),l[t.currentUserPubKey]=m,t.saveUserBookmarks(l),t.bookmarksSubject.next(m))})()}removeBookmark(e){var t=this;return(0,c.A)(function*(){if(!t.currentUserPubKey&&(t.currentUserPubKey=yield t._signerService.getPublicKey(),!t.currentUserPubKey))return void console.warn("No public key found for the current user.");const l=t.getUserBookmarks(),y=(l[t.currentUserPubKey]||[]).filter(E=>E!==e);l[t.currentUserPubKey]=y,t.saveUserBookmarks(l),t.bookmarksSubject.next(y)})()}isBookmarked(e){var t=this;return(0,c.A)(function*(){return t.currentUserPubKey||(t.currentUserPubKey=yield t._signerService.getPublicKey(),t.currentUserPubKey)?(t.getUserBookmarks()[t.currentUserPubKey]||[]).includes(e):(console.warn("No public key found for the current user."),!1)})()}getBookmarks(){var e=this;return(0,c.A)(function*(){return e.currentUserPubKey||(e.currentUserPubKey=yield e._signerService.getPublicKey(),e.currentUserPubKey)?e.getUserBookmarks()[e.currentUserPubKey]||[]:(console.warn("No public key found for the current user."),[])})()}removeAllBookmarks(){var e=this;return(0,c.A)(function*(){if(!e.currentUserPubKey&&(e.currentUserPubKey=yield e._signerService.getPublicKey(),!e.currentUserPubKey))return void console.warn("No public key found for the current user.");const t=e.getUserBookmarks();t[e.currentUserPubKey]=[],e.saveUserBookmarks(t),e.bookmarksSubject.next([])})()}refreshBookmarksForCurrentUser(){this.currentUserPubKey&&this.loadBookmarksForCurrentUser()}static{this.\u0275fac=function(t){return new(t||n)(h.KVO(f.A))}}static{this.\u0275prov=h.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},833:(I,b,a)=>{a.d(b,{F:()=>_});var c=a(4438);let _=(()=>{class h{constructor(){this.mainnetLocalStorageKey="mainnetIndexers",this.testnetLocalStorageKey="testnetIndexers",this.mainnetPrimaryIndexerKey="mainnetPrimaryIndexer",this.testnetPrimaryIndexerKey="testnetPrimaryIndexer",this.networkStorageKey="selectedNetwork",this.defaultMainnetIndexer="https://btc.indexer.angor.io/",this.defaultTestnetIndexer="https://tbtc.indexer.angor.io/",this.initializeDefaultIndexers()}initializeDefaultIndexers(){0===this.getIndexers("mainnet").length&&(this.addIndexer(this.defaultMainnetIndexer,"mainnet"),this.setPrimaryIndexer(this.defaultMainnetIndexer,"mainnet")),0===this.getIndexers("testnet").length&&(this.addIndexer(this.defaultTestnetIndexer,"testnet"),this.setPrimaryIndexer(this.defaultTestnetIndexer,"testnet"))}addIndexer(o,n){let u=this.getIndexers(n);u.includes(o)||(u.push(o),this.saveIndexers(u,n))}getIndexers(o){return JSON.parse(localStorage.getItem("mainnet"===o?this.mainnetLocalStorageKey:this.testnetLocalStorageKey)||"[]")}saveIndexers(o,n){localStorage.setItem("mainnet"===n?this.mainnetLocalStorageKey:this.testnetLocalStorageKey,JSON.stringify(o))}setPrimaryIndexer(o,n){this.getIndexers(n).includes(o)&&localStorage.setItem("mainnet"===n?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey,o)}getPrimaryIndexer(o){return localStorage.getItem("mainnet"===o?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey)}removeIndexer(o,n){let u=this.getIndexers(n);const e=u.indexOf(o);-1!==e&&(u.splice(e,1),this.saveIndexers(u,n),o===this.getPrimaryIndexer(n))&&localStorage.removeItem("mainnet"===n?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey)}clearAllIndexers(o){const u="mainnet"===o?this.mainnetPrimaryIndexerKey:this.testnetPrimaryIndexerKey;localStorage.removeItem("mainnet"===o?this.mainnetLocalStorageKey:this.testnetLocalStorageKey),localStorage.removeItem(u)}setNetwork(o){localStorage.setItem(this.networkStorageKey,o)}getNetwork(){return localStorage.getItem(this.networkStorageKey)||"testnet"}static{this.\u0275fac=function(n){return new(n||h)}}static{this.\u0275prov=c.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},2827:(I,b,a)=>{a.d(b,{T:()=>m});var c=a(467),_=a(1413),h=a(4412),f=a(152),o=a(2498),n=a(6977),u=a(8418),e=a(4438),t=a(5645),l=a(7291);let m=(()=>{class y{constructor(r,s){this.subscriptionService=r,this.storageService=s,this.BATCH_SIZE=50,this.PROCESS_INTERVAL=2e3,this.MAX_RETRY_ATTEMPTS=3,this.publicKeyQueue=new Set,this.processingSubject=new _.B,this._unsubscribeAll=new _.B,this.processingStatus=new h.t([]),this.processingStatus$=this.processingStatus.asObservable(),this.initializeService()}initializeService(){var r=this;return(0,c.A)(function*(){try{yield r.loadStoredPublicKeys(),r.setupQueueProcessor()}catch(s){console.error("Failed to initialize metadata service:",s)}})()}setupQueueProcessor(){this.processingSubject.pipe((0,f.B)(this.PROCESS_INTERVAL),(0,o.L)(this.MAX_RETRY_ATTEMPTS),(0,n.Q)(this._unsubscribeAll)).subscribe(()=>this.processQueue())}addPublicKey(r){this.isValidPublicKey(r)?this.publicKeyQueue.has(r)||(this.publicKeyQueue.add(r),this.processingSubject.next()):console.warn("Invalid public key format:",r)}addPublicKeys(r){const s=r.filter(i=>this.isValidPublicKey(i));s.forEach(i=>this.publicKeyQueue.add(i)),s.length>0&&this.processingSubject.next()}isValidPublicKey(r){return/^[0-9a-f]{64}$/.test(r)}loadStoredPublicKeys(){var r=this;return(0,c.A)(function*(){try{const i=(yield r.storageService.getAllProfiles()).filter(d=>d.pubKey&&r.isValidPublicKey(d.pubKey));i.forEach(d=>{r.publicKeyQueue.add(d.pubKey)}),i.length>0&&r.processingSubject.next()}catch(s){throw console.error("Error loading stored public keys:",s),s}})()}processQueue(){var r=this;return(0,c.A)(function*(){if(0===r.publicKeyQueue.size)return;const s=r.getBatches(Array.from(r.publicKeyQueue));r.publicKeyQueue.clear();const i=[];for(const d of s)try{yield r.processBatch(d,i)}catch(P){console.error("Error processing batch:",P),d.forEach(k=>{i.push({success:!1,pubkey:k,error:"Batch processing failed"})})}r.processingStatus.next(i)})()}getBatches(r){const s=[];for(let i=0;i<r.length;i+=this.BATCH_SIZE)s.push(r.slice(i,i+this.BATCH_SIZE));return s}processBatch(r,s){var i=this;return(0,c.A)(function*(){const d={kinds:[u.OS],authors:r};return new Promise(P=>{let k=0;const v=r.length,p=setTimeout(()=>{g("Batch processing timeout")},1e4),B=i.subscriptionService.addSubscriptions([d],K=>{k++,i.handleMetadataEvent(K,s),k===v&&g()},()=>{g()}),g=K=>{clearTimeout(p),i.subscriptionService.removeSubscriptionById(B),r.forEach(S=>{s.some(U=>U.pubkey===S)||s.push({success:!1,pubkey:S,error:K||"Event not received"})}),P()}})})()}handleMetadataEvent(r,s){try{const i=this.parseMetadataEvent(r);i?(this.storageService.saveProfile(r.pubkey,i),s.push({success:!0,pubkey:r.pubkey})):s.push({success:!1,pubkey:r.pubkey,error:"Invalid metadata format"})}catch{s.push({success:!1,pubkey:r.pubkey,error:"Processing error"})}}parseMetadataEvent(r){try{const s=JSON.parse(r.content);if("object"!=typeof s||null===s)return null;if(s.name&&(s.name=s.name.trim()),s.about&&(s.about=s.about.trim()),s.picture)try{new URL(s.picture)}catch{delete s.picture}return s}catch{return null}}clearQueue(){this.publicKeyQueue.clear()}ngOnDestroy(){this.clearQueue(),this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static{this.\u0275fac=function(s){return new(s||y)(e.KVO(t.n),e.KVO(l.n))}}static{this.\u0275prov=e.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})()}}]);