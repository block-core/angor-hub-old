"use strict";(self.webpackChunkangor=self.webpackChunkangor||[]).push([[907],{5907:(H,x,i)=>{i.r(x),i.d(x,{default:()=>Q});var l=i(467),m=i(8834),M=i(6600),j=i(2102),y=i(9213),P=i(9042),$=i(7575),I=i(2798),b=i(450),D=i(4823),N=i(5167),g=i(177),k=i(1413),S=i(6977),e=i(3953),E=i(9437),C=i(7673),w=i(1626),A=i(833),F=i(4224);let B=(()=>{class n{constructor(t,r,o){this.http=t,this.indexerService=r,this.indexedDBService=o,this.offset=0,this.limit=20,this.totalProjects=0,this.loading=!1,this.projects=[],this.noMoreProjects=!1,this.totalProjectsFetched=!1,this.selectedNetwork="testnet",this.loadNetwork()}loadNetwork(){this.selectedNetwork=this.indexerService.getNetwork()}fetchProjects(){var t=this;return(0,l.A)(function*(){if(t.loading||t.noMoreProjects)return[];t.loading=!0;const r=t.indexerService.getPrimaryIndexer(t.selectedNetwork),o=t.totalProjectsFetched?`${r}api/query/Angor/projects?offset=${t.offset}&limit=${t.limit}`:`${r}api/query/Angor/projects?limit=${t.limit}`;try{const s=yield t.http.get(o,{observe:"response"}).toPromise();if(!t.totalProjectsFetched&&s&&s.headers){const h=s.headers.get("pagination-total");t.totalProjects=h?+h:0,t.totalProjectsFetched=!0,t.offset=Math.max(t.totalProjects-t.limit,0)}const c=s?.body||[];if(!c.length)return t.noMoreProjects=!0,[];const a=c.filter(h=>!t.projects.some(f=>f.projectIdentifier===h.projectIdentifier));if(!a.length)return t.noMoreProjects=!0,[];const d=a.map(function(){var h=(0,l.A)(function*(f){yield t.indexedDBService.saveProject(f)});return function(f){return h.apply(this,arguments)}}()),u=a.map(function(){var h=(0,l.A)(function*(f){try{const v=yield t.indexedDBService.getProjectStats(f.projectIdentifier);return f.totalInvestmentsCount=v?.investorCount??0,f}catch(v){return console.error(`Error fetching details for project ${f.projectIdentifier}:`,v),f}});return function(f){return h.apply(this,arguments)}}());return yield Promise.all([...d,...u]),t.projects=[...t.projects,...a],t.offset=Math.max(t.offset-t.limit,0),a}catch(s){return console.error("Error fetching projects:",s),[]}finally{t.loading=!1}})()}fetchProjectStats(t){const o=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${t}/stats`;return this.http.get(o).pipe((0,E.W)(s=>(console.error(`Error fetching stats for project ${t}:`,s),(0,C.of)({}))))}fetchAndSaveProjectStats(t){var r=this;return(0,l.A)(function*(){try{const o=yield r.fetchProjectStats(t).toPromise();return o&&(yield r.indexedDBService.saveProjectStats(t,o)),o}catch(o){return console.error(`Error fetching and saving stats for project ${t}:`,o),null}})()}fetchProjectDetails(t){const o=`${this.indexerService.getPrimaryIndexer(this.selectedNetwork)}api/query/Angor/projects/${t}`;return this.http.get(o).pipe((0,E.W)(s=>(console.error(`Error fetching details for project ${t}:`,s),(0,C.of)({}))))}fetchAndSaveProjectDetails(t){var r=this;return(0,l.A)(function*(){try{const o=yield r.fetchProjectDetails(t).toPromise();return o&&(yield r.indexedDBService.saveProject(o)),o}catch(o){return console.error(`Error fetching and saving details for project ${t}:`,o),null}})()}getAllProjectsFromDB(){var t=this;return(0,l.A)(function*(){return t.indexedDBService.getAllProjects()})()}getProjectStatsFromDB(t){var r=this;return(0,l.A)(function*(){return r.indexedDBService.getProjectStats(t)})()}getProjects(){return this.projects}resetProjects(){this.projects=[],this.noMoreProjects=!1,this.offset=0,this.totalProjectsFetched=!1}static#t=this.\u0275fac=function(r){return new(r||n)(e.KVO(w.Qq),e.KVO(A.F),e.KVO(F.n))};static#e=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var R=i(9192),U=i(4412);let T=(()=>{class n{constructor(){this.projects=[],this.projectsSubject=new U.t([])}getProjectsObservable(){return this.projectsSubject.asObservable()}setProjects(t){this.projects=t,this.projectsSubject.next(this.projects)}getProjects(){return this.projects}hasProjects(){return this.projects.length>0}updateProject(t){const r=this.projects.findIndex(o=>o.nostrPubKey===t.nostrPubKey);r>-1?this.projects[r]=t:this.projects.push(t),this.projectsSubject.next(this.projects)}getProjectByPubKey(t){return this.projects.find(r=>r.nostrPubKey===t)}static#t=this.\u0275fac=function(r){return new(r||n)};static#e=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var K=i(1553),G=i(345),V=i(7253);const X=()=>[],Y=n=>({"-ml-3":n});function O(n,p){if(1&n){const t=e.RV6();e.j41(0,"div",35)(1,"button",39),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,s=e.XpG();return e.Njj(s.openChat(o.nostrPubKey))}),e.nrm(2,"mat-icon",40),e.k0s()()}2&n&&(e.R7$(2),e.Y8G("svgIcon","heroicons_outline:chat-bubble-left-right"))}function z(n,p){if(1&n&&(e.qex(0),e.nrm(1,"img",41),e.bVm()),2&n){const t=p.index,r=e.XpG().$implicit;e.R7$(),e.Mz_("alt","Investor avatar ",t+1,""),e.Y8G("ngClass",e.eq3(4,Y,r.totalInvestmentsCount>1&&t>0))("src","images/avatars/avatar-placeholder.png",e.B4B)}}function L(n,p){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"angor-card",24)(2,"div",25),e.nrm(3,"img",26),e.k0s(),e.j41(4,"div",27)(5,"div",28),e.nrm(6,"img",29),e.k0s()(),e.j41(7,"div",30)(8,"div",31)(9,"div",32)(10,"div",33),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.goToProjectDetails(o))}),e.EFF(11),e.k0s(),e.j41(12,"div",34),e.EFF(13),e.k0s()(),e.DNE(14,O,3,1,"div",35),e.k0s(),e.nrm(15,"hr",36),e.j41(16,"div",31)(17,"div",37),e.EFF(18),e.k0s(),e.j41(19,"div",38),e.DNE(20,z,2,6,"ng-container",20),e.k0s()()()(),e.bVm()}if(2&n){const t=p.$implicit,r=e.XpG();e.R7$(3),e.Y8G("src",r.getSafeUrl(null==t?null:t.banner,!0)||"images/pages/profile/cover.jpg",e.B4B),e.R7$(3),e.Y8G("src",r.getSafeUrl(null==t?null:t.picture,!1)||"images/avatars/avatar-placeholder.png",e.B4B),e.R7$(5),e.SpI(" ",t.displayName||t.nostrPubKey," "),e.R7$(2),e.SpI(" ",t.about||"No description available"," "),e.R7$(),e.vxM(t.displayName||t.name?14:-1),e.R7$(4),e.SpI(" ",t.totalInvestmentsCount||0," investors "),e.R7$(2),e.Y8G("ngForOf",e.lJ4(7,X).constructor(t.totalInvestmentsCount||0))}}function W(n,p){if(1&n&&(e.j41(0,"div",42),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.errorMessage," ")}}const Q=[{path:"",component:(()=>{class n{constructor(t,r,o,s,c,a,d,u){this.projectService=t,this.router=r,this.stateService=o,this.metadataService=s,this.indexedDBService=c,this.changeDetectorRef=a,this.sanitizer=d,this._chatService=u,this.projects=[],this.errorMessage="",this.loading=!1,this.metadataLoadLimit=5,this._unsubscribeAll=new k.B,this.filteredProjects=[]}ngOnInit(){var t=this;return(0,l.A)(function*(){t.loadInitialProjects(),t.subscribeToMetadataUpdates()})()}loadInitialProjects(){var t=this;return(0,l.A)(function*(){try{if(t.loading=!0,t.projects=t.stateService.getProjects(),0===t.projects.length)yield t.loadProjectsFromService();else{t.filteredProjects=[...t.projects];const r=t.getProjectsWithoutMetadata();r.length>0&&(yield t.loadMetadataForProjects(r))}}catch{t.handleError("Error loading initial projects")}finally{t.loading=!1,t.changeDetectorRef.detectChanges()}})()}loadProjectsFromService(){var t=this;return(0,l.A)(function*(){try{const r=yield t.projectService.fetchProjects();if(0===r.length)return void(t.errorMessage="No projects found");t.projects=r,t.filteredProjects=[...t.projects],t.stateService.setProjects(t.projects);const o=r.map(s=>s.nostrPubKey);yield t.loadMetadataForProjects(o)}catch{t.handleError("Error fetching projects from service")}})()}subscribeToMetadataUpdates(){this.indexedDBService.getMetadataStream().pipe((0,S.Q)(this._unsubscribeAll)).subscribe(t=>{if(t){const r=this.projects.find(o=>o.nostrPubKey===t.pubkey);r&&this.updateProjectMetadata(r,t.metadata)}})}getProjectsWithoutMetadata(){return this.projects.filter(t=>!t.displayName||!t.about).map(t=>t.nostrPubKey)}loadMetadataForProjects(t){var r=this;return(0,l.A)(function*(){const o=t.map(function(){var a=(0,l.A)(function*(d){const u=yield r.indexedDBService.getUserMetadata(d);return u?{pubkey:d,metadata:u}:null});return function(d){return a.apply(this,arguments)}}()),s=yield Promise.all(o),c=s.filter(a=>null===a).map((a,d)=>t[d]);s.forEach(a=>{if(a&&a.metadata){const d=r.projects.find(u=>u.nostrPubKey===a.pubkey);d&&r.updateProjectMetadata(d,a.metadata)}}),c.length>0&&(yield r.metadataService.fetchMetadataForMultipleKeys(c).then(a=>{a.forEach(d=>{const u=r.projects.find(h=>h.nostrPubKey===d.pubkey);u&&r.updateProjectMetadata(u,d)}),r.changeDetectorRef.detectChanges()}).catch(a=>{console.error("Error fetching metadata for projects:",a)}))})()}loadProjects(){var t=this;return(0,l.A)(function*(){t.loading||"No more projects found"===t.errorMessage||(t.loading=!0,t.projectService.fetchProjects().then(function(){var r=(0,l.A)(function*(o){if(0===o.length&&0===t.projects.length)t.errorMessage="No projects found";else if(0===o.length)t.errorMessage="No more projects found";else{t.projects=[...t.projects,...o],t.filteredProjects=[...t.projects];const s=o.map(c=>c.nostrPubKey);yield t.loadMetadataForProjects(s),t.stateService.setProjects(t.projects),t.projects.forEach(c=>t.subscribeToProjectMetadata(c))}t.loading=!1,t.changeDetectorRef.detectChanges()});return function(o){return r.apply(this,arguments)}}()).catch(r=>{console.error("Error fetching projects:",r),t.errorMessage="Error fetching projects. Please try again later.",t.loading=!1,t.changeDetectorRef.detectChanges()}))})()}loadMetadataForProject(t){var r=this;return(0,l.A)(function*(){try{const o=yield r.metadataService.fetchMetadataWithCache(t.nostrPubKey);o?r.updateProjectMetadata(t,o):console.warn(`No metadata found for project ${t.nostrPubKey}`)}catch(o){console.error(`Error fetching metadata for project ${t.nostrPubKey}:`,o)}})()}updateProjectMetadata(t,r){const o={...t,displayName:r.name||"",about:r.about?r.about.replace(/<\/?[^>]+(>|$)/g,""):"",picture:r.picture||"",banner:r.banner||""},s=this.projects.findIndex(c=>c.projectIdentifier===t.projectIdentifier);-1!==s&&(this.projects[s]=o,this.projects=[...this.projects]),this.filteredProjects=[...this.projects],this.changeDetectorRef.detectChanges()}subscribeToProjectMetadata(t){this.metadataService.getMetadataStream().pipe((0,S.Q)(this._unsubscribeAll)).subscribe(r=>{r&&r.pubkey===t.nostrPubKey&&this.updateProjectMetadata(t,r.metadata)})}goToProjectDetails(t){this.router.navigate(["/profile",t.nostrPubKey])}filterByQuery(t){this.filteredProjects=t?this.projects.filter(r=>r.displayName?.toLowerCase().includes(t.toLowerCase())||r.about?.toLowerCase().includes(t.toLowerCase())):[...this.projects]}toggleCompleted(t){}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}handleError(t){console.error(t),this.errorMessage=t,this.loading=!1,this.changeDetectorRef.detectChanges()}getSafeUrl(t,r){return t&&"string"==typeof t&&this.isImageUrl(t)?this.sanitizer.bypassSecurityTrustUrl(t):this.sanitizer.bypassSecurityTrustUrl(r?"/images/pages/profile/cover.jpg":"images/avatars/avatar-placeholder.png")}isImageUrl(t){return/\.(jpeg|jpg|gif|png|svg|bmp|webp|tiff|ico)$/i.test(t)}openChat(t){var r=this;return(0,l.A)(function*(){try{const o=yield r.metadataService.fetchMetadataWithCache(t);if(o){const s={pubKey:t,name:o.name||"Unknown",picture:o.picture||"/images/avatars/avatar-placeholder.png",about:o.about||"",displayName:o.displayName||o.name||"Unknown"};r._chatService.getChatById(s.pubKey,s).subscribe(c=>{r.router.navigate(["/chat",s.pubKey])})}else console.error("No metadata found for the public key:",t)}catch(o){console.error("Error opening chat:",o)}})()}static#t=this.\u0275fac=function(r){return new(r||n)(e.rXU(B),e.rXU(R.Ix),e.rXU(T),e.rXU(K.T),e.rXU(F.n),e.rXU(e.gRc),e.rXU(G.up),e.rXU(V.m))};static#e=this.\u0275cmp=e.VBU({type:n,selectors:[["explore"]],standalone:!0,features:[e.aNF],decls:29,vars:7,consts:[["query",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-y-auto"],[1,"dark","relative","flex-0","overflow-hidden","bg-gray-800","px-4","py-8","sm:p-16"],["viewBox","0 0 960 540","width","100%","height","100%","preserveAspectRatio","xMidYMax slice","xmlns","http://www.w3.org/2000/svg",1,"absolute","inset-0","pointer-events-none"],["fill","none","stroke","currentColor","stroke-width","100",1,"text-gray-700","opacity-25"],["r","234","cx","196","cy","23"],["r","234","cx","790","cy","491"],[1,"relative","z-10","flex","flex-col","items-center"],[1,"text-xl","font-semibold"],[1,"mt-1","text-center","text-4xl","font-extrabold","leading-tight","tracking-tight","sm:text-7xl"],[1,"text-secondary","mt-6","max-w-2xl","text-center","tracking-tight","sm:text-2xl"],[1,"p-6","sm:p-10"],[1,"mx-auto","flex","w-full","max-w-xs","flex-auto","flex-col","sm:max-w-5xl"],[1,"flex","w-full","max-w-xs","flex-col","items-center","justify-between","sm:max-w-none","sm:flex-row"],[1,"mt-4","w-full","sm:mt-0","sm:w-72",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["placeholder","Search ...","matInput","",3,"input"],[1,"mt-8","sm:ml-auto","sm:mt-0",3,"change","color"],[1,"mx-auto","flex","w-full","flex-auto","flex-col","sm:max-w-5xl"],[1,"grid","w-full","min-w-0","grid-cols-1","gap-6","sm:grid-cols-1","md:grid-cols-1","lg:grid-cols-2","mt-10"],[4,"ngFor","ngForOf"],[1,"flex","justify-center","mt-10"],["mat-raised-button","","color","primary",3,"click","disabled"],["class","error-message",4,"ngIf"],[1,"filter-info","flex","w-full","flex-col"],[1,"flex","h-32"],["onerror","this.onerror=null; this.src='/images/pages/profile/cover.jpg';","alt","Card cover image",1,"object-cover",3,"src"],[1,"flex","px-8"],[1,"bg-card","-mt-12","rounded-full","p-1"],["onerror","this.onerror=null; this.src='/images/avatars/avatar-placeholder.png';","alt","Project logo",1,"h-24","w-24","rounded-full","object-cover",3,"src"],[1,"flex","flex-col","px-8","pb-6","pt-4"],[1,"flex","items-center","justify-between"],[1,"mr-4","flex-1","min-w-0"],["role","button",1,"text-2xl","font-semibold","leading-tight","truncate",3,"click"],[1,"text-secondary","mt-1","leading-tight","truncate"],[1,"flex","h-10","w-10","items-center","justify-center","rounded-full","border"],[1,"my-6","w-full","border-t"],[1,"text-secondary","mr-3","text-md","font-medium"],[1,"flex","items-center"],["mat-icon-button","",3,"click"],[1,"icon-size-5",3,"svgIcon"],[1,"text-card","ring-bg-card","m-0.5","h-6","w-6","rounded-full","ring-2",3,"ngClass","src","alt"],[1,"error-message"]],template:function(r,o){if(1&r){const s=e.RV6();e.j41(0,"div",1)(1,"div",2),e.qSk(),e.j41(2,"svg",3)(3,"g",4),e.nrm(4,"circle",5)(5,"circle",6),e.k0s()(),e.joV(),e.j41(6,"div",7)(7,"h2",8),e.EFF(8,"Explore Projects"),e.k0s(),e.j41(9,"div",9),e.EFF(10," What\u2019s your next investment? "),e.k0s(),e.j41(11,"div",10),e.EFF(12," Check out our projects and find your next investment opportunity. "),e.k0s()()(),e.j41(13,"div",11)(14,"div",12)(15,"div",13)(16,"mat-form-field",14),e.nrm(17,"mat-icon",15),e.j41(18,"input",16,0),e.bIt("input",function(){e.eBV(s);const a=e.sdS(19);return e.Njj(o.filterByQuery(a.value))}),e.k0s()(),e.j41(20,"mat-slide-toggle",17),e.bIt("change",function(a){return e.eBV(s),e.Njj(o.toggleCompleted(a))}),e.EFF(21," Hide completed "),e.k0s()()(),e.j41(22,"div",18)(23,"div",19),e.DNE(24,L,21,8,"ng-container",20),e.k0s(),e.j41(25,"div",21)(26,"button",22),e.bIt("click",function(){return e.eBV(s),e.Njj(o.loadProjects())}),e.EFF(27),e.k0s()(),e.DNE(28,W,2,1,"div",23),e.k0s()()()}2&r&&(e.R7$(16),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","heroicons_solid:magnifying-glass"),e.R7$(3),e.Y8G("color","primary"),e.R7$(4),e.Y8G("ngForOf",o.projects),e.R7$(2),e.Y8G("disabled",o.loading),e.R7$(),e.SpI(" ",o.loading?"Loading...":"Load More Projects"," "),e.R7$(),e.Y8G("ngIf",!o.loading&&o.errorMessage))},dependencies:[m.Hl,m.$z,m.iY,y.m_,y.An,N.n,j.RG,j.rl,j.JW,I.Ve,M.Sy,P.fS,P.fg,b.mV,b.sG,g.YU,D.uc,$.PO,g.MD,g.Sq,g.bT],encapsulation:2})}return n})()}]}}]);